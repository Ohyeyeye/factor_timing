2025-04-17 16:53:53,285 - INFO - Starting factor timing strategy optimization...
2025-04-17 16:53:53,285 - INFO - Running parameter grid search...
2025-04-17 16:53:53,285 - INFO - 
Running strategy with lstm classifier and mean_variance optimizer
2025-04-17 16:53:53,285 - INFO - Initializing strategy...
2025-04-17 16:53:59,418 - INFO - Running strategy...
2025-04-17 16:53:59,432 - ERROR - Error running lstm with mean_variance: Missing required columns in Fama-French factors data: ['date']
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 53, in prepare_data
    train_factors = self.data_loader.load_fama_french_factors(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 113, in load_fama_french_factors
    self._validate_dataframe(self.ff_factors, required_columns, "Fama-French factors")
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 74, in _validate_dataframe
    raise ValueError(f"Missing required columns in {data_type} data: {missing_cols}")
ValueError: Missing required columns in Fama-French factors data: ['date']
2025-04-17 16:53:59,434 - INFO - 
Running strategy with lstm classifier and neural optimizer
2025-04-17 16:53:59,434 - INFO - Initializing strategy...
2025-04-17 16:53:59,437 - INFO - Running strategy...
2025-04-17 16:53:59,440 - ERROR - Error running lstm with neural: Missing required columns in Fama-French factors data: ['date']
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 53, in prepare_data
    train_factors = self.data_loader.load_fama_french_factors(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 113, in load_fama_french_factors
    self._validate_dataframe(self.ff_factors, required_columns, "Fama-French factors")
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 74, in _validate_dataframe
    raise ValueError(f"Missing required columns in {data_type} data: {missing_cols}")
ValueError: Missing required columns in Fama-French factors data: ['date']
2025-04-17 16:53:59,441 - INFO - 
Running strategy with xgboost classifier and mean_variance optimizer
2025-04-17 16:53:59,441 - INFO - Initializing strategy...
2025-04-17 16:53:59,610 - INFO - Running strategy...
2025-04-17 16:53:59,613 - ERROR - Error running xgboost with mean_variance: Missing required columns in Fama-French factors data: ['date']
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 53, in prepare_data
    train_factors = self.data_loader.load_fama_french_factors(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 113, in load_fama_french_factors
    self._validate_dataframe(self.ff_factors, required_columns, "Fama-French factors")
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 74, in _validate_dataframe
    raise ValueError(f"Missing required columns in {data_type} data: {missing_cols}")
ValueError: Missing required columns in Fama-French factors data: ['date']
2025-04-17 16:53:59,614 - INFO - 
Running strategy with xgboost classifier and neural optimizer
2025-04-17 16:53:59,614 - INFO - Initializing strategy...
2025-04-17 16:53:59,615 - INFO - Running strategy...
2025-04-17 16:53:59,618 - ERROR - Error running xgboost with neural: Missing required columns in Fama-French factors data: ['date']
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 53, in prepare_data
    train_factors = self.data_loader.load_fama_french_factors(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 113, in load_fama_french_factors
    self._validate_dataframe(self.ff_factors, required_columns, "Fama-French factors")
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 74, in _validate_dataframe
    raise ValueError(f"Missing required columns in {data_type} data: {missing_cols}")
ValueError: Missing required columns in Fama-French factors data: ['date']
2025-04-17 16:53:59,618 - INFO - 
Running strategy with hmm classifier and mean_variance optimizer
2025-04-17 16:53:59,619 - INFO - Initializing strategy...
2025-04-17 16:54:00,127 - INFO - Running strategy...
2025-04-17 16:54:00,130 - ERROR - Error running hmm with mean_variance: Missing required columns in Fama-French factors data: ['date']
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 53, in prepare_data
    train_factors = self.data_loader.load_fama_french_factors(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 113, in load_fama_french_factors
    self._validate_dataframe(self.ff_factors, required_columns, "Fama-French factors")
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 74, in _validate_dataframe
    raise ValueError(f"Missing required columns in {data_type} data: {missing_cols}")
ValueError: Missing required columns in Fama-French factors data: ['date']
2025-04-17 16:54:00,132 - INFO - 
Running strategy with hmm classifier and neural optimizer
2025-04-17 16:54:00,132 - INFO - Initializing strategy...
2025-04-17 16:54:00,133 - INFO - Running strategy...
2025-04-17 16:54:00,136 - ERROR - Error running hmm with neural: Missing required columns in Fama-French factors data: ['date']
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 53, in prepare_data
    train_factors = self.data_loader.load_fama_french_factors(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 113, in load_fama_french_factors
    self._validate_dataframe(self.ff_factors, required_columns, "Fama-French factors")
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 74, in _validate_dataframe
    raise ValueError(f"Missing required columns in {data_type} data: {missing_cols}")
ValueError: Missing required columns in Fama-French factors data: ['date']
2025-04-17 16:54:00,137 - ERROR - No valid results obtained from parameter grid search
2025-04-17 16:54:00,137 - INFO - Factor timing strategy optimization completed
2025-04-17 16:54:40,664 - INFO - Starting factor timing strategy optimization...
2025-04-17 16:54:40,665 - INFO - Running parameter grid search...
2025-04-17 16:54:40,665 - INFO - 
Running strategy with lstm classifier and mean_variance optimizer
2025-04-17 16:54:40,665 - INFO - Initializing strategy...
2025-04-17 16:54:41,553 - INFO - Running strategy...
2025-04-17 16:54:41,567 - ERROR - Error running lstm with mean_variance: Error reading macro data files: 'date'
Traceback (most recent call last):
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'date'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 159, in load_macro_data
    cpi['date'] = pd.to_datetime(cpi['date'])
                                 ~~~^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4102, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'date'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 59, in prepare_data
    train_macro = self.data_loader.load_macro_data(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 173, in load_macro_data
    raise ValueError(f"Error reading macro data files: {str(e)}")
ValueError: Error reading macro data files: 'date'
2025-04-17 16:54:41,571 - INFO - 
Running strategy with lstm classifier and neural optimizer
2025-04-17 16:54:41,572 - INFO - Initializing strategy...
2025-04-17 16:54:41,573 - INFO - Running strategy...
2025-04-17 16:54:41,584 - ERROR - Error running lstm with neural: Error reading macro data files: 'date'
Traceback (most recent call last):
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'date'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 159, in load_macro_data
    cpi['date'] = pd.to_datetime(cpi['date'])
                                 ~~~^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4102, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'date'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 59, in prepare_data
    train_macro = self.data_loader.load_macro_data(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 173, in load_macro_data
    raise ValueError(f"Error reading macro data files: {str(e)}")
ValueError: Error reading macro data files: 'date'
2025-04-17 16:54:41,586 - INFO - 
Running strategy with xgboost classifier and mean_variance optimizer
2025-04-17 16:54:41,586 - INFO - Initializing strategy...
2025-04-17 16:54:41,607 - INFO - Running strategy...
2025-04-17 16:54:41,618 - ERROR - Error running xgboost with mean_variance: Error reading macro data files: 'date'
Traceback (most recent call last):
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'date'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 159, in load_macro_data
    cpi['date'] = pd.to_datetime(cpi['date'])
                                 ~~~^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4102, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'date'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 59, in prepare_data
    train_macro = self.data_loader.load_macro_data(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 173, in load_macro_data
    raise ValueError(f"Error reading macro data files: {str(e)}")
ValueError: Error reading macro data files: 'date'
2025-04-17 16:54:41,620 - INFO - 
Running strategy with xgboost classifier and neural optimizer
2025-04-17 16:54:41,620 - INFO - Initializing strategy...
2025-04-17 16:54:41,621 - INFO - Running strategy...
2025-04-17 16:54:41,631 - ERROR - Error running xgboost with neural: Error reading macro data files: 'date'
Traceback (most recent call last):
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'date'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 159, in load_macro_data
    cpi['date'] = pd.to_datetime(cpi['date'])
                                 ~~~^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4102, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'date'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 59, in prepare_data
    train_macro = self.data_loader.load_macro_data(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 173, in load_macro_data
    raise ValueError(f"Error reading macro data files: {str(e)}")
ValueError: Error reading macro data files: 'date'
2025-04-17 16:54:41,633 - INFO - 
Running strategy with hmm classifier and mean_variance optimizer
2025-04-17 16:54:41,634 - INFO - Initializing strategy...
2025-04-17 16:54:41,662 - INFO - Running strategy...
2025-04-17 16:54:41,674 - ERROR - Error running hmm with mean_variance: Error reading macro data files: 'date'
Traceback (most recent call last):
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'date'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 159, in load_macro_data
    cpi['date'] = pd.to_datetime(cpi['date'])
                                 ~~~^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4102, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'date'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 59, in prepare_data
    train_macro = self.data_loader.load_macro_data(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 173, in load_macro_data
    raise ValueError(f"Error reading macro data files: {str(e)}")
ValueError: Error reading macro data files: 'date'
2025-04-17 16:54:41,676 - INFO - 
Running strategy with hmm classifier and neural optimizer
2025-04-17 16:54:41,676 - INFO - Initializing strategy...
2025-04-17 16:54:41,677 - INFO - Running strategy...
2025-04-17 16:54:41,686 - ERROR - Error running hmm with neural: Error reading macro data files: 'date'
Traceback (most recent call last):
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'date'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 159, in load_macro_data
    cpi['date'] = pd.to_datetime(cpi['date'])
                                 ~~~^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4102, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'date'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 59, in prepare_data
    train_macro = self.data_loader.load_macro_data(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 173, in load_macro_data
    raise ValueError(f"Error reading macro data files: {str(e)}")
ValueError: Error reading macro data files: 'date'
2025-04-17 16:54:41,688 - ERROR - No valid results obtained from parameter grid search
2025-04-17 16:54:41,689 - INFO - Factor timing strategy optimization completed
2025-04-17 16:55:51,927 - INFO - Starting factor timing strategy optimization...
2025-04-17 16:55:51,928 - INFO - Running parameter grid search...
2025-04-17 16:55:51,928 - INFO - 
Running strategy with lstm classifier and mean_variance optimizer
2025-04-17 16:55:51,928 - INFO - Initializing strategy...
2025-04-17 16:55:52,868 - INFO - Running strategy...
2025-04-17 16:55:52,889 - WARNING - US corporate credit spread file not found
2025-04-17 16:55:52,889 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:55:52,892 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 16:55:52,892 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 16:55:52,900 - WARNING - US corporate credit spread file not found
2025-04-17 16:55:52,901 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:55:52,903 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 16:55:52,903 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 16:55:56,009 - ERROR - Error running lstm with mean_variance: Error downloading market data: 'Adj Close'
Traceback (most recent call last):
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Adj Close'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 273, in load_market_data
    sp500_returns = sp500['Adj Close'].pct_change()
                    ~~~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4101, in __getitem__
    return self._getitem_multilevel(key)
           ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4159, in _getitem_multilevel
    loc = self.columns.get_loc(key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\multi.py", line 3040, in get_loc
    loc = self._get_level_indexer(key, level=0)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\multi.py", line 3391, in _get_level_indexer
    idx = self._get_loc_single_level_index(level_index, key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\multi.py", line 2980, in _get_loc_single_level_index
    return level_index.get_loc(key)
           ~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'Adj Close'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 64, in prepare_data
    train_market = self.data_loader.load_market_data(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 297, in load_market_data
    raise ValueError(f"Error downloading market data: {str(e)}")
ValueError: Error downloading market data: 'Adj Close'
2025-04-17 16:55:56,014 - INFO - 
Running strategy with lstm classifier and neural optimizer
2025-04-17 16:55:56,015 - INFO - Initializing strategy...
2025-04-17 16:55:56,016 - INFO - Running strategy...
2025-04-17 16:55:56,032 - WARNING - US corporate credit spread file not found
2025-04-17 16:55:56,033 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:55:56,035 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 16:55:56,035 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 16:55:56,043 - WARNING - US corporate credit spread file not found
2025-04-17 16:55:56,044 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:55:56,046 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 16:55:56,047 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 16:55:56,118 - ERROR - Error running lstm with neural: Error downloading market data: 'Adj Close'
Traceback (most recent call last):
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Adj Close'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 273, in load_market_data
    sp500_returns = sp500['Adj Close'].pct_change()
                    ~~~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4101, in __getitem__
    return self._getitem_multilevel(key)
           ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4159, in _getitem_multilevel
    loc = self.columns.get_loc(key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\multi.py", line 3040, in get_loc
    loc = self._get_level_indexer(key, level=0)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\multi.py", line 3391, in _get_level_indexer
    idx = self._get_loc_single_level_index(level_index, key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\multi.py", line 2980, in _get_loc_single_level_index
    return level_index.get_loc(key)
           ~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'Adj Close'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 64, in prepare_data
    train_market = self.data_loader.load_market_data(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 297, in load_market_data
    raise ValueError(f"Error downloading market data: {str(e)}")
ValueError: Error downloading market data: 'Adj Close'
2025-04-17 16:55:56,120 - INFO - 
Running strategy with xgboost classifier and mean_variance optimizer
2025-04-17 16:55:56,120 - INFO - Initializing strategy...
2025-04-17 16:55:56,140 - INFO - Running strategy...
2025-04-17 16:55:56,157 - WARNING - US corporate credit spread file not found
2025-04-17 16:55:56,158 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:55:56,160 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 16:55:56,160 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 16:55:56,168 - WARNING - US corporate credit spread file not found
2025-04-17 16:55:56,169 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:55:56,171 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 16:55:56,172 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 16:55:56,232 - ERROR - Error running xgboost with mean_variance: Error downloading market data: 'Adj Close'
Traceback (most recent call last):
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Adj Close'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 273, in load_market_data
    sp500_returns = sp500['Adj Close'].pct_change()
                    ~~~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4101, in __getitem__
    return self._getitem_multilevel(key)
           ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4159, in _getitem_multilevel
    loc = self.columns.get_loc(key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\multi.py", line 3040, in get_loc
    loc = self._get_level_indexer(key, level=0)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\multi.py", line 3391, in _get_level_indexer
    idx = self._get_loc_single_level_index(level_index, key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\multi.py", line 2980, in _get_loc_single_level_index
    return level_index.get_loc(key)
           ~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'Adj Close'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 64, in prepare_data
    train_market = self.data_loader.load_market_data(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 297, in load_market_data
    raise ValueError(f"Error downloading market data: {str(e)}")
ValueError: Error downloading market data: 'Adj Close'
2025-04-17 16:55:56,236 - INFO - 
Running strategy with xgboost classifier and neural optimizer
2025-04-17 16:55:56,236 - INFO - Initializing strategy...
2025-04-17 16:55:56,237 - INFO - Running strategy...
2025-04-17 16:55:56,255 - WARNING - US corporate credit spread file not found
2025-04-17 16:55:56,255 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:55:56,259 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 16:55:56,259 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 16:55:56,270 - WARNING - US corporate credit spread file not found
2025-04-17 16:55:56,270 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:55:56,273 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 16:55:56,273 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 16:55:56,324 - ERROR - Error running xgboost with neural: Error downloading market data: 'Adj Close'
Traceback (most recent call last):
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Adj Close'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 273, in load_market_data
    sp500_returns = sp500['Adj Close'].pct_change()
                    ~~~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4101, in __getitem__
    return self._getitem_multilevel(key)
           ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4159, in _getitem_multilevel
    loc = self.columns.get_loc(key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\multi.py", line 3040, in get_loc
    loc = self._get_level_indexer(key, level=0)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\multi.py", line 3391, in _get_level_indexer
    idx = self._get_loc_single_level_index(level_index, key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\multi.py", line 2980, in _get_loc_single_level_index
    return level_index.get_loc(key)
           ~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'Adj Close'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 64, in prepare_data
    train_market = self.data_loader.load_market_data(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 297, in load_market_data
    raise ValueError(f"Error downloading market data: {str(e)}")
ValueError: Error downloading market data: 'Adj Close'
2025-04-17 16:55:56,327 - INFO - 
Running strategy with hmm classifier and mean_variance optimizer
2025-04-17 16:55:56,327 - INFO - Initializing strategy...
2025-04-17 16:55:56,363 - INFO - Running strategy...
2025-04-17 16:55:56,381 - WARNING - US corporate credit spread file not found
2025-04-17 16:55:56,382 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:55:56,383 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 16:55:56,384 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 16:55:56,391 - WARNING - US corporate credit spread file not found
2025-04-17 16:55:56,391 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:55:56,394 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 16:55:56,394 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 16:55:56,451 - ERROR - Error running hmm with mean_variance: Error downloading market data: 'Adj Close'
Traceback (most recent call last):
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Adj Close'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 273, in load_market_data
    sp500_returns = sp500['Adj Close'].pct_change()
                    ~~~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4101, in __getitem__
    return self._getitem_multilevel(key)
           ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4159, in _getitem_multilevel
    loc = self.columns.get_loc(key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\multi.py", line 3040, in get_loc
    loc = self._get_level_indexer(key, level=0)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\multi.py", line 3391, in _get_level_indexer
    idx = self._get_loc_single_level_index(level_index, key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\multi.py", line 2980, in _get_loc_single_level_index
    return level_index.get_loc(key)
           ~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'Adj Close'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 64, in prepare_data
    train_market = self.data_loader.load_market_data(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 297, in load_market_data
    raise ValueError(f"Error downloading market data: {str(e)}")
ValueError: Error downloading market data: 'Adj Close'
2025-04-17 16:55:56,453 - INFO - 
Running strategy with hmm classifier and neural optimizer
2025-04-17 16:55:56,453 - INFO - Initializing strategy...
2025-04-17 16:55:56,454 - INFO - Running strategy...
2025-04-17 16:55:56,470 - WARNING - US corporate credit spread file not found
2025-04-17 16:55:56,470 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:55:56,472 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 16:55:56,473 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 16:55:56,480 - WARNING - US corporate credit spread file not found
2025-04-17 16:55:56,481 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:55:56,483 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 16:55:56,483 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 16:55:56,533 - ERROR - Error running hmm with neural: Error downloading market data: 'Adj Close'
Traceback (most recent call last):
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Adj Close'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 273, in load_market_data
    sp500_returns = sp500['Adj Close'].pct_change()
                    ~~~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4101, in __getitem__
    return self._getitem_multilevel(key)
           ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4159, in _getitem_multilevel
    loc = self.columns.get_loc(key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\multi.py", line 3040, in get_loc
    loc = self._get_level_indexer(key, level=0)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\multi.py", line 3391, in _get_level_indexer
    idx = self._get_loc_single_level_index(level_index, key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\multi.py", line 2980, in _get_loc_single_level_index
    return level_index.get_loc(key)
           ~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'Adj Close'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 64, in prepare_data
    train_market = self.data_loader.load_market_data(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 297, in load_market_data
    raise ValueError(f"Error downloading market data: {str(e)}")
ValueError: Error downloading market data: 'Adj Close'
2025-04-17 16:55:56,535 - ERROR - No valid results obtained from parameter grid search
2025-04-17 16:55:56,535 - INFO - Factor timing strategy optimization completed
2025-04-17 16:57:42,412 - INFO - Starting factor timing strategy optimization...
2025-04-17 16:57:42,413 - INFO - Running parameter grid search...
2025-04-17 16:57:42,413 - INFO - 
Running strategy with lstm classifier and mean_variance optimizer
2025-04-17 16:57:42,413 - INFO - Initializing strategy...
2025-04-17 16:57:43,347 - INFO - Running strategy...
2025-04-17 16:57:43,369 - WARNING - US corporate credit spread file not found
2025-04-17 16:57:43,369 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:57:43,371 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 16:57:43,371 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 16:57:43,378 - WARNING - US corporate credit spread file not found
2025-04-17 16:57:43,379 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:57:43,381 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 16:57:43,381 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 16:57:44,136 - ERROR - Error running lstm with mean_variance: Error downloading market data: 'Adj Close'
Traceback (most recent call last):
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Adj Close'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 280, in load_market_data
    'VIX': vix['Adj Close'],
           ~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4102, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'Adj Close'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 64, in prepare_data
    train_market = self.data_loader.load_market_data(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 299, in load_market_data
    raise ValueError(f"Error downloading market data: {str(e)}")
ValueError: Error downloading market data: 'Adj Close'
2025-04-17 16:57:44,141 - INFO - 
Running strategy with lstm classifier and neural optimizer
2025-04-17 16:57:44,141 - INFO - Initializing strategy...
2025-04-17 16:57:44,142 - INFO - Running strategy...
2025-04-17 16:57:44,160 - WARNING - US corporate credit spread file not found
2025-04-17 16:57:44,161 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:57:44,163 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 16:57:44,163 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 16:57:44,173 - WARNING - US corporate credit spread file not found
2025-04-17 16:57:44,173 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:57:44,175 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 16:57:44,175 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 16:57:44,234 - ERROR - Error running lstm with neural: Error downloading market data: 'Adj Close'
Traceback (most recent call last):
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Adj Close'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 280, in load_market_data
    'VIX': vix['Adj Close'],
           ~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4102, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'Adj Close'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 64, in prepare_data
    train_market = self.data_loader.load_market_data(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 299, in load_market_data
    raise ValueError(f"Error downloading market data: {str(e)}")
ValueError: Error downloading market data: 'Adj Close'
2025-04-17 16:57:44,236 - INFO - 
Running strategy with xgboost classifier and mean_variance optimizer
2025-04-17 16:57:44,237 - INFO - Initializing strategy...
2025-04-17 16:57:44,256 - INFO - Running strategy...
2025-04-17 16:57:44,273 - WARNING - US corporate credit spread file not found
2025-04-17 16:57:44,274 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:57:44,276 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 16:57:44,276 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 16:57:44,284 - WARNING - US corporate credit spread file not found
2025-04-17 16:57:44,285 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:57:44,287 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 16:57:44,287 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 16:57:44,357 - ERROR - Error running xgboost with mean_variance: Error downloading market data: 'Adj Close'
Traceback (most recent call last):
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Adj Close'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 280, in load_market_data
    'VIX': vix['Adj Close'],
           ~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4102, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'Adj Close'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 64, in prepare_data
    train_market = self.data_loader.load_market_data(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 299, in load_market_data
    raise ValueError(f"Error downloading market data: {str(e)}")
ValueError: Error downloading market data: 'Adj Close'
2025-04-17 16:57:44,360 - INFO - 
Running strategy with xgboost classifier and neural optimizer
2025-04-17 16:57:44,361 - INFO - Initializing strategy...
2025-04-17 16:57:44,362 - INFO - Running strategy...
2025-04-17 16:57:44,380 - WARNING - US corporate credit spread file not found
2025-04-17 16:57:44,381 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:57:44,383 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 16:57:44,383 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 16:57:44,391 - WARNING - US corporate credit spread file not found
2025-04-17 16:57:44,391 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:57:44,393 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 16:57:44,394 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 16:57:44,444 - ERROR - Error running xgboost with neural: Error downloading market data: 'Adj Close'
Traceback (most recent call last):
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Adj Close'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 280, in load_market_data
    'VIX': vix['Adj Close'],
           ~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4102, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'Adj Close'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 64, in prepare_data
    train_market = self.data_loader.load_market_data(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 299, in load_market_data
    raise ValueError(f"Error downloading market data: {str(e)}")
ValueError: Error downloading market data: 'Adj Close'
2025-04-17 16:57:44,446 - INFO - 
Running strategy with hmm classifier and mean_variance optimizer
2025-04-17 16:57:44,446 - INFO - Initializing strategy...
2025-04-17 16:57:44,480 - INFO - Running strategy...
2025-04-17 16:57:44,498 - WARNING - US corporate credit spread file not found
2025-04-17 16:57:44,498 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:57:44,500 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 16:57:44,500 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 16:57:44,508 - WARNING - US corporate credit spread file not found
2025-04-17 16:57:44,508 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:57:44,510 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 16:57:44,510 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 16:57:44,566 - ERROR - Error running hmm with mean_variance: Error downloading market data: 'Adj Close'
Traceback (most recent call last):
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Adj Close'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 280, in load_market_data
    'VIX': vix['Adj Close'],
           ~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4102, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'Adj Close'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 64, in prepare_data
    train_market = self.data_loader.load_market_data(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 299, in load_market_data
    raise ValueError(f"Error downloading market data: {str(e)}")
ValueError: Error downloading market data: 'Adj Close'
2025-04-17 16:57:44,568 - INFO - 
Running strategy with hmm classifier and neural optimizer
2025-04-17 16:57:44,568 - INFO - Initializing strategy...
2025-04-17 16:57:44,569 - INFO - Running strategy...
2025-04-17 16:57:44,585 - WARNING - US corporate credit spread file not found
2025-04-17 16:57:44,585 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:57:44,587 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 16:57:44,587 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 16:57:44,595 - WARNING - US corporate credit spread file not found
2025-04-17 16:57:44,595 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:57:44,597 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 16:57:44,597 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 16:57:44,648 - ERROR - Error running hmm with neural: Error downloading market data: 'Adj Close'
Traceback (most recent call last):
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Adj Close'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 280, in load_market_data
    'VIX': vix['Adj Close'],
           ~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4102, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'Adj Close'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 102, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 64, in prepare_data
    train_market = self.data_loader.load_market_data(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 299, in load_market_data
    raise ValueError(f"Error downloading market data: {str(e)}")
ValueError: Error downloading market data: 'Adj Close'
2025-04-17 16:57:44,650 - ERROR - No valid results obtained from parameter grid search
2025-04-17 16:57:44,651 - INFO - Factor timing strategy optimization completed
2025-04-17 16:58:41,249 - INFO - Starting factor timing strategy optimization...
2025-04-17 16:58:41,250 - INFO - Running parameter grid search...
2025-04-17 16:58:41,250 - INFO - 
Running strategy with lstm classifier and mean_variance optimizer
2025-04-17 16:58:41,250 - INFO - Initializing strategy...
2025-04-17 16:58:42,180 - INFO - Running strategy...
2025-04-17 16:58:42,201 - WARNING - US corporate credit spread file not found
2025-04-17 16:58:42,201 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:58:42,203 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 16:58:42,203 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 16:58:42,210 - WARNING - US corporate credit spread file not found
2025-04-17 16:58:42,210 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:58:42,212 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 16:58:42,212 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 16:58:42,774 - WARNING - Found missing values in Market data data
2025-04-17 16:58:42,774 - INFO - Loaded market data with 1509 rows
2025-04-17 16:58:42,775 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 16:58:43,170 - WARNING - Found missing values in Market data data
2025-04-17 16:58:43,170 - INFO - Loaded market data with 1257 rows
2025-04-17 16:58:43,170 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 16:58:43,172 - INFO - Prepared training data with 41 samples
2025-04-17 16:58:43,172 - INFO - Class distribution: {0: 21, 1: 20}
2025-04-17 16:58:43,176 - ERROR - Error running lstm with mean_variance: input.size(-1) must be equal to input_size. Expected 8, got 6
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 105, in run_strategy
    self.train_models()
    ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 92, in train_models
    self.regime_classifier.train(self.train_data['X'], self.train_data['y'])
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\models\regime_classifier.py", line 75, in train
    outputs = self.model(batch_X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\Desktop\factor_timing\models\regime_classifier.py", line 38, in forward
    out, _ = self.lstm(x, (h0, c0))
             ~~~~~~~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\rnn.py", line 1120, in forward
    self.check_forward_args(input, hx, batch_sizes)
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\rnn.py", line 1002, in check_forward_args
    self.check_input(input, batch_sizes)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\rnn.py", line 314, in check_input
    raise RuntimeError(
        f"input.size(-1) must be equal to input_size. Expected {self.input_size}, got {input.size(-1)}"
    )
RuntimeError: input.size(-1) must be equal to input_size. Expected 8, got 6
2025-04-17 16:58:43,179 - INFO - 
Running strategy with lstm classifier and neural optimizer
2025-04-17 16:58:43,179 - INFO - Initializing strategy...
2025-04-17 16:58:43,181 - INFO - Running strategy...
2025-04-17 16:58:43,199 - WARNING - US corporate credit spread file not found
2025-04-17 16:58:43,199 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:58:43,201 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 16:58:43,201 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 16:58:43,209 - WARNING - US corporate credit spread file not found
2025-04-17 16:58:43,210 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:58:43,212 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 16:58:43,212 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 16:58:43,269 - WARNING - Found missing values in Market data data
2025-04-17 16:58:43,269 - INFO - Loaded market data with 1509 rows
2025-04-17 16:58:43,269 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 16:58:43,310 - WARNING - Found missing values in Market data data
2025-04-17 16:58:43,310 - INFO - Loaded market data with 1257 rows
2025-04-17 16:58:43,310 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 16:58:43,312 - INFO - Prepared training data with 41 samples
2025-04-17 16:58:43,313 - INFO - Class distribution: {0: 21, 1: 20}
2025-04-17 16:58:43,315 - ERROR - Error running lstm with neural: input.size(-1) must be equal to input_size. Expected 8, got 6
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 105, in run_strategy
    self.train_models()
    ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 92, in train_models
    self.regime_classifier.train(self.train_data['X'], self.train_data['y'])
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\models\regime_classifier.py", line 75, in train
    outputs = self.model(batch_X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\Desktop\factor_timing\models\regime_classifier.py", line 38, in forward
    out, _ = self.lstm(x, (h0, c0))
             ~~~~~~~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\rnn.py", line 1120, in forward
    self.check_forward_args(input, hx, batch_sizes)
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\rnn.py", line 1002, in check_forward_args
    self.check_input(input, batch_sizes)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\rnn.py", line 314, in check_input
    raise RuntimeError(
        f"input.size(-1) must be equal to input_size. Expected {self.input_size}, got {input.size(-1)}"
    )
RuntimeError: input.size(-1) must be equal to input_size. Expected 8, got 6
2025-04-17 16:58:43,317 - INFO - 
Running strategy with xgboost classifier and mean_variance optimizer
2025-04-17 16:58:43,317 - INFO - Initializing strategy...
2025-04-17 16:58:43,342 - INFO - Running strategy...
2025-04-17 16:58:43,360 - WARNING - US corporate credit spread file not found
2025-04-17 16:58:43,360 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:58:43,361 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 16:58:43,362 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 16:58:43,368 - WARNING - US corporate credit spread file not found
2025-04-17 16:58:43,369 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:58:43,370 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 16:58:43,370 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 16:58:43,429 - WARNING - Found missing values in Market data data
2025-04-17 16:58:43,429 - INFO - Loaded market data with 1509 rows
2025-04-17 16:58:43,429 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 16:58:43,480 - WARNING - Found missing values in Market data data
2025-04-17 16:58:43,480 - INFO - Loaded market data with 1257 rows
2025-04-17 16:58:43,481 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 16:58:43,482 - INFO - Prepared training data with 41 samples
2025-04-17 16:58:43,483 - INFO - Class distribution: {0: 21, 1: 20}
2025-04-17 16:58:44,773 - ERROR - Error running xgboost with mean_variance: Item wrong length 41 instead of 72.
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 120, in run_strategy
    regime_returns[regime] = self.train_data['factors'][regime_mask]
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4093, in __getitem__
    return self._getitem_bool_array(key)
           ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4143, in _getitem_bool_array
    raise ValueError(
        f"Item wrong length {len(key)} instead of {len(self.index)}."
    )
ValueError: Item wrong length 41 instead of 72.
2025-04-17 16:58:44,776 - INFO - 
Running strategy with xgboost classifier and neural optimizer
2025-04-17 16:58:44,777 - INFO - Initializing strategy...
2025-04-17 16:58:44,778 - INFO - Running strategy...
2025-04-17 16:58:44,804 - WARNING - US corporate credit spread file not found
2025-04-17 16:58:44,805 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:58:44,807 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 16:58:44,807 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 16:58:44,817 - WARNING - US corporate credit spread file not found
2025-04-17 16:58:44,818 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:58:44,820 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 16:58:44,820 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 16:58:44,884 - WARNING - Found missing values in Market data data
2025-04-17 16:58:44,885 - INFO - Loaded market data with 1509 rows
2025-04-17 16:58:44,885 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 16:58:44,926 - WARNING - Found missing values in Market data data
2025-04-17 16:58:44,926 - INFO - Loaded market data with 1257 rows
2025-04-17 16:58:44,926 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 16:58:44,928 - INFO - Prepared training data with 41 samples
2025-04-17 16:58:44,929 - INFO - Class distribution: {0: 21, 1: 20}
2025-04-17 16:58:44,954 - ERROR - Error running xgboost with neural: Item wrong length 41 instead of 72.
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 120, in run_strategy
    regime_returns[regime] = self.train_data['factors'][regime_mask]
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4093, in __getitem__
    return self._getitem_bool_array(key)
           ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4143, in _getitem_bool_array
    raise ValueError(
        f"Item wrong length {len(key)} instead of {len(self.index)}."
    )
ValueError: Item wrong length 41 instead of 72.
2025-04-17 16:58:44,956 - INFO - 
Running strategy with hmm classifier and mean_variance optimizer
2025-04-17 16:58:44,956 - INFO - Initializing strategy...
2025-04-17 16:58:45,002 - INFO - Running strategy...
2025-04-17 16:58:45,026 - WARNING - US corporate credit spread file not found
2025-04-17 16:58:45,026 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:58:45,028 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 16:58:45,029 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 16:58:45,040 - WARNING - US corporate credit spread file not found
2025-04-17 16:58:45,040 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:58:45,042 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 16:58:45,042 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 16:58:45,100 - WARNING - Found missing values in Market data data
2025-04-17 16:58:45,101 - INFO - Loaded market data with 1509 rows
2025-04-17 16:58:45,101 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 16:58:45,154 - WARNING - Found missing values in Market data data
2025-04-17 16:58:45,154 - INFO - Loaded market data with 1257 rows
2025-04-17 16:58:45,154 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 16:58:45,156 - INFO - Prepared training data with 41 samples
2025-04-17 16:58:45,156 - INFO - Class distribution: {0: 21, 1: 20}
2025-04-17 16:58:45,320 - ERROR - Error running hmm with mean_variance: Input contains NaN.
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 113, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\models\regime_classifier.py", line 119, in predict
    return self.model.predict(X_scaled)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\hmmlearn\base.py", line 375, in predict
    _, state_sequence = self.decode(X, lengths)
                        ~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\hmmlearn\base.py", line 347, in decode
    X = check_array(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input contains NaN.
2025-04-17 16:58:45,323 - INFO - 
Running strategy with hmm classifier and neural optimizer
2025-04-17 16:58:45,323 - INFO - Initializing strategy...
2025-04-17 16:58:45,324 - INFO - Running strategy...
2025-04-17 16:58:45,342 - WARNING - US corporate credit spread file not found
2025-04-17 16:58:45,342 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:58:45,344 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 16:58:45,345 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 16:58:45,354 - WARNING - US corporate credit spread file not found
2025-04-17 16:58:45,354 - WARNING - 10-year Treasury rate file not found
2025-04-17 16:58:45,357 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 16:58:45,357 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 16:58:45,417 - WARNING - Found missing values in Market data data
2025-04-17 16:58:45,417 - INFO - Loaded market data with 1509 rows
2025-04-17 16:58:45,418 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 16:58:45,471 - WARNING - Found missing values in Market data data
2025-04-17 16:58:45,471 - INFO - Loaded market data with 1257 rows
2025-04-17 16:58:45,472 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 16:58:45,473 - INFO - Prepared training data with 41 samples
2025-04-17 16:58:45,474 - INFO - Class distribution: {0: 21, 1: 20}
2025-04-17 16:58:45,501 - WARNING - Model is not converging.  Current: -258.73930578737827 is not greater than -258.73926126013816. Delta is -4.452724010661768e-05
2025-04-17 16:58:45,504 - ERROR - Error running hmm with neural: Input contains NaN.
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 47, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 113, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\models\regime_classifier.py", line 119, in predict
    return self.model.predict(X_scaled)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\hmmlearn\base.py", line 375, in predict
    _, state_sequence = self.decode(X, lengths)
                        ~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\hmmlearn\base.py", line 347, in decode
    X = check_array(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input contains NaN.
2025-04-17 16:58:45,507 - ERROR - No valid results obtained from parameter grid search
2025-04-17 16:58:45,507 - INFO - Factor timing strategy optimization completed
2025-04-17 17:18:01,019 - INFO - Starting factor timing strategy optimization...
2025-04-17 17:18:01,019 - INFO - Running parameter grid search...
2025-04-17 17:18:01,020 - INFO - 
Running strategy with lstm classifier and mean_variance optimizer
2025-04-17 17:18:01,020 - INFO - Initializing strategy...
2025-04-17 17:18:01,968 - INFO - Running strategy...
2025-04-17 17:18:01,970 - ERROR - Error running lstm with mean_variance: Fama-French factors file not found at C:\Users\ye\Desktop\data\ff.csv
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 103, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 54, in prepare_data
    train_factors = self.data_loader.load_fama_french_factors(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 104, in load_fama_french_factors
    raise FileNotFoundError(f"Fama-French factors file not found at {ff_path}")
FileNotFoundError: Fama-French factors file not found at C:\Users\ye\Desktop\data\ff.csv
2025-04-17 17:18:01,972 - INFO - 
Running strategy with lstm classifier and neural optimizer
2025-04-17 17:18:01,972 - INFO - Initializing strategy...
2025-04-17 17:18:01,973 - INFO - Running strategy...
2025-04-17 17:18:01,975 - ERROR - Error running lstm with neural: Fama-French factors file not found at C:\Users\ye\Desktop\data\ff.csv
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 103, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 54, in prepare_data
    train_factors = self.data_loader.load_fama_french_factors(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 104, in load_fama_french_factors
    raise FileNotFoundError(f"Fama-French factors file not found at {ff_path}")
FileNotFoundError: Fama-French factors file not found at C:\Users\ye\Desktop\data\ff.csv
2025-04-17 17:18:01,975 - INFO - 
Running strategy with xgboost classifier and mean_variance optimizer
2025-04-17 17:18:01,976 - INFO - Initializing strategy...
2025-04-17 17:18:02,008 - INFO - Running strategy...
2025-04-17 17:18:02,010 - ERROR - Error running xgboost with mean_variance: Fama-French factors file not found at C:\Users\ye\Desktop\data\ff.csv
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 103, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 54, in prepare_data
    train_factors = self.data_loader.load_fama_french_factors(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 104, in load_fama_french_factors
    raise FileNotFoundError(f"Fama-French factors file not found at {ff_path}")
FileNotFoundError: Fama-French factors file not found at C:\Users\ye\Desktop\data\ff.csv
2025-04-17 17:18:02,012 - INFO - 
Running strategy with xgboost classifier and neural optimizer
2025-04-17 17:18:02,012 - INFO - Initializing strategy...
2025-04-17 17:18:02,014 - INFO - Running strategy...
2025-04-17 17:18:02,016 - ERROR - Error running xgboost with neural: Fama-French factors file not found at C:\Users\ye\Desktop\data\ff.csv
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 103, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 54, in prepare_data
    train_factors = self.data_loader.load_fama_french_factors(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 104, in load_fama_french_factors
    raise FileNotFoundError(f"Fama-French factors file not found at {ff_path}")
FileNotFoundError: Fama-French factors file not found at C:\Users\ye\Desktop\data\ff.csv
2025-04-17 17:18:02,017 - INFO - 
Running strategy with hmm classifier and mean_variance optimizer
2025-04-17 17:18:02,018 - INFO - Initializing strategy...
2025-04-17 17:18:02,053 - INFO - Running strategy...
2025-04-17 17:18:02,055 - ERROR - Error running hmm with mean_variance: Fama-French factors file not found at C:\Users\ye\Desktop\data\ff.csv
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 103, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 54, in prepare_data
    train_factors = self.data_loader.load_fama_french_factors(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 104, in load_fama_french_factors
    raise FileNotFoundError(f"Fama-French factors file not found at {ff_path}")
FileNotFoundError: Fama-French factors file not found at C:\Users\ye\Desktop\data\ff.csv
2025-04-17 17:18:02,056 - INFO - 
Running strategy with hmm classifier and neural optimizer
2025-04-17 17:18:02,057 - INFO - Initializing strategy...
2025-04-17 17:18:02,057 - INFO - Running strategy...
2025-04-17 17:18:02,059 - ERROR - Error running hmm with neural: Fama-French factors file not found at C:\Users\ye\Desktop\data\ff.csv
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 103, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 54, in prepare_data
    train_factors = self.data_loader.load_fama_french_factors(
        self.train_start_date, self.train_end_date)
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 104, in load_fama_french_factors
    raise FileNotFoundError(f"Fama-French factors file not found at {ff_path}")
FileNotFoundError: Fama-French factors file not found at C:\Users\ye\Desktop\data\ff.csv
2025-04-17 17:18:02,060 - ERROR - No valid results obtained from parameter grid search
2025-04-17 17:18:02,060 - ERROR - No valid results obtained from parameter grid search
2025-04-17 17:18:02,060 - INFO - Factor timing strategy optimization completed
2025-04-17 17:18:21,651 - INFO - Starting factor timing strategy optimization...
2025-04-17 17:18:21,651 - INFO - Running parameter grid search...
2025-04-17 17:18:21,652 - INFO - 
Running strategy with lstm classifier and mean_variance optimizer
2025-04-17 17:18:21,652 - INFO - Initializing strategy...
2025-04-17 17:18:22,557 - INFO - Running strategy...
2025-04-17 17:18:22,577 - WARNING - US corporate credit spread file not found
2025-04-17 17:18:22,578 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:18:22,580 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:18:22,580 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:18:22,587 - WARNING - US corporate credit spread file not found
2025-04-17 17:18:22,587 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:18:22,589 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:18:22,589 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:18:23,174 - WARNING - Found missing values in Market data data
2025-04-17 17:18:23,174 - INFO - Loaded market data with 1509 rows
2025-04-17 17:18:23,174 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:18:23,436 - WARNING - Found missing values in Market data data
2025-04-17 17:18:23,437 - INFO - Loaded market data with 1257 rows
2025-04-17 17:18:23,437 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:18:23,439 - INFO - Prepared training data with 41 samples
2025-04-17 17:18:23,439 - INFO - Class distribution: {0: 21, 1: 20}
2025-04-17 17:18:23,443 - ERROR - Error running lstm with mean_variance: input.size(-1) must be equal to input_size. Expected 8, got 6
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 106, in run_strategy
    self.train_models()
    ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 93, in train_models
    self.regime_classifier.train(self.train_data['X'], self.train_data['y'])
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\models\regime_classifier.py", line 75, in train
    outputs = self.model(batch_X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\Desktop\factor_timing\models\regime_classifier.py", line 38, in forward
    out, _ = self.lstm(x, (h0, c0))
             ~~~~~~~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\rnn.py", line 1120, in forward
    self.check_forward_args(input, hx, batch_sizes)
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\rnn.py", line 1002, in check_forward_args
    self.check_input(input, batch_sizes)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\rnn.py", line 314, in check_input
    raise RuntimeError(
        f"input.size(-1) must be equal to input_size. Expected {self.input_size}, got {input.size(-1)}"
    )
RuntimeError: input.size(-1) must be equal to input_size. Expected 8, got 6
2025-04-17 17:18:23,445 - INFO - 
Running strategy with lstm classifier and neural optimizer
2025-04-17 17:18:23,446 - INFO - Initializing strategy...
2025-04-17 17:18:23,447 - INFO - Running strategy...
2025-04-17 17:18:23,465 - WARNING - US corporate credit spread file not found
2025-04-17 17:18:23,465 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:18:23,468 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:18:23,468 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:18:23,478 - WARNING - US corporate credit spread file not found
2025-04-17 17:18:23,478 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:18:23,480 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:18:23,480 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:18:23,538 - WARNING - Found missing values in Market data data
2025-04-17 17:18:23,538 - INFO - Loaded market data with 1509 rows
2025-04-17 17:18:23,538 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:18:23,596 - WARNING - Found missing values in Market data data
2025-04-17 17:18:23,596 - INFO - Loaded market data with 1257 rows
2025-04-17 17:18:23,597 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:18:23,599 - INFO - Prepared training data with 41 samples
2025-04-17 17:18:23,600 - INFO - Class distribution: {0: 21, 1: 20}
2025-04-17 17:18:23,603 - ERROR - Error running lstm with neural: input.size(-1) must be equal to input_size. Expected 8, got 6
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 106, in run_strategy
    self.train_models()
    ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 93, in train_models
    self.regime_classifier.train(self.train_data['X'], self.train_data['y'])
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\models\regime_classifier.py", line 75, in train
    outputs = self.model(batch_X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\Desktop\factor_timing\models\regime_classifier.py", line 38, in forward
    out, _ = self.lstm(x, (h0, c0))
             ~~~~~~~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\rnn.py", line 1120, in forward
    self.check_forward_args(input, hx, batch_sizes)
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\rnn.py", line 1002, in check_forward_args
    self.check_input(input, batch_sizes)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\rnn.py", line 314, in check_input
    raise RuntimeError(
        f"input.size(-1) must be equal to input_size. Expected {self.input_size}, got {input.size(-1)}"
    )
RuntimeError: input.size(-1) must be equal to input_size. Expected 8, got 6
2025-04-17 17:18:23,605 - INFO - 
Running strategy with xgboost classifier and mean_variance optimizer
2025-04-17 17:18:23,605 - INFO - Initializing strategy...
2025-04-17 17:18:23,631 - INFO - Running strategy...
2025-04-17 17:18:23,648 - WARNING - US corporate credit spread file not found
2025-04-17 17:18:23,649 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:18:23,650 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:18:23,651 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:18:23,658 - WARNING - US corporate credit spread file not found
2025-04-17 17:18:23,658 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:18:23,660 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:18:23,661 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:18:23,718 - WARNING - Found missing values in Market data data
2025-04-17 17:18:23,718 - INFO - Loaded market data with 1509 rows
2025-04-17 17:18:23,718 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:18:23,759 - WARNING - Found missing values in Market data data
2025-04-17 17:18:23,759 - INFO - Loaded market data with 1257 rows
2025-04-17 17:18:23,760 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:18:23,761 - INFO - Prepared training data with 41 samples
2025-04-17 17:18:23,762 - INFO - Class distribution: {0: 21, 1: 20}
2025-04-17 17:18:24,978 - ERROR - Error running xgboost with mean_variance: Item wrong length 41 instead of 72.
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 121, in run_strategy
    regime_returns[regime] = self.train_data['factors'][regime_mask]
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4093, in __getitem__
    return self._getitem_bool_array(key)
           ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4143, in _getitem_bool_array
    raise ValueError(
        f"Item wrong length {len(key)} instead of {len(self.index)}."
    )
ValueError: Item wrong length 41 instead of 72.
2025-04-17 17:18:24,981 - INFO - 
Running strategy with xgboost classifier and neural optimizer
2025-04-17 17:18:24,982 - INFO - Initializing strategy...
2025-04-17 17:18:24,983 - INFO - Running strategy...
2025-04-17 17:18:25,004 - WARNING - US corporate credit spread file not found
2025-04-17 17:18:25,004 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:18:25,006 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:18:25,006 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:18:25,016 - WARNING - US corporate credit spread file not found
2025-04-17 17:18:25,017 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:18:25,019 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:18:25,019 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:18:25,087 - WARNING - Found missing values in Market data data
2025-04-17 17:18:25,088 - INFO - Loaded market data with 1509 rows
2025-04-17 17:18:25,088 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:18:25,138 - WARNING - Found missing values in Market data data
2025-04-17 17:18:25,138 - INFO - Loaded market data with 1257 rows
2025-04-17 17:18:25,139 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:18:25,140 - INFO - Prepared training data with 41 samples
2025-04-17 17:18:25,141 - INFO - Class distribution: {0: 21, 1: 20}
2025-04-17 17:18:25,160 - ERROR - Error running xgboost with neural: Item wrong length 41 instead of 72.
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 121, in run_strategy
    regime_returns[regime] = self.train_data['factors'][regime_mask]
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4093, in __getitem__
    return self._getitem_bool_array(key)
           ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4143, in _getitem_bool_array
    raise ValueError(
        f"Item wrong length {len(key)} instead of {len(self.index)}."
    )
ValueError: Item wrong length 41 instead of 72.
2025-04-17 17:18:25,161 - INFO - 
Running strategy with hmm classifier and mean_variance optimizer
2025-04-17 17:18:25,161 - INFO - Initializing strategy...
2025-04-17 17:18:25,201 - INFO - Running strategy...
2025-04-17 17:18:25,223 - WARNING - US corporate credit spread file not found
2025-04-17 17:18:25,224 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:18:25,226 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:18:25,226 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:18:25,235 - WARNING - US corporate credit spread file not found
2025-04-17 17:18:25,235 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:18:25,237 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:18:25,237 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:18:25,295 - WARNING - Found missing values in Market data data
2025-04-17 17:18:25,295 - INFO - Loaded market data with 1509 rows
2025-04-17 17:18:25,295 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:18:25,346 - WARNING - Found missing values in Market data data
2025-04-17 17:18:25,346 - INFO - Loaded market data with 1257 rows
2025-04-17 17:18:25,347 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:18:25,349 - INFO - Prepared training data with 41 samples
2025-04-17 17:18:25,349 - INFO - Class distribution: {0: 21, 1: 20}
2025-04-17 17:18:25,496 - ERROR - Error running hmm with mean_variance: Input contains NaN.
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 114, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\models\regime_classifier.py", line 119, in predict
    return self.model.predict(X_scaled)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\hmmlearn\base.py", line 375, in predict
    _, state_sequence = self.decode(X, lengths)
                        ~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\hmmlearn\base.py", line 347, in decode
    X = check_array(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input contains NaN.
2025-04-17 17:18:25,500 - INFO - 
Running strategy with hmm classifier and neural optimizer
2025-04-17 17:18:25,500 - INFO - Initializing strategy...
2025-04-17 17:18:25,501 - INFO - Running strategy...
2025-04-17 17:18:25,521 - WARNING - US corporate credit spread file not found
2025-04-17 17:18:25,521 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:18:25,523 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:18:25,523 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:18:25,533 - WARNING - US corporate credit spread file not found
2025-04-17 17:18:25,533 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:18:25,535 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:18:25,535 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:18:25,602 - WARNING - Found missing values in Market data data
2025-04-17 17:18:25,603 - INFO - Loaded market data with 1509 rows
2025-04-17 17:18:25,603 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:18:25,653 - WARNING - Found missing values in Market data data
2025-04-17 17:18:25,654 - INFO - Loaded market data with 1257 rows
2025-04-17 17:18:25,654 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:18:25,656 - INFO - Prepared training data with 41 samples
2025-04-17 17:18:25,657 - INFO - Class distribution: {0: 21, 1: 20}
2025-04-17 17:18:25,684 - ERROR - Error running hmm with neural: Input contains NaN.
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 114, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\models\regime_classifier.py", line 119, in predict
    return self.model.predict(X_scaled)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\hmmlearn\base.py", line 375, in predict
    _, state_sequence = self.decode(X, lengths)
                        ~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\hmmlearn\base.py", line 347, in decode
    X = check_array(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input contains NaN.
2025-04-17 17:18:25,686 - ERROR - No valid results obtained from parameter grid search
2025-04-17 17:18:25,687 - ERROR - No valid results obtained from parameter grid search
2025-04-17 17:18:25,687 - INFO - Factor timing strategy optimization completed
2025-04-17 17:21:54,076 - INFO - Starting factor timing strategy optimization...
2025-04-17 17:21:54,076 - INFO - Running parameter grid search...
2025-04-17 17:21:54,076 - INFO - 
Running strategy with lstm classifier and mean_variance optimizer
2025-04-17 17:21:54,077 - INFO - Initializing strategy...
2025-04-17 17:21:55,051 - INFO - Running strategy...
2025-04-17 17:21:55,072 - WARNING - US corporate credit spread file not found
2025-04-17 17:21:55,072 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:21:55,075 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:21:55,075 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:21:55,083 - WARNING - US corporate credit spread file not found
2025-04-17 17:21:55,083 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:21:55,085 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:21:55,085 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:21:55,793 - WARNING - Found missing values in Market data data
2025-04-17 17:21:55,794 - INFO - Loaded market data with 1509 rows
2025-04-17 17:21:55,794 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:21:56,147 - WARNING - Found missing values in Market data data
2025-04-17 17:21:56,147 - INFO - Loaded market data with 1257 rows
2025-04-17 17:21:56,147 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:21:56,151 - INFO - Prepared training data with 60 samples
2025-04-17 17:21:56,152 - INFO - Class distribution: {0: 40, 1: 20}
2025-04-17 17:21:56,156 - ERROR - Error running lstm with mean_variance: input.size(-1) must be equal to input_size. Expected 8, got 6
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 106, in run_strategy
    self.train_models()
    ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 93, in train_models
    self.regime_classifier.train(self.train_data['X'], self.train_data['y'])
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\models\regime_classifier.py", line 88, in train
    outputs = self.model(batch_X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\Desktop\factor_timing\models\regime_classifier.py", line 51, in forward
    out, _ = self.lstm(x, (h0, c0))
             ~~~~~~~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\rnn.py", line 1120, in forward
    self.check_forward_args(input, hx, batch_sizes)
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\rnn.py", line 1002, in check_forward_args
    self.check_input(input, batch_sizes)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\rnn.py", line 314, in check_input
    raise RuntimeError(
        f"input.size(-1) must be equal to input_size. Expected {self.input_size}, got {input.size(-1)}"
    )
RuntimeError: input.size(-1) must be equal to input_size. Expected 8, got 6
2025-04-17 17:21:56,159 - INFO - 
Running strategy with lstm classifier and neural optimizer
2025-04-17 17:21:56,159 - INFO - Initializing strategy...
2025-04-17 17:21:56,160 - INFO - Running strategy...
2025-04-17 17:21:56,178 - WARNING - US corporate credit spread file not found
2025-04-17 17:21:56,178 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:21:56,180 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:21:56,181 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:21:56,188 - WARNING - US corporate credit spread file not found
2025-04-17 17:21:56,189 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:21:56,190 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:21:56,191 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:21:56,248 - WARNING - Found missing values in Market data data
2025-04-17 17:21:56,248 - INFO - Loaded market data with 1509 rows
2025-04-17 17:21:56,249 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:21:56,300 - WARNING - Found missing values in Market data data
2025-04-17 17:21:56,301 - INFO - Loaded market data with 1257 rows
2025-04-17 17:21:56,301 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:21:56,304 - INFO - Prepared training data with 60 samples
2025-04-17 17:21:56,305 - INFO - Class distribution: {0: 40, 1: 20}
2025-04-17 17:21:56,308 - ERROR - Error running lstm with neural: input.size(-1) must be equal to input_size. Expected 8, got 6
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 106, in run_strategy
    self.train_models()
    ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 93, in train_models
    self.regime_classifier.train(self.train_data['X'], self.train_data['y'])
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\models\regime_classifier.py", line 88, in train
    outputs = self.model(batch_X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\Desktop\factor_timing\models\regime_classifier.py", line 51, in forward
    out, _ = self.lstm(x, (h0, c0))
             ~~~~~~~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\rnn.py", line 1120, in forward
    self.check_forward_args(input, hx, batch_sizes)
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\rnn.py", line 1002, in check_forward_args
    self.check_input(input, batch_sizes)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\rnn.py", line 314, in check_input
    raise RuntimeError(
        f"input.size(-1) must be equal to input_size. Expected {self.input_size}, got {input.size(-1)}"
    )
RuntimeError: input.size(-1) must be equal to input_size. Expected 8, got 6
2025-04-17 17:21:56,310 - INFO - 
Running strategy with xgboost classifier and mean_variance optimizer
2025-04-17 17:21:56,310 - INFO - Initializing strategy...
2025-04-17 17:21:56,336 - INFO - Running strategy...
2025-04-17 17:21:56,353 - WARNING - US corporate credit spread file not found
2025-04-17 17:21:56,353 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:21:56,355 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:21:56,356 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:21:56,364 - WARNING - US corporate credit spread file not found
2025-04-17 17:21:56,364 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:21:56,366 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:21:56,366 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:21:56,423 - WARNING - Found missing values in Market data data
2025-04-17 17:21:56,423 - INFO - Loaded market data with 1509 rows
2025-04-17 17:21:56,423 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:21:56,464 - WARNING - Found missing values in Market data data
2025-04-17 17:21:56,464 - INFO - Loaded market data with 1257 rows
2025-04-17 17:21:56,465 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:21:56,468 - INFO - Prepared training data with 60 samples
2025-04-17 17:21:56,468 - INFO - Class distribution: {0: 40, 1: 20}
2025-04-17 17:21:57,763 - ERROR - Error running xgboost with mean_variance: Item wrong length 60 instead of 72.
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 121, in run_strategy
    regime_returns[regime] = self.train_data['factors'][regime_mask]
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4093, in __getitem__
    return self._getitem_bool_array(key)
           ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4143, in _getitem_bool_array
    raise ValueError(
        f"Item wrong length {len(key)} instead of {len(self.index)}."
    )
ValueError: Item wrong length 60 instead of 72.
2025-04-17 17:21:57,767 - INFO - 
Running strategy with xgboost classifier and neural optimizer
2025-04-17 17:21:57,767 - INFO - Initializing strategy...
2025-04-17 17:21:57,768 - INFO - Running strategy...
2025-04-17 17:21:57,789 - WARNING - US corporate credit spread file not found
2025-04-17 17:21:57,789 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:21:57,791 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:21:57,791 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:21:57,801 - WARNING - US corporate credit spread file not found
2025-04-17 17:21:57,801 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:21:57,803 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:21:57,803 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:21:57,866 - WARNING - Found missing values in Market data data
2025-04-17 17:21:57,866 - INFO - Loaded market data with 1509 rows
2025-04-17 17:21:57,866 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:21:57,907 - WARNING - Found missing values in Market data data
2025-04-17 17:21:57,907 - INFO - Loaded market data with 1257 rows
2025-04-17 17:21:57,907 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:21:57,910 - INFO - Prepared training data with 60 samples
2025-04-17 17:21:57,911 - INFO - Class distribution: {0: 40, 1: 20}
2025-04-17 17:21:57,936 - ERROR - Error running xgboost with neural: Item wrong length 60 instead of 72.
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 121, in run_strategy
    regime_returns[regime] = self.train_data['factors'][regime_mask]
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4093, in __getitem__
    return self._getitem_bool_array(key)
           ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4143, in _getitem_bool_array
    raise ValueError(
        f"Item wrong length {len(key)} instead of {len(self.index)}."
    )
ValueError: Item wrong length 60 instead of 72.
2025-04-17 17:21:57,937 - INFO - 
Running strategy with hmm classifier and mean_variance optimizer
2025-04-17 17:21:57,937 - INFO - Initializing strategy...
2025-04-17 17:21:57,979 - INFO - Running strategy...
2025-04-17 17:21:58,001 - WARNING - US corporate credit spread file not found
2025-04-17 17:21:58,002 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:21:58,004 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:21:58,004 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:21:58,013 - WARNING - US corporate credit spread file not found
2025-04-17 17:21:58,013 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:21:58,015 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:21:58,016 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:21:58,074 - WARNING - Found missing values in Market data data
2025-04-17 17:21:58,074 - INFO - Loaded market data with 1509 rows
2025-04-17 17:21:58,074 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:21:58,126 - WARNING - Found missing values in Market data data
2025-04-17 17:21:58,127 - INFO - Loaded market data with 1257 rows
2025-04-17 17:21:58,127 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:21:58,130 - INFO - Prepared training data with 60 samples
2025-04-17 17:21:58,131 - INFO - Class distribution: {0: 40, 1: 20}
2025-04-17 17:21:58,280 - ERROR - Error running hmm with mean_variance: Input contains NaN.
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 114, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\models\regime_classifier.py", line 132, in predict
    return self.model.predict(X_scaled)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\hmmlearn\base.py", line 375, in predict
    _, state_sequence = self.decode(X, lengths)
                        ~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\hmmlearn\base.py", line 347, in decode
    X = check_array(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input contains NaN.
2025-04-17 17:21:58,283 - INFO - 
Running strategy with hmm classifier and neural optimizer
2025-04-17 17:21:58,284 - INFO - Initializing strategy...
2025-04-17 17:21:58,284 - INFO - Running strategy...
2025-04-17 17:21:58,301 - WARNING - US corporate credit spread file not found
2025-04-17 17:21:58,301 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:21:58,303 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:21:58,303 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:21:58,311 - WARNING - US corporate credit spread file not found
2025-04-17 17:21:58,311 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:21:58,313 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:21:58,314 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:21:58,372 - WARNING - Found missing values in Market data data
2025-04-17 17:21:58,372 - INFO - Loaded market data with 1509 rows
2025-04-17 17:21:58,372 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:21:58,424 - WARNING - Found missing values in Market data data
2025-04-17 17:21:58,424 - INFO - Loaded market data with 1257 rows
2025-04-17 17:21:58,425 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:21:58,428 - INFO - Prepared training data with 60 samples
2025-04-17 17:21:58,428 - INFO - Class distribution: {0: 40, 1: 20}
2025-04-17 17:21:58,456 - ERROR - Error running hmm with neural: Input contains NaN.
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 114, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\models\regime_classifier.py", line 132, in predict
    return self.model.predict(X_scaled)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\hmmlearn\base.py", line 375, in predict
    _, state_sequence = self.decode(X, lengths)
                        ~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\hmmlearn\base.py", line 347, in decode
    X = check_array(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input contains NaN.
2025-04-17 17:21:58,458 - ERROR - No valid results obtained from parameter grid search
2025-04-17 17:21:58,458 - ERROR - No valid results obtained from parameter grid search
2025-04-17 17:21:58,459 - INFO - Factor timing strategy optimization completed
2025-04-17 17:23:39,938 - INFO - Starting factor timing strategy optimization...
2025-04-17 17:23:39,938 - INFO - Running parameter grid search...
2025-04-17 17:23:39,939 - INFO - 
Running strategy with lstm classifier and mean_variance optimizer
2025-04-17 17:23:39,939 - INFO - Initializing strategy...
2025-04-17 17:23:40,904 - INFO - Running strategy...
2025-04-17 17:23:40,925 - WARNING - US corporate credit spread file not found
2025-04-17 17:23:40,925 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:23:40,927 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:23:40,927 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:23:40,935 - WARNING - US corporate credit spread file not found
2025-04-17 17:23:40,935 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:23:40,937 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:23:40,938 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:23:41,433 - WARNING - Found missing values in Market data data
2025-04-17 17:23:41,433 - INFO - Loaded market data with 1509 rows
2025-04-17 17:23:41,433 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:23:41,661 - WARNING - Found missing values in Market data data
2025-04-17 17:23:41,661 - INFO - Loaded market data with 1257 rows
2025-04-17 17:23:41,661 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:23:41,665 - INFO - Prepared training data with 60 samples
2025-04-17 17:23:41,665 - INFO - Class distribution: {0: 40, 1: 20}
2025-04-17 17:23:42,246 - ERROR - Error running lstm with mean_variance: float() argument must be a string or a real number, not 'Timestamp'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 146, in run_strategy
    weights.loc[date] = self.portfolio_optimizer.optimize_weights(
                        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        test_factors.loc[date],
        ^^^^^^^^^^^^^^^^^^^^^^^
        test_factors.cov()
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 34, in optimize_weights
    ret = expected_returns.values @ w
          ~~~~~~~~~~~~~~~~~~~~~~~~^~~
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\cvxpy\expressions\expression.py", line 801, in __array_ufunc__
    return ufunc_handler(self, args[0])
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\cvxpy\expressions\expression.py", line 99, in <lambda>
    np.matmul: lambda self, a: self.__rmatmul__(a),
                               ~~~~~~~~~~~~~~~~^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\cvxpy\expressions\expression.py", line 50, in cast_op
    other = self.cast_to_const(other)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\cvxpy\expressions\expression.py", line 579, in cast_to_const
    return expr if isinstance(expr, Expression) else cvxtypes.constant()(expr)
                                                     ~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\cvxpy\expressions\constants\constant.py", line 54, in __init__
    self._value = intf.DEFAULT_INTF.const_to_matrix(value)
                  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\cvxpy\interface\numpy_interface\ndarray_interface.py", line 56, in const_to_matrix
    return result.astype(numpy.float64)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'Timestamp'
2025-04-17 17:23:42,258 - INFO - 
Running strategy with lstm classifier and neural optimizer
2025-04-17 17:23:42,258 - INFO - Initializing strategy...
2025-04-17 17:23:42,260 - INFO - Running strategy...
2025-04-17 17:23:42,279 - WARNING - US corporate credit spread file not found
2025-04-17 17:23:42,280 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:23:42,282 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:23:42,282 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:23:42,291 - WARNING - US corporate credit spread file not found
2025-04-17 17:23:42,291 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:23:42,293 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:23:42,294 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:23:42,351 - WARNING - Found missing values in Market data data
2025-04-17 17:23:42,352 - INFO - Loaded market data with 1509 rows
2025-04-17 17:23:42,352 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:23:42,408 - WARNING - Found missing values in Market data data
2025-04-17 17:23:42,408 - INFO - Loaded market data with 1257 rows
2025-04-17 17:23:42,408 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:23:42,412 - INFO - Prepared training data with 60 samples
2025-04-17 17:23:42,412 - INFO - Class distribution: {0: 40, 1: 20}
2025-04-17 17:23:42,941 - ERROR - Error running lstm with neural: can't convert np.ndarray of type numpy.object_. The only supported types are: float64, float32, float16, complex64, complex128, int64, int32, int16, int8, uint64, uint32, uint16, uint8, and bool.
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 146, in run_strategy
    weights.loc[date] = self.portfolio_optimizer.optimize_weights(
                        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        test_factors.loc[date],
        ^^^^^^^^^^^^^^^^^^^^^^^
        test_factors.cov()
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 73, in optimize_weights
    features_tensor = torch.FloatTensor(features.values)
TypeError: can't convert np.ndarray of type numpy.object_. The only supported types are: float64, float32, float16, complex64, complex128, int64, int32, int16, int8, uint64, uint32, uint16, uint8, and bool.
2025-04-17 17:23:42,942 - INFO - 
Running strategy with xgboost classifier and mean_variance optimizer
2025-04-17 17:23:42,943 - INFO - Initializing strategy...
2025-04-17 17:23:42,978 - INFO - Running strategy...
2025-04-17 17:23:42,995 - WARNING - US corporate credit spread file not found
2025-04-17 17:23:42,995 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:23:42,997 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:23:42,997 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:23:43,005 - WARNING - US corporate credit spread file not found
2025-04-17 17:23:43,006 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:23:43,008 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:23:43,008 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:23:43,067 - WARNING - Found missing values in Market data data
2025-04-17 17:23:43,068 - INFO - Loaded market data with 1509 rows
2025-04-17 17:23:43,068 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:23:43,121 - WARNING - Found missing values in Market data data
2025-04-17 17:23:43,121 - INFO - Loaded market data with 1257 rows
2025-04-17 17:23:43,122 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:23:43,125 - INFO - Prepared training data with 60 samples
2025-04-17 17:23:43,125 - INFO - Class distribution: {0: 40, 1: 20}
2025-04-17 17:23:44,364 - ERROR - Error running xgboost with mean_variance: float() argument must be a string or a real number, not 'Timestamp'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 146, in run_strategy
    weights.loc[date] = self.portfolio_optimizer.optimize_weights(
                        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        test_factors.loc[date],
        ^^^^^^^^^^^^^^^^^^^^^^^
        test_factors.cov()
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 34, in optimize_weights
    ret = expected_returns.values @ w
          ~~~~~~~~~~~~~~~~~~~~~~~~^~~
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\cvxpy\expressions\expression.py", line 801, in __array_ufunc__
    return ufunc_handler(self, args[0])
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\cvxpy\expressions\expression.py", line 99, in <lambda>
    np.matmul: lambda self, a: self.__rmatmul__(a),
                               ~~~~~~~~~~~~~~~~^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\cvxpy\expressions\expression.py", line 50, in cast_op
    other = self.cast_to_const(other)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\cvxpy\expressions\expression.py", line 579, in cast_to_const
    return expr if isinstance(expr, Expression) else cvxtypes.constant()(expr)
                                                     ~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\cvxpy\expressions\constants\constant.py", line 54, in __init__
    self._value = intf.DEFAULT_INTF.const_to_matrix(value)
                  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\cvxpy\interface\numpy_interface\ndarray_interface.py", line 56, in const_to_matrix
    return result.astype(numpy.float64)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'Timestamp'
2025-04-17 17:23:44,366 - INFO - 
Running strategy with xgboost classifier and neural optimizer
2025-04-17 17:23:44,366 - INFO - Initializing strategy...
2025-04-17 17:23:44,367 - INFO - Running strategy...
2025-04-17 17:23:44,389 - WARNING - US corporate credit spread file not found
2025-04-17 17:23:44,389 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:23:44,391 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:23:44,392 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:23:44,401 - WARNING - US corporate credit spread file not found
2025-04-17 17:23:44,402 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:23:44,404 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:23:44,404 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:23:44,471 - WARNING - Found missing values in Market data data
2025-04-17 17:23:44,471 - INFO - Loaded market data with 1509 rows
2025-04-17 17:23:44,472 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:23:44,511 - WARNING - Found missing values in Market data data
2025-04-17 17:23:44,512 - INFO - Loaded market data with 1257 rows
2025-04-17 17:23:44,512 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:23:44,515 - INFO - Prepared training data with 60 samples
2025-04-17 17:23:44,515 - INFO - Class distribution: {0: 40, 1: 20}
2025-04-17 17:23:44,545 - ERROR - Error running xgboost with neural: can't convert np.ndarray of type numpy.object_. The only supported types are: float64, float32, float16, complex64, complex128, int64, int32, int16, int8, uint64, uint32, uint16, uint8, and bool.
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 146, in run_strategy
    weights.loc[date] = self.portfolio_optimizer.optimize_weights(
                        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        test_factors.loc[date],
        ^^^^^^^^^^^^^^^^^^^^^^^
        test_factors.cov()
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 73, in optimize_weights
    features_tensor = torch.FloatTensor(features.values)
TypeError: can't convert np.ndarray of type numpy.object_. The only supported types are: float64, float32, float16, complex64, complex128, int64, int32, int16, int8, uint64, uint32, uint16, uint8, and bool.
2025-04-17 17:23:44,546 - INFO - 
Running strategy with hmm classifier and mean_variance optimizer
2025-04-17 17:23:44,546 - INFO - Initializing strategy...
2025-04-17 17:23:44,585 - INFO - Running strategy...
2025-04-17 17:23:44,607 - WARNING - US corporate credit spread file not found
2025-04-17 17:23:44,607 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:23:44,609 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:23:44,610 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:23:44,619 - WARNING - US corporate credit spread file not found
2025-04-17 17:23:44,619 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:23:44,621 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:23:44,621 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:23:44,679 - WARNING - Found missing values in Market data data
2025-04-17 17:23:44,680 - INFO - Loaded market data with 1509 rows
2025-04-17 17:23:44,680 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:23:44,720 - WARNING - Found missing values in Market data data
2025-04-17 17:23:44,721 - INFO - Loaded market data with 1257 rows
2025-04-17 17:23:44,721 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:23:44,725 - INFO - Prepared training data with 60 samples
2025-04-17 17:23:44,725 - INFO - Class distribution: {0: 40, 1: 20}
2025-04-17 17:23:44,873 - ERROR - Error running hmm with mean_variance: Input contains NaN.
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 114, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\models\regime_classifier.py", line 132, in predict
    return self.model.predict(X_scaled)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\hmmlearn\base.py", line 375, in predict
    _, state_sequence = self.decode(X, lengths)
                        ~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\hmmlearn\base.py", line 347, in decode
    X = check_array(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input contains NaN.
2025-04-17 17:23:44,877 - INFO - 
Running strategy with hmm classifier and neural optimizer
2025-04-17 17:23:44,877 - INFO - Initializing strategy...
2025-04-17 17:23:44,878 - INFO - Running strategy...
2025-04-17 17:23:44,898 - WARNING - US corporate credit spread file not found
2025-04-17 17:23:44,898 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:23:44,901 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:23:44,901 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:23:44,910 - WARNING - US corporate credit spread file not found
2025-04-17 17:23:44,911 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:23:44,913 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:23:44,913 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:23:44,981 - WARNING - Found missing values in Market data data
2025-04-17 17:23:44,982 - INFO - Loaded market data with 1509 rows
2025-04-17 17:23:44,982 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:23:45,021 - WARNING - Found missing values in Market data data
2025-04-17 17:23:45,021 - INFO - Loaded market data with 1257 rows
2025-04-17 17:23:45,021 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:23:45,025 - INFO - Prepared training data with 60 samples
2025-04-17 17:23:45,025 - INFO - Class distribution: {0: 40, 1: 20}
2025-04-17 17:23:45,054 - ERROR - Error running hmm with neural: Input contains NaN.
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 114, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\models\regime_classifier.py", line 132, in predict
    return self.model.predict(X_scaled)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\hmmlearn\base.py", line 375, in predict
    _, state_sequence = self.decode(X, lengths)
                        ~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\hmmlearn\base.py", line 347, in decode
    X = check_array(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input contains NaN.
2025-04-17 17:23:45,056 - ERROR - No valid results obtained from parameter grid search
2025-04-17 17:23:45,056 - ERROR - No valid results obtained from parameter grid search
2025-04-17 17:23:45,056 - INFO - Factor timing strategy optimization completed
2025-04-17 17:24:54,493 - INFO - Starting factor timing strategy optimization...
2025-04-17 17:24:54,493 - INFO - Running parameter grid search...
2025-04-17 17:24:54,493 - INFO - 
Running strategy with lstm classifier and mean_variance optimizer
2025-04-17 17:24:54,493 - INFO - Initializing strategy...
2025-04-17 17:24:55,443 - INFO - Running strategy...
2025-04-17 17:24:55,465 - WARNING - US corporate credit spread file not found
2025-04-17 17:24:55,465 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:24:55,467 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:24:55,467 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:24:55,476 - WARNING - US corporate credit spread file not found
2025-04-17 17:24:55,477 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:24:55,478 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:24:55,479 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:24:56,062 - WARNING - Found missing values in Market data data
2025-04-17 17:24:56,063 - INFO - Loaded market data with 1509 rows
2025-04-17 17:24:56,063 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:24:56,478 - WARNING - Found missing values in Market data data
2025-04-17 17:24:56,479 - INFO - Loaded market data with 1257 rows
2025-04-17 17:24:56,479 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:24:56,483 - INFO - Prepared training data with 60 samples
2025-04-17 17:24:56,483 - INFO - Class distribution: {0: 40, 1: 20}
2025-04-17 17:24:57,104 - ERROR - Error running lstm with mean_variance: Solver 'OSQP' failed. Try another solver, or solve with verbose=True for more information.
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 146, in run_strategy
    weights.loc[date] = self.portfolio_optimizer.optimize_weights(
                        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        test_factors.loc[date],
        ^^^^^^^^^^^^^^^^^^^^^^^
        test_factors.cov()
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 53, in optimize_weights
    prob.solve()
    ~~~~~~~~~~^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\cvxpy\problems\problem.py", line 600, in solve
    return solve_func(self, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\cvxpy\problems\problem.py", line 1187, in _solve
    self.unpack_results(solution, solving_chain, inverse_data)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\cvxpy\problems\problem.py", line 1512, in unpack_results
    raise error.SolverError(
    ...<2 lines>...
            "information.")
cvxpy.error.SolverError: Solver 'OSQP' failed. Try another solver, or solve with verbose=True for more information.
2025-04-17 17:24:57,108 - INFO - 
Running strategy with lstm classifier and neural optimizer
2025-04-17 17:24:57,108 - INFO - Initializing strategy...
2025-04-17 17:24:57,109 - INFO - Running strategy...
2025-04-17 17:24:57,127 - WARNING - US corporate credit spread file not found
2025-04-17 17:24:57,127 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:24:57,129 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:24:57,129 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:24:57,139 - WARNING - US corporate credit spread file not found
2025-04-17 17:24:57,139 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:24:57,141 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:24:57,141 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:24:57,199 - WARNING - Found missing values in Market data data
2025-04-17 17:24:57,199 - INFO - Loaded market data with 1509 rows
2025-04-17 17:24:57,200 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:24:57,252 - WARNING - Found missing values in Market data data
2025-04-17 17:24:57,252 - INFO - Loaded market data with 1257 rows
2025-04-17 17:24:57,252 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:24:57,256 - INFO - Prepared training data with 60 samples
2025-04-17 17:24:57,257 - INFO - Class distribution: {0: 40, 1: 20}
2025-04-17 17:24:57,795 - ERROR - Error running lstm with neural: mat1 and mat2 shapes cannot be multiplied (7x2 and 6x64)
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 146, in run_strategy
    weights.loc[date] = self.portfolio_optimizer.optimize_weights(
                        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        test_factors.loc[date],
        ^^^^^^^^^^^^^^^^^^^^^^^
        test_factors.cov()
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 85, in optimize_weights
    weights = self.model(features_tensor)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 113, in forward
    x = torch.relu(self.fc1(x))
                   ~~~~~~~~^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\linear.py", line 125, in forward
    return F.linear(input, self.weight, self.bias)
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: mat1 and mat2 shapes cannot be multiplied (7x2 and 6x64)
2025-04-17 17:24:57,798 - INFO - 
Running strategy with xgboost classifier and mean_variance optimizer
2025-04-17 17:24:57,798 - INFO - Initializing strategy...
2025-04-17 17:24:57,827 - INFO - Running strategy...
2025-04-17 17:24:57,846 - WARNING - US corporate credit spread file not found
2025-04-17 17:24:57,847 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:24:57,849 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:24:57,849 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:24:57,856 - WARNING - US corporate credit spread file not found
2025-04-17 17:24:57,857 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:24:57,858 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:24:57,859 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:24:57,917 - WARNING - Found missing values in Market data data
2025-04-17 17:24:57,918 - INFO - Loaded market data with 1509 rows
2025-04-17 17:24:57,918 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:24:57,971 - WARNING - Found missing values in Market data data
2025-04-17 17:24:57,971 - INFO - Loaded market data with 1257 rows
2025-04-17 17:24:57,971 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:24:57,974 - INFO - Prepared training data with 60 samples
2025-04-17 17:24:57,975 - INFO - Class distribution: {0: 40, 1: 20}
2025-04-17 17:24:59,250 - ERROR - Error running xgboost with mean_variance: Solver 'OSQP' failed. Try another solver, or solve with verbose=True for more information.
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 146, in run_strategy
    weights.loc[date] = self.portfolio_optimizer.optimize_weights(
                        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        test_factors.loc[date],
        ^^^^^^^^^^^^^^^^^^^^^^^
        test_factors.cov()
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 53, in optimize_weights
    prob.solve()
    ~~~~~~~~~~^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\cvxpy\problems\problem.py", line 600, in solve
    return solve_func(self, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\cvxpy\problems\problem.py", line 1187, in _solve
    self.unpack_results(solution, solving_chain, inverse_data)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\cvxpy\problems\problem.py", line 1512, in unpack_results
    raise error.SolverError(
    ...<2 lines>...
            "information.")
cvxpy.error.SolverError: Solver 'OSQP' failed. Try another solver, or solve with verbose=True for more information.
2025-04-17 17:24:59,252 - INFO - 
Running strategy with xgboost classifier and neural optimizer
2025-04-17 17:24:59,252 - INFO - Initializing strategy...
2025-04-17 17:24:59,253 - INFO - Running strategy...
2025-04-17 17:24:59,275 - WARNING - US corporate credit spread file not found
2025-04-17 17:24:59,275 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:24:59,277 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:24:59,278 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:24:59,287 - WARNING - US corporate credit spread file not found
2025-04-17 17:24:59,288 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:24:59,290 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:24:59,290 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:24:59,350 - WARNING - Found missing values in Market data data
2025-04-17 17:24:59,350 - INFO - Loaded market data with 1509 rows
2025-04-17 17:24:59,351 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:24:59,391 - WARNING - Found missing values in Market data data
2025-04-17 17:24:59,391 - INFO - Loaded market data with 1257 rows
2025-04-17 17:24:59,391 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:24:59,395 - INFO - Prepared training data with 60 samples
2025-04-17 17:24:59,395 - INFO - Class distribution: {0: 40, 1: 20}
2025-04-17 17:24:59,427 - ERROR - Error running xgboost with neural: mat1 and mat2 shapes cannot be multiplied (7x2 and 6x64)
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 146, in run_strategy
    weights.loc[date] = self.portfolio_optimizer.optimize_weights(
                        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        test_factors.loc[date],
        ^^^^^^^^^^^^^^^^^^^^^^^
        test_factors.cov()
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 85, in optimize_weights
    weights = self.model(features_tensor)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 113, in forward
    x = torch.relu(self.fc1(x))
                   ~~~~~~~~^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\linear.py", line 125, in forward
    return F.linear(input, self.weight, self.bias)
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: mat1 and mat2 shapes cannot be multiplied (7x2 and 6x64)
2025-04-17 17:24:59,429 - INFO - 
Running strategy with hmm classifier and mean_variance optimizer
2025-04-17 17:24:59,429 - INFO - Initializing strategy...
2025-04-17 17:24:59,469 - INFO - Running strategy...
2025-04-17 17:24:59,491 - WARNING - US corporate credit spread file not found
2025-04-17 17:24:59,491 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:24:59,493 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:24:59,493 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:24:59,503 - WARNING - US corporate credit spread file not found
2025-04-17 17:24:59,503 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:24:59,505 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:24:59,505 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:24:59,565 - WARNING - Found missing values in Market data data
2025-04-17 17:24:59,566 - INFO - Loaded market data with 1509 rows
2025-04-17 17:24:59,566 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:24:59,618 - WARNING - Found missing values in Market data data
2025-04-17 17:24:59,618 - INFO - Loaded market data with 1257 rows
2025-04-17 17:24:59,619 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:24:59,622 - INFO - Prepared training data with 60 samples
2025-04-17 17:24:59,622 - INFO - Class distribution: {0: 40, 1: 20}
2025-04-17 17:24:59,770 - ERROR - Error running hmm with mean_variance: Input contains NaN.
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 114, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\models\regime_classifier.py", line 132, in predict
    return self.model.predict(X_scaled)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\hmmlearn\base.py", line 375, in predict
    _, state_sequence = self.decode(X, lengths)
                        ~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\hmmlearn\base.py", line 347, in decode
    X = check_array(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input contains NaN.
2025-04-17 17:24:59,773 - INFO - 
Running strategy with hmm classifier and neural optimizer
2025-04-17 17:24:59,773 - INFO - Initializing strategy...
2025-04-17 17:24:59,774 - INFO - Running strategy...
2025-04-17 17:24:59,793 - WARNING - US corporate credit spread file not found
2025-04-17 17:24:59,794 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:24:59,795 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 17:24:59,796 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 17:24:59,803 - WARNING - US corporate credit spread file not found
2025-04-17 17:24:59,804 - WARNING - 10-year Treasury rate file not found
2025-04-17 17:24:59,806 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 17:24:59,806 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 17:24:59,865 - WARNING - Found missing values in Market data data
2025-04-17 17:24:59,866 - INFO - Loaded market data with 1509 rows
2025-04-17 17:24:59,866 - INFO - Date range: 2014-01-02 00:00:00 to 2019-12-30 00:00:00
2025-04-17 17:24:59,906 - WARNING - Found missing values in Market data data
2025-04-17 17:24:59,906 - INFO - Loaded market data with 1257 rows
2025-04-17 17:24:59,906 - INFO - Date range: 2020-01-02 00:00:00 to 2024-12-30 00:00:00
2025-04-17 17:24:59,910 - INFO - Prepared training data with 60 samples
2025-04-17 17:24:59,910 - INFO - Class distribution: {0: 40, 1: 20}
2025-04-17 17:24:59,941 - ERROR - Error running hmm with neural: Input contains NaN.
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\run_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 114, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\models\regime_classifier.py", line 132, in predict
    return self.model.predict(X_scaled)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\hmmlearn\base.py", line 375, in predict
    _, state_sequence = self.decode(X, lengths)
                        ~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\hmmlearn\base.py", line 347, in decode
    X = check_array(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input contains NaN.
2025-04-17 17:24:59,943 - ERROR - No valid results obtained from parameter grid search
2025-04-17 17:24:59,943 - ERROR - No valid results obtained from parameter grid search
2025-04-17 17:24:59,943 - INFO - Factor timing strategy optimization completed
2025-04-17 21:13:04,058 - INFO - Starting factor timing strategy optimization...
2025-04-17 21:13:04,059 - INFO - Running parameter grid search...
2025-04-17 21:13:04,059 - INFO - 
Running strategy with lstm classifier and mean_variance optimizer
2025-04-17 21:13:04,059 - INFO - Initializing strategy...
2025-04-17 21:13:04,059 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 21:13:04,060 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:13:04,060 - INFO - Initialized LSTMRegimeClassifier with 64 hidden units, 2 layers
2025-04-17 21:13:04,060 - INFO - Running strategy...
2025-04-17 21:13:04,060 - INFO - Starting strategy execution...
2025-04-17 21:13:04,061 - INFO - Preparing training and testing data...
2025-04-17 21:13:04,061 - INFO - Starting data preparation...
2025-04-17 21:13:04,061 - INFO - Loading Fama-French factors...
2025-04-17 21:13:04,076 - INFO - Fama-French factors loaded
2025-04-17 21:13:04,076 - INFO - Processing factor data...
2025-04-17 21:13:04,080 - INFO - Factor data processed
2025-04-17 21:13:04,080 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:13:04,080 - INFO - 
Training Period:
2025-04-17 21:13:04,085 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:13:04,097 - INFO - 
Testing Period:
2025-04-17 21:13:04,105 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:13:04,113 - INFO - Loading macro and market data...
2025-04-17 21:13:04,115 - INFO - Loading existing macro data...
2025-04-17 21:13:04,119 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:13:04,120 - INFO - Loading existing macro data...
2025-04-17 21:13:04,131 - WARNING - US corporate credit spread file not found
2025-04-17 21:13:04,131 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:13:04,136 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:13:04,136 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:13:04,136 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:13:04,137 - INFO - Loading existing market data...
2025-04-17 21:13:04,141 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:13:04,142 - INFO - Loading existing market data...
2025-04-17 21:13:04,147 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:13:04,147 - INFO - Macro and market data loaded
2025-04-17 21:13:04,147 - INFO - Preparing training data for regime classification...
2025-04-17 21:13:04,148 - INFO - Loading existing macro data...
2025-04-17 21:13:04,160 - WARNING - US corporate credit spread file not found
2025-04-17 21:13:04,160 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:13:04,163 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:13:04,164 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:13:04,164 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:13:04,165 - INFO - Loading existing market data...
2025-04-17 21:13:04,169 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:13:04,173 - INFO - Prepared training data with 1508 samples
2025-04-17 21:13:04,174 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:13:04,174 - INFO - Training data prepared
2025-04-17 21:13:04,174 - INFO - Storing data...
2025-04-17 21:13:04,175 - INFO - Aligning data indices...
2025-04-17 21:13:04,176 - INFO - Data indices aligned
2025-04-17 21:13:04,176 - INFO - Data preparation completed
2025-04-17 21:13:04,177 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:13:04,177 - INFO - Training models...
2025-04-17 21:13:04,177 - INFO - Starting model training...
2025-04-17 21:13:04,177 - INFO - Training regime classifier...
2025-04-17 21:13:04,178 - INFO - Training LSTM model...
2025-04-17 21:13:05,308 - INFO - Initialized LSTM model and optimizer
2025-04-17 21:13:05,309 - INFO - Preparing features...
2025-04-17 21:13:05,310 - INFO - Input shape: (1508, 6)
2025-04-17 21:13:05,310 - INFO - Handling missing values...
2025-04-17 21:13:05,312 - INFO - Missing values: 4389 -> 0
2025-04-17 21:13:05,312 - INFO - Scaling features...
2025-04-17 21:13:05,314 - INFO - Fitted new scaler
2025-04-17 21:13:05,315 - INFO - Output shape: (1508, 6)
2025-04-17 21:13:05,315 - INFO - Prepared tensors - X: torch.Size([1508, 1, 6]), y: torch.Size([1508])
2025-04-17 21:13:05,318 - INFO - Created data loaders - Train: 1206 samples, Val: 302 samples
2025-04-17 21:13:05,503 - INFO - Epoch 1/100 - Train Loss: 18.3173, Val Loss: 6.5485 (Best)
2025-04-17 21:13:05,629 - INFO - Epoch 2/100 - Train Loss: 16.7771, Val Loss: 5.3056 (Best)
2025-04-17 21:13:05,758 - INFO - Epoch 3/100 - Train Loss: 16.4304, Val Loss: 5.1448 (Best)
2025-04-17 21:13:05,894 - INFO - Epoch 4/100 - Train Loss: 16.3419, Val Loss: 5.2797
2025-04-17 21:13:06,019 - INFO - Epoch 5/100 - Train Loss: 15.9000, Val Loss: 5.1473
2025-04-17 21:13:06,147 - INFO - Epoch 6/100 - Train Loss: 16.4014, Val Loss: 5.2864
2025-04-17 21:13:06,276 - INFO - Epoch 7/100 - Train Loss: 16.4103, Val Loss: 5.2171
2025-04-17 21:13:06,431 - INFO - Epoch 8/100 - Train Loss: 16.7838, Val Loss: 5.4312
2025-04-17 21:13:06,432 - INFO - Early stopping triggered after 8 epochs
2025-04-17 21:13:06,432 - INFO - Generating LSTM predictions...
2025-04-17 21:13:06,434 - INFO - Input tensor shape: torch.Size([1508, 1, 6])
2025-04-17 21:13:06,439 - INFO - Prediction distribution: {0: np.int64(1483), 1: np.int64(25)}
2025-04-17 21:13:06,760 - INFO - Model training completed
2025-04-17 21:13:06,763 - INFO - Model training completed
2025-04-17 21:13:06,763 - INFO - Initializing portfolio weights...
2025-04-17 21:13:06,764 - INFO - Portfolio weights initialized
2025-04-17 21:13:06,764 - INFO - Generating regime predictions for test period...
2025-04-17 21:13:06,766 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:13:06,766 - INFO - Generating LSTM predictions...
2025-04-17 21:13:06,767 - INFO - Input tensor shape: torch.Size([41, 1, 6])
2025-04-17 21:13:06,771 - INFO - Prediction distribution: {0: np.int64(20), 1: np.int64(21)}
2025-04-17 21:13:06,771 - INFO - Generated 41 regime predictions
2025-04-17 21:13:06,771 - INFO - Calculating regime-specific returns...
2025-04-17 21:13:06,773 - INFO - Generating LSTM predictions...
2025-04-17 21:13:06,775 - INFO - Input tensor shape: torch.Size([45, 1, 6])
2025-04-17 21:13:06,777 - INFO - Prediction distribution: {0: np.int64(20), 1: np.int64(25)}
2025-04-17 21:13:06,778 - INFO - Found 2 unique regimes
2025-04-17 21:13:06,778 - INFO - Processing regime 0...
2025-04-17 21:13:06,779 - INFO - Regime 0: 20 samples
2025-04-17 21:13:06,780 - INFO - Processing regime 1...
2025-04-17 21:13:06,781 - INFO - Regime 1: 25 samples
2025-04-17 21:13:06,781 - INFO - Training portfolio optimizer...
2025-04-17 21:13:06,781 - INFO - Training mean-variance optimizer...
2025-04-17 21:13:06,781 - INFO - Mean-variance optimizer training completed
2025-04-17 21:13:06,782 - INFO - Portfolio optimizer training completed
2025-04-17 21:13:06,782 - INFO - Optimizing portfolio weights...
2025-04-17 21:13:06,788 - WARNING - All weights are zero, using equal weights
2025-04-17 21:13:06,815 - INFO - Portfolio optimization completed
2025-04-17 21:13:06,815 - INFO - Running backtest...
2025-04-17 21:13:06,823 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:13:06,823 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:13:06,824 - INFO - Starting backtest...
2025-04-17 21:13:06,824 - INFO - Aligning dates between weights and returns...
2025-04-17 21:13:06,824 - INFO - Aligned 41 common dates
2025-04-17 21:13:06,825 - INFO - Initializing portfolio...
2025-04-17 21:13:06,825 - INFO - Running backtest simulation...
2025-04-17 21:13:06,834 - INFO - Backtest simulation completed
2025-04-17 21:13:06,835 - INFO - Storing backtest results...
2025-04-17 21:13:06,835 - INFO - Backtest completed successfully
2025-04-17 21:13:06,836 - INFO - Backtest completed
2025-04-17 21:13:06,836 - INFO - Strategy execution completed
2025-04-17 21:13:06,836 - ERROR - Error running lstm with mean_variance: Missing required metric: sharpe_ratio
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 61, in run_parameter_grid
    raise ValueError(f"Missing required metric: {metric}")
ValueError: Missing required metric: sharpe_ratio
2025-04-17 21:13:06,837 - INFO - 
Running strategy with lstm classifier and regime_aware optimizer
2025-04-17 21:13:06,838 - INFO - Initializing strategy...
2025-04-17 21:13:06,838 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 21:13:06,838 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:13:06,838 - INFO - Initialized LSTMRegimeClassifier with 64 hidden units, 2 layers
2025-04-17 21:13:06,839 - INFO - Running strategy...
2025-04-17 21:13:06,839 - INFO - Starting strategy execution...
2025-04-17 21:13:06,839 - INFO - Preparing training and testing data...
2025-04-17 21:13:06,840 - INFO - Starting data preparation...
2025-04-17 21:13:06,840 - INFO - Loading Fama-French factors...
2025-04-17 21:13:06,853 - INFO - Fama-French factors loaded
2025-04-17 21:13:06,853 - INFO - Processing factor data...
2025-04-17 21:13:06,856 - INFO - Factor data processed
2025-04-17 21:13:06,856 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:13:06,856 - INFO - 
Training Period:
2025-04-17 21:13:06,862 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:13:06,871 - INFO - 
Testing Period:
2025-04-17 21:13:06,876 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:13:06,885 - INFO - Loading macro and market data...
2025-04-17 21:13:06,887 - INFO - Loading existing macro data...
2025-04-17 21:13:06,891 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:13:06,892 - INFO - Loading existing macro data...
2025-04-17 21:13:06,902 - WARNING - US corporate credit spread file not found
2025-04-17 21:13:06,903 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:13:06,906 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:13:06,907 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:13:06,907 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:13:06,908 - INFO - Loading existing market data...
2025-04-17 21:13:06,913 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:13:06,914 - INFO - Loading existing market data...
2025-04-17 21:13:06,918 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:13:06,918 - INFO - Macro and market data loaded
2025-04-17 21:13:06,918 - INFO - Preparing training data for regime classification...
2025-04-17 21:13:06,919 - INFO - Loading existing macro data...
2025-04-17 21:13:06,935 - WARNING - US corporate credit spread file not found
2025-04-17 21:13:06,935 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:13:06,939 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:13:06,939 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:13:06,939 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:13:06,940 - INFO - Loading existing market data...
2025-04-17 21:13:06,945 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:13:06,948 - INFO - Prepared training data with 1508 samples
2025-04-17 21:13:06,949 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:13:06,949 - INFO - Training data prepared
2025-04-17 21:13:06,949 - INFO - Storing data...
2025-04-17 21:13:06,949 - INFO - Aligning data indices...
2025-04-17 21:13:06,950 - INFO - Data indices aligned
2025-04-17 21:13:06,951 - INFO - Data preparation completed
2025-04-17 21:13:06,951 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:13:06,951 - INFO - Training models...
2025-04-17 21:13:06,951 - INFO - Starting model training...
2025-04-17 21:13:06,951 - INFO - Training regime classifier...
2025-04-17 21:13:06,951 - INFO - Training LSTM model...
2025-04-17 21:13:06,953 - INFO - Initialized LSTM model and optimizer
2025-04-17 21:13:06,953 - INFO - Preparing features...
2025-04-17 21:13:06,953 - INFO - Input shape: (1508, 6)
2025-04-17 21:13:06,953 - INFO - Handling missing values...
2025-04-17 21:13:06,955 - INFO - Missing values: 4389 -> 0
2025-04-17 21:13:06,955 - INFO - Scaling features...
2025-04-17 21:13:06,956 - INFO - Fitted new scaler
2025-04-17 21:13:06,957 - INFO - Output shape: (1508, 6)
2025-04-17 21:13:06,958 - INFO - Prepared tensors - X: torch.Size([1508, 1, 6]), y: torch.Size([1508])
2025-04-17 21:13:06,959 - INFO - Created data loaders - Train: 1206 samples, Val: 302 samples
2025-04-17 21:13:07,100 - INFO - Epoch 1/100 - Train Loss: 19.3267, Val Loss: 6.4589 (Best)
2025-04-17 21:13:07,235 - INFO - Epoch 2/100 - Train Loss: 17.8361, Val Loss: 4.5782 (Best)
2025-04-17 21:13:07,370 - INFO - Epoch 3/100 - Train Loss: 17.9127, Val Loss: 3.9956 (Best)
2025-04-17 21:13:07,496 - INFO - Epoch 4/100 - Train Loss: 17.5859, Val Loss: 4.0273
2025-04-17 21:13:07,617 - INFO - Epoch 5/100 - Train Loss: 17.8808, Val Loss: 4.0445
2025-04-17 21:13:07,746 - INFO - Epoch 6/100 - Train Loss: 17.2645, Val Loss: 3.9896 (Best)
2025-04-17 21:13:07,870 - INFO - Epoch 7/100 - Train Loss: 17.2896, Val Loss: 4.1039
2025-04-17 21:13:07,994 - INFO - Epoch 8/100 - Train Loss: 17.3108, Val Loss: 3.9689 (Best)
2025-04-17 21:13:08,126 - INFO - Epoch 9/100 - Train Loss: 16.9732, Val Loss: 3.9843
2025-04-17 21:13:08,252 - INFO - Epoch 10/100 - Train Loss: 17.3642, Val Loss: 3.9779
2025-04-17 21:13:08,373 - INFO - Epoch 11/100 - Train Loss: 17.6341, Val Loss: 4.0165
2025-04-17 21:13:08,508 - INFO - Epoch 12/100 - Train Loss: 17.2924, Val Loss: 4.0459
2025-04-17 21:13:08,622 - INFO - Epoch 13/100 - Train Loss: 17.0614, Val Loss: 3.9849
2025-04-17 21:13:08,623 - INFO - Early stopping triggered after 13 epochs
2025-04-17 21:13:08,623 - INFO - Generating LSTM predictions...
2025-04-17 21:13:08,624 - INFO - Input tensor shape: torch.Size([1508, 1, 6])
2025-04-17 21:13:08,628 - INFO - Prediction distribution: {0: np.int64(1488), 1: np.int64(20)}
2025-04-17 21:13:08,800 - INFO - Model training completed
2025-04-17 21:13:08,802 - INFO - Model training completed
2025-04-17 21:13:08,802 - INFO - Initializing portfolio weights...
2025-04-17 21:13:08,803 - INFO - Portfolio weights initialized
2025-04-17 21:13:08,803 - INFO - Generating regime predictions for test period...
2025-04-17 21:13:08,805 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:13:08,805 - INFO - Generating LSTM predictions...
2025-04-17 21:13:08,806 - INFO - Input tensor shape: torch.Size([41, 1, 6])
2025-04-17 21:13:08,808 - INFO - Prediction distribution: {0: np.int64(22), 1: np.int64(19)}
2025-04-17 21:13:08,808 - INFO - Generated 41 regime predictions
2025-04-17 21:13:08,808 - INFO - Calculating regime-specific returns...
2025-04-17 21:13:08,809 - INFO - Generating LSTM predictions...
2025-04-17 21:13:08,810 - INFO - Input tensor shape: torch.Size([45, 1, 6])
2025-04-17 21:13:08,811 - INFO - Prediction distribution: {0: np.int64(25), 1: np.int64(20)}
2025-04-17 21:13:08,812 - INFO - Found 2 unique regimes
2025-04-17 21:13:08,812 - INFO - Processing regime 0...
2025-04-17 21:13:08,813 - INFO - Regime 0: 25 samples
2025-04-17 21:13:08,813 - INFO - Processing regime 1...
2025-04-17 21:13:08,814 - INFO - Regime 1: 20 samples
2025-04-17 21:13:08,814 - INFO - Training portfolio optimizer...
2025-04-17 21:13:08,814 - INFO - Training regime-aware optimizer...
2025-04-17 21:13:08,815 - INFO - Training mean-variance optimizer...
2025-04-17 21:13:08,815 - INFO - Mean-variance optimizer training completed
2025-04-17 21:13:08,815 - INFO - Trained optimizer for regime 0 with 25 samples
2025-04-17 21:13:08,815 - INFO - Training mean-variance optimizer...
2025-04-17 21:13:08,816 - INFO - Mean-variance optimizer training completed
2025-04-17 21:13:08,816 - INFO - Trained optimizer for regime 1 with 20 samples
2025-04-17 21:13:08,816 - WARNING - No samples found for regime 2
2025-04-17 21:13:08,817 - INFO - Portfolio optimizer training completed
2025-04-17 21:13:08,817 - INFO - Optimizing portfolio weights...
2025-04-17 21:13:08,817 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:08,818 - WARNING - All weights are zero, using equal weights
2025-04-17 21:13:08,819 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:08,820 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:08,821 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:08,821 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:08,822 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:08,823 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:08,824 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:08,825 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:08,826 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:08,827 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:08,828 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:08,829 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:08,830 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:08,831 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:08,832 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:08,833 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:08,834 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:08,834 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:08,835 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:08,836 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:08,837 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:08,838 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:08,839 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:08,840 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:08,841 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:08,841 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:08,842 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:08,843 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:08,844 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:08,845 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:08,846 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:08,847 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:08,848 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:08,849 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:08,849 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:08,850 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:08,851 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:08,852 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:08,853 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:08,854 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:08,855 - INFO - Portfolio optimization completed
2025-04-17 21:13:08,855 - INFO - Running backtest...
2025-04-17 21:13:08,864 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:13:08,865 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:13:08,865 - INFO - Starting backtest...
2025-04-17 21:13:08,865 - INFO - Aligning dates between weights and returns...
2025-04-17 21:13:08,866 - INFO - Aligned 41 common dates
2025-04-17 21:13:08,866 - INFO - Initializing portfolio...
2025-04-17 21:13:08,867 - INFO - Running backtest simulation...
2025-04-17 21:13:08,875 - INFO - Backtest simulation completed
2025-04-17 21:13:08,875 - INFO - Storing backtest results...
2025-04-17 21:13:08,875 - INFO - Backtest completed successfully
2025-04-17 21:13:08,876 - INFO - Backtest completed
2025-04-17 21:13:08,876 - INFO - Strategy execution completed
2025-04-17 21:13:08,876 - ERROR - Error running lstm with regime_aware: Missing required metric: sharpe_ratio
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 61, in run_parameter_grid
    raise ValueError(f"Missing required metric: {metric}")
ValueError: Missing required metric: sharpe_ratio
2025-04-17 21:13:08,877 - INFO - 
Running strategy with lstm classifier and neural optimizer
2025-04-17 21:13:08,877 - INFO - Initializing strategy...
2025-04-17 21:13:08,877 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 21:13:08,877 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:13:08,878 - INFO - Initialized LSTMRegimeClassifier with 64 hidden units, 2 layers
2025-04-17 21:13:08,879 - INFO - Running strategy...
2025-04-17 21:13:08,879 - INFO - Starting strategy execution...
2025-04-17 21:13:08,879 - INFO - Preparing training and testing data...
2025-04-17 21:13:08,879 - INFO - Starting data preparation...
2025-04-17 21:13:08,879 - INFO - Loading Fama-French factors...
2025-04-17 21:13:08,890 - INFO - Fama-French factors loaded
2025-04-17 21:13:08,890 - INFO - Processing factor data...
2025-04-17 21:13:08,892 - INFO - Factor data processed
2025-04-17 21:13:08,892 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:13:08,893 - INFO - 
Training Period:
2025-04-17 21:13:08,897 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:13:08,906 - INFO - 
Testing Period:
2025-04-17 21:13:08,911 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:13:08,919 - INFO - Loading macro and market data...
2025-04-17 21:13:08,921 - INFO - Loading existing macro data...
2025-04-17 21:13:08,924 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:13:08,925 - INFO - Loading existing macro data...
2025-04-17 21:13:08,935 - WARNING - US corporate credit spread file not found
2025-04-17 21:13:08,935 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:13:08,938 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:13:08,938 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:13:08,939 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:13:08,940 - INFO - Loading existing market data...
2025-04-17 21:13:08,944 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:13:08,945 - INFO - Loading existing market data...
2025-04-17 21:13:08,947 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:13:08,947 - INFO - Macro and market data loaded
2025-04-17 21:13:08,948 - INFO - Preparing training data for regime classification...
2025-04-17 21:13:08,949 - INFO - Loading existing macro data...
2025-04-17 21:13:08,958 - WARNING - US corporate credit spread file not found
2025-04-17 21:13:08,958 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:13:08,961 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:13:08,961 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:13:08,962 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:13:08,963 - INFO - Loading existing market data...
2025-04-17 21:13:08,967 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:13:08,970 - INFO - Prepared training data with 1508 samples
2025-04-17 21:13:08,971 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:13:08,971 - INFO - Training data prepared
2025-04-17 21:13:08,971 - INFO - Storing data...
2025-04-17 21:13:08,971 - INFO - Aligning data indices...
2025-04-17 21:13:08,973 - INFO - Data indices aligned
2025-04-17 21:13:08,973 - INFO - Data preparation completed
2025-04-17 21:13:08,973 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:13:08,973 - INFO - Training models...
2025-04-17 21:13:08,973 - INFO - Starting model training...
2025-04-17 21:13:08,973 - INFO - Training regime classifier...
2025-04-17 21:13:08,973 - INFO - Training LSTM model...
2025-04-17 21:13:08,974 - INFO - Initialized LSTM model and optimizer
2025-04-17 21:13:08,975 - INFO - Preparing features...
2025-04-17 21:13:08,975 - INFO - Input shape: (1508, 6)
2025-04-17 21:13:08,975 - INFO - Handling missing values...
2025-04-17 21:13:08,976 - INFO - Missing values: 4389 -> 0
2025-04-17 21:13:08,976 - INFO - Scaling features...
2025-04-17 21:13:08,977 - INFO - Fitted new scaler
2025-04-17 21:13:08,978 - INFO - Output shape: (1508, 6)
2025-04-17 21:13:08,979 - INFO - Prepared tensors - X: torch.Size([1508, 1, 6]), y: torch.Size([1508])
2025-04-17 21:13:08,979 - INFO - Created data loaders - Train: 1206 samples, Val: 302 samples
2025-04-17 21:13:09,107 - INFO - Epoch 1/100 - Train Loss: 18.7926, Val Loss: 6.4376 (Best)
2025-04-17 21:13:09,243 - INFO - Epoch 2/100 - Train Loss: 16.8646, Val Loss: 4.7466 (Best)
2025-04-17 21:13:09,362 - INFO - Epoch 3/100 - Train Loss: 17.6399, Val Loss: 4.4365 (Best)
2025-04-17 21:13:09,486 - INFO - Epoch 4/100 - Train Loss: 17.3116, Val Loss: 4.4517
2025-04-17 21:13:09,602 - INFO - Epoch 5/100 - Train Loss: 16.8640, Val Loss: 4.4237 (Best)
2025-04-17 21:13:09,719 - INFO - Epoch 6/100 - Train Loss: 16.6275, Val Loss: 4.4400
2025-04-17 21:13:09,864 - INFO - Epoch 7/100 - Train Loss: 17.0758, Val Loss: 4.4254
2025-04-17 21:13:10,004 - INFO - Epoch 8/100 - Train Loss: 17.0221, Val Loss: 4.3950 (Best)
2025-04-17 21:13:10,132 - INFO - Epoch 9/100 - Train Loss: 17.4032, Val Loss: 4.3776 (Best)
2025-04-17 21:13:10,264 - INFO - Epoch 10/100 - Train Loss: 17.1968, Val Loss: 4.4279
2025-04-17 21:13:10,403 - INFO - Epoch 11/100 - Train Loss: 17.2437, Val Loss: 4.3554 (Best)
2025-04-17 21:13:10,540 - INFO - Epoch 12/100 - Train Loss: 16.6437, Val Loss: 4.3866
2025-04-17 21:13:10,693 - INFO - Epoch 13/100 - Train Loss: 16.9774, Val Loss: 4.3956
2025-04-17 21:13:10,835 - INFO - Epoch 14/100 - Train Loss: 16.8664, Val Loss: 4.4048
2025-04-17 21:13:10,965 - INFO - Epoch 15/100 - Train Loss: 16.2691, Val Loss: 4.4041
2025-04-17 21:13:11,105 - INFO - Epoch 16/100 - Train Loss: 16.6193, Val Loss: 4.4545
2025-04-17 21:13:11,105 - INFO - Early stopping triggered after 16 epochs
2025-04-17 21:13:11,106 - INFO - Generating LSTM predictions...
2025-04-17 21:13:11,107 - INFO - Input tensor shape: torch.Size([1508, 1, 6])
2025-04-17 21:13:11,109 - INFO - Prediction distribution: {0: np.int64(1487), 1: np.int64(21)}
2025-04-17 21:13:11,286 - INFO - Training neural portfolio optimizer...
2025-04-17 21:13:11,286 - INFO - Neural portfolio optimizer training completed
2025-04-17 21:13:11,286 - INFO - Model training completed
2025-04-17 21:13:11,288 - INFO - Model training completed
2025-04-17 21:13:11,288 - INFO - Initializing portfolio weights...
2025-04-17 21:13:11,289 - INFO - Portfolio weights initialized
2025-04-17 21:13:11,289 - INFO - Generating regime predictions for test period...
2025-04-17 21:13:11,291 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:13:11,291 - INFO - Generating LSTM predictions...
2025-04-17 21:13:11,293 - INFO - Input tensor shape: torch.Size([41, 1, 6])
2025-04-17 21:13:11,294 - INFO - Prediction distribution: {0: np.int64(19), 1: np.int64(22)}
2025-04-17 21:13:11,295 - INFO - Generated 41 regime predictions
2025-04-17 21:13:11,295 - INFO - Calculating regime-specific returns...
2025-04-17 21:13:11,296 - INFO - Generating LSTM predictions...
2025-04-17 21:13:11,298 - INFO - Input tensor shape: torch.Size([45, 1, 6])
2025-04-17 21:13:11,299 - INFO - Prediction distribution: {0: np.int64(24), 1: np.int64(21)}
2025-04-17 21:13:11,299 - INFO - Found 2 unique regimes
2025-04-17 21:13:11,299 - INFO - Processing regime 0...
2025-04-17 21:13:11,301 - INFO - Regime 0: 24 samples
2025-04-17 21:13:11,301 - INFO - Processing regime 1...
2025-04-17 21:13:11,302 - INFO - Regime 1: 21 samples
2025-04-17 21:13:11,303 - INFO - Training portfolio optimizer...
2025-04-17 21:13:11,303 - ERROR - Error running lstm with neural: NeuralPortfolioOptimizer.train() missing 1 required positional argument: 'target_weights'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 279, in run_strategy
    self.portfolio_optimizer.train(train_factors)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
TypeError: NeuralPortfolioOptimizer.train() missing 1 required positional argument: 'target_weights'
2025-04-17 21:13:11,305 - INFO - 
Running strategy with xgboost classifier and mean_variance optimizer
2025-04-17 21:13:11,305 - INFO - Initializing strategy...
2025-04-17 21:13:11,306 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 21:13:11,306 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:13:11,359 - INFO - Running strategy...
2025-04-17 21:13:11,360 - INFO - Starting strategy execution...
2025-04-17 21:13:11,360 - INFO - Preparing training and testing data...
2025-04-17 21:13:11,360 - INFO - Starting data preparation...
2025-04-17 21:13:11,360 - INFO - Loading Fama-French factors...
2025-04-17 21:13:11,372 - INFO - Fama-French factors loaded
2025-04-17 21:13:11,372 - INFO - Processing factor data...
2025-04-17 21:13:11,374 - INFO - Factor data processed
2025-04-17 21:13:11,374 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:13:11,374 - INFO - 
Training Period:
2025-04-17 21:13:11,380 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:13:11,391 - INFO - 
Testing Period:
2025-04-17 21:13:11,397 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:13:11,404 - INFO - Loading macro and market data...
2025-04-17 21:13:11,405 - INFO - Loading existing macro data...
2025-04-17 21:13:11,408 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:13:11,409 - INFO - Loading existing macro data...
2025-04-17 21:13:11,419 - WARNING - US corporate credit spread file not found
2025-04-17 21:13:11,419 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:13:11,422 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:13:11,422 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:13:11,423 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:13:11,424 - INFO - Loading existing market data...
2025-04-17 21:13:11,428 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:13:11,429 - INFO - Loading existing market data...
2025-04-17 21:13:11,433 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:13:11,433 - INFO - Macro and market data loaded
2025-04-17 21:13:11,433 - INFO - Preparing training data for regime classification...
2025-04-17 21:13:11,434 - INFO - Loading existing macro data...
2025-04-17 21:13:11,446 - WARNING - US corporate credit spread file not found
2025-04-17 21:13:11,447 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:13:11,451 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:13:11,451 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:13:11,452 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:13:11,453 - INFO - Loading existing market data...
2025-04-17 21:13:11,459 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:13:11,463 - INFO - Prepared training data with 1508 samples
2025-04-17 21:13:11,463 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:13:11,464 - INFO - Training data prepared
2025-04-17 21:13:11,464 - INFO - Storing data...
2025-04-17 21:13:11,464 - INFO - Aligning data indices...
2025-04-17 21:13:11,466 - INFO - Data indices aligned
2025-04-17 21:13:11,466 - INFO - Data preparation completed
2025-04-17 21:13:11,466 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:13:11,466 - INFO - Training models...
2025-04-17 21:13:11,467 - INFO - Starting model training...
2025-04-17 21:13:11,467 - INFO - Training regime classifier...
2025-04-17 21:13:11,467 - INFO - Preparing features...
2025-04-17 21:13:11,467 - INFO - Input shape: (1508, 6)
2025-04-17 21:13:11,467 - INFO - Handling missing values...
2025-04-17 21:13:11,469 - INFO - Missing values: 4389 -> 0
2025-04-17 21:13:11,469 - INFO - Scaling features...
2025-04-17 21:13:11,471 - INFO - Fitted new scaler
2025-04-17 21:13:11,472 - INFO - Output shape: (1508, 6)
2025-04-17 21:13:13,058 - INFO - Model training completed
2025-04-17 21:13:13,060 - INFO - Model training completed
2025-04-17 21:13:13,060 - INFO - Initializing portfolio weights...
2025-04-17 21:13:13,060 - INFO - Portfolio weights initialized
2025-04-17 21:13:13,061 - INFO - Generating regime predictions for test period...
2025-04-17 21:13:13,062 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:13:13,065 - INFO - Generated 41 regime predictions
2025-04-17 21:13:13,065 - INFO - Calculating regime-specific returns...
2025-04-17 21:13:13,069 - INFO - Found 2 unique regimes
2025-04-17 21:13:13,069 - INFO - Processing regime 0...
2025-04-17 21:13:13,071 - INFO - Regime 0: 27 samples
2025-04-17 21:13:13,071 - INFO - Processing regime 1...
2025-04-17 21:13:13,072 - INFO - Regime 1: 18 samples
2025-04-17 21:13:13,072 - INFO - Training portfolio optimizer...
2025-04-17 21:13:13,072 - INFO - Training mean-variance optimizer...
2025-04-17 21:13:13,072 - INFO - Mean-variance optimizer training completed
2025-04-17 21:13:13,073 - INFO - Portfolio optimizer training completed
2025-04-17 21:13:13,073 - INFO - Optimizing portfolio weights...
2025-04-17 21:13:13,074 - WARNING - All weights are zero, using equal weights
2025-04-17 21:13:13,104 - INFO - Portfolio optimization completed
2025-04-17 21:13:13,105 - INFO - Running backtest...
2025-04-17 21:13:13,113 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:13:13,113 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:13:13,114 - INFO - Starting backtest...
2025-04-17 21:13:13,114 - INFO - Aligning dates between weights and returns...
2025-04-17 21:13:13,115 - INFO - Aligned 41 common dates
2025-04-17 21:13:13,115 - INFO - Initializing portfolio...
2025-04-17 21:13:13,115 - INFO - Running backtest simulation...
2025-04-17 21:13:13,128 - INFO - Backtest simulation completed
2025-04-17 21:13:13,128 - INFO - Storing backtest results...
2025-04-17 21:13:13,128 - INFO - Backtest completed successfully
2025-04-17 21:13:13,129 - INFO - Backtest completed
2025-04-17 21:13:13,129 - INFO - Strategy execution completed
2025-04-17 21:13:13,129 - ERROR - Error running xgboost with mean_variance: Missing required metric: sharpe_ratio
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 61, in run_parameter_grid
    raise ValueError(f"Missing required metric: {metric}")
ValueError: Missing required metric: sharpe_ratio
2025-04-17 21:13:13,130 - INFO - 
Running strategy with xgboost classifier and regime_aware optimizer
2025-04-17 21:13:13,131 - INFO - Initializing strategy...
2025-04-17 21:13:13,131 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 21:13:13,131 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:13:13,131 - INFO - Running strategy...
2025-04-17 21:13:13,132 - INFO - Starting strategy execution...
2025-04-17 21:13:13,132 - INFO - Preparing training and testing data...
2025-04-17 21:13:13,132 - INFO - Starting data preparation...
2025-04-17 21:13:13,132 - INFO - Loading Fama-French factors...
2025-04-17 21:13:13,147 - INFO - Fama-French factors loaded
2025-04-17 21:13:13,148 - INFO - Processing factor data...
2025-04-17 21:13:13,151 - INFO - Factor data processed
2025-04-17 21:13:13,151 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:13:13,152 - INFO - 
Training Period:
2025-04-17 21:13:13,158 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:13:13,170 - INFO - 
Testing Period:
2025-04-17 21:13:13,176 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:13:13,183 - INFO - Loading macro and market data...
2025-04-17 21:13:13,185 - INFO - Loading existing macro data...
2025-04-17 21:13:13,188 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:13:13,188 - INFO - Loading existing macro data...
2025-04-17 21:13:13,196 - WARNING - US corporate credit spread file not found
2025-04-17 21:13:13,197 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:13:13,199 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:13:13,200 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:13:13,200 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:13:13,201 - INFO - Loading existing market data...
2025-04-17 21:13:13,205 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:13:13,206 - INFO - Loading existing market data...
2025-04-17 21:13:13,209 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:13:13,209 - INFO - Macro and market data loaded
2025-04-17 21:13:13,209 - INFO - Preparing training data for regime classification...
2025-04-17 21:13:13,211 - INFO - Loading existing macro data...
2025-04-17 21:13:13,224 - WARNING - US corporate credit spread file not found
2025-04-17 21:13:13,225 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:13:13,228 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:13:13,229 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:13:13,229 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:13:13,231 - INFO - Loading existing market data...
2025-04-17 21:13:13,234 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:13:13,238 - INFO - Prepared training data with 1508 samples
2025-04-17 21:13:13,238 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:13:13,239 - INFO - Training data prepared
2025-04-17 21:13:13,239 - INFO - Storing data...
2025-04-17 21:13:13,239 - INFO - Aligning data indices...
2025-04-17 21:13:13,241 - INFO - Data indices aligned
2025-04-17 21:13:13,241 - INFO - Data preparation completed
2025-04-17 21:13:13,241 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:13:13,241 - INFO - Training models...
2025-04-17 21:13:13,242 - INFO - Starting model training...
2025-04-17 21:13:13,242 - INFO - Training regime classifier...
2025-04-17 21:13:13,242 - INFO - Preparing features...
2025-04-17 21:13:13,243 - INFO - Input shape: (1508, 6)
2025-04-17 21:13:13,243 - INFO - Handling missing values...
2025-04-17 21:13:13,245 - INFO - Missing values: 4389 -> 0
2025-04-17 21:13:13,245 - INFO - Scaling features...
2025-04-17 21:13:13,246 - INFO - Fitted new scaler
2025-04-17 21:13:13,247 - INFO - Output shape: (1508, 6)
2025-04-17 21:13:13,524 - INFO - Model training completed
2025-04-17 21:13:13,526 - INFO - Model training completed
2025-04-17 21:13:13,526 - INFO - Initializing portfolio weights...
2025-04-17 21:13:13,527 - INFO - Portfolio weights initialized
2025-04-17 21:13:13,527 - INFO - Generating regime predictions for test period...
2025-04-17 21:13:13,529 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:13:13,531 - INFO - Generated 41 regime predictions
2025-04-17 21:13:13,531 - INFO - Calculating regime-specific returns...
2025-04-17 21:13:13,535 - INFO - Found 2 unique regimes
2025-04-17 21:13:13,536 - INFO - Processing regime 0...
2025-04-17 21:13:13,537 - INFO - Regime 0: 27 samples
2025-04-17 21:13:13,537 - INFO - Processing regime 1...
2025-04-17 21:13:13,538 - INFO - Regime 1: 18 samples
2025-04-17 21:13:13,538 - INFO - Training portfolio optimizer...
2025-04-17 21:13:13,539 - INFO - Training regime-aware optimizer...
2025-04-17 21:13:13,539 - INFO - Training mean-variance optimizer...
2025-04-17 21:13:13,539 - INFO - Mean-variance optimizer training completed
2025-04-17 21:13:13,539 - INFO - Trained optimizer for regime 0 with 27 samples
2025-04-17 21:13:13,540 - INFO - Training mean-variance optimizer...
2025-04-17 21:13:13,540 - INFO - Mean-variance optimizer training completed
2025-04-17 21:13:13,540 - INFO - Trained optimizer for regime 1 with 18 samples
2025-04-17 21:13:13,540 - WARNING - No samples found for regime 2
2025-04-17 21:13:13,540 - INFO - Portfolio optimizer training completed
2025-04-17 21:13:13,541 - INFO - Optimizing portfolio weights...
2025-04-17 21:13:13,541 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:13,542 - WARNING - All weights are zero, using equal weights
2025-04-17 21:13:13,543 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:13,544 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,545 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,547 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,548 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,549 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,549 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,550 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,552 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,552 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,554 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,555 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,556 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,557 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,558 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:13,559 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,560 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:13,561 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:13,562 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:13,563 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,565 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:13,566 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,567 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:13,568 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:13,569 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,570 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:13,571 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:13,572 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,573 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:13,574 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:13,575 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,576 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,577 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,578 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,578 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:13,580 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:13,581 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:13,582 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:13,583 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:13,584 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:13,584 - INFO - Portfolio optimization completed
2025-04-17 21:13:13,585 - INFO - Running backtest...
2025-04-17 21:13:13,594 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:13:13,595 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:13:13,595 - INFO - Starting backtest...
2025-04-17 21:13:13,595 - INFO - Aligning dates between weights and returns...
2025-04-17 21:13:13,596 - INFO - Aligned 41 common dates
2025-04-17 21:13:13,596 - INFO - Initializing portfolio...
2025-04-17 21:13:13,596 - INFO - Running backtest simulation...
2025-04-17 21:13:13,608 - INFO - Backtest simulation completed
2025-04-17 21:13:13,608 - INFO - Storing backtest results...
2025-04-17 21:13:13,609 - INFO - Backtest completed successfully
2025-04-17 21:13:13,609 - INFO - Backtest completed
2025-04-17 21:13:13,609 - INFO - Strategy execution completed
2025-04-17 21:13:13,609 - ERROR - Error running xgboost with regime_aware: Missing required metric: sharpe_ratio
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 61, in run_parameter_grid
    raise ValueError(f"Missing required metric: {metric}")
ValueError: Missing required metric: sharpe_ratio
2025-04-17 21:13:13,610 - INFO - 
Running strategy with xgboost classifier and neural optimizer
2025-04-17 21:13:13,610 - INFO - Initializing strategy...
2025-04-17 21:13:13,610 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 21:13:13,610 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:13:13,612 - INFO - Running strategy...
2025-04-17 21:13:13,612 - INFO - Starting strategy execution...
2025-04-17 21:13:13,612 - INFO - Preparing training and testing data...
2025-04-17 21:13:13,612 - INFO - Starting data preparation...
2025-04-17 21:13:13,612 - INFO - Loading Fama-French factors...
2025-04-17 21:13:13,627 - INFO - Fama-French factors loaded
2025-04-17 21:13:13,627 - INFO - Processing factor data...
2025-04-17 21:13:13,631 - INFO - Factor data processed
2025-04-17 21:13:13,631 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:13:13,631 - INFO - 
Training Period:
2025-04-17 21:13:13,639 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:13:13,648 - INFO - 
Testing Period:
2025-04-17 21:13:13,652 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:13:13,660 - INFO - Loading macro and market data...
2025-04-17 21:13:13,661 - INFO - Loading existing macro data...
2025-04-17 21:13:13,665 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:13:13,666 - INFO - Loading existing macro data...
2025-04-17 21:13:13,675 - WARNING - US corporate credit spread file not found
2025-04-17 21:13:13,675 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:13:13,678 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:13:13,679 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:13:13,679 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:13:13,680 - INFO - Loading existing market data...
2025-04-17 21:13:13,684 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:13:13,685 - INFO - Loading existing market data...
2025-04-17 21:13:13,687 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:13:13,688 - INFO - Macro and market data loaded
2025-04-17 21:13:13,688 - INFO - Preparing training data for regime classification...
2025-04-17 21:13:13,689 - INFO - Loading existing macro data...
2025-04-17 21:13:13,701 - WARNING - US corporate credit spread file not found
2025-04-17 21:13:13,702 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:13:13,706 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:13:13,706 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:13:13,707 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:13:13,708 - INFO - Loading existing market data...
2025-04-17 21:13:13,712 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:13:13,715 - INFO - Prepared training data with 1508 samples
2025-04-17 21:13:13,716 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:13:13,716 - INFO - Training data prepared
2025-04-17 21:13:13,716 - INFO - Storing data...
2025-04-17 21:13:13,717 - INFO - Aligning data indices...
2025-04-17 21:13:13,718 - INFO - Data indices aligned
2025-04-17 21:13:13,718 - INFO - Data preparation completed
2025-04-17 21:13:13,718 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:13:13,719 - INFO - Training models...
2025-04-17 21:13:13,719 - INFO - Starting model training...
2025-04-17 21:13:13,719 - INFO - Training regime classifier...
2025-04-17 21:13:13,720 - INFO - Preparing features...
2025-04-17 21:13:13,721 - INFO - Input shape: (1508, 6)
2025-04-17 21:13:13,721 - INFO - Handling missing values...
2025-04-17 21:13:13,722 - INFO - Missing values: 4389 -> 0
2025-04-17 21:13:13,723 - INFO - Scaling features...
2025-04-17 21:13:13,724 - INFO - Fitted new scaler
2025-04-17 21:13:13,725 - INFO - Output shape: (1508, 6)
2025-04-17 21:13:13,970 - INFO - Training neural portfolio optimizer...
2025-04-17 21:13:13,970 - INFO - Neural portfolio optimizer training completed
2025-04-17 21:13:13,971 - INFO - Model training completed
2025-04-17 21:13:13,973 - INFO - Model training completed
2025-04-17 21:13:13,973 - INFO - Initializing portfolio weights...
2025-04-17 21:13:13,974 - INFO - Portfolio weights initialized
2025-04-17 21:13:13,974 - INFO - Generating regime predictions for test period...
2025-04-17 21:13:13,975 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:13:13,977 - INFO - Generated 41 regime predictions
2025-04-17 21:13:13,977 - INFO - Calculating regime-specific returns...
2025-04-17 21:13:13,981 - INFO - Found 2 unique regimes
2025-04-17 21:13:13,982 - INFO - Processing regime 0...
2025-04-17 21:13:13,983 - INFO - Regime 0: 27 samples
2025-04-17 21:13:13,983 - INFO - Processing regime 1...
2025-04-17 21:13:13,984 - INFO - Regime 1: 18 samples
2025-04-17 21:13:13,984 - INFO - Training portfolio optimizer...
2025-04-17 21:13:13,985 - ERROR - Error running xgboost with neural: NeuralPortfolioOptimizer.train() missing 1 required positional argument: 'target_weights'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 279, in run_strategy
    self.portfolio_optimizer.train(train_factors)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
TypeError: NeuralPortfolioOptimizer.train() missing 1 required positional argument: 'target_weights'
2025-04-17 21:13:13,986 - INFO - 
Running strategy with hmm classifier and mean_variance optimizer
2025-04-17 21:13:13,986 - INFO - Initializing strategy...
2025-04-17 21:13:13,986 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 21:13:13,986 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:13:13,987 - INFO - Running strategy...
2025-04-17 21:13:13,987 - INFO - Starting strategy execution...
2025-04-17 21:13:13,987 - INFO - Preparing training and testing data...
2025-04-17 21:13:13,987 - INFO - Starting data preparation...
2025-04-17 21:13:13,988 - INFO - Loading Fama-French factors...
2025-04-17 21:13:14,003 - INFO - Fama-French factors loaded
2025-04-17 21:13:14,003 - INFO - Processing factor data...
2025-04-17 21:13:14,006 - INFO - Factor data processed
2025-04-17 21:13:14,006 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:13:14,006 - INFO - 
Training Period:
2025-04-17 21:13:14,013 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:13:14,024 - INFO - 
Testing Period:
2025-04-17 21:13:14,030 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:13:14,041 - INFO - Loading macro and market data...
2025-04-17 21:13:14,043 - INFO - Loading existing macro data...
2025-04-17 21:13:14,047 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:13:14,048 - INFO - Loading existing macro data...
2025-04-17 21:13:14,061 - WARNING - US corporate credit spread file not found
2025-04-17 21:13:14,062 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:13:14,066 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:13:14,066 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:13:14,066 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:13:14,067 - INFO - Loading existing market data...
2025-04-17 21:13:14,072 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:13:14,074 - INFO - Loading existing market data...
2025-04-17 21:13:14,078 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:13:14,079 - INFO - Macro and market data loaded
2025-04-17 21:13:14,079 - INFO - Preparing training data for regime classification...
2025-04-17 21:13:14,080 - INFO - Loading existing macro data...
2025-04-17 21:13:14,089 - WARNING - US corporate credit spread file not found
2025-04-17 21:13:14,090 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:13:14,093 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:13:14,093 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:13:14,093 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:13:14,094 - INFO - Loading existing market data...
2025-04-17 21:13:14,098 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:13:14,100 - INFO - Prepared training data with 1508 samples
2025-04-17 21:13:14,101 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:13:14,101 - INFO - Training data prepared
2025-04-17 21:13:14,101 - INFO - Storing data...
2025-04-17 21:13:14,101 - INFO - Aligning data indices...
2025-04-17 21:13:14,102 - INFO - Data indices aligned
2025-04-17 21:13:14,102 - INFO - Data preparation completed
2025-04-17 21:13:14,103 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:13:14,103 - INFO - Training models...
2025-04-17 21:13:14,103 - INFO - Starting model training...
2025-04-17 21:13:14,103 - INFO - Training regime classifier...
2025-04-17 21:13:14,103 - INFO - Training HMM model...
2025-04-17 21:13:14,336 - INFO - HMM model training completed
2025-04-17 21:13:14,511 - INFO - Model training completed
2025-04-17 21:13:14,514 - INFO - Model training completed
2025-04-17 21:13:14,514 - INFO - Initializing portfolio weights...
2025-04-17 21:13:14,515 - INFO - Portfolio weights initialized
2025-04-17 21:13:14,515 - INFO - Generating regime predictions for test period...
2025-04-17 21:13:14,517 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:13:14,519 - INFO - Generated 41 regime predictions
2025-04-17 21:13:14,520 - INFO - Calculating regime-specific returns...
2025-04-17 21:13:14,524 - INFO - Found 2 unique regimes
2025-04-17 21:13:14,525 - INFO - Processing regime 0...
2025-04-17 21:13:14,526 - INFO - Regime 0: 30 samples
2025-04-17 21:13:14,526 - INFO - Processing regime 1...
2025-04-17 21:13:14,527 - INFO - Regime 1: 15 samples
2025-04-17 21:13:14,528 - INFO - Training portfolio optimizer...
2025-04-17 21:13:14,528 - INFO - Training mean-variance optimizer...
2025-04-17 21:13:14,528 - INFO - Mean-variance optimizer training completed
2025-04-17 21:13:14,528 - INFO - Portfolio optimizer training completed
2025-04-17 21:13:14,528 - INFO - Optimizing portfolio weights...
2025-04-17 21:13:14,531 - WARNING - All weights are zero, using equal weights
2025-04-17 21:13:14,553 - INFO - Portfolio optimization completed
2025-04-17 21:13:14,553 - INFO - Running backtest...
2025-04-17 21:13:14,559 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:13:14,560 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:13:14,560 - INFO - Starting backtest...
2025-04-17 21:13:14,560 - INFO - Aligning dates between weights and returns...
2025-04-17 21:13:14,562 - INFO - Aligned 41 common dates
2025-04-17 21:13:14,562 - INFO - Initializing portfolio...
2025-04-17 21:13:14,562 - INFO - Running backtest simulation...
2025-04-17 21:13:14,572 - INFO - Backtest simulation completed
2025-04-17 21:13:14,573 - INFO - Storing backtest results...
2025-04-17 21:13:14,573 - INFO - Backtest completed successfully
2025-04-17 21:13:14,573 - INFO - Backtest completed
2025-04-17 21:13:14,574 - INFO - Strategy execution completed
2025-04-17 21:13:14,574 - ERROR - Error running hmm with mean_variance: Missing required metric: sharpe_ratio
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 61, in run_parameter_grid
    raise ValueError(f"Missing required metric: {metric}")
ValueError: Missing required metric: sharpe_ratio
2025-04-17 21:13:14,575 - INFO - 
Running strategy with hmm classifier and regime_aware optimizer
2025-04-17 21:13:14,575 - INFO - Initializing strategy...
2025-04-17 21:13:14,576 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 21:13:14,576 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:13:14,577 - INFO - Running strategy...
2025-04-17 21:13:14,577 - INFO - Starting strategy execution...
2025-04-17 21:13:14,577 - INFO - Preparing training and testing data...
2025-04-17 21:13:14,578 - INFO - Starting data preparation...
2025-04-17 21:13:14,578 - INFO - Loading Fama-French factors...
2025-04-17 21:13:14,587 - INFO - Fama-French factors loaded
2025-04-17 21:13:14,587 - INFO - Processing factor data...
2025-04-17 21:13:14,590 - INFO - Factor data processed
2025-04-17 21:13:14,590 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:13:14,590 - INFO - 
Training Period:
2025-04-17 21:13:14,595 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:13:14,603 - INFO - 
Testing Period:
2025-04-17 21:13:14,607 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:13:14,615 - INFO - Loading macro and market data...
2025-04-17 21:13:14,616 - INFO - Loading existing macro data...
2025-04-17 21:13:14,620 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:13:14,621 - INFO - Loading existing macro data...
2025-04-17 21:13:14,631 - WARNING - US corporate credit spread file not found
2025-04-17 21:13:14,632 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:13:14,635 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:13:14,635 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:13:14,636 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:13:14,637 - INFO - Loading existing market data...
2025-04-17 21:13:14,641 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:13:14,642 - INFO - Loading existing market data...
2025-04-17 21:13:14,645 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:13:14,645 - INFO - Macro and market data loaded
2025-04-17 21:13:14,646 - INFO - Preparing training data for regime classification...
2025-04-17 21:13:14,647 - INFO - Loading existing macro data...
2025-04-17 21:13:14,656 - WARNING - US corporate credit spread file not found
2025-04-17 21:13:14,656 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:13:14,660 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:13:14,660 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:13:14,661 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:13:14,662 - INFO - Loading existing market data...
2025-04-17 21:13:14,666 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:13:14,669 - INFO - Prepared training data with 1508 samples
2025-04-17 21:13:14,670 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:13:14,671 - INFO - Training data prepared
2025-04-17 21:13:14,671 - INFO - Storing data...
2025-04-17 21:13:14,671 - INFO - Aligning data indices...
2025-04-17 21:13:14,673 - INFO - Data indices aligned
2025-04-17 21:13:14,673 - INFO - Data preparation completed
2025-04-17 21:13:14,674 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:13:14,674 - INFO - Training models...
2025-04-17 21:13:14,674 - INFO - Starting model training...
2025-04-17 21:13:14,674 - INFO - Training regime classifier...
2025-04-17 21:13:14,675 - INFO - Training HMM model...
2025-04-17 21:13:14,753 - INFO - HMM model training completed
2025-04-17 21:13:14,920 - INFO - Model training completed
2025-04-17 21:13:14,922 - INFO - Model training completed
2025-04-17 21:13:14,923 - INFO - Initializing portfolio weights...
2025-04-17 21:13:14,924 - INFO - Portfolio weights initialized
2025-04-17 21:13:14,924 - INFO - Generating regime predictions for test period...
2025-04-17 21:13:14,925 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:13:14,928 - INFO - Generated 41 regime predictions
2025-04-17 21:13:14,929 - INFO - Calculating regime-specific returns...
2025-04-17 21:13:14,934 - INFO - Found 2 unique regimes
2025-04-17 21:13:14,934 - INFO - Processing regime 0...
2025-04-17 21:13:14,935 - INFO - Regime 0: 30 samples
2025-04-17 21:13:14,935 - INFO - Processing regime 1...
2025-04-17 21:13:14,936 - INFO - Regime 1: 15 samples
2025-04-17 21:13:14,936 - INFO - Training portfolio optimizer...
2025-04-17 21:13:14,937 - INFO - Training regime-aware optimizer...
2025-04-17 21:13:14,937 - INFO - Training mean-variance optimizer...
2025-04-17 21:13:14,937 - INFO - Mean-variance optimizer training completed
2025-04-17 21:13:14,937 - INFO - Trained optimizer for regime 0 with 30 samples
2025-04-17 21:13:14,938 - INFO - Training mean-variance optimizer...
2025-04-17 21:13:14,938 - INFO - Mean-variance optimizer training completed
2025-04-17 21:13:14,938 - INFO - Trained optimizer for regime 1 with 15 samples
2025-04-17 21:13:14,939 - WARNING - No samples found for regime 2
2025-04-17 21:13:14,939 - INFO - Portfolio optimizer training completed
2025-04-17 21:13:14,939 - INFO - Optimizing portfolio weights...
2025-04-17 21:13:14,940 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:14,941 - WARNING - All weights are zero, using equal weights
2025-04-17 21:13:14,942 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:14,942 - INFO - Optimizing weights for regime 1
2025-04-17 21:13:14,943 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,944 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,945 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,946 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,947 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,948 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,948 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,949 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,950 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,951 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,952 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,953 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,954 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,955 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,956 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,957 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,957 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,958 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,959 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,960 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,961 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,962 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,963 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,964 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,965 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,966 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,967 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,968 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,969 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,970 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,971 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,972 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,973 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,974 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,975 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,975 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,976 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,977 - INFO - Optimizing weights for regime 0
2025-04-17 21:13:14,978 - INFO - Portfolio optimization completed
2025-04-17 21:13:14,978 - INFO - Running backtest...
2025-04-17 21:13:14,984 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:13:14,984 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:13:14,985 - INFO - Starting backtest...
2025-04-17 21:13:14,985 - INFO - Aligning dates between weights and returns...
2025-04-17 21:13:14,986 - INFO - Aligned 41 common dates
2025-04-17 21:13:14,986 - INFO - Initializing portfolio...
2025-04-17 21:13:14,986 - INFO - Running backtest simulation...
2025-04-17 21:13:14,995 - INFO - Backtest simulation completed
2025-04-17 21:13:14,995 - INFO - Storing backtest results...
2025-04-17 21:13:14,995 - INFO - Backtest completed successfully
2025-04-17 21:13:14,995 - INFO - Backtest completed
2025-04-17 21:13:14,996 - INFO - Strategy execution completed
2025-04-17 21:13:14,996 - ERROR - Error running hmm with regime_aware: Missing required metric: sharpe_ratio
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 61, in run_parameter_grid
    raise ValueError(f"Missing required metric: {metric}")
ValueError: Missing required metric: sharpe_ratio
2025-04-17 21:13:14,997 - INFO - 
Running strategy with hmm classifier and neural optimizer
2025-04-17 21:13:14,997 - INFO - Initializing strategy...
2025-04-17 21:13:14,997 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 21:13:14,997 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:13:14,998 - INFO - Running strategy...
2025-04-17 21:13:14,998 - INFO - Starting strategy execution...
2025-04-17 21:13:14,999 - INFO - Preparing training and testing data...
2025-04-17 21:13:14,999 - INFO - Starting data preparation...
2025-04-17 21:13:14,999 - INFO - Loading Fama-French factors...
2025-04-17 21:13:15,009 - INFO - Fama-French factors loaded
2025-04-17 21:13:15,009 - INFO - Processing factor data...
2025-04-17 21:13:15,011 - INFO - Factor data processed
2025-04-17 21:13:15,011 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:13:15,012 - INFO - 
Training Period:
2025-04-17 21:13:15,017 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:13:15,024 - INFO - 
Testing Period:
2025-04-17 21:13:15,029 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:13:15,037 - INFO - Loading macro and market data...
2025-04-17 21:13:15,038 - INFO - Loading existing macro data...
2025-04-17 21:13:15,041 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:13:15,042 - INFO - Loading existing macro data...
2025-04-17 21:13:15,052 - WARNING - US corporate credit spread file not found
2025-04-17 21:13:15,052 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:13:15,055 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:13:15,055 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:13:15,056 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:13:15,057 - INFO - Loading existing market data...
2025-04-17 21:13:15,060 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:13:15,061 - INFO - Loading existing market data...
2025-04-17 21:13:15,064 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:13:15,065 - INFO - Macro and market data loaded
2025-04-17 21:13:15,065 - INFO - Preparing training data for regime classification...
2025-04-17 21:13:15,066 - INFO - Loading existing macro data...
2025-04-17 21:13:15,077 - WARNING - US corporate credit spread file not found
2025-04-17 21:13:15,077 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:13:15,080 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:13:15,081 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:13:15,081 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:13:15,082 - INFO - Loading existing market data...
2025-04-17 21:13:15,087 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:13:15,090 - INFO - Prepared training data with 1508 samples
2025-04-17 21:13:15,090 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:13:15,090 - INFO - Training data prepared
2025-04-17 21:13:15,091 - INFO - Storing data...
2025-04-17 21:13:15,091 - INFO - Aligning data indices...
2025-04-17 21:13:15,092 - INFO - Data indices aligned
2025-04-17 21:13:15,093 - INFO - Data preparation completed
2025-04-17 21:13:15,093 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:13:15,093 - INFO - Training models...
2025-04-17 21:13:15,093 - INFO - Starting model training...
2025-04-17 21:13:15,093 - INFO - Training regime classifier...
2025-04-17 21:13:15,094 - INFO - Training HMM model...
2025-04-17 21:13:15,166 - INFO - HMM model training completed
2025-04-17 21:13:15,356 - INFO - Training neural portfolio optimizer...
2025-04-17 21:13:15,356 - INFO - Neural portfolio optimizer training completed
2025-04-17 21:13:15,356 - INFO - Model training completed
2025-04-17 21:13:15,358 - INFO - Model training completed
2025-04-17 21:13:15,358 - INFO - Initializing portfolio weights...
2025-04-17 21:13:15,358 - INFO - Portfolio weights initialized
2025-04-17 21:13:15,358 - INFO - Generating regime predictions for test period...
2025-04-17 21:13:15,360 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:13:15,362 - INFO - Generated 41 regime predictions
2025-04-17 21:13:15,362 - INFO - Calculating regime-specific returns...
2025-04-17 21:13:15,365 - INFO - Found 2 unique regimes
2025-04-17 21:13:15,365 - INFO - Processing regime 0...
2025-04-17 21:13:15,366 - INFO - Regime 0: 30 samples
2025-04-17 21:13:15,366 - INFO - Processing regime 1...
2025-04-17 21:13:15,367 - INFO - Regime 1: 15 samples
2025-04-17 21:13:15,367 - INFO - Training portfolio optimizer...
2025-04-17 21:13:15,368 - ERROR - Error running hmm with neural: NeuralPortfolioOptimizer.train() missing 1 required positional argument: 'target_weights'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 279, in run_strategy
    self.portfolio_optimizer.train(train_factors)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
TypeError: NeuralPortfolioOptimizer.train() missing 1 required positional argument: 'target_weights'
2025-04-17 21:13:15,368 - ERROR - No valid results obtained from parameter grid search
2025-04-17 21:13:15,369 - ERROR - No valid results obtained from parameter grid search
2025-04-17 21:13:15,369 - INFO - Factor timing strategy optimization completed
2025-04-17 21:15:33,831 - INFO - Starting factor timing strategy optimization...
2025-04-17 21:15:33,832 - INFO - Running parameter grid search...
2025-04-17 21:15:33,832 - INFO - 
Running strategy with lstm classifier and mean_variance optimizer
2025-04-17 21:15:33,832 - INFO - Initializing strategy...
2025-04-17 21:15:33,832 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 21:15:33,832 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:15:33,833 - INFO - Initialized LSTMRegimeClassifier with 64 hidden units, 2 layers
2025-04-17 21:15:33,833 - INFO - Running strategy...
2025-04-17 21:15:33,833 - INFO - Starting strategy execution...
2025-04-17 21:15:33,833 - INFO - Preparing training and testing data...
2025-04-17 21:15:33,833 - INFO - Starting data preparation...
2025-04-17 21:15:33,833 - INFO - Loading Fama-French factors...
2025-04-17 21:15:33,846 - INFO - Fama-French factors loaded
2025-04-17 21:15:33,846 - INFO - Processing factor data...
2025-04-17 21:15:33,849 - INFO - Factor data processed
2025-04-17 21:15:33,850 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:15:33,850 - INFO - 
Training Period:
2025-04-17 21:15:33,855 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:15:33,864 - INFO - 
Testing Period:
2025-04-17 21:15:33,868 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:15:33,877 - INFO - Loading macro and market data...
2025-04-17 21:15:33,878 - INFO - Loading existing macro data...
2025-04-17 21:15:33,881 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:15:33,883 - INFO - Loading existing macro data...
2025-04-17 21:15:33,893 - WARNING - US corporate credit spread file not found
2025-04-17 21:15:33,893 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:15:33,897 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:15:33,898 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:15:33,898 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:15:33,900 - INFO - Loading existing market data...
2025-04-17 21:15:33,904 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:15:33,905 - INFO - Loading existing market data...
2025-04-17 21:15:33,909 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:15:33,909 - INFO - Macro and market data loaded
2025-04-17 21:15:33,909 - INFO - Preparing training data for regime classification...
2025-04-17 21:15:33,910 - INFO - Loading existing macro data...
2025-04-17 21:15:33,923 - WARNING - US corporate credit spread file not found
2025-04-17 21:15:33,923 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:15:33,926 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:15:33,927 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:15:33,927 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:15:33,928 - INFO - Loading existing market data...
2025-04-17 21:15:33,932 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:15:33,935 - INFO - Prepared training data with 1508 samples
2025-04-17 21:15:33,936 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:15:33,936 - INFO - Training data prepared
2025-04-17 21:15:33,937 - INFO - Storing data...
2025-04-17 21:15:33,937 - INFO - Aligning data indices...
2025-04-17 21:15:33,938 - INFO - Data indices aligned
2025-04-17 21:15:33,939 - INFO - Data preparation completed
2025-04-17 21:15:33,939 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:15:33,939 - INFO - Training models...
2025-04-17 21:15:33,940 - INFO - Starting model training...
2025-04-17 21:15:33,940 - INFO - Training regime classifier...
2025-04-17 21:15:33,940 - INFO - Training LSTM model...
2025-04-17 21:15:35,020 - INFO - Initialized LSTM model and optimizer
2025-04-17 21:15:35,020 - INFO - Preparing features...
2025-04-17 21:15:35,021 - INFO - Input shape: (1508, 6)
2025-04-17 21:15:35,022 - INFO - Handling missing values...
2025-04-17 21:15:35,023 - INFO - Missing values: 4389 -> 0
2025-04-17 21:15:35,023 - INFO - Scaling features...
2025-04-17 21:15:35,025 - INFO - Fitted new scaler
2025-04-17 21:15:35,026 - INFO - Output shape: (1508, 6)
2025-04-17 21:15:35,026 - INFO - Prepared tensors - X: torch.Size([1508, 1, 6]), y: torch.Size([1508])
2025-04-17 21:15:35,029 - INFO - Created data loaders - Train: 1206 samples, Val: 302 samples
2025-04-17 21:15:35,207 - INFO - Epoch 1/100 - Train Loss: 19.0026, Val Loss: 6.5675 (Best)
2025-04-17 21:15:35,331 - INFO - Epoch 2/100 - Train Loss: 17.5885, Val Loss: 5.0473 (Best)
2025-04-17 21:15:35,457 - INFO - Epoch 3/100 - Train Loss: 17.0852, Val Loss: 4.3543 (Best)
2025-04-17 21:15:35,581 - INFO - Epoch 4/100 - Train Loss: 17.1949, Val Loss: 4.4248
2025-04-17 21:15:35,704 - INFO - Epoch 5/100 - Train Loss: 17.0477, Val Loss: 4.3764
2025-04-17 21:15:35,824 - INFO - Epoch 6/100 - Train Loss: 17.4982, Val Loss: 4.4038
2025-04-17 21:15:35,944 - INFO - Epoch 7/100 - Train Loss: 17.2933, Val Loss: 4.3974
2025-04-17 21:15:36,068 - INFO - Epoch 8/100 - Train Loss: 16.8395, Val Loss: 4.3949
2025-04-17 21:15:36,068 - INFO - Early stopping triggered after 8 epochs
2025-04-17 21:15:36,068 - INFO - Generating LSTM predictions...
2025-04-17 21:15:36,070 - INFO - Input tensor shape: torch.Size([1508, 1, 6])
2025-04-17 21:15:36,075 - INFO - Prediction distribution: {0: np.int64(1491), 1: np.int64(17)}
2025-04-17 21:15:36,344 - INFO - Model training completed
2025-04-17 21:15:36,347 - INFO - Model training completed
2025-04-17 21:15:36,347 - INFO - Initializing portfolio weights...
2025-04-17 21:15:36,349 - INFO - Portfolio weights initialized
2025-04-17 21:15:36,350 - INFO - Generating regime predictions for test period...
2025-04-17 21:15:36,354 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:15:36,354 - INFO - Generating LSTM predictions...
2025-04-17 21:15:36,356 - INFO - Input tensor shape: torch.Size([41, 1, 6])
2025-04-17 21:15:36,359 - INFO - Prediction distribution: {0: np.int64(25), 1: np.int64(16)}
2025-04-17 21:15:36,359 - INFO - Generated 41 regime predictions
2025-04-17 21:15:36,359 - INFO - Calculating regime-specific returns...
2025-04-17 21:15:36,362 - INFO - Generating LSTM predictions...
2025-04-17 21:15:36,363 - INFO - Input tensor shape: torch.Size([45, 1, 6])
2025-04-17 21:15:36,365 - INFO - Prediction distribution: {0: np.int64(28), 1: np.int64(17)}
2025-04-17 21:15:36,366 - INFO - Found 2 unique regimes
2025-04-17 21:15:36,366 - INFO - Processing regime 0...
2025-04-17 21:15:36,367 - INFO - Regime 0: 28 samples
2025-04-17 21:15:36,367 - INFO - Processing regime 1...
2025-04-17 21:15:36,369 - INFO - Regime 1: 17 samples
2025-04-17 21:15:36,369 - INFO - Training portfolio optimizer...
2025-04-17 21:15:36,369 - INFO - Training mean-variance optimizer...
2025-04-17 21:15:36,369 - INFO - Mean-variance optimizer training completed
2025-04-17 21:15:36,369 - INFO - Portfolio optimizer training completed
2025-04-17 21:15:36,370 - INFO - Optimizing portfolio weights...
2025-04-17 21:15:36,380 - WARNING - All weights are zero, using equal weights
2025-04-17 21:15:36,419 - INFO - Portfolio optimization completed
2025-04-17 21:15:36,419 - INFO - Running backtest...
2025-04-17 21:15:36,436 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:15:36,436 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:15:36,437 - INFO - Starting backtest...
2025-04-17 21:15:36,437 - INFO - Aligning dates between weights and returns...
2025-04-17 21:15:36,439 - INFO - Aligned 41 common dates
2025-04-17 21:15:36,440 - INFO - Initializing portfolio...
2025-04-17 21:15:36,440 - INFO - Running backtest simulation...
2025-04-17 21:15:36,457 - INFO - Backtest simulation completed
2025-04-17 21:15:36,458 - INFO - Storing backtest results...
2025-04-17 21:15:36,459 - INFO - Backtest completed successfully
2025-04-17 21:15:36,459 - INFO - Backtest completed
2025-04-17 21:15:36,459 - INFO - Strategy execution completed
2025-04-17 21:15:36,460 - ERROR - Error running lstm with mean_variance: Missing required metric: sharpe_ratio
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 61, in run_parameter_grid
    raise ValueError(f"Missing required metric: {metric}")
ValueError: Missing required metric: sharpe_ratio
2025-04-17 21:15:36,461 - INFO - 
Running strategy with lstm classifier and regime_aware optimizer
2025-04-17 21:15:36,462 - INFO - Initializing strategy...
2025-04-17 21:15:36,462 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 21:15:36,462 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:15:36,462 - INFO - Initialized LSTMRegimeClassifier with 64 hidden units, 2 layers
2025-04-17 21:15:36,463 - INFO - Running strategy...
2025-04-17 21:15:36,463 - INFO - Starting strategy execution...
2025-04-17 21:15:36,463 - INFO - Preparing training and testing data...
2025-04-17 21:15:36,463 - INFO - Starting data preparation...
2025-04-17 21:15:36,464 - INFO - Loading Fama-French factors...
2025-04-17 21:15:36,484 - INFO - Fama-French factors loaded
2025-04-17 21:15:36,484 - INFO - Processing factor data...
2025-04-17 21:15:36,489 - INFO - Factor data processed
2025-04-17 21:15:36,489 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:15:36,489 - INFO - 
Training Period:
2025-04-17 21:15:36,496 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:15:36,506 - INFO - 
Testing Period:
2025-04-17 21:15:36,513 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:15:36,523 - INFO - Loading macro and market data...
2025-04-17 21:15:36,524 - INFO - Loading existing macro data...
2025-04-17 21:15:36,529 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:15:36,530 - INFO - Loading existing macro data...
2025-04-17 21:15:36,549 - WARNING - US corporate credit spread file not found
2025-04-17 21:15:36,550 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:15:36,556 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:15:36,556 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:15:36,557 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:15:36,558 - INFO - Loading existing market data...
2025-04-17 21:15:36,562 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:15:36,563 - INFO - Loading existing market data...
2025-04-17 21:15:36,567 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:15:36,567 - INFO - Macro and market data loaded
2025-04-17 21:15:36,567 - INFO - Preparing training data for regime classification...
2025-04-17 21:15:36,568 - INFO - Loading existing macro data...
2025-04-17 21:15:36,580 - WARNING - US corporate credit spread file not found
2025-04-17 21:15:36,580 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:15:36,583 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:15:36,583 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:15:36,583 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:15:36,584 - INFO - Loading existing market data...
2025-04-17 21:15:36,588 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:15:36,591 - INFO - Prepared training data with 1508 samples
2025-04-17 21:15:36,592 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:15:36,592 - INFO - Training data prepared
2025-04-17 21:15:36,592 - INFO - Storing data...
2025-04-17 21:15:36,592 - INFO - Aligning data indices...
2025-04-17 21:15:36,593 - INFO - Data indices aligned
2025-04-17 21:15:36,594 - INFO - Data preparation completed
2025-04-17 21:15:36,594 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:15:36,594 - INFO - Training models...
2025-04-17 21:15:36,594 - INFO - Starting model training...
2025-04-17 21:15:36,594 - INFO - Training regime classifier...
2025-04-17 21:15:36,594 - INFO - Training LSTM model...
2025-04-17 21:15:36,595 - INFO - Initialized LSTM model and optimizer
2025-04-17 21:15:36,595 - INFO - Preparing features...
2025-04-17 21:15:36,596 - INFO - Input shape: (1508, 6)
2025-04-17 21:15:36,596 - INFO - Handling missing values...
2025-04-17 21:15:36,597 - INFO - Missing values: 4389 -> 0
2025-04-17 21:15:36,597 - INFO - Scaling features...
2025-04-17 21:15:36,598 - INFO - Fitted new scaler
2025-04-17 21:15:36,599 - INFO - Output shape: (1508, 6)
2025-04-17 21:15:36,600 - INFO - Prepared tensors - X: torch.Size([1508, 1, 6]), y: torch.Size([1508])
2025-04-17 21:15:36,600 - INFO - Created data loaders - Train: 1206 samples, Val: 302 samples
2025-04-17 21:15:36,739 - INFO - Epoch 1/100 - Train Loss: 18.9990, Val Loss: 6.5167 (Best)
2025-04-17 21:15:36,863 - INFO - Epoch 2/100 - Train Loss: 17.7813, Val Loss: 4.8431 (Best)
2025-04-17 21:15:36,988 - INFO - Epoch 3/100 - Train Loss: 17.7120, Val Loss: 4.1874 (Best)
2025-04-17 21:15:37,115 - INFO - Epoch 4/100 - Train Loss: 17.4659, Val Loss: 4.2754
2025-04-17 21:15:37,241 - INFO - Epoch 5/100 - Train Loss: 16.9102, Val Loss: 4.1172 (Best)
2025-04-17 21:15:37,363 - INFO - Epoch 6/100 - Train Loss: 16.9765, Val Loss: 4.1602
2025-04-17 21:15:37,490 - INFO - Epoch 7/100 - Train Loss: 17.4648, Val Loss: 4.1871
2025-04-17 21:15:37,622 - INFO - Epoch 8/100 - Train Loss: 17.0992, Val Loss: 4.1773
2025-04-17 21:15:37,777 - INFO - Epoch 9/100 - Train Loss: 17.2432, Val Loss: 4.1427
2025-04-17 21:15:37,911 - INFO - Epoch 10/100 - Train Loss: 17.4383, Val Loss: 4.1191
2025-04-17 21:15:37,912 - INFO - Early stopping triggered after 10 epochs
2025-04-17 21:15:37,912 - INFO - Generating LSTM predictions...
2025-04-17 21:15:37,913 - INFO - Input tensor shape: torch.Size([1508, 1, 6])
2025-04-17 21:15:37,916 - INFO - Prediction distribution: {0: np.int64(1488), 1: np.int64(20)}
2025-04-17 21:15:38,106 - INFO - Model training completed
2025-04-17 21:15:38,108 - INFO - Model training completed
2025-04-17 21:15:38,108 - INFO - Initializing portfolio weights...
2025-04-17 21:15:38,109 - INFO - Portfolio weights initialized
2025-04-17 21:15:38,109 - INFO - Generating regime predictions for test period...
2025-04-17 21:15:38,111 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:15:38,111 - INFO - Generating LSTM predictions...
2025-04-17 21:15:38,113 - INFO - Input tensor shape: torch.Size([41, 1, 6])
2025-04-17 21:15:38,115 - INFO - Prediction distribution: {0: np.int64(19), 1: np.int64(22)}
2025-04-17 21:15:38,115 - INFO - Generated 41 regime predictions
2025-04-17 21:15:38,115 - INFO - Calculating regime-specific returns...
2025-04-17 21:15:38,117 - INFO - Generating LSTM predictions...
2025-04-17 21:15:38,118 - INFO - Input tensor shape: torch.Size([45, 1, 6])
2025-04-17 21:15:38,119 - INFO - Prediction distribution: {0: np.int64(25), 1: np.int64(20)}
2025-04-17 21:15:38,119 - INFO - Found 2 unique regimes
2025-04-17 21:15:38,119 - INFO - Processing regime 0...
2025-04-17 21:15:38,120 - INFO - Regime 0: 25 samples
2025-04-17 21:15:38,121 - INFO - Processing regime 1...
2025-04-17 21:15:38,122 - INFO - Regime 1: 20 samples
2025-04-17 21:15:38,122 - INFO - Training portfolio optimizer...
2025-04-17 21:15:38,122 - INFO - Training regime-aware optimizer...
2025-04-17 21:15:38,122 - INFO - Training mean-variance optimizer...
2025-04-17 21:15:38,123 - INFO - Mean-variance optimizer training completed
2025-04-17 21:15:38,123 - INFO - Trained optimizer for regime 0 with 25 samples
2025-04-17 21:15:38,123 - INFO - Training mean-variance optimizer...
2025-04-17 21:15:38,123 - INFO - Mean-variance optimizer training completed
2025-04-17 21:15:38,123 - INFO - Trained optimizer for regime 1 with 20 samples
2025-04-17 21:15:38,123 - WARNING - No samples found for regime 2
2025-04-17 21:15:38,124 - INFO - Portfolio optimizer training completed
2025-04-17 21:15:38,124 - INFO - Optimizing portfolio weights...
2025-04-17 21:15:38,124 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:38,126 - WARNING - All weights are zero, using equal weights
2025-04-17 21:15:38,126 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:38,127 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:38,128 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:38,129 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:38,130 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:38,131 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:38,133 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:38,133 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:38,134 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:38,135 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:38,136 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:38,137 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:38,138 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:38,139 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:38,140 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:38,141 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:38,142 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:38,143 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:38,143 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:38,144 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:38,145 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:38,146 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:38,147 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:38,148 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:38,148 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:38,149 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:38,150 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:38,151 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:38,152 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:38,153 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:38,154 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:38,155 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:38,156 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:38,157 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:38,158 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:38,159 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:38,160 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:38,161 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:38,162 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:38,163 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:38,164 - INFO - Portfolio optimization completed
2025-04-17 21:15:38,164 - INFO - Running backtest...
2025-04-17 21:15:38,171 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:15:38,171 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:15:38,172 - INFO - Starting backtest...
2025-04-17 21:15:38,172 - INFO - Aligning dates between weights and returns...
2025-04-17 21:15:38,172 - INFO - Aligned 41 common dates
2025-04-17 21:15:38,173 - INFO - Initializing portfolio...
2025-04-17 21:15:38,173 - INFO - Running backtest simulation...
2025-04-17 21:15:38,182 - INFO - Backtest simulation completed
2025-04-17 21:15:38,183 - INFO - Storing backtest results...
2025-04-17 21:15:38,183 - INFO - Backtest completed successfully
2025-04-17 21:15:38,183 - INFO - Backtest completed
2025-04-17 21:15:38,183 - INFO - Strategy execution completed
2025-04-17 21:15:38,184 - ERROR - Error running lstm with regime_aware: Missing required metric: sharpe_ratio
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 61, in run_parameter_grid
    raise ValueError(f"Missing required metric: {metric}")
ValueError: Missing required metric: sharpe_ratio
2025-04-17 21:15:38,184 - INFO - 
Running strategy with lstm classifier and neural optimizer
2025-04-17 21:15:38,184 - INFO - Initializing strategy...
2025-04-17 21:15:38,185 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 21:15:38,185 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:15:38,185 - INFO - Initialized LSTMRegimeClassifier with 64 hidden units, 2 layers
2025-04-17 21:15:38,186 - INFO - Running strategy...
2025-04-17 21:15:38,186 - INFO - Starting strategy execution...
2025-04-17 21:15:38,186 - INFO - Preparing training and testing data...
2025-04-17 21:15:38,186 - INFO - Starting data preparation...
2025-04-17 21:15:38,195 - INFO - Loading Fama-French factors...
2025-04-17 21:15:38,207 - INFO - Fama-French factors loaded
2025-04-17 21:15:38,207 - INFO - Processing factor data...
2025-04-17 21:15:38,211 - INFO - Factor data processed
2025-04-17 21:15:38,211 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:15:38,211 - INFO - 
Training Period:
2025-04-17 21:15:38,216 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:15:38,225 - INFO - 
Testing Period:
2025-04-17 21:15:38,230 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:15:38,240 - INFO - Loading macro and market data...
2025-04-17 21:15:38,241 - INFO - Loading existing macro data...
2025-04-17 21:15:38,244 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:15:38,245 - INFO - Loading existing macro data...
2025-04-17 21:15:38,255 - WARNING - US corporate credit spread file not found
2025-04-17 21:15:38,255 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:15:38,258 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:15:38,258 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:15:38,259 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:15:38,260 - INFO - Loading existing market data...
2025-04-17 21:15:38,265 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:15:38,265 - INFO - Loading existing market data...
2025-04-17 21:15:38,269 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:15:38,269 - INFO - Macro and market data loaded
2025-04-17 21:15:38,270 - INFO - Preparing training data for regime classification...
2025-04-17 21:15:38,271 - INFO - Loading existing macro data...
2025-04-17 21:15:38,281 - WARNING - US corporate credit spread file not found
2025-04-17 21:15:38,282 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:15:38,285 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:15:38,285 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:15:38,285 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:15:38,286 - INFO - Loading existing market data...
2025-04-17 21:15:38,290 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:15:38,293 - INFO - Prepared training data with 1508 samples
2025-04-17 21:15:38,294 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:15:38,294 - INFO - Training data prepared
2025-04-17 21:15:38,294 - INFO - Storing data...
2025-04-17 21:15:38,295 - INFO - Aligning data indices...
2025-04-17 21:15:38,296 - INFO - Data indices aligned
2025-04-17 21:15:38,296 - INFO - Data preparation completed
2025-04-17 21:15:38,297 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:15:38,297 - INFO - Training models...
2025-04-17 21:15:38,297 - INFO - Starting model training...
2025-04-17 21:15:38,297 - INFO - Training regime classifier...
2025-04-17 21:15:38,297 - INFO - Training LSTM model...
2025-04-17 21:15:38,298 - INFO - Initialized LSTM model and optimizer
2025-04-17 21:15:38,299 - INFO - Preparing features...
2025-04-17 21:15:38,299 - INFO - Input shape: (1508, 6)
2025-04-17 21:15:38,299 - INFO - Handling missing values...
2025-04-17 21:15:38,300 - INFO - Missing values: 4389 -> 0
2025-04-17 21:15:38,301 - INFO - Scaling features...
2025-04-17 21:15:38,302 - INFO - Fitted new scaler
2025-04-17 21:15:38,303 - INFO - Output shape: (1508, 6)
2025-04-17 21:15:38,303 - INFO - Prepared tensors - X: torch.Size([1508, 1, 6]), y: torch.Size([1508])
2025-04-17 21:15:38,303 - INFO - Created data loaders - Train: 1206 samples, Val: 302 samples
2025-04-17 21:15:38,448 - INFO - Epoch 1/100 - Train Loss: 18.7675, Val Loss: 6.4015 (Best)
2025-04-17 21:15:38,576 - INFO - Epoch 2/100 - Train Loss: 17.3441, Val Loss: 4.7279 (Best)
2025-04-17 21:15:38,702 - INFO - Epoch 3/100 - Train Loss: 17.3674, Val Loss: 4.3394 (Best)
2025-04-17 21:15:38,854 - INFO - Epoch 4/100 - Train Loss: 17.3422, Val Loss: 4.2981 (Best)
2025-04-17 21:15:38,976 - INFO - Epoch 5/100 - Train Loss: 17.0043, Val Loss: 4.2845 (Best)
2025-04-17 21:15:39,100 - INFO - Epoch 6/100 - Train Loss: 17.0522, Val Loss: 4.3745
2025-04-17 21:15:39,234 - INFO - Epoch 7/100 - Train Loss: 16.8819, Val Loss: 4.2494 (Best)
2025-04-17 21:15:39,363 - INFO - Epoch 8/100 - Train Loss: 17.3319, Val Loss: 4.3405
2025-04-17 21:15:39,606 - INFO - Epoch 9/100 - Train Loss: 17.0260, Val Loss: 4.2447 (Best)
2025-04-17 21:15:39,729 - INFO - Epoch 10/100 - Train Loss: 16.8644, Val Loss: 4.2770
2025-04-17 21:15:39,851 - INFO - Epoch 11/100 - Train Loss: 16.7046, Val Loss: 4.2704
2025-04-17 21:15:39,971 - INFO - Epoch 12/100 - Train Loss: 17.0398, Val Loss: 4.3706
2025-04-17 21:15:40,093 - INFO - Epoch 13/100 - Train Loss: 16.8303, Val Loss: 4.2833
2025-04-17 21:15:40,213 - INFO - Epoch 14/100 - Train Loss: 16.6271, Val Loss: 4.2793
2025-04-17 21:15:40,214 - INFO - Early stopping triggered after 14 epochs
2025-04-17 21:15:40,214 - INFO - Generating LSTM predictions...
2025-04-17 21:15:40,216 - INFO - Input tensor shape: torch.Size([1508, 1, 6])
2025-04-17 21:15:40,218 - INFO - Prediction distribution: {0: np.int64(1489), 1: np.int64(19)}
2025-04-17 21:15:40,394 - INFO - Training neural portfolio optimizer...
2025-04-17 21:15:40,394 - INFO - Neural portfolio optimizer training completed
2025-04-17 21:15:40,394 - INFO - Model training completed
2025-04-17 21:15:40,396 - INFO - Model training completed
2025-04-17 21:15:40,397 - INFO - Initializing portfolio weights...
2025-04-17 21:15:40,397 - INFO - Portfolio weights initialized
2025-04-17 21:15:40,397 - INFO - Generating regime predictions for test period...
2025-04-17 21:15:40,399 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:15:40,400 - INFO - Generating LSTM predictions...
2025-04-17 21:15:40,401 - INFO - Input tensor shape: torch.Size([41, 1, 6])
2025-04-17 21:15:40,403 - INFO - Prediction distribution: {0: np.int64(22), 1: np.int64(19)}
2025-04-17 21:15:40,403 - INFO - Generated 41 regime predictions
2025-04-17 21:15:40,403 - INFO - Calculating regime-specific returns...
2025-04-17 21:15:40,405 - INFO - Generating LSTM predictions...
2025-04-17 21:15:40,407 - INFO - Input tensor shape: torch.Size([45, 1, 6])
2025-04-17 21:15:40,408 - INFO - Prediction distribution: {0: np.int64(26), 1: np.int64(19)}
2025-04-17 21:15:40,408 - INFO - Found 2 unique regimes
2025-04-17 21:15:40,408 - INFO - Processing regime 0...
2025-04-17 21:15:40,409 - INFO - Regime 0: 26 samples
2025-04-17 21:15:40,410 - INFO - Processing regime 1...
2025-04-17 21:15:40,410 - INFO - Regime 1: 19 samples
2025-04-17 21:15:40,411 - INFO - Training portfolio optimizer...
2025-04-17 21:15:40,432 - ERROR - Error running lstm with neural: mat1 and mat2 shapes cannot be multiplied (45x5 and 6x64)
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 285, in run_strategy
    self.portfolio_optimizer.train(train_factors, target_weights)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 116, in train
    predictions = self.model(features_tensor)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 129, in forward
    x = torch.relu(self.fc1(x))
                   ~~~~~~~~^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\linear.py", line 125, in forward
    return F.linear(input, self.weight, self.bias)
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: mat1 and mat2 shapes cannot be multiplied (45x5 and 6x64)
2025-04-17 21:15:40,436 - INFO - 
Running strategy with xgboost classifier and mean_variance optimizer
2025-04-17 21:15:40,436 - INFO - Initializing strategy...
2025-04-17 21:15:40,436 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 21:15:40,437 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:15:40,461 - INFO - Running strategy...
2025-04-17 21:15:40,461 - INFO - Starting strategy execution...
2025-04-17 21:15:40,462 - INFO - Preparing training and testing data...
2025-04-17 21:15:40,462 - INFO - Starting data preparation...
2025-04-17 21:15:40,462 - INFO - Loading Fama-French factors...
2025-04-17 21:15:40,474 - INFO - Fama-French factors loaded
2025-04-17 21:15:40,475 - INFO - Processing factor data...
2025-04-17 21:15:40,478 - INFO - Factor data processed
2025-04-17 21:15:40,478 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:15:40,479 - INFO - 
Training Period:
2025-04-17 21:15:40,484 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:15:40,493 - INFO - 
Testing Period:
2025-04-17 21:15:40,498 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:15:40,505 - INFO - Loading macro and market data...
2025-04-17 21:15:40,506 - INFO - Loading existing macro data...
2025-04-17 21:15:40,510 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:15:40,511 - INFO - Loading existing macro data...
2025-04-17 21:15:40,521 - WARNING - US corporate credit spread file not found
2025-04-17 21:15:40,521 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:15:40,524 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:15:40,524 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:15:40,525 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:15:40,526 - INFO - Loading existing market data...
2025-04-17 21:15:40,530 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:15:40,531 - INFO - Loading existing market data...
2025-04-17 21:15:40,535 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:15:40,535 - INFO - Macro and market data loaded
2025-04-17 21:15:40,536 - INFO - Preparing training data for regime classification...
2025-04-17 21:15:40,537 - INFO - Loading existing macro data...
2025-04-17 21:15:40,548 - WARNING - US corporate credit spread file not found
2025-04-17 21:15:40,548 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:15:40,551 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:15:40,551 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:15:40,552 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:15:40,553 - INFO - Loading existing market data...
2025-04-17 21:15:40,557 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:15:40,560 - INFO - Prepared training data with 1508 samples
2025-04-17 21:15:40,560 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:15:40,561 - INFO - Training data prepared
2025-04-17 21:15:40,561 - INFO - Storing data...
2025-04-17 21:15:40,561 - INFO - Aligning data indices...
2025-04-17 21:15:40,563 - INFO - Data indices aligned
2025-04-17 21:15:40,563 - INFO - Data preparation completed
2025-04-17 21:15:40,563 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:15:40,563 - INFO - Training models...
2025-04-17 21:15:40,563 - INFO - Starting model training...
2025-04-17 21:15:40,564 - INFO - Training regime classifier...
2025-04-17 21:15:40,564 - INFO - Preparing features...
2025-04-17 21:15:40,564 - INFO - Input shape: (1508, 6)
2025-04-17 21:15:40,564 - INFO - Handling missing values...
2025-04-17 21:15:40,566 - INFO - Missing values: 4389 -> 0
2025-04-17 21:15:40,566 - INFO - Scaling features...
2025-04-17 21:15:40,567 - INFO - Fitted new scaler
2025-04-17 21:15:40,568 - INFO - Output shape: (1508, 6)
2025-04-17 21:15:42,053 - INFO - Model training completed
2025-04-17 21:15:42,055 - INFO - Model training completed
2025-04-17 21:15:42,056 - INFO - Initializing portfolio weights...
2025-04-17 21:15:42,056 - INFO - Portfolio weights initialized
2025-04-17 21:15:42,057 - INFO - Generating regime predictions for test period...
2025-04-17 21:15:42,058 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:15:42,061 - INFO - Generated 41 regime predictions
2025-04-17 21:15:42,061 - INFO - Calculating regime-specific returns...
2025-04-17 21:15:42,065 - INFO - Found 2 unique regimes
2025-04-17 21:15:42,065 - INFO - Processing regime 0...
2025-04-17 21:15:42,066 - INFO - Regime 0: 27 samples
2025-04-17 21:15:42,067 - INFO - Processing regime 1...
2025-04-17 21:15:42,068 - INFO - Regime 1: 18 samples
2025-04-17 21:15:42,068 - INFO - Training portfolio optimizer...
2025-04-17 21:15:42,068 - INFO - Training mean-variance optimizer...
2025-04-17 21:15:42,068 - INFO - Mean-variance optimizer training completed
2025-04-17 21:15:42,069 - INFO - Portfolio optimizer training completed
2025-04-17 21:15:42,069 - INFO - Optimizing portfolio weights...
2025-04-17 21:15:42,070 - WARNING - All weights are zero, using equal weights
2025-04-17 21:15:42,102 - INFO - Portfolio optimization completed
2025-04-17 21:15:42,102 - INFO - Running backtest...
2025-04-17 21:15:42,111 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:15:42,112 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:15:42,112 - INFO - Starting backtest...
2025-04-17 21:15:42,112 - INFO - Aligning dates between weights and returns...
2025-04-17 21:15:42,112 - INFO - Aligned 41 common dates
2025-04-17 21:15:42,113 - INFO - Initializing portfolio...
2025-04-17 21:15:42,113 - INFO - Running backtest simulation...
2025-04-17 21:15:42,125 - INFO - Backtest simulation completed
2025-04-17 21:15:42,125 - INFO - Storing backtest results...
2025-04-17 21:15:42,126 - INFO - Backtest completed successfully
2025-04-17 21:15:42,127 - INFO - Backtest completed
2025-04-17 21:15:42,127 - INFO - Strategy execution completed
2025-04-17 21:15:42,127 - ERROR - Error running xgboost with mean_variance: Missing required metric: sharpe_ratio
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 61, in run_parameter_grid
    raise ValueError(f"Missing required metric: {metric}")
ValueError: Missing required metric: sharpe_ratio
2025-04-17 21:15:42,128 - INFO - 
Running strategy with xgboost classifier and regime_aware optimizer
2025-04-17 21:15:42,128 - INFO - Initializing strategy...
2025-04-17 21:15:42,128 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 21:15:42,128 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:15:42,129 - INFO - Running strategy...
2025-04-17 21:15:42,129 - INFO - Starting strategy execution...
2025-04-17 21:15:42,129 - INFO - Preparing training and testing data...
2025-04-17 21:15:42,129 - INFO - Starting data preparation...
2025-04-17 21:15:42,129 - INFO - Loading Fama-French factors...
2025-04-17 21:15:42,144 - INFO - Fama-French factors loaded
2025-04-17 21:15:42,144 - INFO - Processing factor data...
2025-04-17 21:15:42,148 - INFO - Factor data processed
2025-04-17 21:15:42,148 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:15:42,148 - INFO - 
Training Period:
2025-04-17 21:15:42,156 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:15:42,166 - INFO - 
Testing Period:
2025-04-17 21:15:42,170 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:15:42,178 - INFO - Loading macro and market data...
2025-04-17 21:15:42,179 - INFO - Loading existing macro data...
2025-04-17 21:15:42,183 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:15:42,184 - INFO - Loading existing macro data...
2025-04-17 21:15:42,196 - WARNING - US corporate credit spread file not found
2025-04-17 21:15:42,196 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:15:42,200 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:15:42,200 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:15:42,200 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:15:42,202 - INFO - Loading existing market data...
2025-04-17 21:15:42,207 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:15:42,208 - INFO - Loading existing market data...
2025-04-17 21:15:42,211 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:15:42,212 - INFO - Macro and market data loaded
2025-04-17 21:15:42,212 - INFO - Preparing training data for regime classification...
2025-04-17 21:15:42,213 - INFO - Loading existing macro data...
2025-04-17 21:15:42,224 - WARNING - US corporate credit spread file not found
2025-04-17 21:15:42,224 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:15:42,227 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:15:42,227 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:15:42,227 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:15:42,228 - INFO - Loading existing market data...
2025-04-17 21:15:42,232 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:15:42,234 - INFO - Prepared training data with 1508 samples
2025-04-17 21:15:42,235 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:15:42,235 - INFO - Training data prepared
2025-04-17 21:15:42,235 - INFO - Storing data...
2025-04-17 21:15:42,235 - INFO - Aligning data indices...
2025-04-17 21:15:42,237 - INFO - Data indices aligned
2025-04-17 21:15:42,237 - INFO - Data preparation completed
2025-04-17 21:15:42,237 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:15:42,237 - INFO - Training models...
2025-04-17 21:15:42,237 - INFO - Starting model training...
2025-04-17 21:15:42,237 - INFO - Training regime classifier...
2025-04-17 21:15:42,237 - INFO - Preparing features...
2025-04-17 21:15:42,238 - INFO - Input shape: (1508, 6)
2025-04-17 21:15:42,238 - INFO - Handling missing values...
2025-04-17 21:15:42,239 - INFO - Missing values: 4389 -> 0
2025-04-17 21:15:42,239 - INFO - Scaling features...
2025-04-17 21:15:42,240 - INFO - Fitted new scaler
2025-04-17 21:15:42,241 - INFO - Output shape: (1508, 6)
2025-04-17 21:15:42,525 - INFO - Model training completed
2025-04-17 21:15:42,528 - INFO - Model training completed
2025-04-17 21:15:42,528 - INFO - Initializing portfolio weights...
2025-04-17 21:15:42,529 - INFO - Portfolio weights initialized
2025-04-17 21:15:42,529 - INFO - Generating regime predictions for test period...
2025-04-17 21:15:42,531 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:15:42,532 - INFO - Generated 41 regime predictions
2025-04-17 21:15:42,533 - INFO - Calculating regime-specific returns...
2025-04-17 21:15:42,537 - INFO - Found 2 unique regimes
2025-04-17 21:15:42,537 - INFO - Processing regime 0...
2025-04-17 21:15:42,538 - INFO - Regime 0: 27 samples
2025-04-17 21:15:42,539 - INFO - Processing regime 1...
2025-04-17 21:15:42,540 - INFO - Regime 1: 18 samples
2025-04-17 21:15:42,540 - INFO - Training portfolio optimizer...
2025-04-17 21:15:42,540 - INFO - Training regime-aware optimizer...
2025-04-17 21:15:42,540 - INFO - Training mean-variance optimizer...
2025-04-17 21:15:42,541 - INFO - Mean-variance optimizer training completed
2025-04-17 21:15:42,541 - INFO - Trained optimizer for regime 0 with 27 samples
2025-04-17 21:15:42,541 - INFO - Training mean-variance optimizer...
2025-04-17 21:15:42,541 - INFO - Mean-variance optimizer training completed
2025-04-17 21:15:42,541 - INFO - Trained optimizer for regime 1 with 18 samples
2025-04-17 21:15:42,542 - WARNING - No samples found for regime 2
2025-04-17 21:15:42,542 - INFO - Portfolio optimizer training completed
2025-04-17 21:15:42,542 - INFO - Optimizing portfolio weights...
2025-04-17 21:15:42,543 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:42,544 - WARNING - All weights are zero, using equal weights
2025-04-17 21:15:42,545 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:42,546 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,547 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,548 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,549 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,550 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,551 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,553 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,553 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,554 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,556 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,557 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,558 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,559 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,560 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:42,561 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,562 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:42,563 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:42,564 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:42,566 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,567 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:42,568 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,568 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:42,570 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:42,571 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,572 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:42,573 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:42,574 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,575 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:42,577 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:42,577 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,578 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,580 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,581 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,582 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:42,583 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:42,584 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:42,585 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:42,586 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:42,587 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:42,587 - INFO - Portfolio optimization completed
2025-04-17 21:15:42,588 - INFO - Running backtest...
2025-04-17 21:15:42,597 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:15:42,597 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:15:42,597 - INFO - Starting backtest...
2025-04-17 21:15:42,598 - INFO - Aligning dates between weights and returns...
2025-04-17 21:15:42,599 - INFO - Aligned 41 common dates
2025-04-17 21:15:42,599 - INFO - Initializing portfolio...
2025-04-17 21:15:42,599 - INFO - Running backtest simulation...
2025-04-17 21:15:42,612 - INFO - Backtest simulation completed
2025-04-17 21:15:42,612 - INFO - Storing backtest results...
2025-04-17 21:15:42,613 - INFO - Backtest completed successfully
2025-04-17 21:15:42,613 - INFO - Backtest completed
2025-04-17 21:15:42,613 - INFO - Strategy execution completed
2025-04-17 21:15:42,613 - ERROR - Error running xgboost with regime_aware: Missing required metric: sharpe_ratio
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 61, in run_parameter_grid
    raise ValueError(f"Missing required metric: {metric}")
ValueError: Missing required metric: sharpe_ratio
2025-04-17 21:15:42,614 - INFO - 
Running strategy with xgboost classifier and neural optimizer
2025-04-17 21:15:42,614 - INFO - Initializing strategy...
2025-04-17 21:15:42,615 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 21:15:42,615 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:15:42,616 - INFO - Running strategy...
2025-04-17 21:15:42,616 - INFO - Starting strategy execution...
2025-04-17 21:15:42,616 - INFO - Preparing training and testing data...
2025-04-17 21:15:42,616 - INFO - Starting data preparation...
2025-04-17 21:15:42,616 - INFO - Loading Fama-French factors...
2025-04-17 21:15:42,633 - INFO - Fama-French factors loaded
2025-04-17 21:15:42,633 - INFO - Processing factor data...
2025-04-17 21:15:42,637 - INFO - Factor data processed
2025-04-17 21:15:42,637 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:15:42,637 - INFO - 
Training Period:
2025-04-17 21:15:42,644 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:15:42,652 - INFO - 
Testing Period:
2025-04-17 21:15:42,657 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:15:42,664 - INFO - Loading macro and market data...
2025-04-17 21:15:42,665 - INFO - Loading existing macro data...
2025-04-17 21:15:42,669 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:15:42,670 - INFO - Loading existing macro data...
2025-04-17 21:15:42,682 - WARNING - US corporate credit spread file not found
2025-04-17 21:15:42,682 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:15:42,687 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:15:42,687 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:15:42,687 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:15:42,689 - INFO - Loading existing market data...
2025-04-17 21:15:42,697 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:15:42,699 - INFO - Loading existing market data...
2025-04-17 21:15:42,703 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:15:42,704 - INFO - Macro and market data loaded
2025-04-17 21:15:42,704 - INFO - Preparing training data for regime classification...
2025-04-17 21:15:42,705 - INFO - Loading existing macro data...
2025-04-17 21:15:42,718 - WARNING - US corporate credit spread file not found
2025-04-17 21:15:42,718 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:15:42,722 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:15:42,722 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:15:42,722 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:15:42,724 - INFO - Loading existing market data...
2025-04-17 21:15:42,727 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:15:42,731 - INFO - Prepared training data with 1508 samples
2025-04-17 21:15:42,731 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:15:42,731 - INFO - Training data prepared
2025-04-17 21:15:42,731 - INFO - Storing data...
2025-04-17 21:15:42,732 - INFO - Aligning data indices...
2025-04-17 21:15:42,733 - INFO - Data indices aligned
2025-04-17 21:15:42,733 - INFO - Data preparation completed
2025-04-17 21:15:42,733 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:15:42,733 - INFO - Training models...
2025-04-17 21:15:42,734 - INFO - Starting model training...
2025-04-17 21:15:42,734 - INFO - Training regime classifier...
2025-04-17 21:15:42,734 - INFO - Preparing features...
2025-04-17 21:15:42,734 - INFO - Input shape: (1508, 6)
2025-04-17 21:15:42,735 - INFO - Handling missing values...
2025-04-17 21:15:42,736 - INFO - Missing values: 4389 -> 0
2025-04-17 21:15:42,737 - INFO - Scaling features...
2025-04-17 21:15:42,738 - INFO - Fitted new scaler
2025-04-17 21:15:42,739 - INFO - Output shape: (1508, 6)
2025-04-17 21:15:43,007 - INFO - Training neural portfolio optimizer...
2025-04-17 21:15:43,008 - INFO - Neural portfolio optimizer training completed
2025-04-17 21:15:43,008 - INFO - Model training completed
2025-04-17 21:15:43,010 - INFO - Model training completed
2025-04-17 21:15:43,010 - INFO - Initializing portfolio weights...
2025-04-17 21:15:43,011 - INFO - Portfolio weights initialized
2025-04-17 21:15:43,011 - INFO - Generating regime predictions for test period...
2025-04-17 21:15:43,012 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:15:43,015 - INFO - Generated 41 regime predictions
2025-04-17 21:15:43,015 - INFO - Calculating regime-specific returns...
2025-04-17 21:15:43,019 - INFO - Found 2 unique regimes
2025-04-17 21:15:43,019 - INFO - Processing regime 0...
2025-04-17 21:15:43,021 - INFO - Regime 0: 27 samples
2025-04-17 21:15:43,021 - INFO - Processing regime 1...
2025-04-17 21:15:43,022 - INFO - Regime 1: 18 samples
2025-04-17 21:15:43,022 - INFO - Training portfolio optimizer...
2025-04-17 21:15:43,023 - ERROR - Error running xgboost with neural: mat1 and mat2 shapes cannot be multiplied (45x5 and 6x64)
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 285, in run_strategy
    self.portfolio_optimizer.train(train_factors, target_weights)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 116, in train
    predictions = self.model(features_tensor)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 129, in forward
    x = torch.relu(self.fc1(x))
                   ~~~~~~~~^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\linear.py", line 125, in forward
    return F.linear(input, self.weight, self.bias)
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: mat1 and mat2 shapes cannot be multiplied (45x5 and 6x64)
2025-04-17 21:15:43,025 - INFO - 
Running strategy with hmm classifier and mean_variance optimizer
2025-04-17 21:15:43,026 - INFO - Initializing strategy...
2025-04-17 21:15:43,026 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 21:15:43,026 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:15:43,027 - INFO - Running strategy...
2025-04-17 21:15:43,027 - INFO - Starting strategy execution...
2025-04-17 21:15:43,027 - INFO - Preparing training and testing data...
2025-04-17 21:15:43,027 - INFO - Starting data preparation...
2025-04-17 21:15:43,027 - INFO - Loading Fama-French factors...
2025-04-17 21:15:43,043 - INFO - Fama-French factors loaded
2025-04-17 21:15:43,043 - INFO - Processing factor data...
2025-04-17 21:15:43,046 - INFO - Factor data processed
2025-04-17 21:15:43,047 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:15:43,047 - INFO - 
Training Period:
2025-04-17 21:15:43,053 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:15:43,064 - INFO - 
Testing Period:
2025-04-17 21:15:43,071 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:15:43,082 - INFO - Loading macro and market data...
2025-04-17 21:15:43,084 - INFO - Loading existing macro data...
2025-04-17 21:15:43,088 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:15:43,089 - INFO - Loading existing macro data...
2025-04-17 21:15:43,103 - WARNING - US corporate credit spread file not found
2025-04-17 21:15:43,103 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:15:43,107 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:15:43,108 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:15:43,108 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:15:43,110 - INFO - Loading existing market data...
2025-04-17 21:15:43,115 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:15:43,117 - INFO - Loading existing market data...
2025-04-17 21:15:43,122 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:15:43,122 - INFO - Macro and market data loaded
2025-04-17 21:15:43,122 - INFO - Preparing training data for regime classification...
2025-04-17 21:15:43,123 - INFO - Loading existing macro data...
2025-04-17 21:15:43,134 - WARNING - US corporate credit spread file not found
2025-04-17 21:15:43,135 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:15:43,137 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:15:43,138 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:15:43,138 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:15:43,139 - INFO - Loading existing market data...
2025-04-17 21:15:43,143 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:15:43,145 - INFO - Prepared training data with 1508 samples
2025-04-17 21:15:43,146 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:15:43,146 - INFO - Training data prepared
2025-04-17 21:15:43,146 - INFO - Storing data...
2025-04-17 21:15:43,147 - INFO - Aligning data indices...
2025-04-17 21:15:43,148 - INFO - Data indices aligned
2025-04-17 21:15:43,148 - INFO - Data preparation completed
2025-04-17 21:15:43,149 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:15:43,149 - INFO - Training models...
2025-04-17 21:15:43,149 - INFO - Starting model training...
2025-04-17 21:15:43,149 - INFO - Training regime classifier...
2025-04-17 21:15:43,149 - INFO - Training HMM model...
2025-04-17 21:15:43,381 - INFO - HMM model training completed
2025-04-17 21:15:43,560 - INFO - Model training completed
2025-04-17 21:15:43,562 - INFO - Model training completed
2025-04-17 21:15:43,562 - INFO - Initializing portfolio weights...
2025-04-17 21:15:43,563 - INFO - Portfolio weights initialized
2025-04-17 21:15:43,563 - INFO - Generating regime predictions for test period...
2025-04-17 21:15:43,565 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:15:43,567 - INFO - Generated 41 regime predictions
2025-04-17 21:15:43,567 - INFO - Calculating regime-specific returns...
2025-04-17 21:15:43,570 - INFO - Found 2 unique regimes
2025-04-17 21:15:43,570 - INFO - Processing regime 0...
2025-04-17 21:15:43,571 - INFO - Regime 0: 30 samples
2025-04-17 21:15:43,571 - INFO - Processing regime 1...
2025-04-17 21:15:43,572 - INFO - Regime 1: 15 samples
2025-04-17 21:15:43,573 - INFO - Training portfolio optimizer...
2025-04-17 21:15:43,573 - INFO - Training mean-variance optimizer...
2025-04-17 21:15:43,573 - INFO - Mean-variance optimizer training completed
2025-04-17 21:15:43,573 - INFO - Portfolio optimizer training completed
2025-04-17 21:15:43,573 - INFO - Optimizing portfolio weights...
2025-04-17 21:15:43,575 - WARNING - All weights are zero, using equal weights
2025-04-17 21:15:43,595 - INFO - Portfolio optimization completed
2025-04-17 21:15:43,595 - INFO - Running backtest...
2025-04-17 21:15:43,601 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:15:43,601 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:15:43,602 - INFO - Starting backtest...
2025-04-17 21:15:43,602 - INFO - Aligning dates between weights and returns...
2025-04-17 21:15:43,603 - INFO - Aligned 41 common dates
2025-04-17 21:15:43,603 - INFO - Initializing portfolio...
2025-04-17 21:15:43,603 - INFO - Running backtest simulation...
2025-04-17 21:15:43,612 - INFO - Backtest simulation completed
2025-04-17 21:15:43,612 - INFO - Storing backtest results...
2025-04-17 21:15:43,613 - INFO - Backtest completed successfully
2025-04-17 21:15:43,613 - INFO - Backtest completed
2025-04-17 21:15:43,613 - INFO - Strategy execution completed
2025-04-17 21:15:43,614 - ERROR - Error running hmm with mean_variance: Missing required metric: sharpe_ratio
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 61, in run_parameter_grid
    raise ValueError(f"Missing required metric: {metric}")
ValueError: Missing required metric: sharpe_ratio
2025-04-17 21:15:43,614 - INFO - 
Running strategy with hmm classifier and regime_aware optimizer
2025-04-17 21:15:43,615 - INFO - Initializing strategy...
2025-04-17 21:15:43,615 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 21:15:43,615 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:15:43,616 - INFO - Running strategy...
2025-04-17 21:15:43,616 - INFO - Starting strategy execution...
2025-04-17 21:15:43,616 - INFO - Preparing training and testing data...
2025-04-17 21:15:43,616 - INFO - Starting data preparation...
2025-04-17 21:15:43,617 - INFO - Loading Fama-French factors...
2025-04-17 21:15:43,626 - INFO - Fama-French factors loaded
2025-04-17 21:15:43,626 - INFO - Processing factor data...
2025-04-17 21:15:43,629 - INFO - Factor data processed
2025-04-17 21:15:43,629 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:15:43,629 - INFO - 
Training Period:
2025-04-17 21:15:43,635 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:15:43,649 - INFO - 
Testing Period:
2025-04-17 21:15:43,653 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:15:43,662 - INFO - Loading macro and market data...
2025-04-17 21:15:43,663 - INFO - Loading existing macro data...
2025-04-17 21:15:43,666 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:15:43,668 - INFO - Loading existing macro data...
2025-04-17 21:15:43,677 - WARNING - US corporate credit spread file not found
2025-04-17 21:15:43,678 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:15:43,681 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:15:43,681 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:15:43,681 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:15:43,682 - INFO - Loading existing market data...
2025-04-17 21:15:43,687 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:15:43,688 - INFO - Loading existing market data...
2025-04-17 21:15:43,693 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:15:43,693 - INFO - Macro and market data loaded
2025-04-17 21:15:43,694 - INFO - Preparing training data for regime classification...
2025-04-17 21:15:43,695 - INFO - Loading existing macro data...
2025-04-17 21:15:43,705 - WARNING - US corporate credit spread file not found
2025-04-17 21:15:43,705 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:15:43,708 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:15:43,709 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:15:43,709 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:15:43,710 - INFO - Loading existing market data...
2025-04-17 21:15:43,713 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:15:43,717 - INFO - Prepared training data with 1508 samples
2025-04-17 21:15:43,717 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:15:43,718 - INFO - Training data prepared
2025-04-17 21:15:43,718 - INFO - Storing data...
2025-04-17 21:15:43,718 - INFO - Aligning data indices...
2025-04-17 21:15:43,719 - INFO - Data indices aligned
2025-04-17 21:15:43,719 - INFO - Data preparation completed
2025-04-17 21:15:43,720 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:15:43,720 - INFO - Training models...
2025-04-17 21:15:43,720 - INFO - Starting model training...
2025-04-17 21:15:43,720 - INFO - Training regime classifier...
2025-04-17 21:15:43,720 - INFO - Training HMM model...
2025-04-17 21:15:43,797 - INFO - HMM model training completed
2025-04-17 21:15:43,981 - INFO - Model training completed
2025-04-17 21:15:43,983 - INFO - Model training completed
2025-04-17 21:15:43,983 - INFO - Initializing portfolio weights...
2025-04-17 21:15:43,983 - INFO - Portfolio weights initialized
2025-04-17 21:15:43,983 - INFO - Generating regime predictions for test period...
2025-04-17 21:15:43,985 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:15:43,987 - INFO - Generated 41 regime predictions
2025-04-17 21:15:43,987 - INFO - Calculating regime-specific returns...
2025-04-17 21:15:43,991 - INFO - Found 2 unique regimes
2025-04-17 21:15:43,991 - INFO - Processing regime 0...
2025-04-17 21:15:43,992 - INFO - Regime 0: 30 samples
2025-04-17 21:15:43,992 - INFO - Processing regime 1...
2025-04-17 21:15:43,993 - INFO - Regime 1: 15 samples
2025-04-17 21:15:43,994 - INFO - Training portfolio optimizer...
2025-04-17 21:15:43,994 - INFO - Training regime-aware optimizer...
2025-04-17 21:15:43,994 - INFO - Training mean-variance optimizer...
2025-04-17 21:15:43,994 - INFO - Mean-variance optimizer training completed
2025-04-17 21:15:43,994 - INFO - Trained optimizer for regime 0 with 30 samples
2025-04-17 21:15:43,995 - INFO - Training mean-variance optimizer...
2025-04-17 21:15:43,995 - INFO - Mean-variance optimizer training completed
2025-04-17 21:15:43,995 - INFO - Trained optimizer for regime 1 with 15 samples
2025-04-17 21:15:43,995 - WARNING - No samples found for regime 2
2025-04-17 21:15:43,996 - INFO - Portfolio optimizer training completed
2025-04-17 21:15:43,996 - INFO - Optimizing portfolio weights...
2025-04-17 21:15:43,996 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:43,997 - WARNING - All weights are zero, using equal weights
2025-04-17 21:15:43,998 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:43,999 - INFO - Optimizing weights for regime 1
2025-04-17 21:15:44,000 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,001 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,002 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,003 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,004 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,005 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,006 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,007 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,008 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,009 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,010 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,011 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,011 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,012 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,013 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,014 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,015 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,016 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,017 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,018 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,019 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,020 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,021 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,022 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,023 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,024 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,025 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,026 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,027 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,028 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,029 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,030 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,031 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,032 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,033 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,034 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,035 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,036 - INFO - Optimizing weights for regime 0
2025-04-17 21:15:44,037 - INFO - Portfolio optimization completed
2025-04-17 21:15:44,037 - INFO - Running backtest...
2025-04-17 21:15:44,044 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:15:44,044 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:15:44,044 - INFO - Starting backtest...
2025-04-17 21:15:44,044 - INFO - Aligning dates between weights and returns...
2025-04-17 21:15:44,045 - INFO - Aligned 41 common dates
2025-04-17 21:15:44,045 - INFO - Initializing portfolio...
2025-04-17 21:15:44,046 - INFO - Running backtest simulation...
2025-04-17 21:15:44,054 - INFO - Backtest simulation completed
2025-04-17 21:15:44,054 - INFO - Storing backtest results...
2025-04-17 21:15:44,055 - INFO - Backtest completed successfully
2025-04-17 21:15:44,055 - INFO - Backtest completed
2025-04-17 21:15:44,056 - INFO - Strategy execution completed
2025-04-17 21:15:44,057 - ERROR - Error running hmm with regime_aware: Missing required metric: sharpe_ratio
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 61, in run_parameter_grid
    raise ValueError(f"Missing required metric: {metric}")
ValueError: Missing required metric: sharpe_ratio
2025-04-17 21:15:44,058 - INFO - 
Running strategy with hmm classifier and neural optimizer
2025-04-17 21:15:44,058 - INFO - Initializing strategy...
2025-04-17 21:15:44,058 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 21:15:44,059 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:15:44,060 - INFO - Running strategy...
2025-04-17 21:15:44,060 - INFO - Starting strategy execution...
2025-04-17 21:15:44,060 - INFO - Preparing training and testing data...
2025-04-17 21:15:44,061 - INFO - Starting data preparation...
2025-04-17 21:15:44,061 - INFO - Loading Fama-French factors...
2025-04-17 21:15:44,071 - INFO - Fama-French factors loaded
2025-04-17 21:15:44,071 - INFO - Processing factor data...
2025-04-17 21:15:44,074 - INFO - Factor data processed
2025-04-17 21:15:44,074 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:15:44,074 - INFO - 
Training Period:
2025-04-17 21:15:44,079 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:15:44,089 - INFO - 
Testing Period:
2025-04-17 21:15:44,094 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:15:44,102 - INFO - Loading macro and market data...
2025-04-17 21:15:44,103 - INFO - Loading existing macro data...
2025-04-17 21:15:44,107 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:15:44,108 - INFO - Loading existing macro data...
2025-04-17 21:15:44,117 - WARNING - US corporate credit spread file not found
2025-04-17 21:15:44,117 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:15:44,121 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:15:44,121 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:15:44,121 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:15:44,122 - INFO - Loading existing market data...
2025-04-17 21:15:44,126 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:15:44,127 - INFO - Loading existing market data...
2025-04-17 21:15:44,130 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:15:44,130 - INFO - Macro and market data loaded
2025-04-17 21:15:44,131 - INFO - Preparing training data for regime classification...
2025-04-17 21:15:44,132 - INFO - Loading existing macro data...
2025-04-17 21:15:44,142 - WARNING - US corporate credit spread file not found
2025-04-17 21:15:44,143 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:15:44,146 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:15:44,146 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:15:44,146 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:15:44,147 - INFO - Loading existing market data...
2025-04-17 21:15:44,151 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:15:44,154 - INFO - Prepared training data with 1508 samples
2025-04-17 21:15:44,155 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:15:44,155 - INFO - Training data prepared
2025-04-17 21:15:44,155 - INFO - Storing data...
2025-04-17 21:15:44,156 - INFO - Aligning data indices...
2025-04-17 21:15:44,157 - INFO - Data indices aligned
2025-04-17 21:15:44,157 - INFO - Data preparation completed
2025-04-17 21:15:44,157 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:15:44,158 - INFO - Training models...
2025-04-17 21:15:44,158 - INFO - Starting model training...
2025-04-17 21:15:44,158 - INFO - Training regime classifier...
2025-04-17 21:15:44,159 - INFO - Training HMM model...
2025-04-17 21:15:44,239 - INFO - HMM model training completed
2025-04-17 21:15:44,430 - INFO - Training neural portfolio optimizer...
2025-04-17 21:15:44,430 - INFO - Neural portfolio optimizer training completed
2025-04-17 21:15:44,431 - INFO - Model training completed
2025-04-17 21:15:44,432 - INFO - Model training completed
2025-04-17 21:15:44,432 - INFO - Initializing portfolio weights...
2025-04-17 21:15:44,433 - INFO - Portfolio weights initialized
2025-04-17 21:15:44,433 - INFO - Generating regime predictions for test period...
2025-04-17 21:15:44,434 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:15:44,436 - INFO - Generated 41 regime predictions
2025-04-17 21:15:44,437 - INFO - Calculating regime-specific returns...
2025-04-17 21:15:44,440 - INFO - Found 2 unique regimes
2025-04-17 21:15:44,440 - INFO - Processing regime 0...
2025-04-17 21:15:44,440 - INFO - Regime 0: 30 samples
2025-04-17 21:15:44,441 - INFO - Processing regime 1...
2025-04-17 21:15:44,441 - INFO - Regime 1: 15 samples
2025-04-17 21:15:44,441 - INFO - Training portfolio optimizer...
2025-04-17 21:15:44,442 - ERROR - Error running hmm with neural: mat1 and mat2 shapes cannot be multiplied (45x5 and 6x64)
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 285, in run_strategy
    self.portfolio_optimizer.train(train_factors, target_weights)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 116, in train
    predictions = self.model(features_tensor)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 129, in forward
    x = torch.relu(self.fc1(x))
                   ~~~~~~~~^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\linear.py", line 125, in forward
    return F.linear(input, self.weight, self.bias)
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: mat1 and mat2 shapes cannot be multiplied (45x5 and 6x64)
2025-04-17 21:15:44,444 - ERROR - No valid results obtained from parameter grid search
2025-04-17 21:15:44,444 - ERROR - No valid results obtained from parameter grid search
2025-04-17 21:15:44,444 - INFO - Factor timing strategy optimization completed
2025-04-17 21:17:35,852 - INFO - Starting factor timing strategy optimization...
2025-04-17 21:17:35,853 - INFO - Running parameter grid search...
2025-04-17 21:17:35,853 - INFO - 
Running strategy with lstm classifier and mean_variance optimizer
2025-04-17 21:17:35,853 - INFO - Initializing strategy...
2025-04-17 21:17:35,853 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 21:17:35,854 - ERROR - Error running lstm with mean_variance: LSTMRegimeClassifier.__init__() missing 3 required positional arguments: 'hidden_size', 'num_layers', and 'num_regimes'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 40, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 36, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 43, in _init_regime_classifier
    return LSTMRegimeClassifier(input_size=6)  # Match actual number of features
TypeError: LSTMRegimeClassifier.__init__() missing 3 required positional arguments: 'hidden_size', 'num_layers', and 'num_regimes'
2025-04-17 21:17:35,855 - INFO - 
Running strategy with lstm classifier and regime_aware optimizer
2025-04-17 21:17:35,855 - INFO - Initializing strategy...
2025-04-17 21:17:35,855 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 21:17:35,856 - ERROR - Error running lstm with regime_aware: LSTMRegimeClassifier.__init__() missing 3 required positional arguments: 'hidden_size', 'num_layers', and 'num_regimes'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 40, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 36, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 43, in _init_regime_classifier
    return LSTMRegimeClassifier(input_size=6)  # Match actual number of features
TypeError: LSTMRegimeClassifier.__init__() missing 3 required positional arguments: 'hidden_size', 'num_layers', and 'num_regimes'
2025-04-17 21:17:35,857 - INFO - 
Running strategy with lstm classifier and neural optimizer
2025-04-17 21:17:35,857 - INFO - Initializing strategy...
2025-04-17 21:17:35,857 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 21:17:35,857 - ERROR - Error running lstm with neural: LSTMRegimeClassifier.__init__() missing 3 required positional arguments: 'hidden_size', 'num_layers', and 'num_regimes'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 40, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 36, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 43, in _init_regime_classifier
    return LSTMRegimeClassifier(input_size=6)  # Match actual number of features
TypeError: LSTMRegimeClassifier.__init__() missing 3 required positional arguments: 'hidden_size', 'num_layers', and 'num_regimes'
2025-04-17 21:17:35,858 - INFO - 
Running strategy with xgboost classifier and mean_variance optimizer
2025-04-17 21:17:35,858 - INFO - Initializing strategy...
2025-04-17 21:17:35,859 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 21:17:35,859 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:17:35,879 - INFO - Running strategy...
2025-04-17 21:17:35,879 - INFO - Starting strategy execution...
2025-04-17 21:17:35,880 - INFO - Preparing training and testing data...
2025-04-17 21:17:35,880 - INFO - Starting data preparation...
2025-04-17 21:17:35,880 - INFO - Loading Fama-French factors...
2025-04-17 21:17:35,895 - INFO - Fama-French factors loaded
2025-04-17 21:17:35,895 - INFO - Processing factor data...
2025-04-17 21:17:35,899 - INFO - Factor data processed
2025-04-17 21:17:35,899 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:17:35,899 - INFO - 
Training Period:
2025-04-17 21:17:35,905 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:17:35,916 - INFO - 
Testing Period:
2025-04-17 21:17:35,921 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:17:35,928 - INFO - Loading macro and market data...
2025-04-17 21:17:35,929 - INFO - Loading existing macro data...
2025-04-17 21:17:35,933 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:17:35,934 - INFO - Loading existing macro data...
2025-04-17 21:17:35,943 - WARNING - US corporate credit spread file not found
2025-04-17 21:17:35,944 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:17:35,948 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:17:35,949 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:17:35,949 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:17:35,951 - INFO - Loading existing market data...
2025-04-17 21:17:35,955 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:17:35,956 - INFO - Loading existing market data...
2025-04-17 21:17:35,959 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:17:35,960 - INFO - Macro and market data loaded
2025-04-17 21:17:35,960 - INFO - Preparing training data for regime classification...
2025-04-17 21:17:35,962 - INFO - Loading existing macro data...
2025-04-17 21:17:35,972 - WARNING - US corporate credit spread file not found
2025-04-17 21:17:35,973 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:17:35,975 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:17:35,976 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:17:35,976 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:17:35,977 - INFO - Loading existing market data...
2025-04-17 21:17:35,981 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:17:35,984 - INFO - Prepared training data with 1508 samples
2025-04-17 21:17:35,985 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:17:35,985 - INFO - Training data prepared
2025-04-17 21:17:35,986 - INFO - Storing data...
2025-04-17 21:17:35,986 - INFO - Aligning data indices...
2025-04-17 21:17:35,987 - INFO - Data indices aligned
2025-04-17 21:17:35,988 - INFO - Data preparation completed
2025-04-17 21:17:35,988 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:17:35,988 - INFO - Training models...
2025-04-17 21:17:35,989 - INFO - Starting model training...
2025-04-17 21:17:35,989 - INFO - Training regime classifier...
2025-04-17 21:17:35,989 - INFO - Preparing features...
2025-04-17 21:17:35,990 - INFO - Input shape: (1508, 6)
2025-04-17 21:17:35,990 - INFO - Handling missing values...
2025-04-17 21:17:35,991 - INFO - Missing values: 4389 -> 0
2025-04-17 21:17:35,992 - INFO - Scaling features...
2025-04-17 21:17:35,993 - INFO - Fitted new scaler
2025-04-17 21:17:35,995 - INFO - Output shape: (1508, 6)
2025-04-17 21:17:37,592 - INFO - Model training completed
2025-04-17 21:17:37,594 - INFO - Model training completed
2025-04-17 21:17:37,594 - INFO - Initializing portfolio weights...
2025-04-17 21:17:37,595 - INFO - Portfolio weights initialized
2025-04-17 21:17:37,595 - INFO - Generating regime predictions for test period...
2025-04-17 21:17:37,597 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:17:37,600 - INFO - Generated 41 regime predictions
2025-04-17 21:17:37,600 - INFO - Calculating regime-specific returns...
2025-04-17 21:17:37,604 - INFO - Found 2 unique regimes
2025-04-17 21:17:37,604 - INFO - Processing regime 0...
2025-04-17 21:17:37,606 - INFO - Regime 0: 27 samples
2025-04-17 21:17:37,606 - INFO - Processing regime 1...
2025-04-17 21:17:37,607 - INFO - Regime 1: 18 samples
2025-04-17 21:17:37,607 - INFO - Training portfolio optimizer...
2025-04-17 21:17:37,607 - INFO - Training mean-variance optimizer...
2025-04-17 21:17:37,608 - INFO - Mean-variance optimizer training completed
2025-04-17 21:17:37,608 - INFO - Portfolio optimizer training completed
2025-04-17 21:17:37,608 - INFO - Optimizing portfolio weights...
2025-04-17 21:17:37,614 - WARNING - All weights are zero, using equal weights
2025-04-17 21:17:37,648 - INFO - Portfolio optimization completed
2025-04-17 21:17:37,649 - INFO - Running backtest...
2025-04-17 21:17:37,660 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:17:37,660 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:17:37,660 - INFO - Starting backtest...
2025-04-17 21:17:37,660 - INFO - Aligning dates between weights and returns...
2025-04-17 21:17:37,661 - INFO - Aligned 41 common dates
2025-04-17 21:17:37,662 - INFO - Initializing portfolio...
2025-04-17 21:17:37,662 - INFO - Running backtest simulation...
2025-04-17 21:17:37,677 - INFO - Backtest simulation completed
2025-04-17 21:17:37,677 - INFO - Storing backtest results...
2025-04-17 21:17:37,678 - INFO - Backtest completed successfully
2025-04-17 21:17:37,678 - INFO - Backtest completed
2025-04-17 21:17:37,678 - INFO - Strategy execution completed
2025-04-17 21:17:37,678 - ERROR - Error running xgboost with mean_variance: Missing required metric: sharpe_ratio
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 61, in run_parameter_grid
    raise ValueError(f"Missing required metric: {metric}")
ValueError: Missing required metric: sharpe_ratio
2025-04-17 21:17:37,679 - INFO - 
Running strategy with xgboost classifier and regime_aware optimizer
2025-04-17 21:17:37,680 - INFO - Initializing strategy...
2025-04-17 21:17:37,680 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 21:17:37,680 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:17:37,680 - INFO - Running strategy...
2025-04-17 21:17:37,681 - INFO - Starting strategy execution...
2025-04-17 21:17:37,681 - INFO - Preparing training and testing data...
2025-04-17 21:17:37,681 - INFO - Starting data preparation...
2025-04-17 21:17:37,681 - INFO - Loading Fama-French factors...
2025-04-17 21:17:37,699 - INFO - Fama-French factors loaded
2025-04-17 21:17:37,699 - INFO - Processing factor data...
2025-04-17 21:17:37,703 - INFO - Factor data processed
2025-04-17 21:17:37,704 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:17:37,704 - INFO - 
Training Period:
2025-04-17 21:17:37,709 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:17:37,718 - INFO - 
Testing Period:
2025-04-17 21:17:37,724 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:17:37,732 - INFO - Loading macro and market data...
2025-04-17 21:17:37,733 - INFO - Loading existing macro data...
2025-04-17 21:17:37,736 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:17:37,738 - INFO - Loading existing macro data...
2025-04-17 21:17:37,751 - WARNING - US corporate credit spread file not found
2025-04-17 21:17:37,752 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:17:37,756 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:17:37,756 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:17:37,756 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:17:37,758 - INFO - Loading existing market data...
2025-04-17 21:17:37,764 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:17:37,765 - INFO - Loading existing market data...
2025-04-17 21:17:37,770 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:17:37,770 - INFO - Macro and market data loaded
2025-04-17 21:17:37,770 - INFO - Preparing training data for regime classification...
2025-04-17 21:17:37,771 - INFO - Loading existing macro data...
2025-04-17 21:17:37,783 - WARNING - US corporate credit spread file not found
2025-04-17 21:17:37,783 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:17:37,787 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:17:37,788 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:17:37,788 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:17:37,790 - INFO - Loading existing market data...
2025-04-17 21:17:37,795 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:17:37,798 - INFO - Prepared training data with 1508 samples
2025-04-17 21:17:37,798 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:17:37,799 - INFO - Training data prepared
2025-04-17 21:17:37,799 - INFO - Storing data...
2025-04-17 21:17:37,799 - INFO - Aligning data indices...
2025-04-17 21:17:37,800 - INFO - Data indices aligned
2025-04-17 21:17:37,801 - INFO - Data preparation completed
2025-04-17 21:17:37,801 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:17:37,801 - INFO - Training models...
2025-04-17 21:17:37,801 - INFO - Starting model training...
2025-04-17 21:17:37,801 - INFO - Training regime classifier...
2025-04-17 21:17:37,801 - INFO - Preparing features...
2025-04-17 21:17:37,802 - INFO - Input shape: (1508, 6)
2025-04-17 21:17:37,802 - INFO - Handling missing values...
2025-04-17 21:17:37,803 - INFO - Missing values: 4389 -> 0
2025-04-17 21:17:37,803 - INFO - Scaling features...
2025-04-17 21:17:37,805 - INFO - Fitted new scaler
2025-04-17 21:17:37,806 - INFO - Output shape: (1508, 6)
2025-04-17 21:17:38,113 - INFO - Model training completed
2025-04-17 21:17:38,115 - INFO - Model training completed
2025-04-17 21:17:38,115 - INFO - Initializing portfolio weights...
2025-04-17 21:17:38,116 - INFO - Portfolio weights initialized
2025-04-17 21:17:38,116 - INFO - Generating regime predictions for test period...
2025-04-17 21:17:38,117 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:17:38,120 - INFO - Generated 41 regime predictions
2025-04-17 21:17:38,121 - INFO - Calculating regime-specific returns...
2025-04-17 21:17:38,126 - INFO - Found 2 unique regimes
2025-04-17 21:17:38,126 - INFO - Processing regime 0...
2025-04-17 21:17:38,128 - INFO - Regime 0: 27 samples
2025-04-17 21:17:38,128 - INFO - Processing regime 1...
2025-04-17 21:17:38,130 - INFO - Regime 1: 18 samples
2025-04-17 21:17:38,130 - INFO - Training portfolio optimizer...
2025-04-17 21:17:38,130 - INFO - Training regime-aware optimizer...
2025-04-17 21:17:38,130 - INFO - Training mean-variance optimizer...
2025-04-17 21:17:38,131 - INFO - Mean-variance optimizer training completed
2025-04-17 21:17:38,131 - INFO - Trained optimizer for regime 0 with 27 samples
2025-04-17 21:17:38,131 - INFO - Training mean-variance optimizer...
2025-04-17 21:17:38,131 - INFO - Mean-variance optimizer training completed
2025-04-17 21:17:38,131 - INFO - Trained optimizer for regime 1 with 18 samples
2025-04-17 21:17:38,132 - WARNING - No samples found for regime 2
2025-04-17 21:17:38,132 - INFO - Portfolio optimizer training completed
2025-04-17 21:17:38,132 - INFO - Optimizing portfolio weights...
2025-04-17 21:17:38,132 - INFO - Optimizing weights for regime 1
2025-04-17 21:17:38,135 - WARNING - All weights are zero, using equal weights
2025-04-17 21:17:38,135 - INFO - Optimizing weights for regime 1
2025-04-17 21:17:38,137 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,138 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,139 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,140 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,141 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,143 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,144 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,145 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,146 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,147 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,148 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,150 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,151 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,152 - INFO - Optimizing weights for regime 1
2025-04-17 21:17:38,153 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,154 - INFO - Optimizing weights for regime 1
2025-04-17 21:17:38,156 - INFO - Optimizing weights for regime 1
2025-04-17 21:17:38,157 - INFO - Optimizing weights for regime 1
2025-04-17 21:17:38,158 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,159 - INFO - Optimizing weights for regime 1
2025-04-17 21:17:38,160 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,161 - INFO - Optimizing weights for regime 1
2025-04-17 21:17:38,163 - INFO - Optimizing weights for regime 1
2025-04-17 21:17:38,164 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,165 - INFO - Optimizing weights for regime 1
2025-04-17 21:17:38,166 - INFO - Optimizing weights for regime 1
2025-04-17 21:17:38,167 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,168 - INFO - Optimizing weights for regime 1
2025-04-17 21:17:38,170 - INFO - Optimizing weights for regime 1
2025-04-17 21:17:38,171 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,172 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,173 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,174 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,175 - INFO - Optimizing weights for regime 1
2025-04-17 21:17:38,176 - INFO - Optimizing weights for regime 1
2025-04-17 21:17:38,177 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:38,178 - INFO - Optimizing weights for regime 1
2025-04-17 21:17:38,179 - INFO - Optimizing weights for regime 1
2025-04-17 21:17:38,180 - INFO - Optimizing weights for regime 1
2025-04-17 21:17:38,181 - INFO - Portfolio optimization completed
2025-04-17 21:17:38,182 - INFO - Running backtest...
2025-04-17 21:17:38,192 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:17:38,193 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:17:38,193 - INFO - Starting backtest...
2025-04-17 21:17:38,193 - INFO - Aligning dates between weights and returns...
2025-04-17 21:17:38,194 - INFO - Aligned 41 common dates
2025-04-17 21:17:38,194 - INFO - Initializing portfolio...
2025-04-17 21:17:38,194 - INFO - Running backtest simulation...
2025-04-17 21:17:38,218 - INFO - Backtest simulation completed
2025-04-17 21:17:38,219 - INFO - Storing backtest results...
2025-04-17 21:17:38,219 - INFO - Backtest completed successfully
2025-04-17 21:17:38,219 - INFO - Backtest completed
2025-04-17 21:17:38,219 - INFO - Strategy execution completed
2025-04-17 21:17:38,220 - ERROR - Error running xgboost with regime_aware: Missing required metric: sharpe_ratio
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 61, in run_parameter_grid
    raise ValueError(f"Missing required metric: {metric}")
ValueError: Missing required metric: sharpe_ratio
2025-04-17 21:17:38,221 - INFO - 
Running strategy with xgboost classifier and neural optimizer
2025-04-17 21:17:38,221 - INFO - Initializing strategy...
2025-04-17 21:17:38,221 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 21:17:38,222 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:17:38,222 - ERROR - Error running xgboost with neural: 'FactorTimingStrategy' object has no attribute 'train_data'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 40, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 37, in __init__
    self.portfolio_optimizer = self._init_portfolio_optimizer(optimizer_type)
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 59, in _init_portfolio_optimizer
    train_X = pd.concat([self.train_data['macro'], self.train_data['market']], axis=1)
                         ^^^^^^^^^^^^^^^
AttributeError: 'FactorTimingStrategy' object has no attribute 'train_data'
2025-04-17 21:17:38,223 - INFO - 
Running strategy with hmm classifier and mean_variance optimizer
2025-04-17 21:17:38,224 - INFO - Initializing strategy...
2025-04-17 21:17:38,224 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 21:17:38,224 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:17:38,226 - INFO - Running strategy...
2025-04-17 21:17:38,226 - INFO - Starting strategy execution...
2025-04-17 21:17:38,226 - INFO - Preparing training and testing data...
2025-04-17 21:17:38,227 - INFO - Starting data preparation...
2025-04-17 21:17:38,227 - INFO - Loading Fama-French factors...
2025-04-17 21:17:38,239 - INFO - Fama-French factors loaded
2025-04-17 21:17:38,240 - INFO - Processing factor data...
2025-04-17 21:17:38,242 - INFO - Factor data processed
2025-04-17 21:17:38,243 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:17:38,243 - INFO - 
Training Period:
2025-04-17 21:17:38,251 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:17:38,261 - INFO - 
Testing Period:
2025-04-17 21:17:38,267 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:17:38,275 - INFO - Loading macro and market data...
2025-04-17 21:17:38,276 - INFO - Loading existing macro data...
2025-04-17 21:17:38,281 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:17:38,282 - INFO - Loading existing macro data...
2025-04-17 21:17:38,293 - WARNING - US corporate credit spread file not found
2025-04-17 21:17:38,293 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:17:38,297 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:17:38,298 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:17:38,298 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:17:38,300 - INFO - Loading existing market data...
2025-04-17 21:17:38,305 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:17:38,306 - INFO - Loading existing market data...
2025-04-17 21:17:38,311 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:17:38,312 - INFO - Macro and market data loaded
2025-04-17 21:17:38,312 - INFO - Preparing training data for regime classification...
2025-04-17 21:17:38,313 - INFO - Loading existing macro data...
2025-04-17 21:17:38,326 - WARNING - US corporate credit spread file not found
2025-04-17 21:17:38,327 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:17:38,331 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:17:38,331 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:17:38,332 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:17:38,333 - INFO - Loading existing market data...
2025-04-17 21:17:38,338 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:17:38,342 - INFO - Prepared training data with 1508 samples
2025-04-17 21:17:38,342 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:17:38,343 - INFO - Training data prepared
2025-04-17 21:17:38,343 - INFO - Storing data...
2025-04-17 21:17:38,344 - INFO - Aligning data indices...
2025-04-17 21:17:38,345 - INFO - Data indices aligned
2025-04-17 21:17:38,345 - INFO - Data preparation completed
2025-04-17 21:17:38,345 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:17:38,346 - INFO - Training models...
2025-04-17 21:17:38,346 - INFO - Starting model training...
2025-04-17 21:17:38,346 - INFO - Training regime classifier...
2025-04-17 21:17:38,346 - INFO - Training HMM model...
2025-04-17 21:17:38,605 - INFO - HMM model training completed
2025-04-17 21:17:38,901 - INFO - Model training completed
2025-04-17 21:17:38,903 - INFO - Model training completed
2025-04-17 21:17:38,903 - INFO - Initializing portfolio weights...
2025-04-17 21:17:38,904 - INFO - Portfolio weights initialized
2025-04-17 21:17:38,905 - INFO - Generating regime predictions for test period...
2025-04-17 21:17:38,906 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:17:38,908 - INFO - Generated 41 regime predictions
2025-04-17 21:17:38,908 - INFO - Calculating regime-specific returns...
2025-04-17 21:17:38,912 - INFO - Found 2 unique regimes
2025-04-17 21:17:38,912 - INFO - Processing regime 0...
2025-04-17 21:17:38,913 - INFO - Regime 0: 30 samples
2025-04-17 21:17:38,913 - INFO - Processing regime 1...
2025-04-17 21:17:38,914 - INFO - Regime 1: 15 samples
2025-04-17 21:17:38,914 - INFO - Training portfolio optimizer...
2025-04-17 21:17:38,914 - INFO - Training mean-variance optimizer...
2025-04-17 21:17:38,914 - INFO - Mean-variance optimizer training completed
2025-04-17 21:17:38,914 - INFO - Portfolio optimizer training completed
2025-04-17 21:17:38,914 - INFO - Optimizing portfolio weights...
2025-04-17 21:17:38,915 - WARNING - All weights are zero, using equal weights
2025-04-17 21:17:38,940 - INFO - Portfolio optimization completed
2025-04-17 21:17:38,940 - INFO - Running backtest...
2025-04-17 21:17:38,946 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:17:38,947 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:17:38,947 - INFO - Starting backtest...
2025-04-17 21:17:38,947 - INFO - Aligning dates between weights and returns...
2025-04-17 21:17:38,948 - INFO - Aligned 41 common dates
2025-04-17 21:17:38,948 - INFO - Initializing portfolio...
2025-04-17 21:17:38,948 - INFO - Running backtest simulation...
2025-04-17 21:17:38,957 - INFO - Backtest simulation completed
2025-04-17 21:17:38,957 - INFO - Storing backtest results...
2025-04-17 21:17:38,958 - INFO - Backtest completed successfully
2025-04-17 21:17:38,958 - INFO - Backtest completed
2025-04-17 21:17:38,958 - INFO - Strategy execution completed
2025-04-17 21:17:38,958 - ERROR - Error running hmm with mean_variance: Missing required metric: sharpe_ratio
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 61, in run_parameter_grid
    raise ValueError(f"Missing required metric: {metric}")
ValueError: Missing required metric: sharpe_ratio
2025-04-17 21:17:38,959 - INFO - 
Running strategy with hmm classifier and regime_aware optimizer
2025-04-17 21:17:38,959 - INFO - Initializing strategy...
2025-04-17 21:17:38,959 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 21:17:38,960 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:17:38,960 - INFO - Running strategy...
2025-04-17 21:17:38,960 - INFO - Starting strategy execution...
2025-04-17 21:17:38,961 - INFO - Preparing training and testing data...
2025-04-17 21:17:38,961 - INFO - Starting data preparation...
2025-04-17 21:17:38,961 - INFO - Loading Fama-French factors...
2025-04-17 21:17:38,972 - INFO - Fama-French factors loaded
2025-04-17 21:17:38,972 - INFO - Processing factor data...
2025-04-17 21:17:38,975 - INFO - Factor data processed
2025-04-17 21:17:38,976 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:17:38,976 - INFO - 
Training Period:
2025-04-17 21:17:38,980 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:17:38,988 - INFO - 
Testing Period:
2025-04-17 21:17:38,993 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:17:39,000 - INFO - Loading macro and market data...
2025-04-17 21:17:39,002 - INFO - Loading existing macro data...
2025-04-17 21:17:39,005 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:17:39,006 - INFO - Loading existing macro data...
2025-04-17 21:17:39,017 - WARNING - US corporate credit spread file not found
2025-04-17 21:17:39,017 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:17:39,020 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:17:39,021 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:17:39,021 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:17:39,023 - INFO - Loading existing market data...
2025-04-17 21:17:39,027 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:17:39,028 - INFO - Loading existing market data...
2025-04-17 21:17:39,032 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:17:39,032 - INFO - Macro and market data loaded
2025-04-17 21:17:39,033 - INFO - Preparing training data for regime classification...
2025-04-17 21:17:39,034 - INFO - Loading existing macro data...
2025-04-17 21:17:39,044 - WARNING - US corporate credit spread file not found
2025-04-17 21:17:39,045 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:17:39,048 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:17:39,048 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:17:39,048 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:17:39,049 - INFO - Loading existing market data...
2025-04-17 21:17:39,054 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:17:39,057 - INFO - Prepared training data with 1508 samples
2025-04-17 21:17:39,058 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:17:39,058 - INFO - Training data prepared
2025-04-17 21:17:39,058 - INFO - Storing data...
2025-04-17 21:17:39,059 - INFO - Aligning data indices...
2025-04-17 21:17:39,060 - INFO - Data indices aligned
2025-04-17 21:17:39,060 - INFO - Data preparation completed
2025-04-17 21:17:39,061 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:17:39,061 - INFO - Training models...
2025-04-17 21:17:39,061 - INFO - Starting model training...
2025-04-17 21:17:39,061 - INFO - Training regime classifier...
2025-04-17 21:17:39,062 - INFO - Training HMM model...
2025-04-17 21:17:39,144 - INFO - HMM model training completed
2025-04-17 21:17:39,324 - INFO - Model training completed
2025-04-17 21:17:39,326 - INFO - Model training completed
2025-04-17 21:17:39,326 - INFO - Initializing portfolio weights...
2025-04-17 21:17:39,326 - INFO - Portfolio weights initialized
2025-04-17 21:17:39,327 - INFO - Generating regime predictions for test period...
2025-04-17 21:17:39,329 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:17:39,331 - INFO - Generated 41 regime predictions
2025-04-17 21:17:39,331 - INFO - Calculating regime-specific returns...
2025-04-17 21:17:39,334 - INFO - Found 2 unique regimes
2025-04-17 21:17:39,334 - INFO - Processing regime 0...
2025-04-17 21:17:39,335 - INFO - Regime 0: 30 samples
2025-04-17 21:17:39,335 - INFO - Processing regime 1...
2025-04-17 21:17:39,336 - INFO - Regime 1: 15 samples
2025-04-17 21:17:39,336 - INFO - Training portfolio optimizer...
2025-04-17 21:17:39,337 - INFO - Training regime-aware optimizer...
2025-04-17 21:17:39,337 - INFO - Training mean-variance optimizer...
2025-04-17 21:17:39,337 - INFO - Mean-variance optimizer training completed
2025-04-17 21:17:39,337 - INFO - Trained optimizer for regime 0 with 30 samples
2025-04-17 21:17:39,337 - INFO - Training mean-variance optimizer...
2025-04-17 21:17:39,337 - INFO - Mean-variance optimizer training completed
2025-04-17 21:17:39,337 - INFO - Trained optimizer for regime 1 with 15 samples
2025-04-17 21:17:39,338 - WARNING - No samples found for regime 2
2025-04-17 21:17:39,338 - INFO - Portfolio optimizer training completed
2025-04-17 21:17:39,338 - INFO - Optimizing portfolio weights...
2025-04-17 21:17:39,338 - INFO - Optimizing weights for regime 1
2025-04-17 21:17:39,339 - WARNING - All weights are zero, using equal weights
2025-04-17 21:17:39,340 - INFO - Optimizing weights for regime 1
2025-04-17 21:17:39,341 - INFO - Optimizing weights for regime 1
2025-04-17 21:17:39,342 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,342 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,344 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,344 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,345 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,346 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,347 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,348 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,349 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,350 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,351 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,352 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,353 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,354 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,355 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,356 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,357 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,358 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,359 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,359 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,360 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,361 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,363 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,365 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,367 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,367 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,368 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,369 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,370 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,371 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,372 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,373 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,375 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,375 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,377 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,378 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,378 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,379 - INFO - Optimizing weights for regime 0
2025-04-17 21:17:39,380 - INFO - Portfolio optimization completed
2025-04-17 21:17:39,381 - INFO - Running backtest...
2025-04-17 21:17:39,388 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:17:39,388 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:17:39,389 - INFO - Starting backtest...
2025-04-17 21:17:39,389 - INFO - Aligning dates between weights and returns...
2025-04-17 21:17:39,390 - INFO - Aligned 41 common dates
2025-04-17 21:17:39,390 - INFO - Initializing portfolio...
2025-04-17 21:17:39,390 - INFO - Running backtest simulation...
2025-04-17 21:17:39,398 - INFO - Backtest simulation completed
2025-04-17 21:17:39,399 - INFO - Storing backtest results...
2025-04-17 21:17:39,399 - INFO - Backtest completed successfully
2025-04-17 21:17:39,400 - INFO - Backtest completed
2025-04-17 21:17:39,400 - INFO - Strategy execution completed
2025-04-17 21:17:39,400 - ERROR - Error running hmm with regime_aware: Missing required metric: sharpe_ratio
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 61, in run_parameter_grid
    raise ValueError(f"Missing required metric: {metric}")
ValueError: Missing required metric: sharpe_ratio
2025-04-17 21:17:39,401 - INFO - 
Running strategy with hmm classifier and neural optimizer
2025-04-17 21:17:39,401 - INFO - Initializing strategy...
2025-04-17 21:17:39,402 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 21:17:39,402 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:17:39,402 - ERROR - Error running hmm with neural: 'FactorTimingStrategy' object has no attribute 'train_data'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 40, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 37, in __init__
    self.portfolio_optimizer = self._init_portfolio_optimizer(optimizer_type)
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 59, in _init_portfolio_optimizer
    train_X = pd.concat([self.train_data['macro'], self.train_data['market']], axis=1)
                         ^^^^^^^^^^^^^^^
AttributeError: 'FactorTimingStrategy' object has no attribute 'train_data'
2025-04-17 21:17:39,403 - ERROR - No valid results obtained from parameter grid search
2025-04-17 21:17:39,404 - ERROR - No valid results obtained from parameter grid search
2025-04-17 21:17:39,404 - INFO - Factor timing strategy optimization completed
2025-04-17 21:18:43,108 - INFO - Starting factor timing strategy optimization...
2025-04-17 21:18:43,108 - INFO - Running parameter grid search...
2025-04-17 21:18:43,108 - INFO - 
Running strategy with lstm classifier and mean_variance optimizer
2025-04-17 21:18:43,109 - INFO - Initializing strategy...
2025-04-17 21:18:43,109 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 21:18:43,111 - INFO - Running strategy...
2025-04-17 21:18:43,111 - INFO - Starting strategy execution...
2025-04-17 21:18:43,111 - INFO - Preparing training and testing data...
2025-04-17 21:18:43,111 - INFO - Starting data preparation...
2025-04-17 21:18:43,111 - INFO - Loading Fama-French factors...
2025-04-17 21:18:43,127 - INFO - Fama-French factors loaded
2025-04-17 21:18:43,127 - INFO - Processing factor data...
2025-04-17 21:18:43,130 - INFO - Factor data processed
2025-04-17 21:18:43,131 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:18:43,131 - INFO - 
Training Period:
2025-04-17 21:18:43,137 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:18:43,147 - INFO - 
Testing Period:
2025-04-17 21:18:43,151 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:18:43,160 - INFO - Loading macro and market data...
2025-04-17 21:18:43,162 - INFO - Loading existing macro data...
2025-04-17 21:18:43,166 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:18:43,168 - INFO - Loading existing macro data...
2025-04-17 21:18:43,179 - WARNING - US corporate credit spread file not found
2025-04-17 21:18:43,180 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:18:43,186 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:18:43,186 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:18:43,186 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:18:43,188 - INFO - Loading existing market data...
2025-04-17 21:18:43,193 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:18:43,195 - INFO - Loading existing market data...
2025-04-17 21:18:43,198 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:18:43,198 - INFO - Macro and market data loaded
2025-04-17 21:18:43,199 - INFO - Preparing training data for regime classification...
2025-04-17 21:18:43,200 - INFO - Loading existing macro data...
2025-04-17 21:18:43,210 - WARNING - US corporate credit spread file not found
2025-04-17 21:18:43,211 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:18:43,214 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:18:43,214 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:18:43,215 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:18:43,216 - INFO - Loading existing market data...
2025-04-17 21:18:43,221 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:18:43,224 - INFO - Prepared training data with 1508 samples
2025-04-17 21:18:43,225 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:18:43,225 - INFO - Training data prepared
2025-04-17 21:18:43,226 - INFO - Storing data...
2025-04-17 21:18:43,226 - INFO - Aligning data indices...
2025-04-17 21:18:43,228 - INFO - Data indices aligned
2025-04-17 21:18:43,228 - INFO - Data preparation completed
2025-04-17 21:18:43,228 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:18:43,229 - INFO - Training models...
2025-04-17 21:18:43,229 - INFO - Starting model training...
2025-04-17 21:18:43,229 - INFO - Training regime classifier...
2025-04-17 21:18:43,230 - ERROR - Error running lstm with mean_variance: Module.train() takes from 1 to 2 positional arguments but 3 were given
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 222, in run_strategy
    training_metrics = self.train_models()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 164, in train_models
    self.regime_classifier.train(train_X, train_y)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
TypeError: Module.train() takes from 1 to 2 positional arguments but 3 were given
2025-04-17 21:18:43,231 - INFO - 
Running strategy with lstm classifier and regime_aware optimizer
2025-04-17 21:18:43,231 - INFO - Initializing strategy...
2025-04-17 21:18:43,232 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 21:18:43,233 - INFO - Running strategy...
2025-04-17 21:18:43,234 - INFO - Starting strategy execution...
2025-04-17 21:18:43,234 - INFO - Preparing training and testing data...
2025-04-17 21:18:43,234 - INFO - Starting data preparation...
2025-04-17 21:18:43,235 - INFO - Loading Fama-French factors...
2025-04-17 21:18:43,244 - INFO - Fama-French factors loaded
2025-04-17 21:18:43,245 - INFO - Processing factor data...
2025-04-17 21:18:43,249 - INFO - Factor data processed
2025-04-17 21:18:43,249 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:18:43,249 - INFO - 
Training Period:
2025-04-17 21:18:43,255 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:18:43,264 - INFO - 
Testing Period:
2025-04-17 21:18:43,269 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:18:43,278 - INFO - Loading macro and market data...
2025-04-17 21:18:43,279 - INFO - Loading existing macro data...
2025-04-17 21:18:43,284 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:18:43,286 - INFO - Loading existing macro data...
2025-04-17 21:18:43,298 - WARNING - US corporate credit spread file not found
2025-04-17 21:18:43,298 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:18:43,301 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:18:43,302 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:18:43,302 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:18:43,303 - INFO - Loading existing market data...
2025-04-17 21:18:43,307 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:18:43,309 - INFO - Loading existing market data...
2025-04-17 21:18:43,313 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:18:43,313 - INFO - Macro and market data loaded
2025-04-17 21:18:43,314 - INFO - Preparing training data for regime classification...
2025-04-17 21:18:43,315 - INFO - Loading existing macro data...
2025-04-17 21:18:43,326 - WARNING - US corporate credit spread file not found
2025-04-17 21:18:43,326 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:18:43,330 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:18:43,331 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:18:43,331 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:18:43,332 - INFO - Loading existing market data...
2025-04-17 21:18:43,336 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:18:43,339 - INFO - Prepared training data with 1508 samples
2025-04-17 21:18:43,340 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:18:43,340 - INFO - Training data prepared
2025-04-17 21:18:43,340 - INFO - Storing data...
2025-04-17 21:18:43,341 - INFO - Aligning data indices...
2025-04-17 21:18:43,342 - INFO - Data indices aligned
2025-04-17 21:18:43,342 - INFO - Data preparation completed
2025-04-17 21:18:43,342 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:18:43,342 - INFO - Training models...
2025-04-17 21:18:43,342 - INFO - Starting model training...
2025-04-17 21:18:43,343 - INFO - Training regime classifier...
2025-04-17 21:18:43,343 - ERROR - Error running lstm with regime_aware: Module.train() takes from 1 to 2 positional arguments but 3 were given
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 222, in run_strategy
    training_metrics = self.train_models()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 164, in train_models
    self.regime_classifier.train(train_X, train_y)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
TypeError: Module.train() takes from 1 to 2 positional arguments but 3 were given
2025-04-17 21:18:43,344 - INFO - 
Running strategy with lstm classifier and neural optimizer
2025-04-17 21:18:43,345 - INFO - Initializing strategy...
2025-04-17 21:18:43,345 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 21:18:44,466 - INFO - Running strategy...
2025-04-17 21:18:44,467 - INFO - Starting strategy execution...
2025-04-17 21:18:44,467 - INFO - Preparing training and testing data...
2025-04-17 21:18:44,467 - INFO - Starting data preparation...
2025-04-17 21:18:44,467 - INFO - Loading Fama-French factors...
2025-04-17 21:18:44,478 - INFO - Fama-French factors loaded
2025-04-17 21:18:44,478 - INFO - Processing factor data...
2025-04-17 21:18:44,481 - INFO - Factor data processed
2025-04-17 21:18:44,481 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:18:44,481 - INFO - 
Training Period:
2025-04-17 21:18:44,487 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:18:44,497 - INFO - 
Testing Period:
2025-04-17 21:18:44,501 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:18:44,511 - INFO - Loading macro and market data...
2025-04-17 21:18:44,512 - INFO - Loading existing macro data...
2025-04-17 21:18:44,516 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:18:44,517 - INFO - Loading existing macro data...
2025-04-17 21:18:44,526 - WARNING - US corporate credit spread file not found
2025-04-17 21:18:44,527 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:18:44,530 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:18:44,531 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:18:44,531 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:18:44,532 - INFO - Loading existing market data...
2025-04-17 21:18:44,537 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:18:44,538 - INFO - Loading existing market data...
2025-04-17 21:18:44,541 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:18:44,542 - INFO - Macro and market data loaded
2025-04-17 21:18:44,542 - INFO - Preparing training data for regime classification...
2025-04-17 21:18:44,552 - INFO - Loading existing macro data...
2025-04-17 21:18:44,562 - WARNING - US corporate credit spread file not found
2025-04-17 21:18:44,563 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:18:44,566 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:18:44,567 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:18:44,567 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:18:44,568 - INFO - Loading existing market data...
2025-04-17 21:18:44,573 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:18:44,577 - INFO - Prepared training data with 1508 samples
2025-04-17 21:18:44,578 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:18:44,578 - INFO - Training data prepared
2025-04-17 21:18:44,579 - INFO - Storing data...
2025-04-17 21:18:44,579 - INFO - Aligning data indices...
2025-04-17 21:18:44,581 - INFO - Data indices aligned
2025-04-17 21:18:44,581 - INFO - Data preparation completed
2025-04-17 21:18:44,581 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:18:44,582 - INFO - Training models...
2025-04-17 21:18:44,583 - INFO - Starting model training...
2025-04-17 21:18:44,583 - INFO - Training regime classifier...
2025-04-17 21:18:44,583 - ERROR - Error running lstm with neural: Module.train() takes from 1 to 2 positional arguments but 3 were given
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 222, in run_strategy
    training_metrics = self.train_models()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 164, in train_models
    self.regime_classifier.train(train_X, train_y)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
TypeError: Module.train() takes from 1 to 2 positional arguments but 3 were given
2025-04-17 21:18:44,584 - INFO - 
Running strategy with xgboost classifier and mean_variance optimizer
2025-04-17 21:18:44,585 - INFO - Initializing strategy...
2025-04-17 21:18:44,585 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 21:18:44,586 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:18:44,610 - INFO - Running strategy...
2025-04-17 21:18:44,611 - INFO - Starting strategy execution...
2025-04-17 21:18:44,611 - INFO - Preparing training and testing data...
2025-04-17 21:18:44,611 - INFO - Starting data preparation...
2025-04-17 21:18:44,612 - INFO - Loading Fama-French factors...
2025-04-17 21:18:44,625 - INFO - Fama-French factors loaded
2025-04-17 21:18:44,626 - INFO - Processing factor data...
2025-04-17 21:18:44,629 - INFO - Factor data processed
2025-04-17 21:18:44,629 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:18:44,630 - INFO - 
Training Period:
2025-04-17 21:18:44,635 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:18:44,644 - INFO - 
Testing Period:
2025-04-17 21:18:44,649 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:18:44,658 - INFO - Loading macro and market data...
2025-04-17 21:18:44,659 - INFO - Loading existing macro data...
2025-04-17 21:18:44,663 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:18:44,664 - INFO - Loading existing macro data...
2025-04-17 21:18:44,674 - WARNING - US corporate credit spread file not found
2025-04-17 21:18:44,675 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:18:44,678 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:18:44,679 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:18:44,679 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:18:44,681 - INFO - Loading existing market data...
2025-04-17 21:18:44,685 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:18:44,686 - INFO - Loading existing market data...
2025-04-17 21:18:44,689 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:18:44,689 - INFO - Macro and market data loaded
2025-04-17 21:18:44,690 - INFO - Preparing training data for regime classification...
2025-04-17 21:18:44,691 - INFO - Loading existing macro data...
2025-04-17 21:18:44,702 - WARNING - US corporate credit spread file not found
2025-04-17 21:18:44,702 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:18:44,706 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:18:44,706 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:18:44,707 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:18:44,708 - INFO - Loading existing market data...
2025-04-17 21:18:44,712 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:18:44,715 - INFO - Prepared training data with 1508 samples
2025-04-17 21:18:44,715 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:18:44,716 - INFO - Training data prepared
2025-04-17 21:18:44,716 - INFO - Storing data...
2025-04-17 21:18:44,716 - INFO - Aligning data indices...
2025-04-17 21:18:44,718 - INFO - Data indices aligned
2025-04-17 21:18:44,718 - INFO - Data preparation completed
2025-04-17 21:18:44,718 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:18:44,719 - INFO - Training models...
2025-04-17 21:18:44,719 - INFO - Starting model training...
2025-04-17 21:18:44,719 - INFO - Training regime classifier...
2025-04-17 21:18:44,720 - INFO - Preparing features...
2025-04-17 21:18:44,720 - INFO - Input shape: (1508, 6)
2025-04-17 21:18:44,721 - INFO - Handling missing values...
2025-04-17 21:18:44,722 - INFO - Missing values: 4389 -> 0
2025-04-17 21:18:44,722 - INFO - Scaling features...
2025-04-17 21:18:44,724 - INFO - Fitted new scaler
2025-04-17 21:18:44,725 - INFO - Output shape: (1508, 6)
2025-04-17 21:18:46,307 - INFO - Model training completed
2025-04-17 21:18:46,310 - INFO - Model training completed
2025-04-17 21:18:46,310 - INFO - Initializing portfolio weights...
2025-04-17 21:18:46,311 - INFO - Portfolio weights initialized
2025-04-17 21:18:46,311 - INFO - Generating regime predictions for test period...
2025-04-17 21:18:46,313 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:18:46,315 - INFO - Generated 41 regime predictions
2025-04-17 21:18:46,315 - INFO - Calculating regime-specific returns...
2025-04-17 21:18:46,320 - INFO - Found 2 unique regimes
2025-04-17 21:18:46,320 - INFO - Processing regime 0...
2025-04-17 21:18:46,321 - INFO - Regime 0: 27 samples
2025-04-17 21:18:46,321 - INFO - Processing regime 1...
2025-04-17 21:18:46,323 - INFO - Regime 1: 18 samples
2025-04-17 21:18:46,323 - INFO - Training portfolio optimizer...
2025-04-17 21:18:46,323 - INFO - Training mean-variance optimizer...
2025-04-17 21:18:46,323 - INFO - Mean-variance optimizer training completed
2025-04-17 21:18:46,323 - INFO - Portfolio optimizer training completed
2025-04-17 21:18:46,324 - INFO - Optimizing portfolio weights...
2025-04-17 21:18:46,330 - WARNING - All weights are zero, using equal weights
2025-04-17 21:18:46,364 - INFO - Portfolio optimization completed
2025-04-17 21:18:46,364 - INFO - Initializing backtester...
2025-04-17 21:18:46,374 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:18:46,375 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:18:46,375 - INFO - Running backtest...
2025-04-17 21:18:46,378 - INFO - Backtest completed
2025-04-17 21:18:46,379 - INFO - Strategy execution completed
2025-04-17 21:18:46,380 - ERROR - Error running xgboost with mean_variance: Missing required metric: annualized_volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 61, in run_parameter_grid
    raise ValueError(f"Missing required metric: {metric}")
ValueError: Missing required metric: annualized_volatility
2025-04-17 21:18:46,380 - INFO - 
Running strategy with xgboost classifier and regime_aware optimizer
2025-04-17 21:18:46,381 - INFO - Initializing strategy...
2025-04-17 21:18:46,381 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 21:18:46,381 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:18:46,382 - INFO - Running strategy...
2025-04-17 21:18:46,382 - INFO - Starting strategy execution...
2025-04-17 21:18:46,382 - INFO - Preparing training and testing data...
2025-04-17 21:18:46,382 - INFO - Starting data preparation...
2025-04-17 21:18:46,382 - INFO - Loading Fama-French factors...
2025-04-17 21:18:46,398 - INFO - Fama-French factors loaded
2025-04-17 21:18:46,398 - INFO - Processing factor data...
2025-04-17 21:18:46,402 - INFO - Factor data processed
2025-04-17 21:18:46,402 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:18:46,402 - INFO - 
Training Period:
2025-04-17 21:18:46,409 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:18:46,421 - INFO - 
Testing Period:
2025-04-17 21:18:46,427 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:18:46,435 - INFO - Loading macro and market data...
2025-04-17 21:18:46,436 - INFO - Loading existing macro data...
2025-04-17 21:18:46,439 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:18:46,441 - INFO - Loading existing macro data...
2025-04-17 21:18:46,449 - WARNING - US corporate credit spread file not found
2025-04-17 21:18:46,449 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:18:46,453 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:18:46,453 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:18:46,453 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:18:46,454 - INFO - Loading existing market data...
2025-04-17 21:18:46,458 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:18:46,459 - INFO - Loading existing market data...
2025-04-17 21:18:46,462 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:18:46,462 - INFO - Macro and market data loaded
2025-04-17 21:18:46,463 - INFO - Preparing training data for regime classification...
2025-04-17 21:18:46,464 - INFO - Loading existing macro data...
2025-04-17 21:18:46,474 - WARNING - US corporate credit spread file not found
2025-04-17 21:18:46,474 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:18:46,477 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:18:46,477 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:18:46,478 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:18:46,479 - INFO - Loading existing market data...
2025-04-17 21:18:46,484 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:18:46,486 - INFO - Prepared training data with 1508 samples
2025-04-17 21:18:46,487 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:18:46,488 - INFO - Training data prepared
2025-04-17 21:18:46,488 - INFO - Storing data...
2025-04-17 21:18:46,488 - INFO - Aligning data indices...
2025-04-17 21:18:46,490 - INFO - Data indices aligned
2025-04-17 21:18:46,490 - INFO - Data preparation completed
2025-04-17 21:18:46,490 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:18:46,491 - INFO - Training models...
2025-04-17 21:18:46,491 - INFO - Starting model training...
2025-04-17 21:18:46,491 - INFO - Training regime classifier...
2025-04-17 21:18:46,491 - INFO - Preparing features...
2025-04-17 21:18:46,492 - INFO - Input shape: (1508, 6)
2025-04-17 21:18:46,492 - INFO - Handling missing values...
2025-04-17 21:18:46,493 - INFO - Missing values: 4389 -> 0
2025-04-17 21:18:46,493 - INFO - Scaling features...
2025-04-17 21:18:46,495 - INFO - Fitted new scaler
2025-04-17 21:18:46,496 - INFO - Output shape: (1508, 6)
2025-04-17 21:18:46,778 - INFO - Model training completed
2025-04-17 21:18:46,781 - INFO - Model training completed
2025-04-17 21:18:46,782 - INFO - Initializing portfolio weights...
2025-04-17 21:18:46,783 - INFO - Portfolio weights initialized
2025-04-17 21:18:46,783 - INFO - Generating regime predictions for test period...
2025-04-17 21:18:46,785 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:18:46,788 - INFO - Generated 41 regime predictions
2025-04-17 21:18:46,788 - INFO - Calculating regime-specific returns...
2025-04-17 21:18:46,793 - INFO - Found 2 unique regimes
2025-04-17 21:18:46,793 - INFO - Processing regime 0...
2025-04-17 21:18:46,794 - INFO - Regime 0: 27 samples
2025-04-17 21:18:46,795 - INFO - Processing regime 1...
2025-04-17 21:18:46,796 - INFO - Regime 1: 18 samples
2025-04-17 21:18:46,796 - INFO - Training portfolio optimizer...
2025-04-17 21:18:46,796 - INFO - Training regime-aware optimizer...
2025-04-17 21:18:46,797 - INFO - Training mean-variance optimizer...
2025-04-17 21:18:46,797 - INFO - Mean-variance optimizer training completed
2025-04-17 21:18:46,797 - INFO - Trained optimizer for regime 0 with 27 samples
2025-04-17 21:18:46,798 - INFO - Training mean-variance optimizer...
2025-04-17 21:18:46,798 - INFO - Mean-variance optimizer training completed
2025-04-17 21:18:46,798 - INFO - Trained optimizer for regime 1 with 18 samples
2025-04-17 21:18:46,798 - WARNING - No samples found for regime 2
2025-04-17 21:18:46,799 - WARNING - No samples found for regime 3
2025-04-17 21:18:46,799 - WARNING - No samples found for regime 4
2025-04-17 21:18:46,799 - INFO - Portfolio optimizer training completed
2025-04-17 21:18:46,799 - INFO - Optimizing portfolio weights...
2025-04-17 21:18:46,800 - INFO - Optimizing weights for regime 1
2025-04-17 21:18:46,802 - WARNING - All weights are zero, using equal weights
2025-04-17 21:18:46,802 - INFO - Optimizing weights for regime 1
2025-04-17 21:18:46,804 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,805 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,806 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,808 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,809 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,810 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,811 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,812 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,813 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,815 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,816 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,817 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,818 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,819 - INFO - Optimizing weights for regime 1
2025-04-17 21:18:46,820 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,822 - INFO - Optimizing weights for regime 1
2025-04-17 21:18:46,823 - INFO - Optimizing weights for regime 1
2025-04-17 21:18:46,824 - INFO - Optimizing weights for regime 1
2025-04-17 21:18:46,825 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,826 - INFO - Optimizing weights for regime 1
2025-04-17 21:18:46,828 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,829 - INFO - Optimizing weights for regime 1
2025-04-17 21:18:46,830 - INFO - Optimizing weights for regime 1
2025-04-17 21:18:46,831 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,832 - INFO - Optimizing weights for regime 1
2025-04-17 21:18:46,833 - INFO - Optimizing weights for regime 1
2025-04-17 21:18:46,835 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,836 - INFO - Optimizing weights for regime 1
2025-04-17 21:18:46,837 - INFO - Optimizing weights for regime 1
2025-04-17 21:18:46,839 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,840 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,841 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,842 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,843 - INFO - Optimizing weights for regime 1
2025-04-17 21:18:46,845 - INFO - Optimizing weights for regime 1
2025-04-17 21:18:46,846 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:46,847 - INFO - Optimizing weights for regime 1
2025-04-17 21:18:46,848 - INFO - Optimizing weights for regime 1
2025-04-17 21:18:46,850 - INFO - Optimizing weights for regime 1
2025-04-17 21:18:46,851 - INFO - Portfolio optimization completed
2025-04-17 21:18:46,851 - INFO - Initializing backtester...
2025-04-17 21:18:46,861 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:18:46,862 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:18:46,862 - INFO - Running backtest...
2025-04-17 21:18:46,866 - INFO - Backtest completed
2025-04-17 21:18:46,867 - INFO - Strategy execution completed
2025-04-17 21:18:46,867 - ERROR - Error running xgboost with regime_aware: Missing required metric: annualized_volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 61, in run_parameter_grid
    raise ValueError(f"Missing required metric: {metric}")
ValueError: Missing required metric: annualized_volatility
2025-04-17 21:18:46,868 - INFO - 
Running strategy with xgboost classifier and neural optimizer
2025-04-17 21:18:46,868 - INFO - Initializing strategy...
2025-04-17 21:18:46,868 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 21:18:46,869 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:18:46,870 - INFO - Running strategy...
2025-04-17 21:18:46,870 - INFO - Starting strategy execution...
2025-04-17 21:18:46,871 - INFO - Preparing training and testing data...
2025-04-17 21:18:46,871 - INFO - Starting data preparation...
2025-04-17 21:18:46,871 - INFO - Loading Fama-French factors...
2025-04-17 21:18:46,889 - INFO - Fama-French factors loaded
2025-04-17 21:18:46,890 - INFO - Processing factor data...
2025-04-17 21:18:46,894 - INFO - Factor data processed
2025-04-17 21:18:46,895 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:18:46,895 - INFO - 
Training Period:
2025-04-17 21:18:46,901 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:18:46,911 - INFO - 
Testing Period:
2025-04-17 21:18:46,916 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:18:46,924 - INFO - Loading macro and market data...
2025-04-17 21:18:46,925 - INFO - Loading existing macro data...
2025-04-17 21:18:46,929 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:18:46,931 - INFO - Loading existing macro data...
2025-04-17 21:18:46,947 - WARNING - US corporate credit spread file not found
2025-04-17 21:18:46,948 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:18:46,952 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:18:46,953 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:18:46,953 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:18:46,955 - INFO - Loading existing market data...
2025-04-17 21:18:46,961 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:18:46,962 - INFO - Loading existing market data...
2025-04-17 21:18:46,967 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:18:46,967 - INFO - Macro and market data loaded
2025-04-17 21:18:46,967 - INFO - Preparing training data for regime classification...
2025-04-17 21:18:46,968 - INFO - Loading existing macro data...
2025-04-17 21:18:46,981 - WARNING - US corporate credit spread file not found
2025-04-17 21:18:46,981 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:18:46,984 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:18:46,985 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:18:46,985 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:18:46,986 - INFO - Loading existing market data...
2025-04-17 21:18:46,990 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:18:46,993 - INFO - Prepared training data with 1508 samples
2025-04-17 21:18:46,994 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:18:46,994 - INFO - Training data prepared
2025-04-17 21:18:46,994 - INFO - Storing data...
2025-04-17 21:18:46,994 - INFO - Aligning data indices...
2025-04-17 21:18:46,996 - INFO - Data indices aligned
2025-04-17 21:18:46,996 - INFO - Data preparation completed
2025-04-17 21:18:46,996 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:18:46,996 - INFO - Training models...
2025-04-17 21:18:46,996 - INFO - Starting model training...
2025-04-17 21:18:46,997 - INFO - Training regime classifier...
2025-04-17 21:18:46,997 - INFO - Preparing features...
2025-04-17 21:18:46,997 - INFO - Input shape: (1508, 6)
2025-04-17 21:18:46,997 - INFO - Handling missing values...
2025-04-17 21:18:46,999 - INFO - Missing values: 4389 -> 0
2025-04-17 21:18:46,999 - INFO - Scaling features...
2025-04-17 21:18:47,000 - INFO - Fitted new scaler
2025-04-17 21:18:47,001 - INFO - Output shape: (1508, 6)
2025-04-17 21:18:47,274 - INFO - Training neural portfolio optimizer...
2025-04-17 21:18:47,274 - INFO - Neural portfolio optimizer training completed
2025-04-17 21:18:47,275 - INFO - Model training completed
2025-04-17 21:18:47,276 - INFO - Model training completed
2025-04-17 21:18:47,276 - INFO - Initializing portfolio weights...
2025-04-17 21:18:47,277 - INFO - Portfolio weights initialized
2025-04-17 21:18:47,277 - INFO - Generating regime predictions for test period...
2025-04-17 21:18:47,279 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:18:47,282 - INFO - Generated 41 regime predictions
2025-04-17 21:18:47,282 - INFO - Calculating regime-specific returns...
2025-04-17 21:18:47,287 - INFO - Found 2 unique regimes
2025-04-17 21:18:47,287 - INFO - Processing regime 0...
2025-04-17 21:18:47,288 - INFO - Regime 0: 27 samples
2025-04-17 21:18:47,289 - INFO - Processing regime 1...
2025-04-17 21:18:47,290 - INFO - Regime 1: 18 samples
2025-04-17 21:18:47,290 - INFO - Training portfolio optimizer...
2025-04-17 21:18:47,292 - ERROR - Error running xgboost with neural: mat1 and mat2 shapes cannot be multiplied (45x5 and 6x64)
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 291, in run_strategy
    self.portfolio_optimizer.train(train_factors, target_weights)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 116, in train
    predictions = self.model(features_tensor)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 129, in forward
    x = torch.relu(self.fc1(x))
                   ~~~~~~~~^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\linear.py", line 125, in forward
    return F.linear(input, self.weight, self.bias)
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: mat1 and mat2 shapes cannot be multiplied (45x5 and 6x64)
2025-04-17 21:18:47,296 - INFO - 
Running strategy with hmm classifier and mean_variance optimizer
2025-04-17 21:18:47,297 - INFO - Initializing strategy...
2025-04-17 21:18:47,297 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 21:18:47,297 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:18:47,297 - INFO - Running strategy...
2025-04-17 21:18:47,298 - INFO - Starting strategy execution...
2025-04-17 21:18:47,298 - INFO - Preparing training and testing data...
2025-04-17 21:18:47,298 - INFO - Starting data preparation...
2025-04-17 21:18:47,298 - INFO - Loading Fama-French factors...
2025-04-17 21:18:47,315 - INFO - Fama-French factors loaded
2025-04-17 21:18:47,316 - INFO - Processing factor data...
2025-04-17 21:18:47,320 - INFO - Factor data processed
2025-04-17 21:18:47,321 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:18:47,321 - INFO - 
Training Period:
2025-04-17 21:18:47,328 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:18:47,341 - INFO - 
Testing Period:
2025-04-17 21:18:47,348 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:18:47,359 - INFO - Loading macro and market data...
2025-04-17 21:18:47,361 - INFO - Loading existing macro data...
2025-04-17 21:18:47,365 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:18:47,367 - INFO - Loading existing macro data...
2025-04-17 21:18:47,383 - WARNING - US corporate credit spread file not found
2025-04-17 21:18:47,384 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:18:47,389 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:18:47,389 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:18:47,389 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:18:47,392 - INFO - Loading existing market data...
2025-04-17 21:18:47,397 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:18:47,398 - INFO - Loading existing market data...
2025-04-17 21:18:47,402 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:18:47,403 - INFO - Macro and market data loaded
2025-04-17 21:18:47,403 - INFO - Preparing training data for regime classification...
2025-04-17 21:18:47,404 - INFO - Loading existing macro data...
2025-04-17 21:18:47,415 - WARNING - US corporate credit spread file not found
2025-04-17 21:18:47,415 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:18:47,419 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:18:47,419 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:18:47,419 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:18:47,421 - INFO - Loading existing market data...
2025-04-17 21:18:47,425 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:18:47,429 - INFO - Prepared training data with 1508 samples
2025-04-17 21:18:47,430 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:18:47,430 - INFO - Training data prepared
2025-04-17 21:18:47,431 - INFO - Storing data...
2025-04-17 21:18:47,431 - INFO - Aligning data indices...
2025-04-17 21:18:47,432 - INFO - Data indices aligned
2025-04-17 21:18:47,432 - INFO - Data preparation completed
2025-04-17 21:18:47,433 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:18:47,433 - INFO - Training models...
2025-04-17 21:18:47,433 - INFO - Starting model training...
2025-04-17 21:18:47,434 - INFO - Training regime classifier...
2025-04-17 21:18:47,434 - INFO - Training HMM model...
2025-04-17 21:18:47,687 - INFO - HMM model training completed
2025-04-17 21:18:47,868 - INFO - Model training completed
2025-04-17 21:18:47,870 - INFO - Model training completed
2025-04-17 21:18:47,870 - INFO - Initializing portfolio weights...
2025-04-17 21:18:47,871 - INFO - Portfolio weights initialized
2025-04-17 21:18:47,871 - INFO - Generating regime predictions for test period...
2025-04-17 21:18:47,873 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:18:47,875 - INFO - Generated 41 regime predictions
2025-04-17 21:18:47,875 - INFO - Calculating regime-specific returns...
2025-04-17 21:18:47,878 - INFO - Found 2 unique regimes
2025-04-17 21:18:47,878 - INFO - Processing regime 0...
2025-04-17 21:18:47,879 - INFO - Regime 0: 30 samples
2025-04-17 21:18:47,880 - INFO - Processing regime 1...
2025-04-17 21:18:47,880 - INFO - Regime 1: 15 samples
2025-04-17 21:18:47,881 - INFO - Training portfolio optimizer...
2025-04-17 21:18:47,881 - INFO - Training mean-variance optimizer...
2025-04-17 21:18:47,881 - INFO - Mean-variance optimizer training completed
2025-04-17 21:18:47,881 - INFO - Portfolio optimizer training completed
2025-04-17 21:18:47,882 - INFO - Optimizing portfolio weights...
2025-04-17 21:18:47,883 - WARNING - All weights are zero, using equal weights
2025-04-17 21:18:47,914 - INFO - Portfolio optimization completed
2025-04-17 21:18:47,914 - INFO - Initializing backtester...
2025-04-17 21:18:47,922 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:18:47,923 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:18:47,924 - INFO - Running backtest...
2025-04-17 21:18:47,927 - INFO - Backtest completed
2025-04-17 21:18:47,928 - INFO - Strategy execution completed
2025-04-17 21:18:47,929 - ERROR - Error running hmm with mean_variance: Missing required metric: annualized_volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 61, in run_parameter_grid
    raise ValueError(f"Missing required metric: {metric}")
ValueError: Missing required metric: annualized_volatility
2025-04-17 21:18:47,930 - INFO - 
Running strategy with hmm classifier and regime_aware optimizer
2025-04-17 21:18:47,930 - INFO - Initializing strategy...
2025-04-17 21:18:47,930 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 21:18:47,931 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:18:47,931 - INFO - Running strategy...
2025-04-17 21:18:47,931 - INFO - Starting strategy execution...
2025-04-17 21:18:47,932 - INFO - Preparing training and testing data...
2025-04-17 21:18:47,932 - INFO - Starting data preparation...
2025-04-17 21:18:47,932 - INFO - Loading Fama-French factors...
2025-04-17 21:18:47,944 - INFO - Fama-French factors loaded
2025-04-17 21:18:47,944 - INFO - Processing factor data...
2025-04-17 21:18:47,947 - INFO - Factor data processed
2025-04-17 21:18:47,947 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:18:47,947 - INFO - 
Training Period:
2025-04-17 21:18:47,952 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:18:47,960 - INFO - 
Testing Period:
2025-04-17 21:18:47,965 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:18:47,973 - INFO - Loading macro and market data...
2025-04-17 21:18:47,974 - INFO - Loading existing macro data...
2025-04-17 21:18:47,978 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:18:47,979 - INFO - Loading existing macro data...
2025-04-17 21:18:47,988 - WARNING - US corporate credit spread file not found
2025-04-17 21:18:47,988 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:18:47,993 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:18:47,994 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:18:47,994 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:18:47,995 - INFO - Loading existing market data...
2025-04-17 21:18:48,000 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:18:48,001 - INFO - Loading existing market data...
2025-04-17 21:18:48,005 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:18:48,005 - INFO - Macro and market data loaded
2025-04-17 21:18:48,005 - INFO - Preparing training data for regime classification...
2025-04-17 21:18:48,006 - INFO - Loading existing macro data...
2025-04-17 21:18:48,016 - WARNING - US corporate credit spread file not found
2025-04-17 21:18:48,016 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:18:48,020 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:18:48,020 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:18:48,020 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:18:48,021 - INFO - Loading existing market data...
2025-04-17 21:18:48,025 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:18:48,027 - INFO - Prepared training data with 1508 samples
2025-04-17 21:18:48,028 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:18:48,028 - INFO - Training data prepared
2025-04-17 21:18:48,028 - INFO - Storing data...
2025-04-17 21:18:48,029 - INFO - Aligning data indices...
2025-04-17 21:18:48,029 - INFO - Data indices aligned
2025-04-17 21:18:48,030 - INFO - Data preparation completed
2025-04-17 21:18:48,030 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:18:48,030 - INFO - Training models...
2025-04-17 21:18:48,030 - INFO - Starting model training...
2025-04-17 21:18:48,030 - INFO - Training regime classifier...
2025-04-17 21:18:48,031 - INFO - Training HMM model...
2025-04-17 21:18:48,109 - INFO - HMM model training completed
2025-04-17 21:18:48,323 - INFO - Model training completed
2025-04-17 21:18:48,326 - INFO - Model training completed
2025-04-17 21:18:48,326 - INFO - Initializing portfolio weights...
2025-04-17 21:18:48,327 - INFO - Portfolio weights initialized
2025-04-17 21:18:48,327 - INFO - Generating regime predictions for test period...
2025-04-17 21:18:48,329 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:18:48,331 - INFO - Generated 41 regime predictions
2025-04-17 21:18:48,332 - INFO - Calculating regime-specific returns...
2025-04-17 21:18:48,335 - INFO - Found 2 unique regimes
2025-04-17 21:18:48,335 - INFO - Processing regime 0...
2025-04-17 21:18:48,337 - INFO - Regime 0: 30 samples
2025-04-17 21:18:48,337 - INFO - Processing regime 1...
2025-04-17 21:18:48,338 - INFO - Regime 1: 15 samples
2025-04-17 21:18:48,338 - INFO - Training portfolio optimizer...
2025-04-17 21:18:48,339 - INFO - Training regime-aware optimizer...
2025-04-17 21:18:48,339 - INFO - Training mean-variance optimizer...
2025-04-17 21:18:48,339 - INFO - Mean-variance optimizer training completed
2025-04-17 21:18:48,339 - INFO - Trained optimizer for regime 0 with 30 samples
2025-04-17 21:18:48,340 - INFO - Training mean-variance optimizer...
2025-04-17 21:18:48,340 - INFO - Mean-variance optimizer training completed
2025-04-17 21:18:48,340 - INFO - Trained optimizer for regime 1 with 15 samples
2025-04-17 21:18:48,340 - WARNING - No samples found for regime 2
2025-04-17 21:18:48,341 - WARNING - No samples found for regime 3
2025-04-17 21:18:48,341 - WARNING - No samples found for regime 4
2025-04-17 21:18:48,341 - INFO - Portfolio optimizer training completed
2025-04-17 21:18:48,341 - INFO - Optimizing portfolio weights...
2025-04-17 21:18:48,342 - INFO - Optimizing weights for regime 1
2025-04-17 21:18:48,343 - WARNING - All weights are zero, using equal weights
2025-04-17 21:18:48,344 - INFO - Optimizing weights for regime 1
2025-04-17 21:18:48,345 - INFO - Optimizing weights for regime 1
2025-04-17 21:18:48,346 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,346 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,347 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,348 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,349 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,350 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,350 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,351 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,352 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,353 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,354 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,355 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,356 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,357 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,357 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,358 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,359 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,360 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,361 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,362 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,364 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,364 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,365 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,366 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,367 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,368 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,369 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,370 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,371 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,371 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,372 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,373 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,374 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,375 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,376 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,377 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,378 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,379 - INFO - Optimizing weights for regime 0
2025-04-17 21:18:48,380 - INFO - Portfolio optimization completed
2025-04-17 21:18:48,380 - INFO - Initializing backtester...
2025-04-17 21:18:48,387 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:18:48,387 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:18:48,387 - INFO - Running backtest...
2025-04-17 21:18:48,389 - INFO - Backtest completed
2025-04-17 21:18:48,391 - INFO - Strategy execution completed
2025-04-17 21:18:48,391 - ERROR - Error running hmm with regime_aware: Missing required metric: annualized_volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 61, in run_parameter_grid
    raise ValueError(f"Missing required metric: {metric}")
ValueError: Missing required metric: annualized_volatility
2025-04-17 21:18:48,392 - INFO - 
Running strategy with hmm classifier and neural optimizer
2025-04-17 21:18:48,393 - INFO - Initializing strategy...
2025-04-17 21:18:48,393 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 21:18:48,393 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:18:48,394 - INFO - Running strategy...
2025-04-17 21:18:48,395 - INFO - Starting strategy execution...
2025-04-17 21:18:48,395 - INFO - Preparing training and testing data...
2025-04-17 21:18:48,395 - INFO - Starting data preparation...
2025-04-17 21:18:48,396 - INFO - Loading Fama-French factors...
2025-04-17 21:18:48,405 - INFO - Fama-French factors loaded
2025-04-17 21:18:48,405 - INFO - Processing factor data...
2025-04-17 21:18:48,408 - INFO - Factor data processed
2025-04-17 21:18:48,408 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:18:48,409 - INFO - 
Training Period:
2025-04-17 21:18:48,413 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:18:48,421 - INFO - 
Testing Period:
2025-04-17 21:18:48,425 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:18:48,433 - INFO - Loading macro and market data...
2025-04-17 21:18:48,435 - INFO - Loading existing macro data...
2025-04-17 21:18:48,438 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:18:48,439 - INFO - Loading existing macro data...
2025-04-17 21:18:48,451 - WARNING - US corporate credit spread file not found
2025-04-17 21:18:48,452 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:18:48,456 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:18:48,456 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:18:48,457 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:18:48,458 - INFO - Loading existing market data...
2025-04-17 21:18:48,462 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:18:48,463 - INFO - Loading existing market data...
2025-04-17 21:18:48,466 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:18:48,466 - INFO - Macro and market data loaded
2025-04-17 21:18:48,467 - INFO - Preparing training data for regime classification...
2025-04-17 21:18:48,468 - INFO - Loading existing macro data...
2025-04-17 21:18:48,479 - WARNING - US corporate credit spread file not found
2025-04-17 21:18:48,479 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:18:48,482 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:18:48,483 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:18:48,483 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:18:48,484 - INFO - Loading existing market data...
2025-04-17 21:18:48,489 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:18:48,492 - INFO - Prepared training data with 1508 samples
2025-04-17 21:18:48,492 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:18:48,493 - INFO - Training data prepared
2025-04-17 21:18:48,493 - INFO - Storing data...
2025-04-17 21:18:48,493 - INFO - Aligning data indices...
2025-04-17 21:18:48,494 - INFO - Data indices aligned
2025-04-17 21:18:48,495 - INFO - Data preparation completed
2025-04-17 21:18:48,495 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:18:48,495 - INFO - Training models...
2025-04-17 21:18:48,495 - INFO - Starting model training...
2025-04-17 21:18:48,496 - INFO - Training regime classifier...
2025-04-17 21:18:48,496 - INFO - Training HMM model...
2025-04-17 21:18:48,581 - INFO - HMM model training completed
2025-04-17 21:18:48,777 - INFO - Training neural portfolio optimizer...
2025-04-17 21:18:48,778 - INFO - Neural portfolio optimizer training completed
2025-04-17 21:18:48,778 - INFO - Model training completed
2025-04-17 21:18:48,779 - INFO - Model training completed
2025-04-17 21:18:48,780 - INFO - Initializing portfolio weights...
2025-04-17 21:18:48,780 - INFO - Portfolio weights initialized
2025-04-17 21:18:48,780 - INFO - Generating regime predictions for test period...
2025-04-17 21:18:48,782 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:18:48,784 - INFO - Generated 41 regime predictions
2025-04-17 21:18:48,784 - INFO - Calculating regime-specific returns...
2025-04-17 21:18:48,788 - INFO - Found 2 unique regimes
2025-04-17 21:18:48,789 - INFO - Processing regime 0...
2025-04-17 21:18:48,790 - INFO - Regime 0: 30 samples
2025-04-17 21:18:48,790 - INFO - Processing regime 1...
2025-04-17 21:18:48,791 - INFO - Regime 1: 15 samples
2025-04-17 21:18:48,791 - INFO - Training portfolio optimizer...
2025-04-17 21:18:48,792 - ERROR - Error running hmm with neural: mat1 and mat2 shapes cannot be multiplied (45x5 and 6x64)
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 291, in run_strategy
    self.portfolio_optimizer.train(train_factors, target_weights)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 116, in train
    predictions = self.model(features_tensor)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 129, in forward
    x = torch.relu(self.fc1(x))
                   ~~~~~~~~^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\linear.py", line 125, in forward
    return F.linear(input, self.weight, self.bias)
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: mat1 and mat2 shapes cannot be multiplied (45x5 and 6x64)
2025-04-17 21:18:48,793 - ERROR - No valid results obtained from parameter grid search
2025-04-17 21:18:48,794 - ERROR - No valid results obtained from parameter grid search
2025-04-17 21:18:48,794 - INFO - Factor timing strategy optimization completed
2025-04-17 21:19:37,584 - INFO - Starting factor timing strategy optimization...
2025-04-17 21:19:37,585 - INFO - Running parameter grid search...
2025-04-17 21:19:37,585 - INFO - 
Running strategy with lstm classifier and mean_variance optimizer
2025-04-17 21:19:37,585 - INFO - Initializing strategy...
2025-04-17 21:19:37,585 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 21:19:37,587 - INFO - Running strategy...
2025-04-17 21:19:37,587 - INFO - Starting strategy execution...
2025-04-17 21:19:37,587 - INFO - Preparing training and testing data...
2025-04-17 21:19:37,587 - INFO - Starting data preparation...
2025-04-17 21:19:37,587 - INFO - Loading Fama-French factors...
2025-04-17 21:19:37,600 - INFO - Fama-French factors loaded
2025-04-17 21:19:37,600 - INFO - Processing factor data...
2025-04-17 21:19:37,603 - INFO - Factor data processed
2025-04-17 21:19:37,603 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:19:37,604 - INFO - 
Training Period:
2025-04-17 21:19:37,609 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:19:37,618 - INFO - 
Testing Period:
2025-04-17 21:19:37,622 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:19:37,633 - INFO - Loading macro and market data...
2025-04-17 21:19:37,634 - INFO - Loading existing macro data...
2025-04-17 21:19:37,637 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:19:37,639 - INFO - Loading existing macro data...
2025-04-17 21:19:37,648 - WARNING - US corporate credit spread file not found
2025-04-17 21:19:37,649 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:19:37,654 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:19:37,654 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:19:37,655 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:19:37,656 - INFO - Loading existing market data...
2025-04-17 21:19:37,661 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:19:37,662 - INFO - Loading existing market data...
2025-04-17 21:19:37,668 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:19:37,668 - INFO - Macro and market data loaded
2025-04-17 21:19:37,668 - INFO - Preparing training data for regime classification...
2025-04-17 21:19:37,670 - INFO - Loading existing macro data...
2025-04-17 21:19:37,679 - WARNING - US corporate credit spread file not found
2025-04-17 21:19:37,679 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:19:37,682 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:19:37,683 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:19:37,683 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:19:37,684 - INFO - Loading existing market data...
2025-04-17 21:19:37,689 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:19:37,692 - INFO - Prepared training data with 1508 samples
2025-04-17 21:19:37,693 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:19:37,693 - INFO - Training data prepared
2025-04-17 21:19:37,694 - INFO - Storing data...
2025-04-17 21:19:37,694 - INFO - Aligning data indices...
2025-04-17 21:19:37,695 - INFO - Data indices aligned
2025-04-17 21:19:37,695 - INFO - Data preparation completed
2025-04-17 21:19:37,696 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:19:37,696 - INFO - Training models...
2025-04-17 21:19:37,696 - INFO - Starting model training...
2025-04-17 21:19:37,696 - INFO - Training regime classifier...
2025-04-17 21:19:37,697 - ERROR - Error running lstm with mean_variance: Module.train() takes from 1 to 2 positional arguments but 3 were given
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 228, in run_strategy
    training_metrics = self.train_models()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 170, in train_models
    self.regime_classifier.train(train_X, train_y)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
TypeError: Module.train() takes from 1 to 2 positional arguments but 3 were given
2025-04-17 21:19:37,698 - INFO - 
Running strategy with lstm classifier and regime_aware optimizer
2025-04-17 21:19:37,698 - INFO - Initializing strategy...
2025-04-17 21:19:37,698 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 21:19:37,700 - INFO - Running strategy...
2025-04-17 21:19:37,700 - INFO - Starting strategy execution...
2025-04-17 21:19:37,700 - INFO - Preparing training and testing data...
2025-04-17 21:19:37,700 - INFO - Starting data preparation...
2025-04-17 21:19:37,701 - INFO - Loading Fama-French factors...
2025-04-17 21:19:37,711 - INFO - Fama-French factors loaded
2025-04-17 21:19:37,711 - INFO - Processing factor data...
2025-04-17 21:19:37,714 - INFO - Factor data processed
2025-04-17 21:19:37,714 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:19:37,714 - INFO - 
Training Period:
2025-04-17 21:19:37,720 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:19:37,728 - INFO - 
Testing Period:
2025-04-17 21:19:37,733 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:19:37,741 - INFO - Loading macro and market data...
2025-04-17 21:19:37,742 - INFO - Loading existing macro data...
2025-04-17 21:19:37,745 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:19:37,746 - INFO - Loading existing macro data...
2025-04-17 21:19:37,758 - WARNING - US corporate credit spread file not found
2025-04-17 21:19:37,758 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:19:37,761 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:19:37,762 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:19:37,762 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:19:37,763 - INFO - Loading existing market data...
2025-04-17 21:19:37,767 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:19:37,768 - INFO - Loading existing market data...
2025-04-17 21:19:37,772 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:19:37,772 - INFO - Macro and market data loaded
2025-04-17 21:19:37,773 - INFO - Preparing training data for regime classification...
2025-04-17 21:19:37,774 - INFO - Loading existing macro data...
2025-04-17 21:19:37,785 - WARNING - US corporate credit spread file not found
2025-04-17 21:19:37,786 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:19:37,788 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:19:37,789 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:19:37,789 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:19:37,790 - INFO - Loading existing market data...
2025-04-17 21:19:37,794 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:19:37,798 - INFO - Prepared training data with 1508 samples
2025-04-17 21:19:37,798 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:19:37,799 - INFO - Training data prepared
2025-04-17 21:19:37,799 - INFO - Storing data...
2025-04-17 21:19:37,799 - INFO - Aligning data indices...
2025-04-17 21:19:37,801 - INFO - Data indices aligned
2025-04-17 21:19:37,801 - INFO - Data preparation completed
2025-04-17 21:19:37,801 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:19:37,802 - INFO - Training models...
2025-04-17 21:19:37,802 - INFO - Starting model training...
2025-04-17 21:19:37,802 - INFO - Training regime classifier...
2025-04-17 21:19:37,803 - ERROR - Error running lstm with regime_aware: Module.train() takes from 1 to 2 positional arguments but 3 were given
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 228, in run_strategy
    training_metrics = self.train_models()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 170, in train_models
    self.regime_classifier.train(train_X, train_y)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
TypeError: Module.train() takes from 1 to 2 positional arguments but 3 were given
2025-04-17 21:19:37,804 - INFO - 
Running strategy with lstm classifier and neural optimizer
2025-04-17 21:19:37,804 - INFO - Initializing strategy...
2025-04-17 21:19:37,804 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 21:19:38,953 - INFO - Running strategy...
2025-04-17 21:19:38,953 - INFO - Starting strategy execution...
2025-04-17 21:19:38,953 - INFO - Preparing training and testing data...
2025-04-17 21:19:38,954 - INFO - Starting data preparation...
2025-04-17 21:19:38,954 - INFO - Loading Fama-French factors...
2025-04-17 21:19:38,965 - INFO - Fama-French factors loaded
2025-04-17 21:19:38,966 - INFO - Processing factor data...
2025-04-17 21:19:38,968 - INFO - Factor data processed
2025-04-17 21:19:38,968 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:19:38,969 - INFO - 
Training Period:
2025-04-17 21:19:38,975 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:19:38,982 - INFO - 
Testing Period:
2025-04-17 21:19:38,988 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:19:38,997 - INFO - Loading macro and market data...
2025-04-17 21:19:38,998 - INFO - Loading existing macro data...
2025-04-17 21:19:39,001 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:19:39,002 - INFO - Loading existing macro data...
2025-04-17 21:19:39,012 - WARNING - US corporate credit spread file not found
2025-04-17 21:19:39,013 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:19:39,016 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:19:39,016 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:19:39,016 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:19:39,017 - INFO - Loading existing market data...
2025-04-17 21:19:39,022 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:19:39,023 - INFO - Loading existing market data...
2025-04-17 21:19:39,027 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:19:39,027 - INFO - Macro and market data loaded
2025-04-17 21:19:39,027 - INFO - Preparing training data for regime classification...
2025-04-17 21:19:39,029 - INFO - Loading existing macro data...
2025-04-17 21:19:39,039 - WARNING - US corporate credit spread file not found
2025-04-17 21:19:39,040 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:19:39,043 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:19:39,043 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:19:39,044 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:19:39,045 - INFO - Loading existing market data...
2025-04-17 21:19:39,050 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:19:39,053 - INFO - Prepared training data with 1508 samples
2025-04-17 21:19:39,054 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:19:39,054 - INFO - Training data prepared
2025-04-17 21:19:39,054 - INFO - Storing data...
2025-04-17 21:19:39,055 - INFO - Aligning data indices...
2025-04-17 21:19:39,056 - INFO - Data indices aligned
2025-04-17 21:19:39,057 - INFO - Updated neural optimizer input size to 6
2025-04-17 21:19:39,057 - INFO - Data preparation completed
2025-04-17 21:19:39,058 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:19:39,058 - INFO - Training models...
2025-04-17 21:19:39,059 - INFO - Starting model training...
2025-04-17 21:19:39,059 - INFO - Training regime classifier...
2025-04-17 21:19:39,059 - ERROR - Error running lstm with neural: Module.train() takes from 1 to 2 positional arguments but 3 were given
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 228, in run_strategy
    training_metrics = self.train_models()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 170, in train_models
    self.regime_classifier.train(train_X, train_y)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
TypeError: Module.train() takes from 1 to 2 positional arguments but 3 were given
2025-04-17 21:19:39,060 - INFO - 
Running strategy with xgboost classifier and mean_variance optimizer
2025-04-17 21:19:39,061 - INFO - Initializing strategy...
2025-04-17 21:19:39,061 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 21:19:39,061 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:19:39,081 - INFO - Running strategy...
2025-04-17 21:19:39,082 - INFO - Starting strategy execution...
2025-04-17 21:19:39,082 - INFO - Preparing training and testing data...
2025-04-17 21:19:39,082 - INFO - Starting data preparation...
2025-04-17 21:19:39,082 - INFO - Loading Fama-French factors...
2025-04-17 21:19:39,094 - INFO - Fama-French factors loaded
2025-04-17 21:19:39,095 - INFO - Processing factor data...
2025-04-17 21:19:39,098 - INFO - Factor data processed
2025-04-17 21:19:39,098 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:19:39,099 - INFO - 
Training Period:
2025-04-17 21:19:39,105 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:19:39,114 - INFO - 
Testing Period:
2025-04-17 21:19:39,119 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:19:39,127 - INFO - Loading macro and market data...
2025-04-17 21:19:39,129 - INFO - Loading existing macro data...
2025-04-17 21:19:39,133 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:19:39,134 - INFO - Loading existing macro data...
2025-04-17 21:19:39,146 - WARNING - US corporate credit spread file not found
2025-04-17 21:19:39,146 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:19:39,150 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:19:39,150 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:19:39,150 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:19:39,152 - INFO - Loading existing market data...
2025-04-17 21:19:39,156 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:19:39,157 - INFO - Loading existing market data...
2025-04-17 21:19:39,161 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:19:39,161 - INFO - Macro and market data loaded
2025-04-17 21:19:39,162 - INFO - Preparing training data for regime classification...
2025-04-17 21:19:39,163 - INFO - Loading existing macro data...
2025-04-17 21:19:39,175 - WARNING - US corporate credit spread file not found
2025-04-17 21:19:39,176 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:19:39,179 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:19:39,179 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:19:39,179 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:19:39,181 - INFO - Loading existing market data...
2025-04-17 21:19:39,185 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:19:39,188 - INFO - Prepared training data with 1508 samples
2025-04-17 21:19:39,189 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:19:39,189 - INFO - Training data prepared
2025-04-17 21:19:39,189 - INFO - Storing data...
2025-04-17 21:19:39,190 - INFO - Aligning data indices...
2025-04-17 21:19:39,191 - INFO - Data indices aligned
2025-04-17 21:19:39,191 - INFO - Data preparation completed
2025-04-17 21:19:39,191 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:19:39,192 - INFO - Training models...
2025-04-17 21:19:39,192 - INFO - Starting model training...
2025-04-17 21:19:39,192 - INFO - Training regime classifier...
2025-04-17 21:19:39,192 - INFO - Preparing features...
2025-04-17 21:19:39,193 - INFO - Input shape: (1508, 6)
2025-04-17 21:19:39,193 - INFO - Handling missing values...
2025-04-17 21:19:39,195 - INFO - Missing values: 4389 -> 0
2025-04-17 21:19:39,196 - INFO - Scaling features...
2025-04-17 21:19:39,197 - INFO - Fitted new scaler
2025-04-17 21:19:39,198 - INFO - Output shape: (1508, 6)
2025-04-17 21:19:40,815 - INFO - Model training completed
2025-04-17 21:19:40,817 - INFO - Model training completed
2025-04-17 21:19:40,817 - INFO - Initializing portfolio weights...
2025-04-17 21:19:40,818 - INFO - Portfolio weights initialized
2025-04-17 21:19:40,818 - INFO - Generating regime predictions for test period...
2025-04-17 21:19:40,821 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:19:40,824 - INFO - Generated 41 regime predictions
2025-04-17 21:19:40,824 - INFO - Calculating regime-specific returns...
2025-04-17 21:19:40,828 - INFO - Found 2 unique regimes
2025-04-17 21:19:40,829 - INFO - Processing regime 0...
2025-04-17 21:19:40,830 - INFO - Regime 0: 27 samples
2025-04-17 21:19:40,830 - INFO - Processing regime 1...
2025-04-17 21:19:40,832 - INFO - Regime 1: 18 samples
2025-04-17 21:19:40,832 - INFO - Training portfolio optimizer...
2025-04-17 21:19:40,832 - INFO - Training mean-variance optimizer...
2025-04-17 21:19:40,832 - INFO - Mean-variance optimizer training completed
2025-04-17 21:19:40,832 - INFO - Portfolio optimizer training completed
2025-04-17 21:19:40,833 - INFO - Optimizing portfolio weights...
2025-04-17 21:19:40,839 - WARNING - All weights are zero, using equal weights
2025-04-17 21:19:40,875 - INFO - Portfolio optimization completed
2025-04-17 21:19:40,875 - INFO - Initializing backtester...
2025-04-17 21:19:40,885 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:19:40,886 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:19:40,886 - INFO - Running backtest...
2025-04-17 21:19:40,889 - INFO - Backtest completed
2025-04-17 21:19:40,890 - ERROR - Error running xgboost with mean_variance: 'annualized_vol'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 344, in run_strategy
    print(f"Annualized Volatility: {self.backtest_results['annualized_vol']:.2%}")
                                    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
KeyError: 'annualized_vol'
2025-04-17 21:19:40,891 - INFO - 
Running strategy with xgboost classifier and regime_aware optimizer
2025-04-17 21:19:40,891 - INFO - Initializing strategy...
2025-04-17 21:19:40,891 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 21:19:40,892 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:19:40,892 - INFO - Running strategy...
2025-04-17 21:19:40,892 - INFO - Starting strategy execution...
2025-04-17 21:19:40,893 - INFO - Preparing training and testing data...
2025-04-17 21:19:40,893 - INFO - Starting data preparation...
2025-04-17 21:19:40,893 - INFO - Loading Fama-French factors...
2025-04-17 21:19:40,911 - INFO - Fama-French factors loaded
2025-04-17 21:19:40,911 - INFO - Processing factor data...
2025-04-17 21:19:40,929 - INFO - Factor data processed
2025-04-17 21:19:40,930 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:19:40,931 - INFO - 
Training Period:
2025-04-17 21:19:40,942 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:19:40,961 - INFO - 
Testing Period:
2025-04-17 21:19:40,970 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:19:40,987 - INFO - Loading macro and market data...
2025-04-17 21:19:40,989 - INFO - Loading existing macro data...
2025-04-17 21:19:40,997 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:19:40,999 - INFO - Loading existing macro data...
2025-04-17 21:19:41,018 - WARNING - US corporate credit spread file not found
2025-04-17 21:19:41,019 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:19:41,025 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:19:41,025 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:19:41,026 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:19:41,027 - INFO - Loading existing market data...
2025-04-17 21:19:41,033 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:19:41,035 - INFO - Loading existing market data...
2025-04-17 21:19:41,039 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:19:41,039 - INFO - Macro and market data loaded
2025-04-17 21:19:41,039 - INFO - Preparing training data for regime classification...
2025-04-17 21:19:41,040 - INFO - Loading existing macro data...
2025-04-17 21:19:41,055 - WARNING - US corporate credit spread file not found
2025-04-17 21:19:41,056 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:19:41,059 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:19:41,059 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:19:41,060 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:19:41,061 - INFO - Loading existing market data...
2025-04-17 21:19:41,066 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:19:41,069 - INFO - Prepared training data with 1508 samples
2025-04-17 21:19:41,070 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:19:41,070 - INFO - Training data prepared
2025-04-17 21:19:41,070 - INFO - Storing data...
2025-04-17 21:19:41,070 - INFO - Aligning data indices...
2025-04-17 21:19:41,072 - INFO - Data indices aligned
2025-04-17 21:19:41,072 - INFO - Data preparation completed
2025-04-17 21:19:41,072 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:19:41,072 - INFO - Training models...
2025-04-17 21:19:41,072 - INFO - Starting model training...
2025-04-17 21:19:41,072 - INFO - Training regime classifier...
2025-04-17 21:19:41,073 - INFO - Preparing features...
2025-04-17 21:19:41,073 - INFO - Input shape: (1508, 6)
2025-04-17 21:19:41,073 - INFO - Handling missing values...
2025-04-17 21:19:41,074 - INFO - Missing values: 4389 -> 0
2025-04-17 21:19:41,074 - INFO - Scaling features...
2025-04-17 21:19:41,076 - INFO - Fitted new scaler
2025-04-17 21:19:41,077 - INFO - Output shape: (1508, 6)
2025-04-17 21:19:41,422 - INFO - Model training completed
2025-04-17 21:19:41,424 - INFO - Model training completed
2025-04-17 21:19:41,424 - INFO - Initializing portfolio weights...
2025-04-17 21:19:41,425 - INFO - Portfolio weights initialized
2025-04-17 21:19:41,425 - INFO - Generating regime predictions for test period...
2025-04-17 21:19:41,426 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:19:41,428 - INFO - Generated 41 regime predictions
2025-04-17 21:19:41,428 - INFO - Calculating regime-specific returns...
2025-04-17 21:19:41,432 - INFO - Found 2 unique regimes
2025-04-17 21:19:41,432 - INFO - Processing regime 0...
2025-04-17 21:19:41,434 - INFO - Regime 0: 27 samples
2025-04-17 21:19:41,434 - INFO - Processing regime 1...
2025-04-17 21:19:41,435 - INFO - Regime 1: 18 samples
2025-04-17 21:19:41,435 - INFO - Training portfolio optimizer...
2025-04-17 21:19:41,435 - INFO - Training regime-aware optimizer...
2025-04-17 21:19:41,436 - INFO - Training mean-variance optimizer...
2025-04-17 21:19:41,436 - INFO - Mean-variance optimizer training completed
2025-04-17 21:19:41,436 - INFO - Trained optimizer for regime 0 with 27 samples
2025-04-17 21:19:41,437 - INFO - Training mean-variance optimizer...
2025-04-17 21:19:41,437 - INFO - Mean-variance optimizer training completed
2025-04-17 21:19:41,437 - INFO - Trained optimizer for regime 1 with 18 samples
2025-04-17 21:19:41,437 - WARNING - No samples found for regime 2
2025-04-17 21:19:41,437 - WARNING - No samples found for regime 3
2025-04-17 21:19:41,438 - WARNING - No samples found for regime 4
2025-04-17 21:19:41,438 - INFO - Portfolio optimizer training completed
2025-04-17 21:19:41,438 - INFO - Optimizing portfolio weights...
2025-04-17 21:19:41,438 - INFO - Optimizing weights for regime 1
2025-04-17 21:19:41,440 - WARNING - All weights are zero, using equal weights
2025-04-17 21:19:41,440 - INFO - Optimizing weights for regime 1
2025-04-17 21:19:41,442 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,443 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,444 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,445 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,446 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,447 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,448 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,449 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,451 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,452 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,453 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,454 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,455 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,456 - INFO - Optimizing weights for regime 1
2025-04-17 21:19:41,458 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,458 - INFO - Optimizing weights for regime 1
2025-04-17 21:19:41,460 - INFO - Optimizing weights for regime 1
2025-04-17 21:19:41,461 - INFO - Optimizing weights for regime 1
2025-04-17 21:19:41,462 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,464 - INFO - Optimizing weights for regime 1
2025-04-17 21:19:41,465 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,467 - INFO - Optimizing weights for regime 1
2025-04-17 21:19:41,468 - INFO - Optimizing weights for regime 1
2025-04-17 21:19:41,469 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,470 - INFO - Optimizing weights for regime 1
2025-04-17 21:19:41,471 - INFO - Optimizing weights for regime 1
2025-04-17 21:19:41,473 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,474 - INFO - Optimizing weights for regime 1
2025-04-17 21:19:41,475 - INFO - Optimizing weights for regime 1
2025-04-17 21:19:41,476 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,478 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,479 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,480 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,481 - INFO - Optimizing weights for regime 1
2025-04-17 21:19:41,483 - INFO - Optimizing weights for regime 1
2025-04-17 21:19:41,484 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:41,485 - INFO - Optimizing weights for regime 1
2025-04-17 21:19:41,487 - INFO - Optimizing weights for regime 1
2025-04-17 21:19:41,488 - INFO - Optimizing weights for regime 1
2025-04-17 21:19:41,489 - INFO - Portfolio optimization completed
2025-04-17 21:19:41,489 - INFO - Initializing backtester...
2025-04-17 21:19:41,500 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:19:41,500 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:19:41,501 - INFO - Running backtest...
2025-04-17 21:19:41,504 - INFO - Backtest completed
2025-04-17 21:19:41,505 - ERROR - Error running xgboost with regime_aware: 'annualized_vol'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 344, in run_strategy
    print(f"Annualized Volatility: {self.backtest_results['annualized_vol']:.2%}")
                                    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
KeyError: 'annualized_vol'
2025-04-17 21:19:41,507 - INFO - 
Running strategy with xgboost classifier and neural optimizer
2025-04-17 21:19:41,507 - INFO - Initializing strategy...
2025-04-17 21:19:41,507 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 21:19:41,507 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:19:41,508 - INFO - Running strategy...
2025-04-17 21:19:41,509 - INFO - Starting strategy execution...
2025-04-17 21:19:41,509 - INFO - Preparing training and testing data...
2025-04-17 21:19:41,509 - INFO - Starting data preparation...
2025-04-17 21:19:41,509 - INFO - Loading Fama-French factors...
2025-04-17 21:19:41,526 - INFO - Fama-French factors loaded
2025-04-17 21:19:41,527 - INFO - Processing factor data...
2025-04-17 21:19:41,531 - INFO - Factor data processed
2025-04-17 21:19:41,531 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:19:41,531 - INFO - 
Training Period:
2025-04-17 21:19:41,538 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:19:41,549 - INFO - 
Testing Period:
2025-04-17 21:19:41,554 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:19:41,565 - INFO - Loading macro and market data...
2025-04-17 21:19:41,567 - INFO - Loading existing macro data...
2025-04-17 21:19:41,570 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:19:41,571 - INFO - Loading existing macro data...
2025-04-17 21:19:41,581 - WARNING - US corporate credit spread file not found
2025-04-17 21:19:41,582 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:19:41,585 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:19:41,586 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:19:41,586 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:19:41,587 - INFO - Loading existing market data...
2025-04-17 21:19:41,591 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:19:41,592 - INFO - Loading existing market data...
2025-04-17 21:19:41,595 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:19:41,595 - INFO - Macro and market data loaded
2025-04-17 21:19:41,596 - INFO - Preparing training data for regime classification...
2025-04-17 21:19:41,597 - INFO - Loading existing macro data...
2025-04-17 21:19:41,608 - WARNING - US corporate credit spread file not found
2025-04-17 21:19:41,608 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:19:41,612 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:19:41,612 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:19:41,612 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:19:41,613 - INFO - Loading existing market data...
2025-04-17 21:19:41,617 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:19:41,620 - INFO - Prepared training data with 1508 samples
2025-04-17 21:19:41,621 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:19:41,621 - INFO - Training data prepared
2025-04-17 21:19:41,621 - INFO - Storing data...
2025-04-17 21:19:41,621 - INFO - Aligning data indices...
2025-04-17 21:19:41,622 - INFO - Data indices aligned
2025-04-17 21:19:41,623 - INFO - Updated neural optimizer input size to 6
2025-04-17 21:19:41,623 - INFO - Data preparation completed
2025-04-17 21:19:41,623 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:19:41,623 - INFO - Training models...
2025-04-17 21:19:41,623 - INFO - Starting model training...
2025-04-17 21:19:41,624 - INFO - Training regime classifier...
2025-04-17 21:19:41,624 - INFO - Preparing features...
2025-04-17 21:19:41,624 - INFO - Input shape: (1508, 6)
2025-04-17 21:19:41,625 - INFO - Handling missing values...
2025-04-17 21:19:41,626 - INFO - Missing values: 4389 -> 0
2025-04-17 21:19:41,626 - INFO - Scaling features...
2025-04-17 21:19:41,628 - INFO - Fitted new scaler
2025-04-17 21:19:41,629 - INFO - Output shape: (1508, 6)
2025-04-17 21:19:41,897 - INFO - Training neural portfolio optimizer...
2025-04-17 21:19:41,897 - INFO - Neural portfolio optimizer training completed
2025-04-17 21:19:41,897 - INFO - Model training completed
2025-04-17 21:19:41,899 - INFO - Model training completed
2025-04-17 21:19:41,899 - INFO - Initializing portfolio weights...
2025-04-17 21:19:41,900 - INFO - Portfolio weights initialized
2025-04-17 21:19:41,900 - INFO - Generating regime predictions for test period...
2025-04-17 21:19:41,902 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:19:41,904 - INFO - Generated 41 regime predictions
2025-04-17 21:19:41,904 - INFO - Calculating regime-specific returns...
2025-04-17 21:19:41,908 - INFO - Found 2 unique regimes
2025-04-17 21:19:41,908 - INFO - Processing regime 0...
2025-04-17 21:19:41,910 - INFO - Regime 0: 27 samples
2025-04-17 21:19:41,910 - INFO - Processing regime 1...
2025-04-17 21:19:41,911 - INFO - Regime 1: 18 samples
2025-04-17 21:19:41,912 - INFO - Training portfolio optimizer...
2025-04-17 21:19:41,913 - ERROR - Error running xgboost with neural: mat1 and mat2 shapes cannot be multiplied (45x5 and 6x64)
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 297, in run_strategy
    self.portfolio_optimizer.train(train_factors, target_weights)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 116, in train
    predictions = self.model(features_tensor)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 129, in forward
    x = torch.relu(self.fc1(x))
                   ~~~~~~~~^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\linear.py", line 125, in forward
    return F.linear(input, self.weight, self.bias)
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: mat1 and mat2 shapes cannot be multiplied (45x5 and 6x64)
2025-04-17 21:19:41,918 - INFO - 
Running strategy with hmm classifier and mean_variance optimizer
2025-04-17 21:19:41,918 - INFO - Initializing strategy...
2025-04-17 21:19:41,918 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 21:19:41,919 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:19:41,919 - INFO - Running strategy...
2025-04-17 21:19:41,919 - INFO - Starting strategy execution...
2025-04-17 21:19:41,919 - INFO - Preparing training and testing data...
2025-04-17 21:19:41,920 - INFO - Starting data preparation...
2025-04-17 21:19:41,920 - INFO - Loading Fama-French factors...
2025-04-17 21:19:41,937 - INFO - Fama-French factors loaded
2025-04-17 21:19:41,937 - INFO - Processing factor data...
2025-04-17 21:19:41,940 - INFO - Factor data processed
2025-04-17 21:19:41,941 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:19:41,941 - INFO - 
Training Period:
2025-04-17 21:19:41,949 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:19:41,961 - INFO - 
Testing Period:
2025-04-17 21:19:41,968 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:19:41,982 - INFO - Loading macro and market data...
2025-04-17 21:19:41,984 - INFO - Loading existing macro data...
2025-04-17 21:19:41,989 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:19:41,990 - INFO - Loading existing macro data...
2025-04-17 21:19:42,009 - WARNING - US corporate credit spread file not found
2025-04-17 21:19:42,010 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:19:42,014 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:19:42,014 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:19:42,015 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:19:42,017 - INFO - Loading existing market data...
2025-04-17 21:19:42,021 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:19:42,023 - INFO - Loading existing market data...
2025-04-17 21:19:42,029 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:19:42,030 - INFO - Macro and market data loaded
2025-04-17 21:19:42,030 - INFO - Preparing training data for regime classification...
2025-04-17 21:19:42,032 - INFO - Loading existing macro data...
2025-04-17 21:19:42,044 - WARNING - US corporate credit spread file not found
2025-04-17 21:19:42,045 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:19:42,049 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:19:42,049 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:19:42,049 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:19:42,051 - INFO - Loading existing market data...
2025-04-17 21:19:42,055 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:19:42,058 - INFO - Prepared training data with 1508 samples
2025-04-17 21:19:42,058 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:19:42,058 - INFO - Training data prepared
2025-04-17 21:19:42,059 - INFO - Storing data...
2025-04-17 21:19:42,059 - INFO - Aligning data indices...
2025-04-17 21:19:42,060 - INFO - Data indices aligned
2025-04-17 21:19:42,060 - INFO - Data preparation completed
2025-04-17 21:19:42,061 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:19:42,061 - INFO - Training models...
2025-04-17 21:19:42,061 - INFO - Starting model training...
2025-04-17 21:19:42,061 - INFO - Training regime classifier...
2025-04-17 21:19:42,062 - INFO - Training HMM model...
2025-04-17 21:19:42,314 - INFO - HMM model training completed
2025-04-17 21:19:42,503 - INFO - Model training completed
2025-04-17 21:19:42,505 - INFO - Model training completed
2025-04-17 21:19:42,506 - INFO - Initializing portfolio weights...
2025-04-17 21:19:42,507 - INFO - Portfolio weights initialized
2025-04-17 21:19:42,507 - INFO - Generating regime predictions for test period...
2025-04-17 21:19:42,509 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:19:42,511 - INFO - Generated 41 regime predictions
2025-04-17 21:19:42,512 - INFO - Calculating regime-specific returns...
2025-04-17 21:19:42,515 - INFO - Found 2 unique regimes
2025-04-17 21:19:42,516 - INFO - Processing regime 0...
2025-04-17 21:19:42,517 - INFO - Regime 0: 30 samples
2025-04-17 21:19:42,517 - INFO - Processing regime 1...
2025-04-17 21:19:42,518 - INFO - Regime 1: 15 samples
2025-04-17 21:19:42,518 - INFO - Training portfolio optimizer...
2025-04-17 21:19:42,518 - INFO - Training mean-variance optimizer...
2025-04-17 21:19:42,519 - INFO - Mean-variance optimizer training completed
2025-04-17 21:19:42,519 - INFO - Portfolio optimizer training completed
2025-04-17 21:19:42,519 - INFO - Optimizing portfolio weights...
2025-04-17 21:19:42,521 - WARNING - All weights are zero, using equal weights
2025-04-17 21:19:42,545 - INFO - Portfolio optimization completed
2025-04-17 21:19:42,546 - INFO - Initializing backtester...
2025-04-17 21:19:42,552 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:19:42,552 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:19:42,552 - INFO - Running backtest...
2025-04-17 21:19:42,555 - INFO - Backtest completed
2025-04-17 21:19:42,556 - ERROR - Error running hmm with mean_variance: 'annualized_vol'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 344, in run_strategy
    print(f"Annualized Volatility: {self.backtest_results['annualized_vol']:.2%}")
                                    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
KeyError: 'annualized_vol'
2025-04-17 21:19:42,557 - INFO - 
Running strategy with hmm classifier and regime_aware optimizer
2025-04-17 21:19:42,557 - INFO - Initializing strategy...
2025-04-17 21:19:42,557 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 21:19:42,557 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:19:42,558 - INFO - Running strategy...
2025-04-17 21:19:42,558 - INFO - Starting strategy execution...
2025-04-17 21:19:42,558 - INFO - Preparing training and testing data...
2025-04-17 21:19:42,558 - INFO - Starting data preparation...
2025-04-17 21:19:42,558 - INFO - Loading Fama-French factors...
2025-04-17 21:19:42,568 - INFO - Fama-French factors loaded
2025-04-17 21:19:42,569 - INFO - Processing factor data...
2025-04-17 21:19:42,572 - INFO - Factor data processed
2025-04-17 21:19:42,572 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:19:42,572 - INFO - 
Training Period:
2025-04-17 21:19:42,577 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:19:42,585 - INFO - 
Testing Period:
2025-04-17 21:19:42,591 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:19:42,599 - INFO - Loading macro and market data...
2025-04-17 21:19:42,601 - INFO - Loading existing macro data...
2025-04-17 21:19:42,605 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:19:42,606 - INFO - Loading existing macro data...
2025-04-17 21:19:42,617 - WARNING - US corporate credit spread file not found
2025-04-17 21:19:42,617 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:19:42,620 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:19:42,621 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:19:42,621 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:19:42,622 - INFO - Loading existing market data...
2025-04-17 21:19:42,627 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:19:42,628 - INFO - Loading existing market data...
2025-04-17 21:19:42,633 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:19:42,633 - INFO - Macro and market data loaded
2025-04-17 21:19:42,633 - INFO - Preparing training data for regime classification...
2025-04-17 21:19:42,634 - INFO - Loading existing macro data...
2025-04-17 21:19:42,644 - WARNING - US corporate credit spread file not found
2025-04-17 21:19:42,644 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:19:42,648 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:19:42,648 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:19:42,649 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:19:42,650 - INFO - Loading existing market data...
2025-04-17 21:19:42,655 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:19:42,658 - INFO - Prepared training data with 1508 samples
2025-04-17 21:19:42,658 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:19:42,658 - INFO - Training data prepared
2025-04-17 21:19:42,659 - INFO - Storing data...
2025-04-17 21:19:42,659 - INFO - Aligning data indices...
2025-04-17 21:19:42,660 - INFO - Data indices aligned
2025-04-17 21:19:42,660 - INFO - Data preparation completed
2025-04-17 21:19:42,660 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:19:42,660 - INFO - Training models...
2025-04-17 21:19:42,661 - INFO - Starting model training...
2025-04-17 21:19:42,661 - INFO - Training regime classifier...
2025-04-17 21:19:42,661 - INFO - Training HMM model...
2025-04-17 21:19:42,749 - INFO - HMM model training completed
2025-04-17 21:19:42,961 - INFO - Model training completed
2025-04-17 21:19:42,963 - INFO - Model training completed
2025-04-17 21:19:42,963 - INFO - Initializing portfolio weights...
2025-04-17 21:19:42,964 - INFO - Portfolio weights initialized
2025-04-17 21:19:42,964 - INFO - Generating regime predictions for test period...
2025-04-17 21:19:42,966 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:19:42,968 - INFO - Generated 41 regime predictions
2025-04-17 21:19:42,968 - INFO - Calculating regime-specific returns...
2025-04-17 21:19:42,972 - INFO - Found 2 unique regimes
2025-04-17 21:19:42,972 - INFO - Processing regime 0...
2025-04-17 21:19:42,973 - INFO - Regime 0: 30 samples
2025-04-17 21:19:42,973 - INFO - Processing regime 1...
2025-04-17 21:19:42,974 - INFO - Regime 1: 15 samples
2025-04-17 21:19:42,974 - INFO - Training portfolio optimizer...
2025-04-17 21:19:42,974 - INFO - Training regime-aware optimizer...
2025-04-17 21:19:42,975 - INFO - Training mean-variance optimizer...
2025-04-17 21:19:42,975 - INFO - Mean-variance optimizer training completed
2025-04-17 21:19:42,975 - INFO - Trained optimizer for regime 0 with 30 samples
2025-04-17 21:19:42,975 - INFO - Training mean-variance optimizer...
2025-04-17 21:19:42,975 - INFO - Mean-variance optimizer training completed
2025-04-17 21:19:42,975 - INFO - Trained optimizer for regime 1 with 15 samples
2025-04-17 21:19:42,976 - WARNING - No samples found for regime 2
2025-04-17 21:19:42,976 - WARNING - No samples found for regime 3
2025-04-17 21:19:42,976 - WARNING - No samples found for regime 4
2025-04-17 21:19:42,976 - INFO - Portfolio optimizer training completed
2025-04-17 21:19:42,976 - INFO - Optimizing portfolio weights...
2025-04-17 21:19:42,977 - INFO - Optimizing weights for regime 1
2025-04-17 21:19:42,978 - WARNING - All weights are zero, using equal weights
2025-04-17 21:19:42,979 - INFO - Optimizing weights for regime 1
2025-04-17 21:19:42,980 - INFO - Optimizing weights for regime 1
2025-04-17 21:19:42,981 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:42,982 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:42,983 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:42,984 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:42,984 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:42,985 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:42,986 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:42,987 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:42,988 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:42,989 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:42,989 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:42,990 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:42,991 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:42,992 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:42,993 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:42,994 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:42,995 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:42,996 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:42,997 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:42,998 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:42,998 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:42,999 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:43,000 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:43,001 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:43,002 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:43,003 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:43,004 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:43,005 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:43,006 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:43,007 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:43,008 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:43,009 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:43,009 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:43,010 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:43,011 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:43,012 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:43,012 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:43,013 - INFO - Optimizing weights for regime 0
2025-04-17 21:19:43,014 - INFO - Portfolio optimization completed
2025-04-17 21:19:43,014 - INFO - Initializing backtester...
2025-04-17 21:19:43,020 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:19:43,021 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:19:43,021 - INFO - Running backtest...
2025-04-17 21:19:43,023 - INFO - Backtest completed
2025-04-17 21:19:43,024 - ERROR - Error running hmm with regime_aware: 'annualized_vol'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 344, in run_strategy
    print(f"Annualized Volatility: {self.backtest_results['annualized_vol']:.2%}")
                                    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
KeyError: 'annualized_vol'
2025-04-17 21:19:43,024 - INFO - 
Running strategy with hmm classifier and neural optimizer
2025-04-17 21:19:43,025 - INFO - Initializing strategy...
2025-04-17 21:19:43,025 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 21:19:43,025 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:19:43,025 - INFO - Running strategy...
2025-04-17 21:19:43,026 - INFO - Starting strategy execution...
2025-04-17 21:19:43,026 - INFO - Preparing training and testing data...
2025-04-17 21:19:43,026 - INFO - Starting data preparation...
2025-04-17 21:19:43,026 - INFO - Loading Fama-French factors...
2025-04-17 21:19:43,037 - INFO - Fama-French factors loaded
2025-04-17 21:19:43,037 - INFO - Processing factor data...
2025-04-17 21:19:43,039 - INFO - Factor data processed
2025-04-17 21:19:43,040 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:19:43,040 - INFO - 
Training Period:
2025-04-17 21:19:43,046 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:19:43,055 - INFO - 
Testing Period:
2025-04-17 21:19:43,059 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:19:43,067 - INFO - Loading macro and market data...
2025-04-17 21:19:43,069 - INFO - Loading existing macro data...
2025-04-17 21:19:43,072 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:19:43,072 - INFO - Loading existing macro data...
2025-04-17 21:19:43,082 - WARNING - US corporate credit spread file not found
2025-04-17 21:19:43,083 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:19:43,086 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:19:43,087 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:19:43,087 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:19:43,088 - INFO - Loading existing market data...
2025-04-17 21:19:43,092 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:19:43,093 - INFO - Loading existing market data...
2025-04-17 21:19:43,096 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:19:43,096 - INFO - Macro and market data loaded
2025-04-17 21:19:43,096 - INFO - Preparing training data for regime classification...
2025-04-17 21:19:43,097 - INFO - Loading existing macro data...
2025-04-17 21:19:43,108 - WARNING - US corporate credit spread file not found
2025-04-17 21:19:43,109 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:19:43,113 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:19:43,113 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:19:43,113 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:19:43,115 - INFO - Loading existing market data...
2025-04-17 21:19:43,119 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:19:43,122 - INFO - Prepared training data with 1508 samples
2025-04-17 21:19:43,122 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:19:43,122 - INFO - Training data prepared
2025-04-17 21:19:43,123 - INFO - Storing data...
2025-04-17 21:19:43,123 - INFO - Aligning data indices...
2025-04-17 21:19:43,124 - INFO - Data indices aligned
2025-04-17 21:19:43,124 - INFO - Updated neural optimizer input size to 6
2025-04-17 21:19:43,124 - INFO - Data preparation completed
2025-04-17 21:19:43,125 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:19:43,125 - INFO - Training models...
2025-04-17 21:19:43,125 - INFO - Starting model training...
2025-04-17 21:19:43,125 - INFO - Training regime classifier...
2025-04-17 21:19:43,125 - INFO - Training HMM model...
2025-04-17 21:19:43,208 - INFO - HMM model training completed
2025-04-17 21:19:43,401 - INFO - Training neural portfolio optimizer...
2025-04-17 21:19:43,401 - INFO - Neural portfolio optimizer training completed
2025-04-17 21:19:43,402 - INFO - Model training completed
2025-04-17 21:19:43,403 - INFO - Model training completed
2025-04-17 21:19:43,404 - INFO - Initializing portfolio weights...
2025-04-17 21:19:43,404 - INFO - Portfolio weights initialized
2025-04-17 21:19:43,404 - INFO - Generating regime predictions for test period...
2025-04-17 21:19:43,406 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:19:43,409 - INFO - Generated 41 regime predictions
2025-04-17 21:19:43,409 - INFO - Calculating regime-specific returns...
2025-04-17 21:19:43,413 - INFO - Found 2 unique regimes
2025-04-17 21:19:43,413 - INFO - Processing regime 0...
2025-04-17 21:19:43,414 - INFO - Regime 0: 30 samples
2025-04-17 21:19:43,415 - INFO - Processing regime 1...
2025-04-17 21:19:43,416 - INFO - Regime 1: 15 samples
2025-04-17 21:19:43,416 - INFO - Training portfolio optimizer...
2025-04-17 21:19:43,417 - ERROR - Error running hmm with neural: mat1 and mat2 shapes cannot be multiplied (45x5 and 6x64)
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 297, in run_strategy
    self.portfolio_optimizer.train(train_factors, target_weights)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 116, in train
    predictions = self.model(features_tensor)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\Desktop\factor_timing\optimization\portfolio_optimizer.py", line 129, in forward
    x = torch.relu(self.fc1(x))
                   ~~~~~~~~^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\linear.py", line 125, in forward
    return F.linear(input, self.weight, self.bias)
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: mat1 and mat2 shapes cannot be multiplied (45x5 and 6x64)
2025-04-17 21:19:43,419 - ERROR - No valid results obtained from parameter grid search
2025-04-17 21:19:43,419 - ERROR - No valid results obtained from parameter grid search
2025-04-17 21:19:43,419 - INFO - Factor timing strategy optimization completed
2025-04-17 21:20:50,235 - INFO - Starting factor timing strategy optimization...
2025-04-17 21:20:50,235 - INFO - Running parameter grid search...
2025-04-17 21:20:50,235 - INFO - 
Running strategy with lstm classifier and mean_variance optimizer
2025-04-17 21:20:50,236 - INFO - Initializing strategy...
2025-04-17 21:20:50,236 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 21:20:50,238 - INFO - Running strategy...
2025-04-17 21:20:50,238 - INFO - Starting strategy execution...
2025-04-17 21:20:50,238 - INFO - Preparing training and testing data...
2025-04-17 21:20:50,238 - INFO - Starting data preparation...
2025-04-17 21:20:50,238 - INFO - Loading Fama-French factors...
2025-04-17 21:20:50,259 - INFO - Fama-French factors loaded
2025-04-17 21:20:50,259 - INFO - Processing factor data...
2025-04-17 21:20:50,264 - INFO - Factor data processed
2025-04-17 21:20:50,264 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:20:50,264 - INFO - 
Training Period:
2025-04-17 21:20:50,272 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:20:50,283 - INFO - 
Testing Period:
2025-04-17 21:20:50,288 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:20:50,299 - INFO - Loading macro and market data...
2025-04-17 21:20:50,300 - INFO - Loading existing macro data...
2025-04-17 21:20:50,307 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:20:50,309 - INFO - Loading existing macro data...
2025-04-17 21:20:50,326 - WARNING - US corporate credit spread file not found
2025-04-17 21:20:50,327 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:20:50,331 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:20:50,332 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:20:50,332 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:20:50,333 - INFO - Loading existing market data...
2025-04-17 21:20:50,338 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:20:50,340 - INFO - Loading existing market data...
2025-04-17 21:20:50,344 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:20:50,345 - INFO - Macro and market data loaded
2025-04-17 21:20:50,345 - INFO - Preparing training data for regime classification...
2025-04-17 21:20:50,346 - INFO - Loading existing macro data...
2025-04-17 21:20:50,358 - WARNING - US corporate credit spread file not found
2025-04-17 21:20:50,359 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:20:50,362 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:20:50,363 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:20:50,363 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:20:50,365 - INFO - Loading existing market data...
2025-04-17 21:20:50,370 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:20:50,374 - INFO - Prepared training data with 1508 samples
2025-04-17 21:20:50,375 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:20:50,375 - INFO - Training data prepared
2025-04-17 21:20:50,376 - INFO - Storing data...
2025-04-17 21:20:50,376 - INFO - Aligning data indices...
2025-04-17 21:20:50,378 - INFO - Data indices aligned
2025-04-17 21:20:50,378 - INFO - Data preparation completed
2025-04-17 21:20:50,379 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:20:50,379 - INFO - Training models...
2025-04-17 21:20:50,379 - INFO - Starting model training...
2025-04-17 21:20:50,380 - INFO - Training regime classifier...
2025-04-17 21:20:50,380 - ERROR - Error running lstm with mean_variance: Module.train() takes from 1 to 2 positional arguments but 3 were given
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 229, in run_strategy
    training_metrics = self.train_models()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 171, in train_models
    self.regime_classifier.train(train_X, train_y)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
TypeError: Module.train() takes from 1 to 2 positional arguments but 3 were given
2025-04-17 21:20:50,382 - INFO - 
Running strategy with lstm classifier and regime_aware optimizer
2025-04-17 21:20:50,382 - INFO - Initializing strategy...
2025-04-17 21:20:50,382 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 21:20:50,384 - INFO - Running strategy...
2025-04-17 21:20:50,384 - INFO - Starting strategy execution...
2025-04-17 21:20:50,384 - INFO - Preparing training and testing data...
2025-04-17 21:20:50,385 - INFO - Starting data preparation...
2025-04-17 21:20:50,385 - INFO - Loading Fama-French factors...
2025-04-17 21:20:50,395 - INFO - Fama-French factors loaded
2025-04-17 21:20:50,395 - INFO - Processing factor data...
2025-04-17 21:20:50,398 - INFO - Factor data processed
2025-04-17 21:20:50,398 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:20:50,398 - INFO - 
Training Period:
2025-04-17 21:20:50,404 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:20:50,412 - INFO - 
Testing Period:
2025-04-17 21:20:50,416 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:20:50,423 - INFO - Loading macro and market data...
2025-04-17 21:20:50,424 - INFO - Loading existing macro data...
2025-04-17 21:20:50,427 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:20:50,428 - INFO - Loading existing macro data...
2025-04-17 21:20:50,436 - WARNING - US corporate credit spread file not found
2025-04-17 21:20:50,436 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:20:50,439 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:20:50,439 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:20:50,439 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:20:50,440 - INFO - Loading existing market data...
2025-04-17 21:20:50,444 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:20:50,445 - INFO - Loading existing market data...
2025-04-17 21:20:50,448 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:20:50,448 - INFO - Macro and market data loaded
2025-04-17 21:20:50,448 - INFO - Preparing training data for regime classification...
2025-04-17 21:20:50,449 - INFO - Loading existing macro data...
2025-04-17 21:20:50,460 - WARNING - US corporate credit spread file not found
2025-04-17 21:20:50,460 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:20:50,463 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:20:50,464 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:20:50,464 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:20:50,465 - INFO - Loading existing market data...
2025-04-17 21:20:50,468 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:20:50,471 - INFO - Prepared training data with 1508 samples
2025-04-17 21:20:50,471 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:20:50,471 - INFO - Training data prepared
2025-04-17 21:20:50,472 - INFO - Storing data...
2025-04-17 21:20:50,472 - INFO - Aligning data indices...
2025-04-17 21:20:50,473 - INFO - Data indices aligned
2025-04-17 21:20:50,473 - INFO - Data preparation completed
2025-04-17 21:20:50,473 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:20:50,473 - INFO - Training models...
2025-04-17 21:20:50,474 - INFO - Starting model training...
2025-04-17 21:20:50,474 - INFO - Training regime classifier...
2025-04-17 21:20:50,474 - ERROR - Error running lstm with regime_aware: Module.train() takes from 1 to 2 positional arguments but 3 were given
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 229, in run_strategy
    training_metrics = self.train_models()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 171, in train_models
    self.regime_classifier.train(train_X, train_y)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
TypeError: Module.train() takes from 1 to 2 positional arguments but 3 were given
2025-04-17 21:20:50,475 - INFO - 
Running strategy with lstm classifier and neural optimizer
2025-04-17 21:20:50,475 - INFO - Initializing strategy...
2025-04-17 21:20:50,475 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 21:20:51,665 - INFO - Running strategy...
2025-04-17 21:20:51,665 - INFO - Starting strategy execution...
2025-04-17 21:20:51,665 - INFO - Preparing training and testing data...
2025-04-17 21:20:51,666 - INFO - Starting data preparation...
2025-04-17 21:20:51,666 - INFO - Loading Fama-French factors...
2025-04-17 21:20:51,678 - INFO - Fama-French factors loaded
2025-04-17 21:20:51,679 - INFO - Processing factor data...
2025-04-17 21:20:51,681 - INFO - Factor data processed
2025-04-17 21:20:51,681 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:20:51,682 - INFO - 
Training Period:
2025-04-17 21:20:51,689 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:20:51,696 - INFO - 
Testing Period:
2025-04-17 21:20:51,702 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:20:51,711 - INFO - Loading macro and market data...
2025-04-17 21:20:51,712 - INFO - Loading existing macro data...
2025-04-17 21:20:51,716 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:20:51,717 - INFO - Loading existing macro data...
2025-04-17 21:20:51,729 - WARNING - US corporate credit spread file not found
2025-04-17 21:20:51,730 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:20:51,733 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:20:51,733 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:20:51,734 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:20:51,735 - INFO - Loading existing market data...
2025-04-17 21:20:51,739 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:20:51,740 - INFO - Loading existing market data...
2025-04-17 21:20:51,744 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:20:51,744 - INFO - Macro and market data loaded
2025-04-17 21:20:51,744 - INFO - Preparing training data for regime classification...
2025-04-17 21:20:51,746 - INFO - Loading existing macro data...
2025-04-17 21:20:51,757 - WARNING - US corporate credit spread file not found
2025-04-17 21:20:51,757 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:20:51,760 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:20:51,760 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:20:51,760 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:20:51,761 - INFO - Loading existing market data...
2025-04-17 21:20:51,766 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:20:51,769 - INFO - Prepared training data with 1508 samples
2025-04-17 21:20:51,770 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:20:51,770 - INFO - Training data prepared
2025-04-17 21:20:51,770 - INFO - Storing data...
2025-04-17 21:20:51,771 - INFO - Aligning data indices...
2025-04-17 21:20:51,772 - INFO - Data indices aligned
2025-04-17 21:20:51,772 - INFO - Data preparation completed
2025-04-17 21:20:51,772 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:20:51,773 - INFO - Training models...
2025-04-17 21:20:51,773 - INFO - Starting model training...
2025-04-17 21:20:51,773 - INFO - Training regime classifier...
2025-04-17 21:20:51,773 - ERROR - Error running lstm with neural: Module.train() takes from 1 to 2 positional arguments but 3 were given
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 229, in run_strategy
    training_metrics = self.train_models()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 171, in train_models
    self.regime_classifier.train(train_X, train_y)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
TypeError: Module.train() takes from 1 to 2 positional arguments but 3 were given
2025-04-17 21:20:51,774 - INFO - 
Running strategy with xgboost classifier and mean_variance optimizer
2025-04-17 21:20:51,775 - INFO - Initializing strategy...
2025-04-17 21:20:51,775 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 21:20:51,775 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:20:51,796 - INFO - Running strategy...
2025-04-17 21:20:51,796 - INFO - Starting strategy execution...
2025-04-17 21:20:51,796 - INFO - Preparing training and testing data...
2025-04-17 21:20:51,797 - INFO - Starting data preparation...
2025-04-17 21:20:51,797 - INFO - Loading Fama-French factors...
2025-04-17 21:20:51,806 - INFO - Fama-French factors loaded
2025-04-17 21:20:51,806 - INFO - Processing factor data...
2025-04-17 21:20:51,809 - INFO - Factor data processed
2025-04-17 21:20:51,810 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:20:51,810 - INFO - 
Training Period:
2025-04-17 21:20:51,815 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:20:51,823 - INFO - 
Testing Period:
2025-04-17 21:20:51,828 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:20:51,836 - INFO - Loading macro and market data...
2025-04-17 21:20:51,837 - INFO - Loading existing macro data...
2025-04-17 21:20:51,841 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:20:51,842 - INFO - Loading existing macro data...
2025-04-17 21:20:51,851 - WARNING - US corporate credit spread file not found
2025-04-17 21:20:51,851 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:20:51,855 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:20:51,855 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:20:51,855 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:20:51,857 - INFO - Loading existing market data...
2025-04-17 21:20:51,860 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:20:51,861 - INFO - Loading existing market data...
2025-04-17 21:20:51,864 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:20:51,864 - INFO - Macro and market data loaded
2025-04-17 21:20:51,864 - INFO - Preparing training data for regime classification...
2025-04-17 21:20:51,865 - INFO - Loading existing macro data...
2025-04-17 21:20:51,877 - WARNING - US corporate credit spread file not found
2025-04-17 21:20:51,877 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:20:51,880 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:20:51,880 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:20:51,881 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:20:51,882 - INFO - Loading existing market data...
2025-04-17 21:20:51,885 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:20:51,888 - INFO - Prepared training data with 1508 samples
2025-04-17 21:20:51,888 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:20:51,889 - INFO - Training data prepared
2025-04-17 21:20:51,889 - INFO - Storing data...
2025-04-17 21:20:51,889 - INFO - Aligning data indices...
2025-04-17 21:20:51,891 - INFO - Data indices aligned
2025-04-17 21:20:51,891 - INFO - Data preparation completed
2025-04-17 21:20:51,891 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:20:51,892 - INFO - Training models...
2025-04-17 21:20:51,892 - INFO - Starting model training...
2025-04-17 21:20:51,892 - INFO - Training regime classifier...
2025-04-17 21:20:51,893 - INFO - Preparing features...
2025-04-17 21:20:51,893 - INFO - Input shape: (1508, 6)
2025-04-17 21:20:51,893 - INFO - Handling missing values...
2025-04-17 21:20:51,895 - INFO - Missing values: 4389 -> 0
2025-04-17 21:20:51,896 - INFO - Scaling features...
2025-04-17 21:20:51,897 - INFO - Fitted new scaler
2025-04-17 21:20:51,898 - INFO - Output shape: (1508, 6)
2025-04-17 21:20:53,494 - INFO - Model training completed
2025-04-17 21:20:53,496 - INFO - Model training completed
2025-04-17 21:20:53,496 - INFO - Initializing portfolio weights...
2025-04-17 21:20:53,497 - INFO - Portfolio weights initialized
2025-04-17 21:20:53,497 - INFO - Generating regime predictions for test period...
2025-04-17 21:20:53,499 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:20:53,501 - INFO - Generated 41 regime predictions
2025-04-17 21:20:53,501 - INFO - Calculating regime-specific returns...
2025-04-17 21:20:53,505 - INFO - Found 2 unique regimes
2025-04-17 21:20:53,505 - INFO - Processing regime 0...
2025-04-17 21:20:53,507 - INFO - Regime 0: 27 samples
2025-04-17 21:20:53,507 - INFO - Processing regime 1...
2025-04-17 21:20:53,508 - INFO - Regime 1: 18 samples
2025-04-17 21:20:53,508 - INFO - Training portfolio optimizer...
2025-04-17 21:20:53,509 - INFO - Training mean-variance optimizer...
2025-04-17 21:20:53,509 - INFO - Mean-variance optimizer training completed
2025-04-17 21:20:53,509 - INFO - Portfolio optimizer training completed
2025-04-17 21:20:53,509 - INFO - Optimizing portfolio weights...
2025-04-17 21:20:53,515 - WARNING - All weights are zero, using equal weights
2025-04-17 21:20:53,549 - INFO - Portfolio optimization completed
2025-04-17 21:20:53,549 - INFO - Initializing backtester...
2025-04-17 21:20:53,559 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:20:53,559 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:20:53,559 - INFO - Running backtest...
2025-04-17 21:20:53,563 - INFO - Backtest completed
2025-04-17 21:20:53,563 - INFO - Strategy execution completed
2025-04-17 21:20:53,564 - INFO - Plotting results...
2025-04-17 21:20:53,564 - INFO - Starting to plot results...
2025-04-17 21:20:53,564 - INFO - Starting to plot results...
2025-04-17 21:20:53,564 - ERROR - Error running xgboost with mean_variance: Run backtest first before plotting
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 72, in run_parameter_grid
    strategy.plot_results()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 358, in plot_results
    self.backtester.plot_results(benchmark)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\backtest\backtester.py", line 104, in plot_results
    raise ValueError("Run backtest first before plotting")
ValueError: Run backtest first before plotting
2025-04-17 21:20:53,566 - INFO - 
Running strategy with xgboost classifier and regime_aware optimizer
2025-04-17 21:20:53,566 - INFO - Initializing strategy...
2025-04-17 21:20:53,566 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 21:20:53,566 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:20:53,567 - INFO - Running strategy...
2025-04-17 21:20:53,567 - INFO - Starting strategy execution...
2025-04-17 21:20:53,567 - INFO - Preparing training and testing data...
2025-04-17 21:20:53,567 - INFO - Starting data preparation...
2025-04-17 21:20:53,568 - INFO - Loading Fama-French factors...
2025-04-17 21:20:53,583 - INFO - Fama-French factors loaded
2025-04-17 21:20:53,584 - INFO - Processing factor data...
2025-04-17 21:20:53,587 - INFO - Factor data processed
2025-04-17 21:20:53,588 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:20:53,588 - INFO - 
Training Period:
2025-04-17 21:20:53,595 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:20:53,607 - INFO - 
Testing Period:
2025-04-17 21:20:53,613 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:20:53,621 - INFO - Loading macro and market data...
2025-04-17 21:20:53,623 - INFO - Loading existing macro data...
2025-04-17 21:20:53,627 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:20:53,628 - INFO - Loading existing macro data...
2025-04-17 21:20:53,636 - WARNING - US corporate credit spread file not found
2025-04-17 21:20:53,637 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:20:53,640 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:20:53,641 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:20:53,641 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:20:53,643 - INFO - Loading existing market data...
2025-04-17 21:20:53,647 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:20:53,649 - INFO - Loading existing market data...
2025-04-17 21:20:53,654 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:20:53,654 - INFO - Macro and market data loaded
2025-04-17 21:20:53,655 - INFO - Preparing training data for regime classification...
2025-04-17 21:20:53,656 - INFO - Loading existing macro data...
2025-04-17 21:20:53,668 - WARNING - US corporate credit spread file not found
2025-04-17 21:20:53,669 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:20:53,673 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:20:53,673 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:20:53,674 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:20:53,675 - INFO - Loading existing market data...
2025-04-17 21:20:53,678 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:20:53,682 - INFO - Prepared training data with 1508 samples
2025-04-17 21:20:53,682 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:20:53,682 - INFO - Training data prepared
2025-04-17 21:20:53,683 - INFO - Storing data...
2025-04-17 21:20:53,683 - INFO - Aligning data indices...
2025-04-17 21:20:53,684 - INFO - Data indices aligned
2025-04-17 21:20:53,684 - INFO - Data preparation completed
2025-04-17 21:20:53,684 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:20:53,685 - INFO - Training models...
2025-04-17 21:20:53,685 - INFO - Starting model training...
2025-04-17 21:20:53,685 - INFO - Training regime classifier...
2025-04-17 21:20:53,685 - INFO - Preparing features...
2025-04-17 21:20:53,685 - INFO - Input shape: (1508, 6)
2025-04-17 21:20:53,686 - INFO - Handling missing values...
2025-04-17 21:20:53,687 - INFO - Missing values: 4389 -> 0
2025-04-17 21:20:53,687 - INFO - Scaling features...
2025-04-17 21:20:53,689 - INFO - Fitted new scaler
2025-04-17 21:20:53,690 - INFO - Output shape: (1508, 6)
2025-04-17 21:20:53,990 - INFO - Model training completed
2025-04-17 21:20:53,992 - INFO - Model training completed
2025-04-17 21:20:53,993 - INFO - Initializing portfolio weights...
2025-04-17 21:20:53,993 - INFO - Portfolio weights initialized
2025-04-17 21:20:53,994 - INFO - Generating regime predictions for test period...
2025-04-17 21:20:53,996 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:20:53,998 - INFO - Generated 41 regime predictions
2025-04-17 21:20:53,998 - INFO - Calculating regime-specific returns...
2025-04-17 21:20:54,004 - INFO - Found 2 unique regimes
2025-04-17 21:20:54,004 - INFO - Processing regime 0...
2025-04-17 21:20:54,005 - INFO - Regime 0: 27 samples
2025-04-17 21:20:54,006 - INFO - Processing regime 1...
2025-04-17 21:20:54,007 - INFO - Regime 1: 18 samples
2025-04-17 21:20:54,007 - INFO - Training portfolio optimizer...
2025-04-17 21:20:54,007 - INFO - Training regime-aware optimizer...
2025-04-17 21:20:54,007 - INFO - Training mean-variance optimizer...
2025-04-17 21:20:54,008 - INFO - Mean-variance optimizer training completed
2025-04-17 21:20:54,008 - INFO - Trained optimizer for regime 0 with 27 samples
2025-04-17 21:20:54,008 - INFO - Training mean-variance optimizer...
2025-04-17 21:20:54,008 - INFO - Mean-variance optimizer training completed
2025-04-17 21:20:54,009 - INFO - Trained optimizer for regime 1 with 18 samples
2025-04-17 21:20:54,009 - WARNING - No samples found for regime 2
2025-04-17 21:20:54,009 - WARNING - No samples found for regime 3
2025-04-17 21:20:54,010 - WARNING - No samples found for regime 4
2025-04-17 21:20:54,010 - INFO - Portfolio optimizer training completed
2025-04-17 21:20:54,010 - INFO - Optimizing portfolio weights...
2025-04-17 21:20:54,011 - INFO - Optimizing weights for regime 1
2025-04-17 21:20:54,012 - WARNING - All weights are zero, using equal weights
2025-04-17 21:20:54,013 - INFO - Optimizing weights for regime 1
2025-04-17 21:20:54,014 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,015 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,017 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,018 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,019 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,020 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,021 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,023 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,024 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,025 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,026 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,027 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,028 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,029 - INFO - Optimizing weights for regime 1
2025-04-17 21:20:54,030 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,031 - INFO - Optimizing weights for regime 1
2025-04-17 21:20:54,032 - INFO - Optimizing weights for regime 1
2025-04-17 21:20:54,033 - INFO - Optimizing weights for regime 1
2025-04-17 21:20:54,035 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,036 - INFO - Optimizing weights for regime 1
2025-04-17 21:20:54,037 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,038 - INFO - Optimizing weights for regime 1
2025-04-17 21:20:54,039 - INFO - Optimizing weights for regime 1
2025-04-17 21:20:54,040 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,041 - INFO - Optimizing weights for regime 1
2025-04-17 21:20:54,043 - INFO - Optimizing weights for regime 1
2025-04-17 21:20:54,044 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,045 - INFO - Optimizing weights for regime 1
2025-04-17 21:20:54,046 - INFO - Optimizing weights for regime 1
2025-04-17 21:20:54,047 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,048 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,050 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,051 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,052 - INFO - Optimizing weights for regime 1
2025-04-17 21:20:54,053 - INFO - Optimizing weights for regime 1
2025-04-17 21:20:54,054 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:54,055 - INFO - Optimizing weights for regime 1
2025-04-17 21:20:54,056 - INFO - Optimizing weights for regime 1
2025-04-17 21:20:54,057 - INFO - Optimizing weights for regime 1
2025-04-17 21:20:54,058 - INFO - Portfolio optimization completed
2025-04-17 21:20:54,059 - INFO - Initializing backtester...
2025-04-17 21:20:54,069 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:20:54,069 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:20:54,069 - INFO - Running backtest...
2025-04-17 21:20:54,072 - INFO - Backtest completed
2025-04-17 21:20:54,073 - INFO - Strategy execution completed
2025-04-17 21:20:54,073 - INFO - Plotting results...
2025-04-17 21:20:54,074 - INFO - Starting to plot results...
2025-04-17 21:20:54,074 - INFO - Starting to plot results...
2025-04-17 21:20:54,074 - ERROR - Error running xgboost with regime_aware: Run backtest first before plotting
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 72, in run_parameter_grid
    strategy.plot_results()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 358, in plot_results
    self.backtester.plot_results(benchmark)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\backtest\backtester.py", line 104, in plot_results
    raise ValueError("Run backtest first before plotting")
ValueError: Run backtest first before plotting
2025-04-17 21:20:54,075 - INFO - 
Running strategy with xgboost classifier and neural optimizer
2025-04-17 21:20:54,075 - INFO - Initializing strategy...
2025-04-17 21:20:54,075 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 21:20:54,076 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:20:54,077 - INFO - Running strategy...
2025-04-17 21:20:54,077 - INFO - Starting strategy execution...
2025-04-17 21:20:54,077 - INFO - Preparing training and testing data...
2025-04-17 21:20:54,077 - INFO - Starting data preparation...
2025-04-17 21:20:54,078 - INFO - Loading Fama-French factors...
2025-04-17 21:20:54,094 - INFO - Fama-French factors loaded
2025-04-17 21:20:54,094 - INFO - Processing factor data...
2025-04-17 21:20:54,098 - INFO - Factor data processed
2025-04-17 21:20:54,098 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:20:54,099 - INFO - 
Training Period:
2025-04-17 21:20:54,106 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:20:54,116 - INFO - 
Testing Period:
2025-04-17 21:20:54,120 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:20:54,128 - INFO - Loading macro and market data...
2025-04-17 21:20:54,129 - INFO - Loading existing macro data...
2025-04-17 21:20:54,133 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:20:54,134 - INFO - Loading existing macro data...
2025-04-17 21:20:54,143 - WARNING - US corporate credit spread file not found
2025-04-17 21:20:54,144 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:20:54,147 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:20:54,147 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:20:54,148 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:20:54,149 - INFO - Loading existing market data...
2025-04-17 21:20:54,153 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:20:54,154 - INFO - Loading existing market data...
2025-04-17 21:20:54,159 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:20:54,159 - INFO - Macro and market data loaded
2025-04-17 21:20:54,159 - INFO - Preparing training data for regime classification...
2025-04-17 21:20:54,162 - INFO - Loading existing macro data...
2025-04-17 21:20:54,183 - WARNING - US corporate credit spread file not found
2025-04-17 21:20:54,183 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:20:54,189 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:20:54,189 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:20:54,190 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:20:54,191 - INFO - Loading existing market data...
2025-04-17 21:20:54,195 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:20:54,198 - INFO - Prepared training data with 1508 samples
2025-04-17 21:20:54,199 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:20:54,199 - INFO - Training data prepared
2025-04-17 21:20:54,199 - INFO - Storing data...
2025-04-17 21:20:54,200 - INFO - Aligning data indices...
2025-04-17 21:20:54,201 - INFO - Data indices aligned
2025-04-17 21:20:54,201 - INFO - Data preparation completed
2025-04-17 21:20:54,202 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:20:54,202 - INFO - Training models...
2025-04-17 21:20:54,202 - INFO - Starting model training...
2025-04-17 21:20:54,202 - INFO - Training regime classifier...
2025-04-17 21:20:54,202 - INFO - Preparing features...
2025-04-17 21:20:54,203 - INFO - Input shape: (1508, 6)
2025-04-17 21:20:54,203 - INFO - Handling missing values...
2025-04-17 21:20:54,204 - INFO - Missing values: 4389 -> 0
2025-04-17 21:20:54,205 - INFO - Scaling features...
2025-04-17 21:20:54,206 - INFO - Fitted new scaler
2025-04-17 21:20:54,208 - INFO - Output shape: (1508, 6)
2025-04-17 21:20:54,494 - INFO - Model training completed
2025-04-17 21:20:54,496 - INFO - Model training completed
2025-04-17 21:20:54,496 - INFO - Initializing portfolio weights...
2025-04-17 21:20:54,497 - INFO - Portfolio weights initialized
2025-04-17 21:20:54,497 - INFO - Generating regime predictions for test period...
2025-04-17 21:20:54,499 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:20:54,501 - INFO - Generated 41 regime predictions
2025-04-17 21:20:54,501 - INFO - Calculating regime-specific returns...
2025-04-17 21:20:54,505 - INFO - Found 2 unique regimes
2025-04-17 21:20:54,505 - INFO - Processing regime 0...
2025-04-17 21:20:54,507 - INFO - Regime 0: 27 samples
2025-04-17 21:20:54,507 - INFO - Processing regime 1...
2025-04-17 21:20:54,508 - INFO - Regime 1: 18 samples
2025-04-17 21:20:54,508 - INFO - Training portfolio optimizer...
2025-04-17 21:20:54,508 - ERROR - Error running xgboost with neural: 'NoneType' object has no attribute 'train'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 300, in run_strategy
    self.portfolio_optimizer.train(train_factors)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'train'
2025-04-17 21:20:54,510 - INFO - 
Running strategy with hmm classifier and mean_variance optimizer
2025-04-17 21:20:54,510 - INFO - Initializing strategy...
2025-04-17 21:20:54,510 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 21:20:54,510 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:20:54,511 - INFO - Running strategy...
2025-04-17 21:20:54,511 - INFO - Starting strategy execution...
2025-04-17 21:20:54,511 - INFO - Preparing training and testing data...
2025-04-17 21:20:54,511 - INFO - Starting data preparation...
2025-04-17 21:20:54,512 - INFO - Loading Fama-French factors...
2025-04-17 21:20:54,528 - INFO - Fama-French factors loaded
2025-04-17 21:20:54,528 - INFO - Processing factor data...
2025-04-17 21:20:54,531 - INFO - Factor data processed
2025-04-17 21:20:54,532 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:20:54,532 - INFO - 
Training Period:
2025-04-17 21:20:54,539 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:20:54,550 - INFO - 
Testing Period:
2025-04-17 21:20:54,557 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:20:54,569 - INFO - Loading macro and market data...
2025-04-17 21:20:54,571 - INFO - Loading existing macro data...
2025-04-17 21:20:54,575 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:20:54,577 - INFO - Loading existing macro data...
2025-04-17 21:20:54,592 - WARNING - US corporate credit spread file not found
2025-04-17 21:20:54,592 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:20:54,597 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:20:54,597 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:20:54,597 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:20:54,599 - INFO - Loading existing market data...
2025-04-17 21:20:54,605 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:20:54,607 - INFO - Loading existing market data...
2025-04-17 21:20:54,611 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:20:54,612 - INFO - Macro and market data loaded
2025-04-17 21:20:54,612 - INFO - Preparing training data for regime classification...
2025-04-17 21:20:54,613 - INFO - Loading existing macro data...
2025-04-17 21:20:54,624 - WARNING - US corporate credit spread file not found
2025-04-17 21:20:54,625 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:20:54,628 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:20:54,628 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:20:54,629 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:20:54,630 - INFO - Loading existing market data...
2025-04-17 21:20:54,635 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:20:54,638 - INFO - Prepared training data with 1508 samples
2025-04-17 21:20:54,639 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:20:54,639 - INFO - Training data prepared
2025-04-17 21:20:54,639 - INFO - Storing data...
2025-04-17 21:20:54,640 - INFO - Aligning data indices...
2025-04-17 21:20:54,641 - INFO - Data indices aligned
2025-04-17 21:20:54,641 - INFO - Data preparation completed
2025-04-17 21:20:54,641 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:20:54,642 - INFO - Training models...
2025-04-17 21:20:54,642 - INFO - Starting model training...
2025-04-17 21:20:54,642 - INFO - Training regime classifier...
2025-04-17 21:20:54,642 - INFO - Training HMM model...
2025-04-17 21:20:54,882 - INFO - HMM model training completed
2025-04-17 21:20:55,073 - INFO - Model training completed
2025-04-17 21:20:55,075 - INFO - Model training completed
2025-04-17 21:20:55,076 - INFO - Initializing portfolio weights...
2025-04-17 21:20:55,076 - INFO - Portfolio weights initialized
2025-04-17 21:20:55,076 - INFO - Generating regime predictions for test period...
2025-04-17 21:20:55,078 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:20:55,080 - INFO - Generated 41 regime predictions
2025-04-17 21:20:55,080 - INFO - Calculating regime-specific returns...
2025-04-17 21:20:55,084 - INFO - Found 2 unique regimes
2025-04-17 21:20:55,085 - INFO - Processing regime 0...
2025-04-17 21:20:55,085 - INFO - Regime 0: 30 samples
2025-04-17 21:20:55,086 - INFO - Processing regime 1...
2025-04-17 21:20:55,086 - INFO - Regime 1: 15 samples
2025-04-17 21:20:55,087 - INFO - Training portfolio optimizer...
2025-04-17 21:20:55,087 - INFO - Training mean-variance optimizer...
2025-04-17 21:20:55,087 - INFO - Mean-variance optimizer training completed
2025-04-17 21:20:55,088 - INFO - Portfolio optimizer training completed
2025-04-17 21:20:55,088 - INFO - Optimizing portfolio weights...
2025-04-17 21:20:55,089 - WARNING - All weights are zero, using equal weights
2025-04-17 21:20:55,113 - INFO - Portfolio optimization completed
2025-04-17 21:20:55,113 - INFO - Initializing backtester...
2025-04-17 21:20:55,119 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:20:55,119 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:20:55,120 - INFO - Running backtest...
2025-04-17 21:20:55,122 - INFO - Backtest completed
2025-04-17 21:20:55,123 - INFO - Strategy execution completed
2025-04-17 21:20:55,123 - INFO - Plotting results...
2025-04-17 21:20:55,124 - INFO - Starting to plot results...
2025-04-17 21:20:55,124 - INFO - Starting to plot results...
2025-04-17 21:20:55,124 - ERROR - Error running hmm with mean_variance: Run backtest first before plotting
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 72, in run_parameter_grid
    strategy.plot_results()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 358, in plot_results
    self.backtester.plot_results(benchmark)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\backtest\backtester.py", line 104, in plot_results
    raise ValueError("Run backtest first before plotting")
ValueError: Run backtest first before plotting
2025-04-17 21:20:55,125 - INFO - 
Running strategy with hmm classifier and regime_aware optimizer
2025-04-17 21:20:55,125 - INFO - Initializing strategy...
2025-04-17 21:20:55,126 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 21:20:55,126 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:20:55,127 - INFO - Running strategy...
2025-04-17 21:20:55,127 - INFO - Starting strategy execution...
2025-04-17 21:20:55,127 - INFO - Preparing training and testing data...
2025-04-17 21:20:55,128 - INFO - Starting data preparation...
2025-04-17 21:20:55,128 - INFO - Loading Fama-French factors...
2025-04-17 21:20:55,137 - INFO - Fama-French factors loaded
2025-04-17 21:20:55,138 - INFO - Processing factor data...
2025-04-17 21:20:55,140 - INFO - Factor data processed
2025-04-17 21:20:55,140 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:20:55,141 - INFO - 
Training Period:
2025-04-17 21:20:55,146 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:20:55,154 - INFO - 
Testing Period:
2025-04-17 21:20:55,159 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:20:55,167 - INFO - Loading macro and market data...
2025-04-17 21:20:55,168 - INFO - Loading existing macro data...
2025-04-17 21:20:55,171 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:20:55,173 - INFO - Loading existing macro data...
2025-04-17 21:20:55,182 - WARNING - US corporate credit spread file not found
2025-04-17 21:20:55,183 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:20:55,186 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:20:55,187 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:20:55,187 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:20:55,188 - INFO - Loading existing market data...
2025-04-17 21:20:55,192 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:20:55,193 - INFO - Loading existing market data...
2025-04-17 21:20:55,196 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:20:55,197 - INFO - Macro and market data loaded
2025-04-17 21:20:55,197 - INFO - Preparing training data for regime classification...
2025-04-17 21:20:55,198 - INFO - Loading existing macro data...
2025-04-17 21:20:55,208 - WARNING - US corporate credit spread file not found
2025-04-17 21:20:55,209 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:20:55,211 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:20:55,212 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:20:55,212 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:20:55,213 - INFO - Loading existing market data...
2025-04-17 21:20:55,216 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:20:55,219 - INFO - Prepared training data with 1508 samples
2025-04-17 21:20:55,220 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:20:55,220 - INFO - Training data prepared
2025-04-17 21:20:55,220 - INFO - Storing data...
2025-04-17 21:20:55,221 - INFO - Aligning data indices...
2025-04-17 21:20:55,221 - INFO - Data indices aligned
2025-04-17 21:20:55,222 - INFO - Data preparation completed
2025-04-17 21:20:55,222 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:20:55,222 - INFO - Training models...
2025-04-17 21:20:55,222 - INFO - Starting model training...
2025-04-17 21:20:55,223 - INFO - Training regime classifier...
2025-04-17 21:20:55,223 - INFO - Training HMM model...
2025-04-17 21:20:55,304 - INFO - HMM model training completed
2025-04-17 21:20:55,508 - INFO - Model training completed
2025-04-17 21:20:55,510 - INFO - Model training completed
2025-04-17 21:20:55,510 - INFO - Initializing portfolio weights...
2025-04-17 21:20:55,511 - INFO - Portfolio weights initialized
2025-04-17 21:20:55,511 - INFO - Generating regime predictions for test period...
2025-04-17 21:20:55,512 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:20:55,514 - INFO - Generated 41 regime predictions
2025-04-17 21:20:55,515 - INFO - Calculating regime-specific returns...
2025-04-17 21:20:55,518 - INFO - Found 2 unique regimes
2025-04-17 21:20:55,518 - INFO - Processing regime 0...
2025-04-17 21:20:55,519 - INFO - Regime 0: 30 samples
2025-04-17 21:20:55,519 - INFO - Processing regime 1...
2025-04-17 21:20:55,520 - INFO - Regime 1: 15 samples
2025-04-17 21:20:55,521 - INFO - Training portfolio optimizer...
2025-04-17 21:20:55,521 - INFO - Training regime-aware optimizer...
2025-04-17 21:20:55,521 - INFO - Training mean-variance optimizer...
2025-04-17 21:20:55,521 - INFO - Mean-variance optimizer training completed
2025-04-17 21:20:55,521 - INFO - Trained optimizer for regime 0 with 30 samples
2025-04-17 21:20:55,522 - INFO - Training mean-variance optimizer...
2025-04-17 21:20:55,522 - INFO - Mean-variance optimizer training completed
2025-04-17 21:20:55,522 - INFO - Trained optimizer for regime 1 with 15 samples
2025-04-17 21:20:55,522 - WARNING - No samples found for regime 2
2025-04-17 21:20:55,523 - WARNING - No samples found for regime 3
2025-04-17 21:20:55,523 - WARNING - No samples found for regime 4
2025-04-17 21:20:55,523 - INFO - Portfolio optimizer training completed
2025-04-17 21:20:55,523 - INFO - Optimizing portfolio weights...
2025-04-17 21:20:55,524 - INFO - Optimizing weights for regime 1
2025-04-17 21:20:55,525 - WARNING - All weights are zero, using equal weights
2025-04-17 21:20:55,525 - INFO - Optimizing weights for regime 1
2025-04-17 21:20:55,527 - INFO - Optimizing weights for regime 1
2025-04-17 21:20:55,528 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,528 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,529 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,530 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,531 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,531 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,532 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,534 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,534 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,535 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,536 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,537 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,538 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,539 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,541 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,541 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,542 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,543 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,544 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,545 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,546 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,547 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,549 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,549 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,550 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,551 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,552 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,554 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,555 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,556 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,557 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,558 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,559 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,560 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,561 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,562 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,563 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,564 - INFO - Optimizing weights for regime 0
2025-04-17 21:20:55,565 - INFO - Portfolio optimization completed
2025-04-17 21:20:55,565 - INFO - Initializing backtester...
2025-04-17 21:20:55,573 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:20:55,573 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:20:55,573 - INFO - Running backtest...
2025-04-17 21:20:55,576 - INFO - Backtest completed
2025-04-17 21:20:55,578 - INFO - Strategy execution completed
2025-04-17 21:20:55,578 - INFO - Plotting results...
2025-04-17 21:20:55,578 - INFO - Starting to plot results...
2025-04-17 21:20:55,578 - INFO - Starting to plot results...
2025-04-17 21:20:55,579 - ERROR - Error running hmm with regime_aware: Run backtest first before plotting
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 72, in run_parameter_grid
    strategy.plot_results()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 358, in plot_results
    self.backtester.plot_results(benchmark)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\backtest\backtester.py", line 104, in plot_results
    raise ValueError("Run backtest first before plotting")
ValueError: Run backtest first before plotting
2025-04-17 21:20:55,580 - INFO - 
Running strategy with hmm classifier and neural optimizer
2025-04-17 21:20:55,580 - INFO - Initializing strategy...
2025-04-17 21:20:55,580 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 21:20:55,581 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:20:55,582 - INFO - Running strategy...
2025-04-17 21:20:55,582 - INFO - Starting strategy execution...
2025-04-17 21:20:55,582 - INFO - Preparing training and testing data...
2025-04-17 21:20:55,582 - INFO - Starting data preparation...
2025-04-17 21:20:55,582 - INFO - Loading Fama-French factors...
2025-04-17 21:20:55,595 - INFO - Fama-French factors loaded
2025-04-17 21:20:55,596 - INFO - Processing factor data...
2025-04-17 21:20:55,600 - INFO - Factor data processed
2025-04-17 21:20:55,600 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:20:55,601 - INFO - 
Training Period:
2025-04-17 21:20:55,606 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:20:55,614 - INFO - 
Testing Period:
2025-04-17 21:20:55,621 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:20:55,634 - INFO - Loading macro and market data...
2025-04-17 21:20:55,635 - INFO - Loading existing macro data...
2025-04-17 21:20:55,639 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:20:55,641 - INFO - Loading existing macro data...
2025-04-17 21:20:55,654 - WARNING - US corporate credit spread file not found
2025-04-17 21:20:55,654 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:20:55,657 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:20:55,657 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:20:55,658 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:20:55,659 - INFO - Loading existing market data...
2025-04-17 21:20:55,664 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:20:55,665 - INFO - Loading existing market data...
2025-04-17 21:20:55,669 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:20:55,669 - INFO - Macro and market data loaded
2025-04-17 21:20:55,669 - INFO - Preparing training data for regime classification...
2025-04-17 21:20:55,671 - INFO - Loading existing macro data...
2025-04-17 21:20:55,682 - WARNING - US corporate credit spread file not found
2025-04-17 21:20:55,682 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:20:55,687 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:20:55,687 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:20:55,688 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:20:55,689 - INFO - Loading existing market data...
2025-04-17 21:20:55,695 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:20:55,699 - INFO - Prepared training data with 1508 samples
2025-04-17 21:20:55,700 - INFO - Class distribution: {0: np.int64(754), 1: np.int64(754)}
2025-04-17 21:20:55,700 - INFO - Training data prepared
2025-04-17 21:20:55,701 - INFO - Storing data...
2025-04-17 21:20:55,702 - INFO - Aligning data indices...
2025-04-17 21:20:55,703 - INFO - Data indices aligned
2025-04-17 21:20:55,704 - INFO - Data preparation completed
2025-04-17 21:20:55,705 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:20:55,705 - INFO - Training models...
2025-04-17 21:20:55,705 - INFO - Starting model training...
2025-04-17 21:20:55,706 - INFO - Training regime classifier...
2025-04-17 21:20:55,707 - INFO - Training HMM model...
2025-04-17 21:20:55,812 - INFO - HMM model training completed
2025-04-17 21:20:56,009 - INFO - Model training completed
2025-04-17 21:20:56,011 - INFO - Model training completed
2025-04-17 21:20:56,011 - INFO - Initializing portfolio weights...
2025-04-17 21:20:56,012 - INFO - Portfolio weights initialized
2025-04-17 21:20:56,012 - INFO - Generating regime predictions for test period...
2025-04-17 21:20:56,014 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:20:56,017 - INFO - Generated 41 regime predictions
2025-04-17 21:20:56,017 - INFO - Calculating regime-specific returns...
2025-04-17 21:20:56,021 - INFO - Found 2 unique regimes
2025-04-17 21:20:56,021 - INFO - Processing regime 0...
2025-04-17 21:20:56,022 - INFO - Regime 0: 30 samples
2025-04-17 21:20:56,022 - INFO - Processing regime 1...
2025-04-17 21:20:56,023 - INFO - Regime 1: 15 samples
2025-04-17 21:20:56,023 - INFO - Training portfolio optimizer...
2025-04-17 21:20:56,023 - ERROR - Error running hmm with neural: 'NoneType' object has no attribute 'train'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 52, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 300, in run_strategy
    self.portfolio_optimizer.train(train_factors)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'train'
2025-04-17 21:20:56,024 - INFO - Analyzing results...
2025-04-17 21:20:56,026 - INFO - 
Strategy Performance Comparison:
2025-04-17 21:20:56,028 - INFO -   Model     Optimizer  Sharpe Ratio  Annualized Return  Annualized Volatility  Max Drawdown
xgboost mean_variance       5.16876           9.468039               0.369195     -0.055897
xgboost  regime_aware       5.16876           9.468039               0.369195     -0.055897
    hmm mean_variance       5.16876           9.468039               0.369195     -0.055897
    hmm  regime_aware       5.16876           9.468039               0.369195     -0.055897
2025-04-17 21:20:56,499 - INFO - Results saved to strategy_results.csv
2025-04-17 21:20:56,499 - INFO - 
Summary Statistics:
2025-04-17 21:20:56,499 - INFO - 
Sharpe Ratio Statistics:
2025-04-17 21:20:56,500 - INFO - Mean: 5.1688
2025-04-17 21:20:56,500 - INFO - Std: 0.0000
2025-04-17 21:20:56,500 - INFO - Min: 5.1688
2025-04-17 21:20:56,501 - INFO - Max: 5.1688
2025-04-17 21:20:56,501 - INFO - 
Annualized Return Statistics:
2025-04-17 21:20:56,501 - INFO - Mean: 9.4680
2025-04-17 21:20:56,501 - INFO - Std: 0.0000
2025-04-17 21:20:56,502 - INFO - Min: 9.4680
2025-04-17 21:20:56,502 - INFO - Max: 9.4680
2025-04-17 21:20:56,502 - INFO - 
Annualized Volatility Statistics:
2025-04-17 21:20:56,502 - INFO - Mean: 0.3692
2025-04-17 21:20:56,502 - INFO - Std: 0.0000
2025-04-17 21:20:56,503 - INFO - Min: 0.3692
2025-04-17 21:20:56,503 - INFO - Max: 0.3692
2025-04-17 21:20:56,503 - INFO - 
Max Drawdown Statistics:
2025-04-17 21:20:56,503 - INFO - Mean: -0.0559
2025-04-17 21:20:56,504 - INFO - Std: 0.0000
2025-04-17 21:20:56,504 - INFO - Min: -0.0559
2025-04-17 21:20:56,504 - INFO - Max: -0.0559
2025-04-17 21:20:56,505 - INFO - 
Best Performing Combination:
2025-04-17 21:20:56,505 - INFO - Model: xgboost
2025-04-17 21:20:56,506 - INFO - Optimizer: mean_variance
2025-04-17 21:20:56,506 - INFO - Sharpe Ratio: 5.1688
2025-04-17 21:20:56,506 - INFO - Annualized Return: 9.4680
2025-04-17 21:20:56,507 - INFO - Factor timing strategy optimization completed
2025-04-17 21:50:06,962 - INFO - Starting factor timing strategy optimization...
2025-04-17 21:50:06,963 - INFO - Running parameter grid search...
2025-04-17 21:50:06,963 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 3 regimes
2025-04-17 21:50:06,963 - INFO - Initializing strategy...
2025-04-17 21:50:06,964 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 21:50:06,964 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:06,965 - INFO - Initialized LSTMRegimeClassifier with 5 regimes
2025-04-17 21:50:06,965 - INFO - Running strategy...
2025-04-17 21:50:06,966 - INFO - Starting strategy execution...
2025-04-17 21:50:06,966 - INFO - Preparing training and testing data...
2025-04-17 21:50:06,966 - INFO - Starting data preparation...
2025-04-17 21:50:06,966 - INFO - Loading Fama-French factors...
2025-04-17 21:50:06,980 - INFO - Fama-French factors loaded
2025-04-17 21:50:06,980 - INFO - Processing factor data...
2025-04-17 21:50:06,983 - INFO - Factor data processed
2025-04-17 21:50:06,983 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:06,984 - INFO - 
Training Period:
2025-04-17 21:50:06,989 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:06,999 - INFO - 
Testing Period:
2025-04-17 21:50:07,003 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:07,011 - INFO - Loading macro and market data...
2025-04-17 21:50:07,013 - INFO - Loading existing macro data...
2025-04-17 21:50:07,015 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:07,016 - INFO - Loading existing macro data...
2025-04-17 21:50:07,025 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:07,025 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:07,029 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:07,029 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:07,030 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:07,031 - INFO - Loading existing market data...
2025-04-17 21:50:07,036 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:07,037 - INFO - Loading existing market data...
2025-04-17 21:50:07,041 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:07,041 - INFO - Macro and market data loaded
2025-04-17 21:50:07,042 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:07,042 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:07,043 - INFO - Loading existing macro data...
2025-04-17 21:50:07,055 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:07,056 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:07,059 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:07,059 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:07,060 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:07,061 - INFO - Loading existing market data...
2025-04-17 21:50:07,065 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:07,202 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:07,203 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:07,203 - INFO - Training data prepared
2025-04-17 21:50:07,204 - INFO - Storing data...
2025-04-17 21:50:07,204 - INFO - Aligning data indices...
2025-04-17 21:50:07,206 - INFO - Data indices aligned
2025-04-17 21:50:07,206 - INFO - Data preparation completed
2025-04-17 21:50:07,206 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:07,207 - INFO - Training models...
2025-04-17 21:50:07,207 - INFO - Starting model training...
2025-04-17 21:50:07,207 - INFO - Training regime classifier...
2025-04-17 21:50:07,208 - INFO - Training LSTM model...
2025-04-17 21:50:07,208 - INFO - Preparing features...
2025-04-17 21:50:07,208 - INFO - Input shape: (1536, 6)
2025-04-17 21:50:07,209 - INFO - Handling missing values...
2025-04-17 21:50:07,211 - INFO - Missing values: 0 -> 0
2025-04-17 21:50:07,211 - INFO - Scaling features...
2025-04-17 21:50:07,212 - INFO - Fitted new scaler
2025-04-17 21:50:07,214 - INFO - Output shape: (1536, 6)
2025-04-17 21:50:07,217 - ERROR - Error running lstm with mean_variance and 3 regimes: 'LSTMRegimeClassifier' object has no attribute 'parameters'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 62, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 245, in run_strategy
    training_metrics = self.train_models()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 187, in train_models
    self.regime_classifier.train(train_X, train_y)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 126, in train
    optimizer = torch.optim.Adam(self.parameters())
                                 ^^^^^^^^^^^^^^^
AttributeError: 'LSTMRegimeClassifier' object has no attribute 'parameters'
2025-04-17 21:50:07,219 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 5 regimes
2025-04-17 21:50:07,219 - INFO - Initializing strategy...
2025-04-17 21:50:07,219 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 21:50:07,220 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:07,221 - INFO - Initialized LSTMRegimeClassifier with 5 regimes
2025-04-17 21:50:07,222 - INFO - Running strategy...
2025-04-17 21:50:07,222 - INFO - Starting strategy execution...
2025-04-17 21:50:07,222 - INFO - Preparing training and testing data...
2025-04-17 21:50:07,222 - INFO - Starting data preparation...
2025-04-17 21:50:07,222 - INFO - Loading Fama-French factors...
2025-04-17 21:50:07,236 - INFO - Fama-French factors loaded
2025-04-17 21:50:07,237 - INFO - Processing factor data...
2025-04-17 21:50:07,240 - INFO - Factor data processed
2025-04-17 21:50:07,240 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:07,241 - INFO - 
Training Period:
2025-04-17 21:50:07,246 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:07,256 - INFO - 
Testing Period:
2025-04-17 21:50:07,261 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:07,270 - INFO - Loading macro and market data...
2025-04-17 21:50:07,272 - INFO - Loading existing macro data...
2025-04-17 21:50:07,275 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:07,276 - INFO - Loading existing macro data...
2025-04-17 21:50:07,288 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:07,288 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:07,292 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:07,292 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:07,292 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:07,294 - INFO - Loading existing market data...
2025-04-17 21:50:07,299 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:07,300 - INFO - Loading existing market data...
2025-04-17 21:50:07,304 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:07,305 - INFO - Macro and market data loaded
2025-04-17 21:50:07,305 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:07,305 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:07,306 - INFO - Loading existing macro data...
2025-04-17 21:50:07,316 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:07,316 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:07,319 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:07,319 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:07,319 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:07,320 - INFO - Loading existing market data...
2025-04-17 21:50:07,324 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:07,333 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:07,333 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:07,334 - INFO - Training data prepared
2025-04-17 21:50:07,334 - INFO - Storing data...
2025-04-17 21:50:07,334 - INFO - Aligning data indices...
2025-04-17 21:50:07,335 - INFO - Data indices aligned
2025-04-17 21:50:07,336 - INFO - Data preparation completed
2025-04-17 21:50:07,336 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:07,336 - INFO - Training models...
2025-04-17 21:50:07,336 - INFO - Starting model training...
2025-04-17 21:50:07,336 - INFO - Training regime classifier...
2025-04-17 21:50:07,336 - INFO - Training LSTM model...
2025-04-17 21:50:07,336 - INFO - Preparing features...
2025-04-17 21:50:07,337 - INFO - Input shape: (1536, 6)
2025-04-17 21:50:07,337 - INFO - Handling missing values...
2025-04-17 21:50:07,338 - INFO - Missing values: 0 -> 0
2025-04-17 21:50:07,338 - INFO - Scaling features...
2025-04-17 21:50:07,340 - INFO - Fitted new scaler
2025-04-17 21:50:07,341 - INFO - Output shape: (1536, 6)
2025-04-17 21:50:07,341 - ERROR - Error running lstm with mean_variance and 5 regimes: 'LSTMRegimeClassifier' object has no attribute 'parameters'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 62, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 245, in run_strategy
    training_metrics = self.train_models()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 187, in train_models
    self.regime_classifier.train(train_X, train_y)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 126, in train
    optimizer = torch.optim.Adam(self.parameters())
                                 ^^^^^^^^^^^^^^^
AttributeError: 'LSTMRegimeClassifier' object has no attribute 'parameters'
2025-04-17 21:50:07,343 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 7 regimes
2025-04-17 21:50:07,343 - INFO - Initializing strategy...
2025-04-17 21:50:07,343 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 21:50:07,344 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:07,345 - INFO - Initialized LSTMRegimeClassifier with 5 regimes
2025-04-17 21:50:07,345 - INFO - Running strategy...
2025-04-17 21:50:07,345 - INFO - Starting strategy execution...
2025-04-17 21:50:07,346 - INFO - Preparing training and testing data...
2025-04-17 21:50:07,346 - INFO - Starting data preparation...
2025-04-17 21:50:07,346 - INFO - Loading Fama-French factors...
2025-04-17 21:50:07,359 - INFO - Fama-French factors loaded
2025-04-17 21:50:07,359 - INFO - Processing factor data...
2025-04-17 21:50:07,363 - INFO - Factor data processed
2025-04-17 21:50:07,363 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:07,364 - INFO - 
Training Period:
2025-04-17 21:50:07,368 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:07,377 - INFO - 
Testing Period:
2025-04-17 21:50:07,383 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:07,392 - INFO - Loading macro and market data...
2025-04-17 21:50:07,394 - INFO - Loading existing macro data...
2025-04-17 21:50:07,397 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:07,399 - INFO - Loading existing macro data...
2025-04-17 21:50:07,408 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:07,408 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:07,412 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:07,413 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:07,413 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:07,414 - INFO - Loading existing market data...
2025-04-17 21:50:07,422 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:07,424 - INFO - Loading existing market data...
2025-04-17 21:50:07,428 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:07,428 - INFO - Macro and market data loaded
2025-04-17 21:50:07,428 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:07,428 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:07,429 - INFO - Loading existing macro data...
2025-04-17 21:50:07,441 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:07,442 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:07,445 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:07,445 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:07,445 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:07,447 - INFO - Loading existing market data...
2025-04-17 21:50:07,450 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:07,459 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:07,459 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:07,460 - INFO - Training data prepared
2025-04-17 21:50:07,460 - INFO - Storing data...
2025-04-17 21:50:07,460 - INFO - Aligning data indices...
2025-04-17 21:50:07,461 - INFO - Data indices aligned
2025-04-17 21:50:07,462 - INFO - Data preparation completed
2025-04-17 21:50:07,462 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:07,462 - INFO - Training models...
2025-04-17 21:50:07,462 - INFO - Starting model training...
2025-04-17 21:50:07,463 - INFO - Training regime classifier...
2025-04-17 21:50:07,463 - INFO - Training LSTM model...
2025-04-17 21:50:07,463 - INFO - Preparing features...
2025-04-17 21:50:07,463 - INFO - Input shape: (1536, 6)
2025-04-17 21:50:07,464 - INFO - Handling missing values...
2025-04-17 21:50:07,465 - INFO - Missing values: 0 -> 0
2025-04-17 21:50:07,465 - INFO - Scaling features...
2025-04-17 21:50:07,466 - INFO - Fitted new scaler
2025-04-17 21:50:07,467 - INFO - Output shape: (1536, 6)
2025-04-17 21:50:07,468 - ERROR - Error running lstm with mean_variance and 7 regimes: 'LSTMRegimeClassifier' object has no attribute 'parameters'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 62, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 245, in run_strategy
    training_metrics = self.train_models()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 187, in train_models
    self.regime_classifier.train(train_X, train_y)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 126, in train
    optimizer = torch.optim.Adam(self.parameters())
                                 ^^^^^^^^^^^^^^^
AttributeError: 'LSTMRegimeClassifier' object has no attribute 'parameters'
2025-04-17 21:50:07,469 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 3 regimes
2025-04-17 21:50:07,469 - INFO - Initializing strategy...
2025-04-17 21:50:07,469 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 21:50:07,469 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:07,470 - INFO - Initialized LSTMRegimeClassifier with 5 regimes
2025-04-17 21:50:07,471 - INFO - Running strategy...
2025-04-17 21:50:07,471 - INFO - Starting strategy execution...
2025-04-17 21:50:07,471 - INFO - Preparing training and testing data...
2025-04-17 21:50:07,471 - INFO - Starting data preparation...
2025-04-17 21:50:07,471 - INFO - Loading Fama-French factors...
2025-04-17 21:50:07,484 - INFO - Fama-French factors loaded
2025-04-17 21:50:07,484 - INFO - Processing factor data...
2025-04-17 21:50:07,487 - INFO - Factor data processed
2025-04-17 21:50:07,487 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:07,487 - INFO - 
Training Period:
2025-04-17 21:50:07,492 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:07,501 - INFO - 
Testing Period:
2025-04-17 21:50:07,507 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:07,517 - INFO - Loading macro and market data...
2025-04-17 21:50:07,518 - INFO - Loading existing macro data...
2025-04-17 21:50:07,521 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:07,523 - INFO - Loading existing macro data...
2025-04-17 21:50:07,534 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:07,535 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:07,538 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:07,538 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:07,539 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:07,540 - INFO - Loading existing market data...
2025-04-17 21:50:07,544 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:07,545 - INFO - Loading existing market data...
2025-04-17 21:50:07,548 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:07,549 - INFO - Macro and market data loaded
2025-04-17 21:50:07,549 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:07,549 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:07,550 - INFO - Loading existing macro data...
2025-04-17 21:50:07,561 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:07,561 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:07,565 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:07,565 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:07,565 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:07,566 - INFO - Loading existing market data...
2025-04-17 21:50:07,570 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:07,577 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:07,577 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:07,578 - INFO - Training data prepared
2025-04-17 21:50:07,578 - INFO - Storing data...
2025-04-17 21:50:07,578 - INFO - Aligning data indices...
2025-04-17 21:50:07,580 - INFO - Data indices aligned
2025-04-17 21:50:07,580 - INFO - Data preparation completed
2025-04-17 21:50:07,580 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:07,580 - INFO - Training models...
2025-04-17 21:50:07,581 - INFO - Starting model training...
2025-04-17 21:50:07,581 - INFO - Training regime classifier...
2025-04-17 21:50:07,581 - INFO - Training LSTM model...
2025-04-17 21:50:07,581 - INFO - Preparing features...
2025-04-17 21:50:07,581 - INFO - Input shape: (1536, 6)
2025-04-17 21:50:07,581 - INFO - Handling missing values...
2025-04-17 21:50:07,583 - INFO - Missing values: 0 -> 0
2025-04-17 21:50:07,583 - INFO - Scaling features...
2025-04-17 21:50:07,584 - INFO - Fitted new scaler
2025-04-17 21:50:07,585 - INFO - Output shape: (1536, 6)
2025-04-17 21:50:07,586 - ERROR - Error running lstm with regime_aware and 3 regimes: 'LSTMRegimeClassifier' object has no attribute 'parameters'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 62, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 245, in run_strategy
    training_metrics = self.train_models()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 187, in train_models
    self.regime_classifier.train(train_X, train_y)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 126, in train
    optimizer = torch.optim.Adam(self.parameters())
                                 ^^^^^^^^^^^^^^^
AttributeError: 'LSTMRegimeClassifier' object has no attribute 'parameters'
2025-04-17 21:50:07,587 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 5 regimes
2025-04-17 21:50:07,587 - INFO - Initializing strategy...
2025-04-17 21:50:07,587 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 21:50:07,588 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:07,589 - INFO - Initialized LSTMRegimeClassifier with 5 regimes
2025-04-17 21:50:07,589 - INFO - Running strategy...
2025-04-17 21:50:07,589 - INFO - Starting strategy execution...
2025-04-17 21:50:07,589 - INFO - Preparing training and testing data...
2025-04-17 21:50:07,589 - INFO - Starting data preparation...
2025-04-17 21:50:07,589 - INFO - Loading Fama-French factors...
2025-04-17 21:50:07,602 - INFO - Fama-French factors loaded
2025-04-17 21:50:07,602 - INFO - Processing factor data...
2025-04-17 21:50:07,605 - INFO - Factor data processed
2025-04-17 21:50:07,605 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:07,605 - INFO - 
Training Period:
2025-04-17 21:50:07,611 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:07,620 - INFO - 
Testing Period:
2025-04-17 21:50:07,625 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:07,636 - INFO - Loading macro and market data...
2025-04-17 21:50:07,637 - INFO - Loading existing macro data...
2025-04-17 21:50:07,640 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:07,641 - INFO - Loading existing macro data...
2025-04-17 21:50:07,651 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:07,652 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:07,655 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:07,655 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:07,656 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:07,657 - INFO - Loading existing market data...
2025-04-17 21:50:07,661 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:07,662 - INFO - Loading existing market data...
2025-04-17 21:50:07,666 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:07,666 - INFO - Macro and market data loaded
2025-04-17 21:50:07,666 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:07,666 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:07,667 - INFO - Loading existing macro data...
2025-04-17 21:50:07,678 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:07,678 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:07,681 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:07,681 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:07,681 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:07,682 - INFO - Loading existing market data...
2025-04-17 21:50:07,685 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:07,693 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:07,694 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:07,694 - INFO - Training data prepared
2025-04-17 21:50:07,694 - INFO - Storing data...
2025-04-17 21:50:07,694 - INFO - Aligning data indices...
2025-04-17 21:50:07,696 - INFO - Data indices aligned
2025-04-17 21:50:07,696 - INFO - Data preparation completed
2025-04-17 21:50:07,696 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:07,696 - INFO - Training models...
2025-04-17 21:50:07,697 - INFO - Starting model training...
2025-04-17 21:50:07,697 - INFO - Training regime classifier...
2025-04-17 21:50:07,697 - INFO - Training LSTM model...
2025-04-17 21:50:07,697 - INFO - Preparing features...
2025-04-17 21:50:07,697 - INFO - Input shape: (1536, 6)
2025-04-17 21:50:07,697 - INFO - Handling missing values...
2025-04-17 21:50:07,699 - INFO - Missing values: 0 -> 0
2025-04-17 21:50:07,699 - INFO - Scaling features...
2025-04-17 21:50:07,700 - INFO - Fitted new scaler
2025-04-17 21:50:07,701 - INFO - Output shape: (1536, 6)
2025-04-17 21:50:07,701 - ERROR - Error running lstm with regime_aware and 5 regimes: 'LSTMRegimeClassifier' object has no attribute 'parameters'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 62, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 245, in run_strategy
    training_metrics = self.train_models()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 187, in train_models
    self.regime_classifier.train(train_X, train_y)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 126, in train
    optimizer = torch.optim.Adam(self.parameters())
                                 ^^^^^^^^^^^^^^^
AttributeError: 'LSTMRegimeClassifier' object has no attribute 'parameters'
2025-04-17 21:50:07,702 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 7 regimes
2025-04-17 21:50:07,702 - INFO - Initializing strategy...
2025-04-17 21:50:07,703 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 21:50:07,703 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:07,705 - INFO - Initialized LSTMRegimeClassifier with 5 regimes
2025-04-17 21:50:07,705 - INFO - Running strategy...
2025-04-17 21:50:07,706 - INFO - Starting strategy execution...
2025-04-17 21:50:07,706 - INFO - Preparing training and testing data...
2025-04-17 21:50:07,706 - INFO - Starting data preparation...
2025-04-17 21:50:07,706 - INFO - Loading Fama-French factors...
2025-04-17 21:50:07,719 - INFO - Fama-French factors loaded
2025-04-17 21:50:07,719 - INFO - Processing factor data...
2025-04-17 21:50:07,722 - INFO - Factor data processed
2025-04-17 21:50:07,722 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:07,723 - INFO - 
Training Period:
2025-04-17 21:50:07,729 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:07,738 - INFO - 
Testing Period:
2025-04-17 21:50:07,744 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:07,754 - INFO - Loading macro and market data...
2025-04-17 21:50:07,755 - INFO - Loading existing macro data...
2025-04-17 21:50:07,759 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:07,760 - INFO - Loading existing macro data...
2025-04-17 21:50:07,771 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:07,771 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:07,775 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:07,775 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:07,776 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:07,777 - INFO - Loading existing market data...
2025-04-17 21:50:07,781 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:07,782 - INFO - Loading existing market data...
2025-04-17 21:50:07,785 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:07,785 - INFO - Macro and market data loaded
2025-04-17 21:50:07,785 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:07,786 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:07,787 - INFO - Loading existing macro data...
2025-04-17 21:50:07,799 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:07,799 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:07,802 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:07,802 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:07,802 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:07,803 - INFO - Loading existing market data...
2025-04-17 21:50:07,806 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:07,815 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:07,816 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:07,816 - INFO - Training data prepared
2025-04-17 21:50:07,816 - INFO - Storing data...
2025-04-17 21:50:07,816 - INFO - Aligning data indices...
2025-04-17 21:50:07,817 - INFO - Data indices aligned
2025-04-17 21:50:07,817 - INFO - Data preparation completed
2025-04-17 21:50:07,818 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:07,818 - INFO - Training models...
2025-04-17 21:50:07,818 - INFO - Starting model training...
2025-04-17 21:50:07,818 - INFO - Training regime classifier...
2025-04-17 21:50:07,818 - INFO - Training LSTM model...
2025-04-17 21:50:07,818 - INFO - Preparing features...
2025-04-17 21:50:07,819 - INFO - Input shape: (1536, 6)
2025-04-17 21:50:07,819 - INFO - Handling missing values...
2025-04-17 21:50:07,820 - INFO - Missing values: 0 -> 0
2025-04-17 21:50:07,820 - INFO - Scaling features...
2025-04-17 21:50:07,821 - INFO - Fitted new scaler
2025-04-17 21:50:07,822 - INFO - Output shape: (1536, 6)
2025-04-17 21:50:07,823 - ERROR - Error running lstm with regime_aware and 7 regimes: 'LSTMRegimeClassifier' object has no attribute 'parameters'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 62, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 245, in run_strategy
    training_metrics = self.train_models()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 187, in train_models
    self.regime_classifier.train(train_X, train_y)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 126, in train
    optimizer = torch.optim.Adam(self.parameters())
                                 ^^^^^^^^^^^^^^^
AttributeError: 'LSTMRegimeClassifier' object has no attribute 'parameters'
2025-04-17 21:50:07,824 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 3 regimes
2025-04-17 21:50:07,824 - INFO - Initializing strategy...
2025-04-17 21:50:07,824 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 21:50:07,825 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:07,825 - INFO - Initialized LSTMRegimeClassifier with 5 regimes
2025-04-17 21:50:07,826 - ERROR - Error running lstm with neural_regime and 3 regimes: 'FactorTimingStrategy' object has no attribute 'factor_columns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 42, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 39, in __init__
    self.portfolio_optimizer = self._init_portfolio_optimizer(optimizer_type)
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 68, in _init_portfolio_optimizer
    input_size=len(self.factor_columns),
                   ^^^^^^^^^^^^^^^^^^^
AttributeError: 'FactorTimingStrategy' object has no attribute 'factor_columns'
2025-04-17 21:50:07,827 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 5 regimes
2025-04-17 21:50:07,827 - INFO - Initializing strategy...
2025-04-17 21:50:07,827 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 21:50:07,827 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:07,829 - INFO - Initialized LSTMRegimeClassifier with 5 regimes
2025-04-17 21:50:07,829 - ERROR - Error running lstm with neural_regime and 5 regimes: 'FactorTimingStrategy' object has no attribute 'factor_columns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 42, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 39, in __init__
    self.portfolio_optimizer = self._init_portfolio_optimizer(optimizer_type)
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 68, in _init_portfolio_optimizer
    input_size=len(self.factor_columns),
                   ^^^^^^^^^^^^^^^^^^^
AttributeError: 'FactorTimingStrategy' object has no attribute 'factor_columns'
2025-04-17 21:50:07,830 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 7 regimes
2025-04-17 21:50:07,830 - INFO - Initializing strategy...
2025-04-17 21:50:07,830 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 21:50:07,831 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:07,831 - INFO - Initialized LSTMRegimeClassifier with 5 regimes
2025-04-17 21:50:07,832 - ERROR - Error running lstm with neural_regime and 7 regimes: 'FactorTimingStrategy' object has no attribute 'factor_columns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 42, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 39, in __init__
    self.portfolio_optimizer = self._init_portfolio_optimizer(optimizer_type)
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 68, in _init_portfolio_optimizer
    input_size=len(self.factor_columns),
                   ^^^^^^^^^^^^^^^^^^^
AttributeError: 'FactorTimingStrategy' object has no attribute 'factor_columns'
2025-04-17 21:50:07,833 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 21:50:07,833 - INFO - Initializing strategy...
2025-04-17 21:50:07,833 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 21:50:07,833 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:07,834 - INFO - Initialized LSTMRegimeClassifier with 5 regimes
2025-04-17 21:50:07,834 - ERROR - Error running lstm with autoencoder_regime and 3 regimes: 'FactorTimingStrategy' object has no attribute 'factor_columns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 42, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 39, in __init__
    self.portfolio_optimizer = self._init_portfolio_optimizer(optimizer_type)
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 75, in _init_portfolio_optimizer
    input_size=len(self.factor_columns),
                   ^^^^^^^^^^^^^^^^^^^
AttributeError: 'FactorTimingStrategy' object has no attribute 'factor_columns'
2025-04-17 21:50:07,835 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 21:50:07,835 - INFO - Initializing strategy...
2025-04-17 21:50:07,835 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 21:50:07,836 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:07,837 - INFO - Initialized LSTMRegimeClassifier with 5 regimes
2025-04-17 21:50:07,837 - ERROR - Error running lstm with autoencoder_regime and 5 regimes: 'FactorTimingStrategy' object has no attribute 'factor_columns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 42, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 39, in __init__
    self.portfolio_optimizer = self._init_portfolio_optimizer(optimizer_type)
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 75, in _init_portfolio_optimizer
    input_size=len(self.factor_columns),
                   ^^^^^^^^^^^^^^^^^^^
AttributeError: 'FactorTimingStrategy' object has no attribute 'factor_columns'
2025-04-17 21:50:07,838 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 21:50:07,838 - INFO - Initializing strategy...
2025-04-17 21:50:07,838 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 21:50:07,838 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:07,839 - INFO - Initialized LSTMRegimeClassifier with 5 regimes
2025-04-17 21:50:07,839 - ERROR - Error running lstm with autoencoder_regime and 7 regimes: 'FactorTimingStrategy' object has no attribute 'factor_columns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 42, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 39, in __init__
    self.portfolio_optimizer = self._init_portfolio_optimizer(optimizer_type)
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 75, in _init_portfolio_optimizer
    input_size=len(self.factor_columns),
                   ^^^^^^^^^^^^^^^^^^^
AttributeError: 'FactorTimingStrategy' object has no attribute 'factor_columns'
2025-04-17 21:50:07,840 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 3 regimes
2025-04-17 21:50:07,841 - INFO - Initializing strategy...
2025-04-17 21:50:07,841 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 21:50:07,841 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:07,842 - INFO - Initialized LSTMRegimeClassifier with 5 regimes
2025-04-17 21:50:08,948 - INFO - Running strategy...
2025-04-17 21:50:08,949 - INFO - Starting strategy execution...
2025-04-17 21:50:08,949 - INFO - Preparing training and testing data...
2025-04-17 21:50:08,949 - INFO - Starting data preparation...
2025-04-17 21:50:08,949 - INFO - Loading Fama-French factors...
2025-04-17 21:50:08,967 - INFO - Fama-French factors loaded
2025-04-17 21:50:08,968 - INFO - Processing factor data...
2025-04-17 21:50:08,972 - INFO - Factor data processed
2025-04-17 21:50:08,972 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:08,972 - INFO - 
Training Period:
2025-04-17 21:50:08,980 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:08,991 - INFO - 
Testing Period:
2025-04-17 21:50:08,997 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:09,006 - INFO - Loading macro and market data...
2025-04-17 21:50:09,007 - INFO - Loading existing macro data...
2025-04-17 21:50:09,012 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:09,013 - INFO - Loading existing macro data...
2025-04-17 21:50:09,027 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:09,028 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:09,031 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:09,032 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:09,032 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:09,034 - INFO - Loading existing market data...
2025-04-17 21:50:09,039 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:09,040 - INFO - Loading existing market data...
2025-04-17 21:50:09,044 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:09,044 - INFO - Macro and market data loaded
2025-04-17 21:50:09,044 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:09,044 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:09,046 - INFO - Loading existing macro data...
2025-04-17 21:50:09,058 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:09,058 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:09,061 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:09,062 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:09,062 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:09,063 - INFO - Loading existing market data...
2025-04-17 21:50:09,067 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:09,075 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:09,076 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:09,076 - INFO - Training data prepared
2025-04-17 21:50:09,076 - INFO - Storing data...
2025-04-17 21:50:09,076 - INFO - Aligning data indices...
2025-04-17 21:50:09,078 - INFO - Data indices aligned
2025-04-17 21:50:09,078 - INFO - Data preparation completed
2025-04-17 21:50:09,078 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:09,079 - INFO - Training models...
2025-04-17 21:50:09,079 - INFO - Starting model training...
2025-04-17 21:50:09,079 - INFO - Training regime classifier...
2025-04-17 21:50:09,079 - INFO - Training LSTM model...
2025-04-17 21:50:09,079 - INFO - Preparing features...
2025-04-17 21:50:09,080 - INFO - Input shape: (1536, 6)
2025-04-17 21:50:09,080 - INFO - Handling missing values...
2025-04-17 21:50:09,081 - INFO - Missing values: 0 -> 0
2025-04-17 21:50:09,081 - INFO - Scaling features...
2025-04-17 21:50:09,083 - INFO - Fitted new scaler
2025-04-17 21:50:09,084 - INFO - Output shape: (1536, 6)
2025-04-17 21:50:09,084 - ERROR - Error running lstm with neural and 3 regimes: 'LSTMRegimeClassifier' object has no attribute 'parameters'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 62, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 245, in run_strategy
    training_metrics = self.train_models()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 187, in train_models
    self.regime_classifier.train(train_X, train_y)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 126, in train
    optimizer = torch.optim.Adam(self.parameters())
                                 ^^^^^^^^^^^^^^^
AttributeError: 'LSTMRegimeClassifier' object has no attribute 'parameters'
2025-04-17 21:50:09,086 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 5 regimes
2025-04-17 21:50:09,086 - INFO - Initializing strategy...
2025-04-17 21:50:09,086 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 21:50:09,086 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:09,088 - INFO - Initialized LSTMRegimeClassifier with 5 regimes
2025-04-17 21:50:09,089 - INFO - Running strategy...
2025-04-17 21:50:09,089 - INFO - Starting strategy execution...
2025-04-17 21:50:09,089 - INFO - Preparing training and testing data...
2025-04-17 21:50:09,089 - INFO - Starting data preparation...
2025-04-17 21:50:09,089 - INFO - Loading Fama-French factors...
2025-04-17 21:50:09,101 - INFO - Fama-French factors loaded
2025-04-17 21:50:09,101 - INFO - Processing factor data...
2025-04-17 21:50:09,104 - INFO - Factor data processed
2025-04-17 21:50:09,105 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:09,105 - INFO - 
Training Period:
2025-04-17 21:50:09,110 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:09,120 - INFO - 
Testing Period:
2025-04-17 21:50:09,125 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:09,133 - INFO - Loading macro and market data...
2025-04-17 21:50:09,135 - INFO - Loading existing macro data...
2025-04-17 21:50:09,138 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:09,139 - INFO - Loading existing macro data...
2025-04-17 21:50:09,150 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:09,151 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:09,155 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:09,155 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:09,156 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:09,157 - INFO - Loading existing market data...
2025-04-17 21:50:09,161 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:09,162 - INFO - Loading existing market data...
2025-04-17 21:50:09,166 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:09,166 - INFO - Macro and market data loaded
2025-04-17 21:50:09,166 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:09,166 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:09,167 - INFO - Loading existing macro data...
2025-04-17 21:50:09,181 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:09,181 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:09,184 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:09,185 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:09,185 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:09,186 - INFO - Loading existing market data...
2025-04-17 21:50:09,190 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:09,198 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:09,199 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:09,199 - INFO - Training data prepared
2025-04-17 21:50:09,199 - INFO - Storing data...
2025-04-17 21:50:09,199 - INFO - Aligning data indices...
2025-04-17 21:50:09,200 - INFO - Data indices aligned
2025-04-17 21:50:09,201 - INFO - Data preparation completed
2025-04-17 21:50:09,201 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:09,201 - INFO - Training models...
2025-04-17 21:50:09,201 - INFO - Starting model training...
2025-04-17 21:50:09,201 - INFO - Training regime classifier...
2025-04-17 21:50:09,202 - INFO - Training LSTM model...
2025-04-17 21:50:09,202 - INFO - Preparing features...
2025-04-17 21:50:09,202 - INFO - Input shape: (1536, 6)
2025-04-17 21:50:09,202 - INFO - Handling missing values...
2025-04-17 21:50:09,204 - INFO - Missing values: 0 -> 0
2025-04-17 21:50:09,204 - INFO - Scaling features...
2025-04-17 21:50:09,206 - INFO - Fitted new scaler
2025-04-17 21:50:09,207 - INFO - Output shape: (1536, 6)
2025-04-17 21:50:09,207 - ERROR - Error running lstm with neural and 5 regimes: 'LSTMRegimeClassifier' object has no attribute 'parameters'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 62, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 245, in run_strategy
    training_metrics = self.train_models()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 187, in train_models
    self.regime_classifier.train(train_X, train_y)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 126, in train
    optimizer = torch.optim.Adam(self.parameters())
                                 ^^^^^^^^^^^^^^^
AttributeError: 'LSTMRegimeClassifier' object has no attribute 'parameters'
2025-04-17 21:50:09,209 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 7 regimes
2025-04-17 21:50:09,209 - INFO - Initializing strategy...
2025-04-17 21:50:09,209 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 21:50:09,209 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:09,210 - INFO - Initialized LSTMRegimeClassifier with 5 regimes
2025-04-17 21:50:09,211 - INFO - Running strategy...
2025-04-17 21:50:09,211 - INFO - Starting strategy execution...
2025-04-17 21:50:09,212 - INFO - Preparing training and testing data...
2025-04-17 21:50:09,212 - INFO - Starting data preparation...
2025-04-17 21:50:09,212 - INFO - Loading Fama-French factors...
2025-04-17 21:50:09,223 - INFO - Fama-French factors loaded
2025-04-17 21:50:09,223 - INFO - Processing factor data...
2025-04-17 21:50:09,226 - INFO - Factor data processed
2025-04-17 21:50:09,226 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:09,227 - INFO - 
Training Period:
2025-04-17 21:50:09,232 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:09,242 - INFO - 
Testing Period:
2025-04-17 21:50:09,248 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:09,256 - INFO - Loading macro and market data...
2025-04-17 21:50:09,258 - INFO - Loading existing macro data...
2025-04-17 21:50:09,261 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:09,262 - INFO - Loading existing macro data...
2025-04-17 21:50:09,273 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:09,274 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:09,277 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:09,277 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:09,277 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:09,278 - INFO - Loading existing market data...
2025-04-17 21:50:09,283 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:09,284 - INFO - Loading existing market data...
2025-04-17 21:50:09,288 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:09,288 - INFO - Macro and market data loaded
2025-04-17 21:50:09,288 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:09,288 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:09,289 - INFO - Loading existing macro data...
2025-04-17 21:50:09,301 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:09,301 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:09,304 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:09,304 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:09,304 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:09,305 - INFO - Loading existing market data...
2025-04-17 21:50:09,310 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:09,317 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:09,318 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:09,318 - INFO - Training data prepared
2025-04-17 21:50:09,318 - INFO - Storing data...
2025-04-17 21:50:09,318 - INFO - Aligning data indices...
2025-04-17 21:50:09,320 - INFO - Data indices aligned
2025-04-17 21:50:09,320 - INFO - Data preparation completed
2025-04-17 21:50:09,321 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:09,321 - INFO - Training models...
2025-04-17 21:50:09,321 - INFO - Starting model training...
2025-04-17 21:50:09,321 - INFO - Training regime classifier...
2025-04-17 21:50:09,321 - INFO - Training LSTM model...
2025-04-17 21:50:09,321 - INFO - Preparing features...
2025-04-17 21:50:09,322 - INFO - Input shape: (1536, 6)
2025-04-17 21:50:09,322 - INFO - Handling missing values...
2025-04-17 21:50:09,323 - INFO - Missing values: 0 -> 0
2025-04-17 21:50:09,323 - INFO - Scaling features...
2025-04-17 21:50:09,325 - INFO - Fitted new scaler
2025-04-17 21:50:09,326 - INFO - Output shape: (1536, 6)
2025-04-17 21:50:09,326 - ERROR - Error running lstm with neural and 7 regimes: 'LSTMRegimeClassifier' object has no attribute 'parameters'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 62, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 245, in run_strategy
    training_metrics = self.train_models()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 187, in train_models
    self.regime_classifier.train(train_X, train_y)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 126, in train
    optimizer = torch.optim.Adam(self.parameters())
                                 ^^^^^^^^^^^^^^^
AttributeError: 'LSTMRegimeClassifier' object has no attribute 'parameters'
2025-04-17 21:50:09,327 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 3 regimes
2025-04-17 21:50:09,327 - INFO - Initializing strategy...
2025-04-17 21:50:09,327 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 21:50:09,327 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:09,351 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:50:09,351 - INFO - Running strategy...
2025-04-17 21:50:09,351 - INFO - Starting strategy execution...
2025-04-17 21:50:09,352 - INFO - Preparing training and testing data...
2025-04-17 21:50:09,352 - INFO - Starting data preparation...
2025-04-17 21:50:09,352 - INFO - Loading Fama-French factors...
2025-04-17 21:50:09,367 - INFO - Fama-French factors loaded
2025-04-17 21:50:09,367 - INFO - Processing factor data...
2025-04-17 21:50:09,370 - INFO - Factor data processed
2025-04-17 21:50:09,370 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:09,370 - INFO - 
Training Period:
2025-04-17 21:50:09,377 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:09,387 - INFO - 
Testing Period:
2025-04-17 21:50:09,393 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:09,402 - INFO - Loading macro and market data...
2025-04-17 21:50:09,404 - INFO - Loading existing macro data...
2025-04-17 21:50:09,408 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:09,409 - INFO - Loading existing macro data...
2025-04-17 21:50:09,420 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:09,421 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:09,424 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:09,424 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:09,425 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:09,426 - INFO - Loading existing market data...
2025-04-17 21:50:09,429 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:09,430 - INFO - Loading existing market data...
2025-04-17 21:50:09,433 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:09,433 - INFO - Macro and market data loaded
2025-04-17 21:50:09,433 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:09,433 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:09,434 - INFO - Loading existing macro data...
2025-04-17 21:50:09,444 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:09,444 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:09,448 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:09,448 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:09,449 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:09,450 - INFO - Loading existing market data...
2025-04-17 21:50:09,453 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:09,462 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:09,462 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:09,463 - INFO - Training data prepared
2025-04-17 21:50:09,463 - INFO - Storing data...
2025-04-17 21:50:09,463 - INFO - Aligning data indices...
2025-04-17 21:50:09,464 - INFO - Data indices aligned
2025-04-17 21:50:09,464 - INFO - Data preparation completed
2025-04-17 21:50:09,464 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:09,465 - INFO - Training models...
2025-04-17 21:50:09,465 - INFO - Starting model training...
2025-04-17 21:50:09,465 - INFO - Training regime classifier...
2025-04-17 21:50:09,465 - INFO - Training XGBoost model...
2025-04-17 21:50:09,465 - INFO - Preparing features...
2025-04-17 21:50:09,466 - INFO - Input shape: (1536, 6)
2025-04-17 21:50:09,466 - INFO - Handling missing values...
2025-04-17 21:50:09,467 - INFO - Missing values: 0 -> 0
2025-04-17 21:50:09,467 - INFO - Scaling features...
2025-04-17 21:50:09,469 - INFO - Fitted new scaler
2025-04-17 21:50:09,470 - INFO - Output shape: (1536, 6)
2025-04-17 21:50:10,795 - INFO - XGBoost model training completed
2025-04-17 21:50:11,148 - INFO - Model training completed
2025-04-17 21:50:11,150 - INFO - Model training completed
2025-04-17 21:50:11,150 - INFO - Initializing portfolio weights...
2025-04-17 21:50:11,151 - INFO - Portfolio weights initialized
2025-04-17 21:50:11,151 - INFO - Generating regime predictions for test period...
2025-04-17 21:50:11,154 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:50:11,157 - INFO - Generated 41 regime predictions
2025-04-17 21:50:11,158 - INFO - Calculating regime-specific returns...
2025-04-17 21:50:11,163 - INFO - Found 5 unique regimes
2025-04-17 21:50:11,163 - INFO - Processing regime 0...
2025-04-17 21:50:11,165 - INFO - Regime 0: 16 samples
2025-04-17 21:50:11,165 - INFO - Processing regime 1...
2025-04-17 21:50:11,166 - INFO - Regime 1: 6 samples
2025-04-17 21:50:11,166 - INFO - Processing regime 2...
2025-04-17 21:50:11,167 - INFO - Regime 2: 6 samples
2025-04-17 21:50:11,168 - INFO - Processing regime 3...
2025-04-17 21:50:11,169 - INFO - Regime 3: 8 samples
2025-04-17 21:50:11,169 - INFO - Processing regime 4...
2025-04-17 21:50:11,170 - INFO - Regime 4: 9 samples
2025-04-17 21:50:11,171 - INFO - Training portfolio optimizer...
2025-04-17 21:50:11,171 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:11,171 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:11,171 - INFO - Portfolio optimizer training completed
2025-04-17 21:50:11,171 - INFO - Optimizing portfolio weights...
2025-04-17 21:50:11,178 - WARNING - All weights are zero, using equal weights
2025-04-17 21:50:11,220 - INFO - Portfolio optimization completed
2025-04-17 21:50:11,220 - INFO - Initializing backtester...
2025-04-17 21:50:11,232 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:50:11,232 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:50:11,232 - INFO - Running backtest...
2025-04-17 21:50:11,233 - INFO - Starting backtest...
2025-04-17 21:50:11,233 - INFO - Calculating portfolio returns...
2025-04-17 21:50:11,233 - INFO - Calculating portfolio returns...
2025-04-17 21:50:11,235 - INFO - Calculated 41 portfolio returns
2025-04-17 21:50:11,235 - INFO - Calculating performance metrics...
2025-04-17 21:50:11,235 - INFO - Starting performance metrics calculation...
2025-04-17 21:50:11,236 - INFO - Calculating metrics...
2025-04-17 21:50:11,239 - INFO - Performance metrics calculation completed
2025-04-17 21:50:11,240 - INFO - Backtest completed
2025-04-17 21:50:11,240 - INFO - Backtest completed
2025-04-17 21:50:11,241 - INFO - Strategy execution completed
2025-04-17 21:50:11,241 - INFO - Plotting results...
2025-04-17 21:50:11,242 - INFO - Starting to plot results...
2025-04-17 21:50:11,242 - INFO - Starting to plot results...
2025-04-17 21:50:11,649 - INFO - Plot completed
2025-04-17 21:50:11,650 - INFO - Plot completed
2025-04-17 21:50:11,779 - INFO - Successfully completed run for xgboost with mean_variance and 3 regimes
2025-04-17 21:50:11,779 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 5 regimes
2025-04-17 21:50:11,779 - INFO - Initializing strategy...
2025-04-17 21:50:11,780 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 21:50:11,780 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:11,780 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:50:11,781 - INFO - Running strategy...
2025-04-17 21:50:11,781 - INFO - Starting strategy execution...
2025-04-17 21:50:11,781 - INFO - Preparing training and testing data...
2025-04-17 21:50:11,781 - INFO - Starting data preparation...
2025-04-17 21:50:11,781 - INFO - Loading Fama-French factors...
2025-04-17 21:50:11,792 - INFO - Fama-French factors loaded
2025-04-17 21:50:11,792 - INFO - Processing factor data...
2025-04-17 21:50:11,796 - INFO - Factor data processed
2025-04-17 21:50:11,796 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:11,797 - INFO - 
Training Period:
2025-04-17 21:50:11,802 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:11,811 - INFO - 
Testing Period:
2025-04-17 21:50:11,817 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:11,825 - INFO - Loading macro and market data...
2025-04-17 21:50:11,827 - INFO - Loading existing macro data...
2025-04-17 21:50:11,831 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:11,832 - INFO - Loading existing macro data...
2025-04-17 21:50:11,842 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:11,842 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:11,845 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:11,846 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:11,846 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:11,847 - INFO - Loading existing market data...
2025-04-17 21:50:11,851 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:11,852 - INFO - Loading existing market data...
2025-04-17 21:50:11,855 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:11,855 - INFO - Macro and market data loaded
2025-04-17 21:50:11,856 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:11,856 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:11,857 - INFO - Loading existing macro data...
2025-04-17 21:50:11,867 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:11,867 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:11,871 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:11,871 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:11,871 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:11,873 - INFO - Loading existing market data...
2025-04-17 21:50:11,878 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:11,891 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:11,891 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:11,892 - INFO - Training data prepared
2025-04-17 21:50:11,892 - INFO - Storing data...
2025-04-17 21:50:11,892 - INFO - Aligning data indices...
2025-04-17 21:50:11,894 - INFO - Data indices aligned
2025-04-17 21:50:11,894 - INFO - Data preparation completed
2025-04-17 21:50:11,894 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:11,894 - INFO - Training models...
2025-04-17 21:50:11,894 - INFO - Starting model training...
2025-04-17 21:50:11,895 - INFO - Training regime classifier...
2025-04-17 21:50:11,895 - INFO - Training XGBoost model...
2025-04-17 21:50:11,895 - INFO - Preparing features...
2025-04-17 21:50:11,895 - INFO - Input shape: (1536, 6)
2025-04-17 21:50:11,896 - INFO - Handling missing values...
2025-04-17 21:50:11,897 - INFO - Missing values: 0 -> 0
2025-04-17 21:50:11,897 - INFO - Scaling features...
2025-04-17 21:50:11,899 - INFO - Fitted new scaler
2025-04-17 21:50:11,900 - INFO - Output shape: (1536, 6)
2025-04-17 21:50:11,998 - INFO - XGBoost model training completed
2025-04-17 21:50:12,262 - INFO - Model training completed
2025-04-17 21:50:12,265 - INFO - Model training completed
2025-04-17 21:50:12,265 - INFO - Initializing portfolio weights...
2025-04-17 21:50:12,265 - INFO - Portfolio weights initialized
2025-04-17 21:50:12,266 - INFO - Generating regime predictions for test period...
2025-04-17 21:50:12,268 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:50:12,270 - INFO - Generated 41 regime predictions
2025-04-17 21:50:12,270 - INFO - Calculating regime-specific returns...
2025-04-17 21:50:12,275 - INFO - Found 5 unique regimes
2025-04-17 21:50:12,275 - INFO - Processing regime 0...
2025-04-17 21:50:12,276 - INFO - Regime 0: 16 samples
2025-04-17 21:50:12,277 - INFO - Processing regime 1...
2025-04-17 21:50:12,278 - INFO - Regime 1: 6 samples
2025-04-17 21:50:12,278 - INFO - Processing regime 2...
2025-04-17 21:50:12,279 - INFO - Regime 2: 6 samples
2025-04-17 21:50:12,280 - INFO - Processing regime 3...
2025-04-17 21:50:12,281 - INFO - Regime 3: 8 samples
2025-04-17 21:50:12,281 - INFO - Processing regime 4...
2025-04-17 21:50:12,282 - INFO - Regime 4: 9 samples
2025-04-17 21:50:12,282 - INFO - Training portfolio optimizer...
2025-04-17 21:50:12,282 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:12,283 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:12,283 - INFO - Portfolio optimizer training completed
2025-04-17 21:50:12,283 - INFO - Optimizing portfolio weights...
2025-04-17 21:50:12,284 - WARNING - All weights are zero, using equal weights
2025-04-17 21:50:12,323 - INFO - Portfolio optimization completed
2025-04-17 21:50:12,323 - INFO - Initializing backtester...
2025-04-17 21:50:12,333 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:50:12,334 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:50:12,334 - INFO - Running backtest...
2025-04-17 21:50:12,334 - INFO - Starting backtest...
2025-04-17 21:50:12,334 - INFO - Calculating portfolio returns...
2025-04-17 21:50:12,334 - INFO - Calculating portfolio returns...
2025-04-17 21:50:12,336 - INFO - Calculated 41 portfolio returns
2025-04-17 21:50:12,336 - INFO - Calculating performance metrics...
2025-04-17 21:50:12,337 - INFO - Starting performance metrics calculation...
2025-04-17 21:50:12,337 - INFO - Calculating metrics...
2025-04-17 21:50:12,341 - INFO - Performance metrics calculation completed
2025-04-17 21:50:12,341 - INFO - Backtest completed
2025-04-17 21:50:12,341 - INFO - Backtest completed
2025-04-17 21:50:12,342 - INFO - Strategy execution completed
2025-04-17 21:50:12,343 - INFO - Plotting results...
2025-04-17 21:50:12,343 - INFO - Starting to plot results...
2025-04-17 21:50:12,343 - INFO - Starting to plot results...
2025-04-17 21:50:12,680 - INFO - Plot completed
2025-04-17 21:50:12,680 - INFO - Plot completed
2025-04-17 21:50:12,798 - INFO - Successfully completed run for xgboost with mean_variance and 5 regimes
2025-04-17 21:50:12,798 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 7 regimes
2025-04-17 21:50:12,799 - INFO - Initializing strategy...
2025-04-17 21:50:12,799 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 21:50:12,799 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:12,800 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:50:12,801 - INFO - Running strategy...
2025-04-17 21:50:12,801 - INFO - Starting strategy execution...
2025-04-17 21:50:12,801 - INFO - Preparing training and testing data...
2025-04-17 21:50:12,801 - INFO - Starting data preparation...
2025-04-17 21:50:12,802 - INFO - Loading Fama-French factors...
2025-04-17 21:50:12,813 - INFO - Fama-French factors loaded
2025-04-17 21:50:12,813 - INFO - Processing factor data...
2025-04-17 21:50:12,816 - INFO - Factor data processed
2025-04-17 21:50:12,816 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:12,816 - INFO - 
Training Period:
2025-04-17 21:50:12,821 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:12,829 - INFO - 
Testing Period:
2025-04-17 21:50:12,833 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:12,843 - INFO - Loading macro and market data...
2025-04-17 21:50:12,844 - INFO - Loading existing macro data...
2025-04-17 21:50:12,847 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:12,848 - INFO - Loading existing macro data...
2025-04-17 21:50:12,857 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:12,858 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:12,861 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:12,861 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:12,862 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:12,863 - INFO - Loading existing market data...
2025-04-17 21:50:12,867 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:12,868 - INFO - Loading existing market data...
2025-04-17 21:50:12,871 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:12,872 - INFO - Macro and market data loaded
2025-04-17 21:50:12,872 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:12,872 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:12,873 - INFO - Loading existing macro data...
2025-04-17 21:50:12,883 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:12,884 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:12,887 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:12,887 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:12,888 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:12,889 - INFO - Loading existing market data...
2025-04-17 21:50:12,894 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:12,904 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:12,905 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:12,906 - INFO - Training data prepared
2025-04-17 21:50:12,906 - INFO - Storing data...
2025-04-17 21:50:12,906 - INFO - Aligning data indices...
2025-04-17 21:50:12,908 - INFO - Data indices aligned
2025-04-17 21:50:12,908 - INFO - Data preparation completed
2025-04-17 21:50:12,908 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:12,908 - INFO - Training models...
2025-04-17 21:50:12,908 - INFO - Starting model training...
2025-04-17 21:50:12,908 - INFO - Training regime classifier...
2025-04-17 21:50:12,909 - INFO - Training XGBoost model...
2025-04-17 21:50:12,909 - INFO - Preparing features...
2025-04-17 21:50:12,909 - INFO - Input shape: (1536, 6)
2025-04-17 21:50:12,909 - INFO - Handling missing values...
2025-04-17 21:50:12,911 - INFO - Missing values: 0 -> 0
2025-04-17 21:50:12,911 - INFO - Scaling features...
2025-04-17 21:50:12,913 - INFO - Fitted new scaler
2025-04-17 21:50:12,914 - INFO - Output shape: (1536, 6)
2025-04-17 21:50:13,029 - INFO - XGBoost model training completed
2025-04-17 21:50:13,304 - INFO - Model training completed
2025-04-17 21:50:13,305 - INFO - Model training completed
2025-04-17 21:50:13,306 - INFO - Initializing portfolio weights...
2025-04-17 21:50:13,306 - INFO - Portfolio weights initialized
2025-04-17 21:50:13,306 - INFO - Generating regime predictions for test period...
2025-04-17 21:50:13,308 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:50:13,310 - INFO - Generated 41 regime predictions
2025-04-17 21:50:13,310 - INFO - Calculating regime-specific returns...
2025-04-17 21:50:13,314 - INFO - Found 5 unique regimes
2025-04-17 21:50:13,315 - INFO - Processing regime 0...
2025-04-17 21:50:13,316 - INFO - Regime 0: 16 samples
2025-04-17 21:50:13,316 - INFO - Processing regime 1...
2025-04-17 21:50:13,317 - INFO - Regime 1: 6 samples
2025-04-17 21:50:13,317 - INFO - Processing regime 2...
2025-04-17 21:50:13,318 - INFO - Regime 2: 6 samples
2025-04-17 21:50:13,319 - INFO - Processing regime 3...
2025-04-17 21:50:13,320 - INFO - Regime 3: 8 samples
2025-04-17 21:50:13,320 - INFO - Processing regime 4...
2025-04-17 21:50:13,321 - INFO - Regime 4: 9 samples
2025-04-17 21:50:13,321 - INFO - Training portfolio optimizer...
2025-04-17 21:50:13,322 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:13,322 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:13,322 - INFO - Portfolio optimizer training completed
2025-04-17 21:50:13,322 - INFO - Optimizing portfolio weights...
2025-04-17 21:50:13,324 - WARNING - All weights are zero, using equal weights
2025-04-17 21:50:13,360 - INFO - Portfolio optimization completed
2025-04-17 21:50:13,360 - INFO - Initializing backtester...
2025-04-17 21:50:13,370 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:50:13,371 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:50:13,371 - INFO - Running backtest...
2025-04-17 21:50:13,371 - INFO - Starting backtest...
2025-04-17 21:50:13,371 - INFO - Calculating portfolio returns...
2025-04-17 21:50:13,372 - INFO - Calculating portfolio returns...
2025-04-17 21:50:13,373 - INFO - Calculated 41 portfolio returns
2025-04-17 21:50:13,374 - INFO - Calculating performance metrics...
2025-04-17 21:50:13,374 - INFO - Starting performance metrics calculation...
2025-04-17 21:50:13,374 - INFO - Calculating metrics...
2025-04-17 21:50:13,377 - INFO - Performance metrics calculation completed
2025-04-17 21:50:13,378 - INFO - Backtest completed
2025-04-17 21:50:13,378 - INFO - Backtest completed
2025-04-17 21:50:13,379 - INFO - Strategy execution completed
2025-04-17 21:50:13,379 - INFO - Plotting results...
2025-04-17 21:50:13,379 - INFO - Starting to plot results...
2025-04-17 21:50:13,380 - INFO - Starting to plot results...
2025-04-17 21:50:13,720 - INFO - Plot completed
2025-04-17 21:50:13,721 - INFO - Plot completed
2025-04-17 21:50:13,857 - INFO - Successfully completed run for xgboost with mean_variance and 7 regimes
2025-04-17 21:50:13,858 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 3 regimes
2025-04-17 21:50:13,858 - INFO - Initializing strategy...
2025-04-17 21:50:13,858 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 21:50:13,858 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:13,859 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:50:13,859 - INFO - Running strategy...
2025-04-17 21:50:13,860 - INFO - Starting strategy execution...
2025-04-17 21:50:13,860 - INFO - Preparing training and testing data...
2025-04-17 21:50:13,860 - INFO - Starting data preparation...
2025-04-17 21:50:13,860 - INFO - Loading Fama-French factors...
2025-04-17 21:50:13,869 - INFO - Fama-French factors loaded
2025-04-17 21:50:13,870 - INFO - Processing factor data...
2025-04-17 21:50:13,872 - INFO - Factor data processed
2025-04-17 21:50:13,872 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:13,873 - INFO - 
Training Period:
2025-04-17 21:50:13,878 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:13,886 - INFO - 
Testing Period:
2025-04-17 21:50:13,891 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:13,900 - INFO - Loading macro and market data...
2025-04-17 21:50:13,901 - INFO - Loading existing macro data...
2025-04-17 21:50:13,904 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:13,905 - INFO - Loading existing macro data...
2025-04-17 21:50:13,915 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:13,915 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:13,918 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:13,919 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:13,919 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:13,921 - INFO - Loading existing market data...
2025-04-17 21:50:13,925 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:13,926 - INFO - Loading existing market data...
2025-04-17 21:50:13,929 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:13,929 - INFO - Macro and market data loaded
2025-04-17 21:50:13,930 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:13,930 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:13,931 - INFO - Loading existing macro data...
2025-04-17 21:50:13,941 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:13,942 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:13,945 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:13,945 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:13,945 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:13,947 - INFO - Loading existing market data...
2025-04-17 21:50:13,951 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:13,963 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:13,963 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:13,964 - INFO - Training data prepared
2025-04-17 21:50:13,964 - INFO - Storing data...
2025-04-17 21:50:13,964 - INFO - Aligning data indices...
2025-04-17 21:50:13,965 - INFO - Data indices aligned
2025-04-17 21:50:13,966 - INFO - Data preparation completed
2025-04-17 21:50:13,966 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:13,966 - INFO - Training models...
2025-04-17 21:50:13,966 - INFO - Starting model training...
2025-04-17 21:50:13,967 - INFO - Training regime classifier...
2025-04-17 21:50:13,967 - INFO - Training XGBoost model...
2025-04-17 21:50:13,967 - INFO - Preparing features...
2025-04-17 21:50:13,967 - INFO - Input shape: (1536, 6)
2025-04-17 21:50:13,968 - INFO - Handling missing values...
2025-04-17 21:50:13,969 - INFO - Missing values: 0 -> 0
2025-04-17 21:50:13,969 - INFO - Scaling features...
2025-04-17 21:50:13,970 - INFO - Fitted new scaler
2025-04-17 21:50:13,971 - INFO - Output shape: (1536, 6)
2025-04-17 21:50:14,066 - INFO - XGBoost model training completed
2025-04-17 21:50:14,358 - INFO - Model training completed
2025-04-17 21:50:14,360 - INFO - Model training completed
2025-04-17 21:50:14,360 - INFO - Initializing portfolio weights...
2025-04-17 21:50:14,361 - INFO - Portfolio weights initialized
2025-04-17 21:50:14,361 - INFO - Generating regime predictions for test period...
2025-04-17 21:50:14,362 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:50:14,365 - INFO - Generated 41 regime predictions
2025-04-17 21:50:14,365 - INFO - Calculating regime-specific returns...
2025-04-17 21:50:14,369 - INFO - Found 5 unique regimes
2025-04-17 21:50:14,369 - INFO - Processing regime 0...
2025-04-17 21:50:14,371 - INFO - Regime 0: 16 samples
2025-04-17 21:50:14,371 - INFO - Processing regime 1...
2025-04-17 21:50:14,372 - INFO - Regime 1: 6 samples
2025-04-17 21:50:14,372 - INFO - Processing regime 2...
2025-04-17 21:50:14,373 - INFO - Regime 2: 6 samples
2025-04-17 21:50:14,374 - INFO - Processing regime 3...
2025-04-17 21:50:14,375 - INFO - Regime 3: 8 samples
2025-04-17 21:50:14,375 - INFO - Processing regime 4...
2025-04-17 21:50:14,376 - INFO - Regime 4: 9 samples
2025-04-17 21:50:14,376 - INFO - Training portfolio optimizer...
2025-04-17 21:50:14,376 - INFO - Training regime-aware optimizer...
2025-04-17 21:50:14,377 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:14,377 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:14,377 - INFO - Trained optimizer for regime 0 with 16 samples
2025-04-17 21:50:14,378 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:14,378 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:14,378 - INFO - Trained optimizer for regime 1 with 6 samples
2025-04-17 21:50:14,378 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:14,378 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:14,379 - INFO - Trained optimizer for regime 2 with 6 samples
2025-04-17 21:50:14,379 - INFO - Portfolio optimizer training completed
2025-04-17 21:50:14,379 - INFO - Optimizing portfolio weights...
2025-04-17 21:50:14,379 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:14,380 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 21:50:14,381 - WARNING - All weights are zero, using equal weights
2025-04-17 21:50:14,382 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:14,382 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 21:50:14,383 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:14,384 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,385 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,386 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,388 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,389 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,391 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,392 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,393 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,395 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,396 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,397 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,398 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,400 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,401 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,402 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,403 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,404 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,406 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,407 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,408 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,410 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,411 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,412 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,413 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,415 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,416 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,417 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,418 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,420 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,421 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,422 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,424 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,425 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,427 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,428 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,429 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,431 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,432 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,433 - INFO - Portfolio optimization completed
2025-04-17 21:50:14,433 - INFO - Initializing backtester...
2025-04-17 21:50:14,444 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:50:14,444 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:50:14,445 - INFO - Running backtest...
2025-04-17 21:50:14,445 - INFO - Starting backtest...
2025-04-17 21:50:14,445 - INFO - Calculating portfolio returns...
2025-04-17 21:50:14,446 - INFO - Calculating portfolio returns...
2025-04-17 21:50:14,447 - INFO - Calculated 41 portfolio returns
2025-04-17 21:50:14,448 - INFO - Calculating performance metrics...
2025-04-17 21:50:14,448 - INFO - Starting performance metrics calculation...
2025-04-17 21:50:14,448 - INFO - Calculating metrics...
2025-04-17 21:50:14,451 - INFO - Performance metrics calculation completed
2025-04-17 21:50:14,452 - INFO - Backtest completed
2025-04-17 21:50:14,452 - INFO - Backtest completed
2025-04-17 21:50:14,454 - INFO - Strategy execution completed
2025-04-17 21:50:14,454 - ERROR - Error running xgboost with regime_aware and 3 regimes: 'MeanVarianceOptimizer' object has no attribute 'returns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 76, in run_parameter_grid
    regime_stats = strategy.portfolio_optimizer.get_regime_stats()
  File "C:\Users\ye\Desktop\factor_timing\optimizer\portfolio_optimizer.py", line 178, in get_regime_stats
    'n_samples': len(optimizer.returns),
                     ^^^^^^^^^^^^^^^^^
AttributeError: 'MeanVarianceOptimizer' object has no attribute 'returns'
2025-04-17 21:50:14,455 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 5 regimes
2025-04-17 21:50:14,455 - INFO - Initializing strategy...
2025-04-17 21:50:14,456 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 21:50:14,456 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:14,456 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:50:14,457 - INFO - Running strategy...
2025-04-17 21:50:14,457 - INFO - Starting strategy execution...
2025-04-17 21:50:14,457 - INFO - Preparing training and testing data...
2025-04-17 21:50:14,458 - INFO - Starting data preparation...
2025-04-17 21:50:14,458 - INFO - Loading Fama-French factors...
2025-04-17 21:50:14,474 - INFO - Fama-French factors loaded
2025-04-17 21:50:14,475 - INFO - Processing factor data...
2025-04-17 21:50:14,477 - INFO - Factor data processed
2025-04-17 21:50:14,478 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:14,478 - INFO - 
Training Period:
2025-04-17 21:50:14,482 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:14,490 - INFO - 
Testing Period:
2025-04-17 21:50:14,496 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:14,504 - INFO - Loading macro and market data...
2025-04-17 21:50:14,505 - INFO - Loading existing macro data...
2025-04-17 21:50:14,509 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:14,510 - INFO - Loading existing macro data...
2025-04-17 21:50:14,520 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:14,520 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:14,525 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:14,526 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:14,526 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:14,527 - INFO - Loading existing market data...
2025-04-17 21:50:14,533 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:14,534 - INFO - Loading existing market data...
2025-04-17 21:50:14,539 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:14,539 - INFO - Macro and market data loaded
2025-04-17 21:50:14,539 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:14,540 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:14,541 - INFO - Loading existing macro data...
2025-04-17 21:50:14,552 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:14,553 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:14,556 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:14,556 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:14,557 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:14,558 - INFO - Loading existing market data...
2025-04-17 21:50:14,562 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:14,573 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:14,574 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:14,574 - INFO - Training data prepared
2025-04-17 21:50:14,574 - INFO - Storing data...
2025-04-17 21:50:14,574 - INFO - Aligning data indices...
2025-04-17 21:50:14,576 - INFO - Data indices aligned
2025-04-17 21:50:14,576 - INFO - Data preparation completed
2025-04-17 21:50:14,576 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:14,576 - INFO - Training models...
2025-04-17 21:50:14,576 - INFO - Starting model training...
2025-04-17 21:50:14,577 - INFO - Training regime classifier...
2025-04-17 21:50:14,577 - INFO - Training XGBoost model...
2025-04-17 21:50:14,577 - INFO - Preparing features...
2025-04-17 21:50:14,577 - INFO - Input shape: (1536, 6)
2025-04-17 21:50:14,577 - INFO - Handling missing values...
2025-04-17 21:50:14,579 - INFO - Missing values: 0 -> 0
2025-04-17 21:50:14,579 - INFO - Scaling features...
2025-04-17 21:50:14,580 - INFO - Fitted new scaler
2025-04-17 21:50:14,581 - INFO - Output shape: (1536, 6)
2025-04-17 21:50:14,672 - INFO - XGBoost model training completed
2025-04-17 21:50:14,961 - INFO - Model training completed
2025-04-17 21:50:14,964 - INFO - Model training completed
2025-04-17 21:50:14,964 - INFO - Initializing portfolio weights...
2025-04-17 21:50:14,965 - INFO - Portfolio weights initialized
2025-04-17 21:50:14,965 - INFO - Generating regime predictions for test period...
2025-04-17 21:50:14,967 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:50:14,969 - INFO - Generated 41 regime predictions
2025-04-17 21:50:14,969 - INFO - Calculating regime-specific returns...
2025-04-17 21:50:14,973 - INFO - Found 5 unique regimes
2025-04-17 21:50:14,974 - INFO - Processing regime 0...
2025-04-17 21:50:14,975 - INFO - Regime 0: 16 samples
2025-04-17 21:50:14,975 - INFO - Processing regime 1...
2025-04-17 21:50:14,976 - INFO - Regime 1: 6 samples
2025-04-17 21:50:14,977 - INFO - Processing regime 2...
2025-04-17 21:50:14,978 - INFO - Regime 2: 6 samples
2025-04-17 21:50:14,978 - INFO - Processing regime 3...
2025-04-17 21:50:14,979 - INFO - Regime 3: 8 samples
2025-04-17 21:50:14,979 - INFO - Processing regime 4...
2025-04-17 21:50:14,980 - INFO - Regime 4: 9 samples
2025-04-17 21:50:14,981 - INFO - Training portfolio optimizer...
2025-04-17 21:50:14,981 - INFO - Training regime-aware optimizer...
2025-04-17 21:50:14,981 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:14,981 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:14,982 - INFO - Trained optimizer for regime 0 with 16 samples
2025-04-17 21:50:14,982 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:14,982 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:14,982 - INFO - Trained optimizer for regime 1 with 6 samples
2025-04-17 21:50:14,983 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:14,983 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:14,983 - INFO - Trained optimizer for regime 2 with 6 samples
2025-04-17 21:50:14,983 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:14,984 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:14,984 - INFO - Trained optimizer for regime 3 with 8 samples
2025-04-17 21:50:14,984 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:14,984 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:14,984 - INFO - Trained optimizer for regime 4 with 9 samples
2025-04-17 21:50:14,984 - INFO - Portfolio optimizer training completed
2025-04-17 21:50:14,985 - INFO - Optimizing portfolio weights...
2025-04-17 21:50:14,985 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:14,987 - WARNING - All weights are zero, using equal weights
2025-04-17 21:50:14,987 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:14,988 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:14,990 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,991 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,992 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,993 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,994 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,995 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,996 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,997 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:14,998 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,000 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,001 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,002 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,003 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,004 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,006 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,007 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,009 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,010 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,011 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,013 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,014 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,016 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,017 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,018 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,019 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,021 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,022 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,023 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,025 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,026 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,027 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,028 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,030 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,031 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,032 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,034 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,035 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,036 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,037 - INFO - Portfolio optimization completed
2025-04-17 21:50:15,037 - INFO - Initializing backtester...
2025-04-17 21:50:15,048 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:50:15,048 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:50:15,048 - INFO - Running backtest...
2025-04-17 21:50:15,049 - INFO - Starting backtest...
2025-04-17 21:50:15,049 - INFO - Calculating portfolio returns...
2025-04-17 21:50:15,049 - INFO - Calculating portfolio returns...
2025-04-17 21:50:15,051 - INFO - Calculated 41 portfolio returns
2025-04-17 21:50:15,051 - INFO - Calculating performance metrics...
2025-04-17 21:50:15,051 - INFO - Starting performance metrics calculation...
2025-04-17 21:50:15,052 - INFO - Calculating metrics...
2025-04-17 21:50:15,056 - INFO - Performance metrics calculation completed
2025-04-17 21:50:15,057 - INFO - Backtest completed
2025-04-17 21:50:15,057 - INFO - Backtest completed
2025-04-17 21:50:15,058 - INFO - Strategy execution completed
2025-04-17 21:50:15,058 - ERROR - Error running xgboost with regime_aware and 5 regimes: 'MeanVarianceOptimizer' object has no attribute 'returns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 76, in run_parameter_grid
    regime_stats = strategy.portfolio_optimizer.get_regime_stats()
  File "C:\Users\ye\Desktop\factor_timing\optimizer\portfolio_optimizer.py", line 178, in get_regime_stats
    'n_samples': len(optimizer.returns),
                     ^^^^^^^^^^^^^^^^^
AttributeError: 'MeanVarianceOptimizer' object has no attribute 'returns'
2025-04-17 21:50:15,060 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 7 regimes
2025-04-17 21:50:15,060 - INFO - Initializing strategy...
2025-04-17 21:50:15,060 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 21:50:15,060 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:15,060 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:50:15,061 - INFO - Running strategy...
2025-04-17 21:50:15,062 - INFO - Starting strategy execution...
2025-04-17 21:50:15,062 - INFO - Preparing training and testing data...
2025-04-17 21:50:15,062 - INFO - Starting data preparation...
2025-04-17 21:50:15,062 - INFO - Loading Fama-French factors...
2025-04-17 21:50:15,083 - INFO - Fama-French factors loaded
2025-04-17 21:50:15,083 - INFO - Processing factor data...
2025-04-17 21:50:15,086 - INFO - Factor data processed
2025-04-17 21:50:15,086 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:15,087 - INFO - 
Training Period:
2025-04-17 21:50:15,091 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:15,099 - INFO - 
Testing Period:
2025-04-17 21:50:15,105 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:15,114 - INFO - Loading macro and market data...
2025-04-17 21:50:15,116 - INFO - Loading existing macro data...
2025-04-17 21:50:15,120 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:15,122 - INFO - Loading existing macro data...
2025-04-17 21:50:15,136 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:15,136 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:15,141 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:15,142 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:15,142 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:15,144 - INFO - Loading existing market data...
2025-04-17 21:50:15,149 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:15,150 - INFO - Loading existing market data...
2025-04-17 21:50:15,154 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:15,154 - INFO - Macro and market data loaded
2025-04-17 21:50:15,154 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:15,155 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:15,156 - INFO - Loading existing macro data...
2025-04-17 21:50:15,165 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:15,166 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:15,169 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:15,169 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:15,170 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:15,171 - INFO - Loading existing market data...
2025-04-17 21:50:15,174 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:15,186 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:15,187 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:15,187 - INFO - Training data prepared
2025-04-17 21:50:15,188 - INFO - Storing data...
2025-04-17 21:50:15,188 - INFO - Aligning data indices...
2025-04-17 21:50:15,189 - INFO - Data indices aligned
2025-04-17 21:50:15,190 - INFO - Data preparation completed
2025-04-17 21:50:15,190 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:15,190 - INFO - Training models...
2025-04-17 21:50:15,190 - INFO - Starting model training...
2025-04-17 21:50:15,190 - INFO - Training regime classifier...
2025-04-17 21:50:15,190 - INFO - Training XGBoost model...
2025-04-17 21:50:15,191 - INFO - Preparing features...
2025-04-17 21:50:15,191 - INFO - Input shape: (1536, 6)
2025-04-17 21:50:15,191 - INFO - Handling missing values...
2025-04-17 21:50:15,192 - INFO - Missing values: 0 -> 0
2025-04-17 21:50:15,192 - INFO - Scaling features...
2025-04-17 21:50:15,194 - INFO - Fitted new scaler
2025-04-17 21:50:15,195 - INFO - Output shape: (1536, 6)
2025-04-17 21:50:15,287 - INFO - XGBoost model training completed
2025-04-17 21:50:15,568 - INFO - Model training completed
2025-04-17 21:50:15,570 - INFO - Model training completed
2025-04-17 21:50:15,570 - INFO - Initializing portfolio weights...
2025-04-17 21:50:15,571 - INFO - Portfolio weights initialized
2025-04-17 21:50:15,572 - INFO - Generating regime predictions for test period...
2025-04-17 21:50:15,573 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:50:15,576 - INFO - Generated 41 regime predictions
2025-04-17 21:50:15,576 - INFO - Calculating regime-specific returns...
2025-04-17 21:50:15,581 - INFO - Found 5 unique regimes
2025-04-17 21:50:15,581 - INFO - Processing regime 0...
2025-04-17 21:50:15,582 - INFO - Regime 0: 16 samples
2025-04-17 21:50:15,583 - INFO - Processing regime 1...
2025-04-17 21:50:15,584 - INFO - Regime 1: 6 samples
2025-04-17 21:50:15,584 - INFO - Processing regime 2...
2025-04-17 21:50:15,585 - INFO - Regime 2: 6 samples
2025-04-17 21:50:15,585 - INFO - Processing regime 3...
2025-04-17 21:50:15,586 - INFO - Regime 3: 8 samples
2025-04-17 21:50:15,587 - INFO - Processing regime 4...
2025-04-17 21:50:15,588 - INFO - Regime 4: 9 samples
2025-04-17 21:50:15,588 - INFO - Training portfolio optimizer...
2025-04-17 21:50:15,588 - INFO - Training regime-aware optimizer...
2025-04-17 21:50:15,588 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:15,588 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:15,589 - INFO - Trained optimizer for regime 0 with 16 samples
2025-04-17 21:50:15,589 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:15,589 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:15,589 - INFO - Trained optimizer for regime 1 with 6 samples
2025-04-17 21:50:15,590 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:15,590 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:15,590 - INFO - Trained optimizer for regime 2 with 6 samples
2025-04-17 21:50:15,590 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:15,590 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:15,591 - INFO - Trained optimizer for regime 3 with 8 samples
2025-04-17 21:50:15,591 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:15,591 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:15,591 - INFO - Trained optimizer for regime 4 with 9 samples
2025-04-17 21:50:15,591 - WARNING - No samples found for regime 5
2025-04-17 21:50:15,592 - WARNING - No samples found for regime 6
2025-04-17 21:50:15,592 - INFO - Portfolio optimizer training completed
2025-04-17 21:50:15,592 - INFO - Optimizing portfolio weights...
2025-04-17 21:50:15,593 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:15,594 - WARNING - All weights are zero, using equal weights
2025-04-17 21:50:15,595 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:15,596 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:15,597 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,598 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,599 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,601 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,602 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,603 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,604 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,605 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,607 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,608 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,609 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,611 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,611 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,612 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,614 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,615 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,616 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,618 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,619 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,620 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,621 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,622 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,624 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,625 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,627 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,627 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,629 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,630 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,631 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,632 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,633 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,634 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,636 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,637 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,638 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,640 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,641 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,643 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:15,644 - INFO - Portfolio optimization completed
2025-04-17 21:50:15,644 - INFO - Initializing backtester...
2025-04-17 21:50:15,655 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:50:15,655 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:50:15,655 - INFO - Running backtest...
2025-04-17 21:50:15,655 - INFO - Starting backtest...
2025-04-17 21:50:15,656 - INFO - Calculating portfolio returns...
2025-04-17 21:50:15,656 - INFO - Calculating portfolio returns...
2025-04-17 21:50:15,658 - INFO - Calculated 41 portfolio returns
2025-04-17 21:50:15,658 - INFO - Calculating performance metrics...
2025-04-17 21:50:15,658 - INFO - Starting performance metrics calculation...
2025-04-17 21:50:15,658 - INFO - Calculating metrics...
2025-04-17 21:50:15,663 - INFO - Performance metrics calculation completed
2025-04-17 21:50:15,664 - INFO - Backtest completed
2025-04-17 21:50:15,664 - INFO - Backtest completed
2025-04-17 21:50:15,664 - INFO - Strategy execution completed
2025-04-17 21:50:15,665 - ERROR - Error running xgboost with regime_aware and 7 regimes: 'MeanVarianceOptimizer' object has no attribute 'returns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 76, in run_parameter_grid
    regime_stats = strategy.portfolio_optimizer.get_regime_stats()
  File "C:\Users\ye\Desktop\factor_timing\optimizer\portfolio_optimizer.py", line 178, in get_regime_stats
    'n_samples': len(optimizer.returns),
                     ^^^^^^^^^^^^^^^^^
AttributeError: 'MeanVarianceOptimizer' object has no attribute 'returns'
2025-04-17 21:50:15,666 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 3 regimes
2025-04-17 21:50:15,667 - INFO - Initializing strategy...
2025-04-17 21:50:15,667 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 21:50:15,667 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:15,667 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:50:15,667 - ERROR - Error running xgboost with neural_regime and 3 regimes: 'FactorTimingStrategy' object has no attribute 'factor_columns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 42, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 39, in __init__
    self.portfolio_optimizer = self._init_portfolio_optimizer(optimizer_type)
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 68, in _init_portfolio_optimizer
    input_size=len(self.factor_columns),
                   ^^^^^^^^^^^^^^^^^^^
AttributeError: 'FactorTimingStrategy' object has no attribute 'factor_columns'
2025-04-17 21:50:15,669 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 5 regimes
2025-04-17 21:50:15,669 - INFO - Initializing strategy...
2025-04-17 21:50:15,670 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 21:50:15,670 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:15,670 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:50:15,671 - ERROR - Error running xgboost with neural_regime and 5 regimes: 'FactorTimingStrategy' object has no attribute 'factor_columns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 42, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 39, in __init__
    self.portfolio_optimizer = self._init_portfolio_optimizer(optimizer_type)
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 68, in _init_portfolio_optimizer
    input_size=len(self.factor_columns),
                   ^^^^^^^^^^^^^^^^^^^
AttributeError: 'FactorTimingStrategy' object has no attribute 'factor_columns'
2025-04-17 21:50:15,671 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 7 regimes
2025-04-17 21:50:15,671 - INFO - Initializing strategy...
2025-04-17 21:50:15,672 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 21:50:15,672 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:15,672 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:50:15,672 - ERROR - Error running xgboost with neural_regime and 7 regimes: 'FactorTimingStrategy' object has no attribute 'factor_columns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 42, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 39, in __init__
    self.portfolio_optimizer = self._init_portfolio_optimizer(optimizer_type)
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 68, in _init_portfolio_optimizer
    input_size=len(self.factor_columns),
                   ^^^^^^^^^^^^^^^^^^^
AttributeError: 'FactorTimingStrategy' object has no attribute 'factor_columns'
2025-04-17 21:50:15,674 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 21:50:15,674 - INFO - Initializing strategy...
2025-04-17 21:50:15,674 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 21:50:15,674 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:15,675 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:50:15,675 - ERROR - Error running xgboost with autoencoder_regime and 3 regimes: 'FactorTimingStrategy' object has no attribute 'factor_columns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 42, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 39, in __init__
    self.portfolio_optimizer = self._init_portfolio_optimizer(optimizer_type)
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 75, in _init_portfolio_optimizer
    input_size=len(self.factor_columns),
                   ^^^^^^^^^^^^^^^^^^^
AttributeError: 'FactorTimingStrategy' object has no attribute 'factor_columns'
2025-04-17 21:50:15,676 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 21:50:15,677 - INFO - Initializing strategy...
2025-04-17 21:50:15,678 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 21:50:15,678 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:15,679 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:50:15,679 - ERROR - Error running xgboost with autoencoder_regime and 5 regimes: 'FactorTimingStrategy' object has no attribute 'factor_columns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 42, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 39, in __init__
    self.portfolio_optimizer = self._init_portfolio_optimizer(optimizer_type)
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 75, in _init_portfolio_optimizer
    input_size=len(self.factor_columns),
                   ^^^^^^^^^^^^^^^^^^^
AttributeError: 'FactorTimingStrategy' object has no attribute 'factor_columns'
2025-04-17 21:50:15,680 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 21:50:15,680 - INFO - Initializing strategy...
2025-04-17 21:50:15,681 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 21:50:15,681 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:15,681 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:50:15,681 - ERROR - Error running xgboost with autoencoder_regime and 7 regimes: 'FactorTimingStrategy' object has no attribute 'factor_columns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 42, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 39, in __init__
    self.portfolio_optimizer = self._init_portfolio_optimizer(optimizer_type)
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 75, in _init_portfolio_optimizer
    input_size=len(self.factor_columns),
                   ^^^^^^^^^^^^^^^^^^^
AttributeError: 'FactorTimingStrategy' object has no attribute 'factor_columns'
2025-04-17 21:50:15,682 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 3 regimes
2025-04-17 21:50:15,683 - INFO - Initializing strategy...
2025-04-17 21:50:15,683 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 21:50:15,683 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:15,684 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:50:15,685 - INFO - Running strategy...
2025-04-17 21:50:15,685 - INFO - Starting strategy execution...
2025-04-17 21:50:15,685 - INFO - Preparing training and testing data...
2025-04-17 21:50:15,686 - INFO - Starting data preparation...
2025-04-17 21:50:15,686 - INFO - Loading Fama-French factors...
2025-04-17 21:50:15,695 - INFO - Fama-French factors loaded
2025-04-17 21:50:15,696 - INFO - Processing factor data...
2025-04-17 21:50:15,698 - INFO - Factor data processed
2025-04-17 21:50:15,699 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:15,699 - INFO - 
Training Period:
2025-04-17 21:50:15,704 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:15,711 - INFO - 
Testing Period:
2025-04-17 21:50:15,715 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:15,725 - INFO - Loading macro and market data...
2025-04-17 21:50:15,726 - INFO - Loading existing macro data...
2025-04-17 21:50:15,730 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:15,733 - INFO - Loading existing macro data...
2025-04-17 21:50:15,742 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:15,742 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:15,752 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:15,753 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:15,753 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:15,754 - INFO - Loading existing market data...
2025-04-17 21:50:15,758 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:15,759 - INFO - Loading existing market data...
2025-04-17 21:50:15,763 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:15,764 - INFO - Macro and market data loaded
2025-04-17 21:50:15,764 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:15,764 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:15,765 - INFO - Loading existing macro data...
2025-04-17 21:50:15,775 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:15,775 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:15,779 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:15,779 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:15,780 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:15,780 - INFO - Loading existing market data...
2025-04-17 21:50:15,784 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:15,795 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:15,796 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:15,796 - INFO - Training data prepared
2025-04-17 21:50:15,796 - INFO - Storing data...
2025-04-17 21:50:15,796 - INFO - Aligning data indices...
2025-04-17 21:50:15,797 - INFO - Data indices aligned
2025-04-17 21:50:15,798 - INFO - Data preparation completed
2025-04-17 21:50:15,798 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:15,798 - INFO - Training models...
2025-04-17 21:50:15,798 - INFO - Starting model training...
2025-04-17 21:50:15,798 - INFO - Training regime classifier...
2025-04-17 21:50:15,798 - INFO - Training XGBoost model...
2025-04-17 21:50:15,799 - INFO - Preparing features...
2025-04-17 21:50:15,799 - INFO - Input shape: (1536, 6)
2025-04-17 21:50:15,799 - INFO - Handling missing values...
2025-04-17 21:50:15,800 - INFO - Missing values: 0 -> 0
2025-04-17 21:50:15,801 - INFO - Scaling features...
2025-04-17 21:50:15,802 - INFO - Fitted new scaler
2025-04-17 21:50:15,803 - INFO - Output shape: (1536, 6)
2025-04-17 21:50:15,894 - INFO - XGBoost model training completed
2025-04-17 21:50:16,164 - INFO - Model training completed
2025-04-17 21:50:16,166 - INFO - Model training completed
2025-04-17 21:50:16,166 - INFO - Initializing portfolio weights...
2025-04-17 21:50:16,167 - INFO - Portfolio weights initialized
2025-04-17 21:50:16,167 - INFO - Generating regime predictions for test period...
2025-04-17 21:50:16,169 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:50:16,171 - INFO - Generated 41 regime predictions
2025-04-17 21:50:16,171 - INFO - Calculating regime-specific returns...
2025-04-17 21:50:16,175 - INFO - Found 5 unique regimes
2025-04-17 21:50:16,176 - INFO - Processing regime 0...
2025-04-17 21:50:16,177 - INFO - Regime 0: 16 samples
2025-04-17 21:50:16,177 - INFO - Processing regime 1...
2025-04-17 21:50:16,178 - INFO - Regime 1: 6 samples
2025-04-17 21:50:16,179 - INFO - Processing regime 2...
2025-04-17 21:50:16,180 - INFO - Regime 2: 6 samples
2025-04-17 21:50:16,180 - INFO - Processing regime 3...
2025-04-17 21:50:16,181 - INFO - Regime 3: 8 samples
2025-04-17 21:50:16,181 - INFO - Processing regime 4...
2025-04-17 21:50:16,182 - INFO - Regime 4: 9 samples
2025-04-17 21:50:16,183 - INFO - Training portfolio optimizer...
2025-04-17 21:50:16,183 - ERROR - Error running xgboost with neural and 3 regimes: 'NoneType' object has no attribute 'train'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 62, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 318, in run_strategy
    self.portfolio_optimizer.train(train_factors)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'train'
2025-04-17 21:50:16,184 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 5 regimes
2025-04-17 21:50:16,184 - INFO - Initializing strategy...
2025-04-17 21:50:16,185 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 21:50:16,185 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:16,185 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:50:16,186 - INFO - Running strategy...
2025-04-17 21:50:16,186 - INFO - Starting strategy execution...
2025-04-17 21:50:16,187 - INFO - Preparing training and testing data...
2025-04-17 21:50:16,187 - INFO - Starting data preparation...
2025-04-17 21:50:16,187 - INFO - Loading Fama-French factors...
2025-04-17 21:50:16,203 - INFO - Fama-French factors loaded
2025-04-17 21:50:16,203 - INFO - Processing factor data...
2025-04-17 21:50:16,207 - INFO - Factor data processed
2025-04-17 21:50:16,207 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:16,207 - INFO - 
Training Period:
2025-04-17 21:50:16,216 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:16,230 - INFO - 
Testing Period:
2025-04-17 21:50:16,238 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:16,251 - INFO - Loading macro and market data...
2025-04-17 21:50:16,253 - INFO - Loading existing macro data...
2025-04-17 21:50:16,257 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:16,258 - INFO - Loading existing macro data...
2025-04-17 21:50:16,273 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:16,273 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:16,278 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:16,278 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:16,278 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:16,280 - INFO - Loading existing market data...
2025-04-17 21:50:16,285 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:16,287 - INFO - Loading existing market data...
2025-04-17 21:50:16,290 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:16,290 - INFO - Macro and market data loaded
2025-04-17 21:50:16,290 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:16,291 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:16,291 - INFO - Loading existing macro data...
2025-04-17 21:50:16,301 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:16,301 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:16,304 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:16,304 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:16,305 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:16,306 - INFO - Loading existing market data...
2025-04-17 21:50:16,310 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:16,321 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:16,322 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:16,322 - INFO - Training data prepared
2025-04-17 21:50:16,322 - INFO - Storing data...
2025-04-17 21:50:16,323 - INFO - Aligning data indices...
2025-04-17 21:50:16,324 - INFO - Data indices aligned
2025-04-17 21:50:16,325 - INFO - Data preparation completed
2025-04-17 21:50:16,325 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:16,325 - INFO - Training models...
2025-04-17 21:50:16,325 - INFO - Starting model training...
2025-04-17 21:50:16,326 - INFO - Training regime classifier...
2025-04-17 21:50:16,326 - INFO - Training XGBoost model...
2025-04-17 21:50:16,326 - INFO - Preparing features...
2025-04-17 21:50:16,326 - INFO - Input shape: (1536, 6)
2025-04-17 21:50:16,326 - INFO - Handling missing values...
2025-04-17 21:50:16,327 - INFO - Missing values: 0 -> 0
2025-04-17 21:50:16,328 - INFO - Scaling features...
2025-04-17 21:50:16,329 - INFO - Fitted new scaler
2025-04-17 21:50:16,331 - INFO - Output shape: (1536, 6)
2025-04-17 21:50:16,422 - INFO - XGBoost model training completed
2025-04-17 21:50:16,692 - INFO - Model training completed
2025-04-17 21:50:16,694 - INFO - Model training completed
2025-04-17 21:50:16,694 - INFO - Initializing portfolio weights...
2025-04-17 21:50:16,694 - INFO - Portfolio weights initialized
2025-04-17 21:50:16,695 - INFO - Generating regime predictions for test period...
2025-04-17 21:50:16,696 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:50:16,698 - INFO - Generated 41 regime predictions
2025-04-17 21:50:16,698 - INFO - Calculating regime-specific returns...
2025-04-17 21:50:16,703 - INFO - Found 5 unique regimes
2025-04-17 21:50:16,703 - INFO - Processing regime 0...
2025-04-17 21:50:16,705 - INFO - Regime 0: 16 samples
2025-04-17 21:50:16,705 - INFO - Processing regime 1...
2025-04-17 21:50:16,706 - INFO - Regime 1: 6 samples
2025-04-17 21:50:16,706 - INFO - Processing regime 2...
2025-04-17 21:50:16,707 - INFO - Regime 2: 6 samples
2025-04-17 21:50:16,708 - INFO - Processing regime 3...
2025-04-17 21:50:16,709 - INFO - Regime 3: 8 samples
2025-04-17 21:50:16,709 - INFO - Processing regime 4...
2025-04-17 21:50:16,710 - INFO - Regime 4: 9 samples
2025-04-17 21:50:16,711 - INFO - Training portfolio optimizer...
2025-04-17 21:50:16,711 - ERROR - Error running xgboost with neural and 5 regimes: 'NoneType' object has no attribute 'train'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 62, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 318, in run_strategy
    self.portfolio_optimizer.train(train_factors)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'train'
2025-04-17 21:50:16,712 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 7 regimes
2025-04-17 21:50:16,712 - INFO - Initializing strategy...
2025-04-17 21:50:16,713 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 21:50:16,713 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:16,713 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:50:16,714 - INFO - Running strategy...
2025-04-17 21:50:16,715 - INFO - Starting strategy execution...
2025-04-17 21:50:16,715 - INFO - Preparing training and testing data...
2025-04-17 21:50:16,715 - INFO - Starting data preparation...
2025-04-17 21:50:16,715 - INFO - Loading Fama-French factors...
2025-04-17 21:50:16,733 - INFO - Fama-French factors loaded
2025-04-17 21:50:16,733 - INFO - Processing factor data...
2025-04-17 21:50:16,737 - INFO - Factor data processed
2025-04-17 21:50:16,737 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:16,737 - INFO - 
Training Period:
2025-04-17 21:50:16,745 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:16,760 - INFO - 
Testing Period:
2025-04-17 21:50:16,767 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:16,780 - INFO - Loading macro and market data...
2025-04-17 21:50:16,782 - INFO - Loading existing macro data...
2025-04-17 21:50:16,786 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:16,788 - INFO - Loading existing macro data...
2025-04-17 21:50:16,802 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:16,803 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:16,806 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:16,807 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:16,807 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:16,809 - INFO - Loading existing market data...
2025-04-17 21:50:16,813 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:16,814 - INFO - Loading existing market data...
2025-04-17 21:50:16,817 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:16,818 - INFO - Macro and market data loaded
2025-04-17 21:50:16,818 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:16,819 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:16,820 - INFO - Loading existing macro data...
2025-04-17 21:50:16,831 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:16,832 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:16,836 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:16,836 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:16,837 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:16,838 - INFO - Loading existing market data...
2025-04-17 21:50:16,844 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:16,857 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:16,858 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:16,858 - INFO - Training data prepared
2025-04-17 21:50:16,858 - INFO - Storing data...
2025-04-17 21:50:16,858 - INFO - Aligning data indices...
2025-04-17 21:50:16,859 - INFO - Data indices aligned
2025-04-17 21:50:16,860 - INFO - Data preparation completed
2025-04-17 21:50:16,860 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:16,860 - INFO - Training models...
2025-04-17 21:50:16,860 - INFO - Starting model training...
2025-04-17 21:50:16,860 - INFO - Training regime classifier...
2025-04-17 21:50:16,860 - INFO - Training XGBoost model...
2025-04-17 21:50:16,860 - INFO - Preparing features...
2025-04-17 21:50:16,861 - INFO - Input shape: (1536, 6)
2025-04-17 21:50:16,861 - INFO - Handling missing values...
2025-04-17 21:50:16,862 - INFO - Missing values: 0 -> 0
2025-04-17 21:50:16,862 - INFO - Scaling features...
2025-04-17 21:50:16,864 - INFO - Fitted new scaler
2025-04-17 21:50:16,865 - INFO - Output shape: (1536, 6)
2025-04-17 21:50:16,949 - INFO - XGBoost model training completed
2025-04-17 21:50:17,236 - INFO - Model training completed
2025-04-17 21:50:17,237 - INFO - Model training completed
2025-04-17 21:50:17,238 - INFO - Initializing portfolio weights...
2025-04-17 21:50:17,238 - INFO - Portfolio weights initialized
2025-04-17 21:50:17,238 - INFO - Generating regime predictions for test period...
2025-04-17 21:50:17,240 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:50:17,242 - INFO - Generated 41 regime predictions
2025-04-17 21:50:17,242 - INFO - Calculating regime-specific returns...
2025-04-17 21:50:17,247 - INFO - Found 5 unique regimes
2025-04-17 21:50:17,247 - INFO - Processing regime 0...
2025-04-17 21:50:17,249 - INFO - Regime 0: 16 samples
2025-04-17 21:50:17,249 - INFO - Processing regime 1...
2025-04-17 21:50:17,250 - INFO - Regime 1: 6 samples
2025-04-17 21:50:17,250 - INFO - Processing regime 2...
2025-04-17 21:50:17,252 - INFO - Regime 2: 6 samples
2025-04-17 21:50:17,252 - INFO - Processing regime 3...
2025-04-17 21:50:17,253 - INFO - Regime 3: 8 samples
2025-04-17 21:50:17,254 - INFO - Processing regime 4...
2025-04-17 21:50:17,255 - INFO - Regime 4: 9 samples
2025-04-17 21:50:17,255 - INFO - Training portfolio optimizer...
2025-04-17 21:50:17,255 - ERROR - Error running xgboost with neural and 7 regimes: 'NoneType' object has no attribute 'train'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 62, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 318, in run_strategy
    self.portfolio_optimizer.train(train_factors)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'train'
2025-04-17 21:50:17,257 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 3 regimes
2025-04-17 21:50:17,257 - INFO - Initializing strategy...
2025-04-17 21:50:17,257 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 21:50:17,258 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:17,258 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:50:17,259 - INFO - Running strategy...
2025-04-17 21:50:17,259 - INFO - Starting strategy execution...
2025-04-17 21:50:17,259 - INFO - Preparing training and testing data...
2025-04-17 21:50:17,259 - INFO - Starting data preparation...
2025-04-17 21:50:17,260 - INFO - Loading Fama-French factors...
2025-04-17 21:50:17,277 - INFO - Fama-French factors loaded
2025-04-17 21:50:17,277 - INFO - Processing factor data...
2025-04-17 21:50:17,282 - INFO - Factor data processed
2025-04-17 21:50:17,283 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:17,283 - INFO - 
Training Period:
2025-04-17 21:50:17,290 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:17,307 - INFO - 
Testing Period:
2025-04-17 21:50:17,316 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:17,330 - INFO - Loading macro and market data...
2025-04-17 21:50:17,332 - INFO - Loading existing macro data...
2025-04-17 21:50:17,336 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:17,338 - INFO - Loading existing macro data...
2025-04-17 21:50:17,351 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:17,351 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:17,354 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:17,355 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:17,355 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:17,356 - INFO - Loading existing market data...
2025-04-17 21:50:17,359 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:17,360 - INFO - Loading existing market data...
2025-04-17 21:50:17,363 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:17,363 - INFO - Macro and market data loaded
2025-04-17 21:50:17,364 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:17,364 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:17,365 - INFO - Loading existing macro data...
2025-04-17 21:50:17,376 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:17,376 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:17,381 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:17,381 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:17,381 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:17,382 - INFO - Loading existing market data...
2025-04-17 21:50:17,387 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:17,402 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:17,403 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:17,403 - INFO - Training data prepared
2025-04-17 21:50:17,404 - INFO - Storing data...
2025-04-17 21:50:17,404 - INFO - Aligning data indices...
2025-04-17 21:50:17,406 - INFO - Data indices aligned
2025-04-17 21:50:17,406 - INFO - Data preparation completed
2025-04-17 21:50:17,406 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:17,406 - INFO - Training models...
2025-04-17 21:50:17,406 - INFO - Starting model training...
2025-04-17 21:50:17,407 - INFO - Training regime classifier...
2025-04-17 21:50:17,407 - INFO - Training HMM model...
2025-04-17 21:50:17,627 - INFO - HMM model training completed
2025-04-17 21:50:18,020 - INFO - Model training completed
2025-04-17 21:50:18,023 - INFO - Model training completed
2025-04-17 21:50:18,023 - INFO - Initializing portfolio weights...
2025-04-17 21:50:18,024 - INFO - Portfolio weights initialized
2025-04-17 21:50:18,024 - INFO - Generating regime predictions for test period...
2025-04-17 21:50:18,026 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:50:18,029 - INFO - Generated 41 regime predictions
2025-04-17 21:50:18,029 - INFO - Calculating regime-specific returns...
2025-04-17 21:50:18,034 - INFO - Found 5 unique regimes
2025-04-17 21:50:18,034 - INFO - Processing regime 0...
2025-04-17 21:50:18,035 - INFO - Regime 0: 13 samples
2025-04-17 21:50:18,035 - INFO - Processing regime 1...
2025-04-17 21:50:18,036 - INFO - Regime 1: 8 samples
2025-04-17 21:50:18,037 - INFO - Processing regime 2...
2025-04-17 21:50:18,038 - INFO - Regime 2: 9 samples
2025-04-17 21:50:18,038 - INFO - Processing regime 3...
2025-04-17 21:50:18,039 - INFO - Regime 3: 7 samples
2025-04-17 21:50:18,039 - INFO - Processing regime 4...
2025-04-17 21:50:18,040 - INFO - Regime 4: 8 samples
2025-04-17 21:50:18,040 - INFO - Training portfolio optimizer...
2025-04-17 21:50:18,041 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:18,041 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:18,041 - INFO - Portfolio optimizer training completed
2025-04-17 21:50:18,041 - INFO - Optimizing portfolio weights...
2025-04-17 21:50:18,043 - WARNING - All weights are zero, using equal weights
2025-04-17 21:50:18,064 - INFO - Portfolio optimization completed
2025-04-17 21:50:18,065 - INFO - Initializing backtester...
2025-04-17 21:50:18,071 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:50:18,072 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:50:18,072 - INFO - Running backtest...
2025-04-17 21:50:18,072 - INFO - Starting backtest...
2025-04-17 21:50:18,072 - INFO - Calculating portfolio returns...
2025-04-17 21:50:18,072 - INFO - Calculating portfolio returns...
2025-04-17 21:50:18,074 - INFO - Calculated 41 portfolio returns
2025-04-17 21:50:18,075 - INFO - Calculating performance metrics...
2025-04-17 21:50:18,075 - INFO - Starting performance metrics calculation...
2025-04-17 21:50:18,075 - INFO - Calculating metrics...
2025-04-17 21:50:18,079 - INFO - Performance metrics calculation completed
2025-04-17 21:50:18,079 - INFO - Backtest completed
2025-04-17 21:50:18,079 - INFO - Backtest completed
2025-04-17 21:50:18,080 - INFO - Strategy execution completed
2025-04-17 21:50:18,081 - INFO - Plotting results...
2025-04-17 21:50:18,081 - INFO - Starting to plot results...
2025-04-17 21:50:18,081 - INFO - Starting to plot results...
2025-04-17 21:50:18,388 - INFO - Plot completed
2025-04-17 21:50:18,388 - INFO - Plot completed
2025-04-17 21:50:18,506 - INFO - Successfully completed run for hmm with mean_variance and 3 regimes
2025-04-17 21:50:18,506 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 5 regimes
2025-04-17 21:50:18,507 - INFO - Initializing strategy...
2025-04-17 21:50:18,507 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 21:50:18,507 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:18,507 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:50:18,507 - INFO - Running strategy...
2025-04-17 21:50:18,508 - INFO - Starting strategy execution...
2025-04-17 21:50:18,508 - INFO - Preparing training and testing data...
2025-04-17 21:50:18,508 - INFO - Starting data preparation...
2025-04-17 21:50:18,508 - INFO - Loading Fama-French factors...
2025-04-17 21:50:18,520 - INFO - Fama-French factors loaded
2025-04-17 21:50:18,520 - INFO - Processing factor data...
2025-04-17 21:50:18,523 - INFO - Factor data processed
2025-04-17 21:50:18,523 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:18,523 - INFO - 
Training Period:
2025-04-17 21:50:18,528 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:18,536 - INFO - 
Testing Period:
2025-04-17 21:50:18,542 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:18,551 - INFO - Loading macro and market data...
2025-04-17 21:50:18,552 - INFO - Loading existing macro data...
2025-04-17 21:50:18,556 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:18,557 - INFO - Loading existing macro data...
2025-04-17 21:50:18,567 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:18,568 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:18,571 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:18,571 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:18,572 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:18,573 - INFO - Loading existing market data...
2025-04-17 21:50:18,577 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:18,578 - INFO - Loading existing market data...
2025-04-17 21:50:18,581 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:18,581 - INFO - Macro and market data loaded
2025-04-17 21:50:18,582 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:18,582 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:18,583 - INFO - Loading existing macro data...
2025-04-17 21:50:18,594 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:18,594 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:18,598 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:18,598 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:18,599 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:18,600 - INFO - Loading existing market data...
2025-04-17 21:50:18,603 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:18,612 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:18,613 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:18,613 - INFO - Training data prepared
2025-04-17 21:50:18,613 - INFO - Storing data...
2025-04-17 21:50:18,614 - INFO - Aligning data indices...
2025-04-17 21:50:18,615 - INFO - Data indices aligned
2025-04-17 21:50:18,615 - INFO - Data preparation completed
2025-04-17 21:50:18,615 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:18,615 - INFO - Training models...
2025-04-17 21:50:18,615 - INFO - Starting model training...
2025-04-17 21:50:18,615 - INFO - Training regime classifier...
2025-04-17 21:50:18,616 - INFO - Training HMM model...
2025-04-17 21:50:18,839 - INFO - HMM model training completed
2025-04-17 21:50:19,056 - INFO - Model training completed
2025-04-17 21:50:19,059 - INFO - Model training completed
2025-04-17 21:50:19,060 - INFO - Initializing portfolio weights...
2025-04-17 21:50:19,060 - INFO - Portfolio weights initialized
2025-04-17 21:50:19,060 - INFO - Generating regime predictions for test period...
2025-04-17 21:50:19,062 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:50:19,065 - INFO - Generated 41 regime predictions
2025-04-17 21:50:19,065 - INFO - Calculating regime-specific returns...
2025-04-17 21:50:19,069 - INFO - Found 5 unique regimes
2025-04-17 21:50:19,070 - INFO - Processing regime 0...
2025-04-17 21:50:19,071 - INFO - Regime 0: 13 samples
2025-04-17 21:50:19,071 - INFO - Processing regime 1...
2025-04-17 21:50:19,072 - INFO - Regime 1: 8 samples
2025-04-17 21:50:19,072 - INFO - Processing regime 2...
2025-04-17 21:50:19,073 - INFO - Regime 2: 9 samples
2025-04-17 21:50:19,074 - INFO - Processing regime 3...
2025-04-17 21:50:19,074 - INFO - Regime 3: 7 samples
2025-04-17 21:50:19,075 - INFO - Processing regime 4...
2025-04-17 21:50:19,076 - INFO - Regime 4: 8 samples
2025-04-17 21:50:19,077 - INFO - Training portfolio optimizer...
2025-04-17 21:50:19,077 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:19,078 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:19,078 - INFO - Portfolio optimizer training completed
2025-04-17 21:50:19,078 - INFO - Optimizing portfolio weights...
2025-04-17 21:50:19,080 - WARNING - All weights are zero, using equal weights
2025-04-17 21:50:19,103 - INFO - Portfolio optimization completed
2025-04-17 21:50:19,103 - INFO - Initializing backtester...
2025-04-17 21:50:19,110 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:50:19,110 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:50:19,110 - INFO - Running backtest...
2025-04-17 21:50:19,110 - INFO - Starting backtest...
2025-04-17 21:50:19,111 - INFO - Calculating portfolio returns...
2025-04-17 21:50:19,111 - INFO - Calculating portfolio returns...
2025-04-17 21:50:19,112 - INFO - Calculated 41 portfolio returns
2025-04-17 21:50:19,112 - INFO - Calculating performance metrics...
2025-04-17 21:50:19,112 - INFO - Starting performance metrics calculation...
2025-04-17 21:50:19,113 - INFO - Calculating metrics...
2025-04-17 21:50:19,115 - INFO - Performance metrics calculation completed
2025-04-17 21:50:19,115 - INFO - Backtest completed
2025-04-17 21:50:19,115 - INFO - Backtest completed
2025-04-17 21:50:19,116 - INFO - Strategy execution completed
2025-04-17 21:50:19,116 - INFO - Plotting results...
2025-04-17 21:50:19,116 - INFO - Starting to plot results...
2025-04-17 21:50:19,117 - INFO - Starting to plot results...
2025-04-17 21:50:19,438 - INFO - Plot completed
2025-04-17 21:50:19,439 - INFO - Plot completed
2025-04-17 21:50:19,548 - INFO - Successfully completed run for hmm with mean_variance and 5 regimes
2025-04-17 21:50:19,548 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 7 regimes
2025-04-17 21:50:19,548 - INFO - Initializing strategy...
2025-04-17 21:50:19,548 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 21:50:19,549 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:19,549 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:50:19,549 - INFO - Running strategy...
2025-04-17 21:50:19,549 - INFO - Starting strategy execution...
2025-04-17 21:50:19,549 - INFO - Preparing training and testing data...
2025-04-17 21:50:19,549 - INFO - Starting data preparation...
2025-04-17 21:50:19,549 - INFO - Loading Fama-French factors...
2025-04-17 21:50:19,561 - INFO - Fama-French factors loaded
2025-04-17 21:50:19,561 - INFO - Processing factor data...
2025-04-17 21:50:19,563 - INFO - Factor data processed
2025-04-17 21:50:19,564 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:19,564 - INFO - 
Training Period:
2025-04-17 21:50:19,568 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:19,576 - INFO - 
Testing Period:
2025-04-17 21:50:19,581 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:19,589 - INFO - Loading macro and market data...
2025-04-17 21:50:19,591 - INFO - Loading existing macro data...
2025-04-17 21:50:19,596 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:19,597 - INFO - Loading existing macro data...
2025-04-17 21:50:19,607 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:19,607 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:19,610 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:19,610 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:19,611 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:19,611 - INFO - Loading existing market data...
2025-04-17 21:50:19,615 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:19,616 - INFO - Loading existing market data...
2025-04-17 21:50:19,619 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:19,619 - INFO - Macro and market data loaded
2025-04-17 21:50:19,620 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:19,620 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:19,622 - INFO - Loading existing macro data...
2025-04-17 21:50:19,631 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:19,632 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:19,635 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:19,635 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:19,636 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:19,637 - INFO - Loading existing market data...
2025-04-17 21:50:19,641 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:19,652 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:19,652 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:19,653 - INFO - Training data prepared
2025-04-17 21:50:19,653 - INFO - Storing data...
2025-04-17 21:50:19,653 - INFO - Aligning data indices...
2025-04-17 21:50:19,655 - INFO - Data indices aligned
2025-04-17 21:50:19,655 - INFO - Data preparation completed
2025-04-17 21:50:19,655 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:19,655 - INFO - Training models...
2025-04-17 21:50:19,656 - INFO - Starting model training...
2025-04-17 21:50:19,656 - INFO - Training regime classifier...
2025-04-17 21:50:19,656 - INFO - Training HMM model...
2025-04-17 21:50:19,901 - INFO - HMM model training completed
2025-04-17 21:50:20,121 - INFO - Model training completed
2025-04-17 21:50:20,123 - INFO - Model training completed
2025-04-17 21:50:20,123 - INFO - Initializing portfolio weights...
2025-04-17 21:50:20,124 - INFO - Portfolio weights initialized
2025-04-17 21:50:20,124 - INFO - Generating regime predictions for test period...
2025-04-17 21:50:20,126 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:50:20,129 - INFO - Generated 41 regime predictions
2025-04-17 21:50:20,129 - INFO - Calculating regime-specific returns...
2025-04-17 21:50:20,134 - INFO - Found 5 unique regimes
2025-04-17 21:50:20,134 - INFO - Processing regime 0...
2025-04-17 21:50:20,135 - INFO - Regime 0: 13 samples
2025-04-17 21:50:20,135 - INFO - Processing regime 1...
2025-04-17 21:50:20,136 - INFO - Regime 1: 8 samples
2025-04-17 21:50:20,136 - INFO - Processing regime 2...
2025-04-17 21:50:20,137 - INFO - Regime 2: 9 samples
2025-04-17 21:50:20,137 - INFO - Processing regime 3...
2025-04-17 21:50:20,138 - INFO - Regime 3: 7 samples
2025-04-17 21:50:20,138 - INFO - Processing regime 4...
2025-04-17 21:50:20,139 - INFO - Regime 4: 8 samples
2025-04-17 21:50:20,139 - INFO - Training portfolio optimizer...
2025-04-17 21:50:20,139 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:20,139 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:20,140 - INFO - Portfolio optimizer training completed
2025-04-17 21:50:20,140 - INFO - Optimizing portfolio weights...
2025-04-17 21:50:20,142 - WARNING - All weights are zero, using equal weights
2025-04-17 21:50:20,164 - INFO - Portfolio optimization completed
2025-04-17 21:50:20,164 - INFO - Initializing backtester...
2025-04-17 21:50:20,171 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:50:20,171 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:50:20,172 - INFO - Running backtest...
2025-04-17 21:50:20,172 - INFO - Starting backtest...
2025-04-17 21:50:20,172 - INFO - Calculating portfolio returns...
2025-04-17 21:50:20,173 - INFO - Calculating portfolio returns...
2025-04-17 21:50:20,174 - INFO - Calculated 41 portfolio returns
2025-04-17 21:50:20,174 - INFO - Calculating performance metrics...
2025-04-17 21:50:20,174 - INFO - Starting performance metrics calculation...
2025-04-17 21:50:20,174 - INFO - Calculating metrics...
2025-04-17 21:50:20,177 - INFO - Performance metrics calculation completed
2025-04-17 21:50:20,177 - INFO - Backtest completed
2025-04-17 21:50:20,177 - INFO - Backtest completed
2025-04-17 21:50:20,178 - INFO - Strategy execution completed
2025-04-17 21:50:20,179 - INFO - Plotting results...
2025-04-17 21:50:20,179 - INFO - Starting to plot results...
2025-04-17 21:50:20,179 - INFO - Starting to plot results...
2025-04-17 21:50:20,505 - INFO - Plot completed
2025-04-17 21:50:20,505 - INFO - Plot completed
2025-04-17 21:50:20,626 - INFO - Successfully completed run for hmm with mean_variance and 7 regimes
2025-04-17 21:50:20,627 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 3 regimes
2025-04-17 21:50:20,627 - INFO - Initializing strategy...
2025-04-17 21:50:20,627 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 21:50:20,628 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:20,628 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:50:20,628 - INFO - Running strategy...
2025-04-17 21:50:20,629 - INFO - Starting strategy execution...
2025-04-17 21:50:20,629 - INFO - Preparing training and testing data...
2025-04-17 21:50:20,629 - INFO - Starting data preparation...
2025-04-17 21:50:20,630 - INFO - Loading Fama-French factors...
2025-04-17 21:50:20,639 - INFO - Fama-French factors loaded
2025-04-17 21:50:20,640 - INFO - Processing factor data...
2025-04-17 21:50:20,642 - INFO - Factor data processed
2025-04-17 21:50:20,642 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:20,643 - INFO - 
Training Period:
2025-04-17 21:50:20,647 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:20,657 - INFO - 
Testing Period:
2025-04-17 21:50:20,661 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:20,670 - INFO - Loading macro and market data...
2025-04-17 21:50:20,671 - INFO - Loading existing macro data...
2025-04-17 21:50:20,674 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:20,676 - INFO - Loading existing macro data...
2025-04-17 21:50:20,685 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:20,686 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:20,689 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:20,689 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:20,689 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:20,690 - INFO - Loading existing market data...
2025-04-17 21:50:20,694 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:20,695 - INFO - Loading existing market data...
2025-04-17 21:50:20,698 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:20,699 - INFO - Macro and market data loaded
2025-04-17 21:50:20,699 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:20,699 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:20,701 - INFO - Loading existing macro data...
2025-04-17 21:50:20,711 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:20,712 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:20,716 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:20,716 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:20,717 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:20,719 - INFO - Loading existing market data...
2025-04-17 21:50:20,723 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:20,734 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:20,735 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:20,735 - INFO - Training data prepared
2025-04-17 21:50:20,735 - INFO - Storing data...
2025-04-17 21:50:20,735 - INFO - Aligning data indices...
2025-04-17 21:50:20,737 - INFO - Data indices aligned
2025-04-17 21:50:20,737 - INFO - Data preparation completed
2025-04-17 21:50:20,737 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:20,737 - INFO - Training models...
2025-04-17 21:50:20,737 - INFO - Starting model training...
2025-04-17 21:50:20,738 - INFO - Training regime classifier...
2025-04-17 21:50:20,738 - INFO - Training HMM model...
2025-04-17 21:50:20,984 - INFO - HMM model training completed
2025-04-17 21:50:21,218 - INFO - Model training completed
2025-04-17 21:50:21,220 - INFO - Model training completed
2025-04-17 21:50:21,220 - INFO - Initializing portfolio weights...
2025-04-17 21:50:21,221 - INFO - Portfolio weights initialized
2025-04-17 21:50:21,221 - INFO - Generating regime predictions for test period...
2025-04-17 21:50:21,223 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:50:21,226 - INFO - Generated 41 regime predictions
2025-04-17 21:50:21,226 - INFO - Calculating regime-specific returns...
2025-04-17 21:50:21,231 - INFO - Found 5 unique regimes
2025-04-17 21:50:21,231 - INFO - Processing regime 0...
2025-04-17 21:50:21,232 - INFO - Regime 0: 13 samples
2025-04-17 21:50:21,232 - INFO - Processing regime 1...
2025-04-17 21:50:21,234 - INFO - Regime 1: 8 samples
2025-04-17 21:50:21,234 - INFO - Processing regime 2...
2025-04-17 21:50:21,235 - INFO - Regime 2: 9 samples
2025-04-17 21:50:21,235 - INFO - Processing regime 3...
2025-04-17 21:50:21,237 - INFO - Regime 3: 7 samples
2025-04-17 21:50:21,237 - INFO - Processing regime 4...
2025-04-17 21:50:21,238 - INFO - Regime 4: 8 samples
2025-04-17 21:50:21,238 - INFO - Training portfolio optimizer...
2025-04-17 21:50:21,239 - INFO - Training regime-aware optimizer...
2025-04-17 21:50:21,239 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:21,240 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:21,240 - INFO - Trained optimizer for regime 0 with 13 samples
2025-04-17 21:50:21,240 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:21,241 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:21,241 - INFO - Trained optimizer for regime 1 with 8 samples
2025-04-17 21:50:21,241 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:21,242 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:21,242 - INFO - Trained optimizer for regime 2 with 9 samples
2025-04-17 21:50:21,242 - INFO - Portfolio optimizer training completed
2025-04-17 21:50:21,243 - INFO - Optimizing portfolio weights...
2025-04-17 21:50:21,243 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:21,245 - WARNING - All weights are zero, using equal weights
2025-04-17 21:50:21,245 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:21,247 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:21,248 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:21,249 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:21,250 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:21,251 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:21,252 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:21,253 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:21,254 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:21,255 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:21,256 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:21,257 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,257 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 21:50:21,258 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,258 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 21:50:21,260 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,260 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 21:50:21,261 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,261 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 21:50:21,262 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,262 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 21:50:21,263 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,263 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 21:50:21,264 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,264 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 21:50:21,265 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,265 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 21:50:21,267 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,267 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 21:50:21,268 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,268 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 21:50:21,269 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,270 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 21:50:21,271 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,271 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 21:50:21,272 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,272 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 21:50:21,273 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,273 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 21:50:21,274 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,274 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 21:50:21,275 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,275 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 21:50:21,276 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,276 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 21:50:21,277 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,277 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 21:50:21,279 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,279 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 21:50:21,281 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,281 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 21:50:21,282 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,282 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 21:50:21,283 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,284 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 21:50:21,285 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,286 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 21:50:21,287 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,287 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 21:50:21,288 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,288 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 21:50:21,289 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,289 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 21:50:21,290 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,291 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 21:50:21,291 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,292 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 21:50:21,293 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,293 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 21:50:21,294 - INFO - Portfolio optimization completed
2025-04-17 21:50:21,295 - INFO - Initializing backtester...
2025-04-17 21:50:21,301 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:50:21,301 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:50:21,301 - INFO - Running backtest...
2025-04-17 21:50:21,302 - INFO - Starting backtest...
2025-04-17 21:50:21,302 - INFO - Calculating portfolio returns...
2025-04-17 21:50:21,302 - INFO - Calculating portfolio returns...
2025-04-17 21:50:21,304 - INFO - Calculated 41 portfolio returns
2025-04-17 21:50:21,304 - INFO - Calculating performance metrics...
2025-04-17 21:50:21,305 - INFO - Starting performance metrics calculation...
2025-04-17 21:50:21,305 - INFO - Calculating metrics...
2025-04-17 21:50:21,307 - INFO - Performance metrics calculation completed
2025-04-17 21:50:21,308 - INFO - Backtest completed
2025-04-17 21:50:21,308 - INFO - Backtest completed
2025-04-17 21:50:21,311 - INFO - Strategy execution completed
2025-04-17 21:50:21,311 - ERROR - Error running hmm with regime_aware and 3 regimes: 'MeanVarianceOptimizer' object has no attribute 'returns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 76, in run_parameter_grid
    regime_stats = strategy.portfolio_optimizer.get_regime_stats()
  File "C:\Users\ye\Desktop\factor_timing\optimizer\portfolio_optimizer.py", line 178, in get_regime_stats
    'n_samples': len(optimizer.returns),
                     ^^^^^^^^^^^^^^^^^
AttributeError: 'MeanVarianceOptimizer' object has no attribute 'returns'
2025-04-17 21:50:21,312 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 5 regimes
2025-04-17 21:50:21,312 - INFO - Initializing strategy...
2025-04-17 21:50:21,312 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 21:50:21,313 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:21,313 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:50:21,313 - INFO - Running strategy...
2025-04-17 21:50:21,313 - INFO - Starting strategy execution...
2025-04-17 21:50:21,313 - INFO - Preparing training and testing data...
2025-04-17 21:50:21,314 - INFO - Starting data preparation...
2025-04-17 21:50:21,314 - INFO - Loading Fama-French factors...
2025-04-17 21:50:21,324 - INFO - Fama-French factors loaded
2025-04-17 21:50:21,325 - INFO - Processing factor data...
2025-04-17 21:50:21,328 - INFO - Factor data processed
2025-04-17 21:50:21,328 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:21,328 - INFO - 
Training Period:
2025-04-17 21:50:21,332 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:21,341 - INFO - 
Testing Period:
2025-04-17 21:50:21,347 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:21,356 - INFO - Loading macro and market data...
2025-04-17 21:50:21,357 - INFO - Loading existing macro data...
2025-04-17 21:50:21,361 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:21,362 - INFO - Loading existing macro data...
2025-04-17 21:50:21,371 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:21,371 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:21,375 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:21,375 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:21,376 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:21,377 - INFO - Loading existing market data...
2025-04-17 21:50:21,381 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:21,383 - INFO - Loading existing market data...
2025-04-17 21:50:21,386 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:21,386 - INFO - Macro and market data loaded
2025-04-17 21:50:21,387 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:21,387 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:21,388 - INFO - Loading existing macro data...
2025-04-17 21:50:21,397 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:21,398 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:21,401 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:21,402 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:21,402 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:21,403 - INFO - Loading existing market data...
2025-04-17 21:50:21,408 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:21,418 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:21,419 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:21,419 - INFO - Training data prepared
2025-04-17 21:50:21,420 - INFO - Storing data...
2025-04-17 21:50:21,420 - INFO - Aligning data indices...
2025-04-17 21:50:21,422 - INFO - Data indices aligned
2025-04-17 21:50:21,422 - INFO - Data preparation completed
2025-04-17 21:50:21,422 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:21,423 - INFO - Training models...
2025-04-17 21:50:21,423 - INFO - Starting model training...
2025-04-17 21:50:21,423 - INFO - Training regime classifier...
2025-04-17 21:50:21,423 - INFO - Training HMM model...
2025-04-17 21:50:21,652 - INFO - HMM model training completed
2025-04-17 21:50:21,871 - INFO - Model training completed
2025-04-17 21:50:21,873 - INFO - Model training completed
2025-04-17 21:50:21,873 - INFO - Initializing portfolio weights...
2025-04-17 21:50:21,874 - INFO - Portfolio weights initialized
2025-04-17 21:50:21,874 - INFO - Generating regime predictions for test period...
2025-04-17 21:50:21,876 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:50:21,878 - INFO - Generated 41 regime predictions
2025-04-17 21:50:21,878 - INFO - Calculating regime-specific returns...
2025-04-17 21:50:21,882 - INFO - Found 5 unique regimes
2025-04-17 21:50:21,882 - INFO - Processing regime 0...
2025-04-17 21:50:21,883 - INFO - Regime 0: 13 samples
2025-04-17 21:50:21,883 - INFO - Processing regime 1...
2025-04-17 21:50:21,883 - INFO - Regime 1: 8 samples
2025-04-17 21:50:21,884 - INFO - Processing regime 2...
2025-04-17 21:50:21,885 - INFO - Regime 2: 9 samples
2025-04-17 21:50:21,885 - INFO - Processing regime 3...
2025-04-17 21:50:21,886 - INFO - Regime 3: 7 samples
2025-04-17 21:50:21,886 - INFO - Processing regime 4...
2025-04-17 21:50:21,886 - INFO - Regime 4: 8 samples
2025-04-17 21:50:21,887 - INFO - Training portfolio optimizer...
2025-04-17 21:50:21,887 - INFO - Training regime-aware optimizer...
2025-04-17 21:50:21,887 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:21,887 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:21,887 - INFO - Trained optimizer for regime 0 with 13 samples
2025-04-17 21:50:21,888 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:21,888 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:21,888 - INFO - Trained optimizer for regime 1 with 8 samples
2025-04-17 21:50:21,888 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:21,888 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:21,888 - INFO - Trained optimizer for regime 2 with 9 samples
2025-04-17 21:50:21,888 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:21,889 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:21,889 - INFO - Trained optimizer for regime 3 with 7 samples
2025-04-17 21:50:21,889 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:21,889 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:21,889 - INFO - Trained optimizer for regime 4 with 8 samples
2025-04-17 21:50:21,889 - INFO - Portfolio optimizer training completed
2025-04-17 21:50:21,889 - INFO - Optimizing portfolio weights...
2025-04-17 21:50:21,890 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:21,891 - WARNING - All weights are zero, using equal weights
2025-04-17 21:50:21,892 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:21,892 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:21,893 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:21,894 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:21,895 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:21,896 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:21,896 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:21,897 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:21,898 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:21,899 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:21,900 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:21,901 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,901 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,902 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,903 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,904 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,905 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,906 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,907 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,908 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,909 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,910 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,911 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,912 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,912 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,913 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,914 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,915 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,916 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,917 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,918 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,920 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:21,921 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,922 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,923 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,924 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,925 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,925 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,926 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,927 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:21,928 - INFO - Portfolio optimization completed
2025-04-17 21:50:21,928 - INFO - Initializing backtester...
2025-04-17 21:50:21,935 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:50:21,936 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:50:21,936 - INFO - Running backtest...
2025-04-17 21:50:21,936 - INFO - Starting backtest...
2025-04-17 21:50:21,937 - INFO - Calculating portfolio returns...
2025-04-17 21:50:21,937 - INFO - Calculating portfolio returns...
2025-04-17 21:50:21,938 - INFO - Calculated 41 portfolio returns
2025-04-17 21:50:21,939 - INFO - Calculating performance metrics...
2025-04-17 21:50:21,939 - INFO - Starting performance metrics calculation...
2025-04-17 21:50:21,939 - INFO - Calculating metrics...
2025-04-17 21:50:21,941 - INFO - Performance metrics calculation completed
2025-04-17 21:50:21,942 - INFO - Backtest completed
2025-04-17 21:50:21,942 - INFO - Backtest completed
2025-04-17 21:50:21,944 - INFO - Strategy execution completed
2025-04-17 21:50:21,944 - ERROR - Error running hmm with regime_aware and 5 regimes: 'MeanVarianceOptimizer' object has no attribute 'returns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 76, in run_parameter_grid
    regime_stats = strategy.portfolio_optimizer.get_regime_stats()
  File "C:\Users\ye\Desktop\factor_timing\optimizer\portfolio_optimizer.py", line 178, in get_regime_stats
    'n_samples': len(optimizer.returns),
                     ^^^^^^^^^^^^^^^^^
AttributeError: 'MeanVarianceOptimizer' object has no attribute 'returns'
2025-04-17 21:50:21,945 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 7 regimes
2025-04-17 21:50:21,945 - INFO - Initializing strategy...
2025-04-17 21:50:21,945 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 21:50:21,946 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:21,946 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:50:21,946 - INFO - Running strategy...
2025-04-17 21:50:21,946 - INFO - Starting strategy execution...
2025-04-17 21:50:21,947 - INFO - Preparing training and testing data...
2025-04-17 21:50:21,947 - INFO - Starting data preparation...
2025-04-17 21:50:21,948 - INFO - Loading Fama-French factors...
2025-04-17 21:50:21,956 - INFO - Fama-French factors loaded
2025-04-17 21:50:21,957 - INFO - Processing factor data...
2025-04-17 21:50:21,959 - INFO - Factor data processed
2025-04-17 21:50:21,959 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:21,960 - INFO - 
Training Period:
2025-04-17 21:50:21,964 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:21,972 - INFO - 
Testing Period:
2025-04-17 21:50:21,977 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:21,985 - INFO - Loading macro and market data...
2025-04-17 21:50:21,986 - INFO - Loading existing macro data...
2025-04-17 21:50:21,990 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:21,991 - INFO - Loading existing macro data...
2025-04-17 21:50:22,001 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:22,002 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:22,005 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:22,005 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:22,005 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:22,006 - INFO - Loading existing market data...
2025-04-17 21:50:22,010 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:22,012 - INFO - Loading existing market data...
2025-04-17 21:50:22,014 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:22,015 - INFO - Macro and market data loaded
2025-04-17 21:50:22,015 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:22,015 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:22,016 - INFO - Loading existing macro data...
2025-04-17 21:50:22,026 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:22,027 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:22,029 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:22,030 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:22,030 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:22,031 - INFO - Loading existing market data...
2025-04-17 21:50:22,035 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:22,044 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:22,045 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:22,045 - INFO - Training data prepared
2025-04-17 21:50:22,046 - INFO - Storing data...
2025-04-17 21:50:22,046 - INFO - Aligning data indices...
2025-04-17 21:50:22,047 - INFO - Data indices aligned
2025-04-17 21:50:22,047 - INFO - Data preparation completed
2025-04-17 21:50:22,047 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:22,048 - INFO - Training models...
2025-04-17 21:50:22,048 - INFO - Starting model training...
2025-04-17 21:50:22,048 - INFO - Training regime classifier...
2025-04-17 21:50:22,048 - INFO - Training HMM model...
2025-04-17 21:50:22,271 - INFO - HMM model training completed
2025-04-17 21:50:22,475 - INFO - Model training completed
2025-04-17 21:50:22,478 - INFO - Model training completed
2025-04-17 21:50:22,478 - INFO - Initializing portfolio weights...
2025-04-17 21:50:22,479 - INFO - Portfolio weights initialized
2025-04-17 21:50:22,479 - INFO - Generating regime predictions for test period...
2025-04-17 21:50:22,481 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:50:22,484 - INFO - Generated 41 regime predictions
2025-04-17 21:50:22,484 - INFO - Calculating regime-specific returns...
2025-04-17 21:50:22,488 - INFO - Found 5 unique regimes
2025-04-17 21:50:22,488 - INFO - Processing regime 0...
2025-04-17 21:50:22,489 - INFO - Regime 0: 13 samples
2025-04-17 21:50:22,489 - INFO - Processing regime 1...
2025-04-17 21:50:22,490 - INFO - Regime 1: 8 samples
2025-04-17 21:50:22,491 - INFO - Processing regime 2...
2025-04-17 21:50:22,491 - INFO - Regime 2: 9 samples
2025-04-17 21:50:22,492 - INFO - Processing regime 3...
2025-04-17 21:50:22,492 - INFO - Regime 3: 7 samples
2025-04-17 21:50:22,493 - INFO - Processing regime 4...
2025-04-17 21:50:22,494 - INFO - Regime 4: 8 samples
2025-04-17 21:50:22,494 - INFO - Training portfolio optimizer...
2025-04-17 21:50:22,495 - INFO - Training regime-aware optimizer...
2025-04-17 21:50:22,495 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:22,495 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:22,495 - INFO - Trained optimizer for regime 0 with 13 samples
2025-04-17 21:50:22,496 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:22,496 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:22,496 - INFO - Trained optimizer for regime 1 with 8 samples
2025-04-17 21:50:22,496 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:22,496 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:22,496 - INFO - Trained optimizer for regime 2 with 9 samples
2025-04-17 21:50:22,497 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:22,497 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:22,497 - INFO - Trained optimizer for regime 3 with 7 samples
2025-04-17 21:50:22,497 - INFO - Training mean-variance optimizer...
2025-04-17 21:50:22,498 - INFO - Mean-variance optimizer training completed
2025-04-17 21:50:22,498 - INFO - Trained optimizer for regime 4 with 8 samples
2025-04-17 21:50:22,498 - WARNING - No samples found for regime 5
2025-04-17 21:50:22,498 - WARNING - No samples found for regime 6
2025-04-17 21:50:22,499 - INFO - Portfolio optimizer training completed
2025-04-17 21:50:22,499 - INFO - Optimizing portfolio weights...
2025-04-17 21:50:22,499 - INFO - Optimizing weights for regime 1
2025-04-17 21:50:22,500 - WARNING - All weights are zero, using equal weights
2025-04-17 21:50:22,501 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:22,502 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:22,503 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:22,504 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:22,505 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:22,506 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:22,507 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:22,507 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:22,509 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:22,510 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:22,510 - INFO - Optimizing weights for regime 2
2025-04-17 21:50:22,511 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:22,512 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:22,513 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:22,514 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:22,515 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:22,516 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:22,516 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:22,517 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:22,518 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:22,519 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:22,520 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:22,521 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:22,521 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:22,522 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:22,523 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:22,525 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:22,525 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:22,526 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:22,527 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:22,528 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:22,529 - INFO - Optimizing weights for regime 3
2025-04-17 21:50:22,530 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:22,531 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:22,532 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:22,533 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:22,534 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:22,534 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:22,535 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:22,536 - INFO - Optimizing weights for regime 4
2025-04-17 21:50:22,537 - INFO - Portfolio optimization completed
2025-04-17 21:50:22,537 - INFO - Initializing backtester...
2025-04-17 21:50:22,544 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 21:50:22,545 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 21:50:22,545 - INFO - Running backtest...
2025-04-17 21:50:22,545 - INFO - Starting backtest...
2025-04-17 21:50:22,545 - INFO - Calculating portfolio returns...
2025-04-17 21:50:22,546 - INFO - Calculating portfolio returns...
2025-04-17 21:50:22,547 - INFO - Calculated 41 portfolio returns
2025-04-17 21:50:22,547 - INFO - Calculating performance metrics...
2025-04-17 21:50:22,547 - INFO - Starting performance metrics calculation...
2025-04-17 21:50:22,547 - INFO - Calculating metrics...
2025-04-17 21:50:22,549 - INFO - Performance metrics calculation completed
2025-04-17 21:50:22,550 - INFO - Backtest completed
2025-04-17 21:50:22,550 - INFO - Backtest completed
2025-04-17 21:50:22,551 - INFO - Strategy execution completed
2025-04-17 21:50:22,551 - ERROR - Error running hmm with regime_aware and 7 regimes: 'MeanVarianceOptimizer' object has no attribute 'returns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 76, in run_parameter_grid
    regime_stats = strategy.portfolio_optimizer.get_regime_stats()
  File "C:\Users\ye\Desktop\factor_timing\optimizer\portfolio_optimizer.py", line 178, in get_regime_stats
    'n_samples': len(optimizer.returns),
                     ^^^^^^^^^^^^^^^^^
AttributeError: 'MeanVarianceOptimizer' object has no attribute 'returns'
2025-04-17 21:50:22,552 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 3 regimes
2025-04-17 21:50:22,552 - INFO - Initializing strategy...
2025-04-17 21:50:22,552 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 21:50:22,553 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:22,553 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:50:22,553 - ERROR - Error running hmm with neural_regime and 3 regimes: 'FactorTimingStrategy' object has no attribute 'factor_columns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 42, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 39, in __init__
    self.portfolio_optimizer = self._init_portfolio_optimizer(optimizer_type)
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 68, in _init_portfolio_optimizer
    input_size=len(self.factor_columns),
                   ^^^^^^^^^^^^^^^^^^^
AttributeError: 'FactorTimingStrategy' object has no attribute 'factor_columns'
2025-04-17 21:50:22,553 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 5 regimes
2025-04-17 21:50:22,554 - INFO - Initializing strategy...
2025-04-17 21:50:22,554 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 21:50:22,554 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:22,554 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:50:22,554 - ERROR - Error running hmm with neural_regime and 5 regimes: 'FactorTimingStrategy' object has no attribute 'factor_columns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 42, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 39, in __init__
    self.portfolio_optimizer = self._init_portfolio_optimizer(optimizer_type)
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 68, in _init_portfolio_optimizer
    input_size=len(self.factor_columns),
                   ^^^^^^^^^^^^^^^^^^^
AttributeError: 'FactorTimingStrategy' object has no attribute 'factor_columns'
2025-04-17 21:50:22,555 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 7 regimes
2025-04-17 21:50:22,555 - INFO - Initializing strategy...
2025-04-17 21:50:22,555 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 21:50:22,555 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:22,556 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:50:22,556 - ERROR - Error running hmm with neural_regime and 7 regimes: 'FactorTimingStrategy' object has no attribute 'factor_columns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 42, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 39, in __init__
    self.portfolio_optimizer = self._init_portfolio_optimizer(optimizer_type)
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 68, in _init_portfolio_optimizer
    input_size=len(self.factor_columns),
                   ^^^^^^^^^^^^^^^^^^^
AttributeError: 'FactorTimingStrategy' object has no attribute 'factor_columns'
2025-04-17 21:50:22,557 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 21:50:22,557 - INFO - Initializing strategy...
2025-04-17 21:50:22,558 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 21:50:22,558 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:22,558 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:50:22,558 - ERROR - Error running hmm with autoencoder_regime and 3 regimes: 'FactorTimingStrategy' object has no attribute 'factor_columns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 42, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 39, in __init__
    self.portfolio_optimizer = self._init_portfolio_optimizer(optimizer_type)
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 75, in _init_portfolio_optimizer
    input_size=len(self.factor_columns),
                   ^^^^^^^^^^^^^^^^^^^
AttributeError: 'FactorTimingStrategy' object has no attribute 'factor_columns'
2025-04-17 21:50:22,559 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 21:50:22,559 - INFO - Initializing strategy...
2025-04-17 21:50:22,559 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 21:50:22,560 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:22,560 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:50:22,560 - ERROR - Error running hmm with autoencoder_regime and 5 regimes: 'FactorTimingStrategy' object has no attribute 'factor_columns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 42, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 39, in __init__
    self.portfolio_optimizer = self._init_portfolio_optimizer(optimizer_type)
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 75, in _init_portfolio_optimizer
    input_size=len(self.factor_columns),
                   ^^^^^^^^^^^^^^^^^^^
AttributeError: 'FactorTimingStrategy' object has no attribute 'factor_columns'
2025-04-17 21:50:22,561 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 21:50:22,561 - INFO - Initializing strategy...
2025-04-17 21:50:22,561 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 21:50:22,561 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:22,561 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:50:22,562 - ERROR - Error running hmm with autoencoder_regime and 7 regimes: 'FactorTimingStrategy' object has no attribute 'factor_columns'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 42, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 39, in __init__
    self.portfolio_optimizer = self._init_portfolio_optimizer(optimizer_type)
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 75, in _init_portfolio_optimizer
    input_size=len(self.factor_columns),
                   ^^^^^^^^^^^^^^^^^^^
AttributeError: 'FactorTimingStrategy' object has no attribute 'factor_columns'
2025-04-17 21:50:22,562 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 3 regimes
2025-04-17 21:50:22,563 - INFO - Initializing strategy...
2025-04-17 21:50:22,563 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 21:50:22,563 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:22,563 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:50:22,564 - INFO - Running strategy...
2025-04-17 21:50:22,564 - INFO - Starting strategy execution...
2025-04-17 21:50:22,565 - INFO - Preparing training and testing data...
2025-04-17 21:50:22,565 - INFO - Starting data preparation...
2025-04-17 21:50:22,565 - INFO - Loading Fama-French factors...
2025-04-17 21:50:22,579 - INFO - Fama-French factors loaded
2025-04-17 21:50:22,579 - INFO - Processing factor data...
2025-04-17 21:50:22,582 - INFO - Factor data processed
2025-04-17 21:50:22,582 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:22,582 - INFO - 
Training Period:
2025-04-17 21:50:22,587 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:22,595 - INFO - 
Testing Period:
2025-04-17 21:50:22,600 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:22,608 - INFO - Loading macro and market data...
2025-04-17 21:50:22,609 - INFO - Loading existing macro data...
2025-04-17 21:50:22,612 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:22,613 - INFO - Loading existing macro data...
2025-04-17 21:50:22,623 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:22,623 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:22,626 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:22,626 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:22,627 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:22,628 - INFO - Loading existing market data...
2025-04-17 21:50:22,631 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:22,632 - INFO - Loading existing market data...
2025-04-17 21:50:22,635 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:22,635 - INFO - Macro and market data loaded
2025-04-17 21:50:22,636 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:22,636 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:22,637 - INFO - Loading existing macro data...
2025-04-17 21:50:22,646 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:22,646 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:22,649 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:22,649 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:22,650 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:22,651 - INFO - Loading existing market data...
2025-04-17 21:50:22,655 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:22,664 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:22,664 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:22,665 - INFO - Training data prepared
2025-04-17 21:50:22,665 - INFO - Storing data...
2025-04-17 21:50:22,665 - INFO - Aligning data indices...
2025-04-17 21:50:22,667 - INFO - Data indices aligned
2025-04-17 21:50:22,667 - INFO - Data preparation completed
2025-04-17 21:50:22,667 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:22,667 - INFO - Training models...
2025-04-17 21:50:22,667 - INFO - Starting model training...
2025-04-17 21:50:22,667 - INFO - Training regime classifier...
2025-04-17 21:50:22,667 - INFO - Training HMM model...
2025-04-17 21:50:22,903 - INFO - HMM model training completed
2025-04-17 21:50:23,117 - INFO - Model training completed
2025-04-17 21:50:23,119 - INFO - Model training completed
2025-04-17 21:50:23,120 - INFO - Initializing portfolio weights...
2025-04-17 21:50:23,120 - INFO - Portfolio weights initialized
2025-04-17 21:50:23,120 - INFO - Generating regime predictions for test period...
2025-04-17 21:50:23,122 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:50:23,125 - INFO - Generated 41 regime predictions
2025-04-17 21:50:23,125 - INFO - Calculating regime-specific returns...
2025-04-17 21:50:23,128 - INFO - Found 5 unique regimes
2025-04-17 21:50:23,128 - INFO - Processing regime 0...
2025-04-17 21:50:23,129 - INFO - Regime 0: 13 samples
2025-04-17 21:50:23,129 - INFO - Processing regime 1...
2025-04-17 21:50:23,130 - INFO - Regime 1: 8 samples
2025-04-17 21:50:23,130 - INFO - Processing regime 2...
2025-04-17 21:50:23,131 - INFO - Regime 2: 9 samples
2025-04-17 21:50:23,131 - INFO - Processing regime 3...
2025-04-17 21:50:23,132 - INFO - Regime 3: 7 samples
2025-04-17 21:50:23,132 - INFO - Processing regime 4...
2025-04-17 21:50:23,133 - INFO - Regime 4: 8 samples
2025-04-17 21:50:23,133 - INFO - Training portfolio optimizer...
2025-04-17 21:50:23,133 - ERROR - Error running hmm with neural and 3 regimes: 'NoneType' object has no attribute 'train'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 62, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 318, in run_strategy
    self.portfolio_optimizer.train(train_factors)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'train'
2025-04-17 21:50:23,134 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 5 regimes
2025-04-17 21:50:23,134 - INFO - Initializing strategy...
2025-04-17 21:50:23,134 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 21:50:23,134 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:23,135 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:50:23,135 - INFO - Running strategy...
2025-04-17 21:50:23,135 - INFO - Starting strategy execution...
2025-04-17 21:50:23,136 - INFO - Preparing training and testing data...
2025-04-17 21:50:23,136 - INFO - Starting data preparation...
2025-04-17 21:50:23,136 - INFO - Loading Fama-French factors...
2025-04-17 21:50:23,145 - INFO - Fama-French factors loaded
2025-04-17 21:50:23,145 - INFO - Processing factor data...
2025-04-17 21:50:23,148 - INFO - Factor data processed
2025-04-17 21:50:23,148 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:23,149 - INFO - 
Training Period:
2025-04-17 21:50:23,153 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:23,161 - INFO - 
Testing Period:
2025-04-17 21:50:23,166 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:23,174 - INFO - Loading macro and market data...
2025-04-17 21:50:23,176 - INFO - Loading existing macro data...
2025-04-17 21:50:23,180 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:23,181 - INFO - Loading existing macro data...
2025-04-17 21:50:23,191 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:23,191 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:23,195 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:23,195 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:23,196 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:23,197 - INFO - Loading existing market data...
2025-04-17 21:50:23,200 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:23,201 - INFO - Loading existing market data...
2025-04-17 21:50:23,205 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:23,205 - INFO - Macro and market data loaded
2025-04-17 21:50:23,205 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:23,206 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:23,207 - INFO - Loading existing macro data...
2025-04-17 21:50:23,217 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:23,217 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:23,220 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:23,220 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:23,221 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:23,222 - INFO - Loading existing market data...
2025-04-17 21:50:23,227 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:23,237 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:23,238 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:23,238 - INFO - Training data prepared
2025-04-17 21:50:23,239 - INFO - Storing data...
2025-04-17 21:50:23,239 - INFO - Aligning data indices...
2025-04-17 21:50:23,240 - INFO - Data indices aligned
2025-04-17 21:50:23,240 - INFO - Data preparation completed
2025-04-17 21:50:23,240 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:23,241 - INFO - Training models...
2025-04-17 21:50:23,241 - INFO - Starting model training...
2025-04-17 21:50:23,241 - INFO - Training regime classifier...
2025-04-17 21:50:23,241 - INFO - Training HMM model...
2025-04-17 21:50:23,467 - INFO - HMM model training completed
2025-04-17 21:50:23,671 - INFO - Model training completed
2025-04-17 21:50:23,673 - INFO - Model training completed
2025-04-17 21:50:23,673 - INFO - Initializing portfolio weights...
2025-04-17 21:50:23,674 - INFO - Portfolio weights initialized
2025-04-17 21:50:23,674 - INFO - Generating regime predictions for test period...
2025-04-17 21:50:23,675 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:50:23,678 - INFO - Generated 41 regime predictions
2025-04-17 21:50:23,678 - INFO - Calculating regime-specific returns...
2025-04-17 21:50:23,682 - INFO - Found 5 unique regimes
2025-04-17 21:50:23,682 - INFO - Processing regime 0...
2025-04-17 21:50:23,683 - INFO - Regime 0: 13 samples
2025-04-17 21:50:23,683 - INFO - Processing regime 1...
2025-04-17 21:50:23,684 - INFO - Regime 1: 8 samples
2025-04-17 21:50:23,684 - INFO - Processing regime 2...
2025-04-17 21:50:23,685 - INFO - Regime 2: 9 samples
2025-04-17 21:50:23,685 - INFO - Processing regime 3...
2025-04-17 21:50:23,686 - INFO - Regime 3: 7 samples
2025-04-17 21:50:23,686 - INFO - Processing regime 4...
2025-04-17 21:50:23,686 - INFO - Regime 4: 8 samples
2025-04-17 21:50:23,687 - INFO - Training portfolio optimizer...
2025-04-17 21:50:23,687 - ERROR - Error running hmm with neural and 5 regimes: 'NoneType' object has no attribute 'train'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 62, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 318, in run_strategy
    self.portfolio_optimizer.train(train_factors)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'train'
2025-04-17 21:50:23,688 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 7 regimes
2025-04-17 21:50:23,688 - INFO - Initializing strategy...
2025-04-17 21:50:23,688 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 21:50:23,688 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:50:23,688 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:50:23,689 - INFO - Running strategy...
2025-04-17 21:50:23,689 - INFO - Starting strategy execution...
2025-04-17 21:50:23,690 - INFO - Preparing training and testing data...
2025-04-17 21:50:23,690 - INFO - Starting data preparation...
2025-04-17 21:50:23,690 - INFO - Loading Fama-French factors...
2025-04-17 21:50:23,699 - INFO - Fama-French factors loaded
2025-04-17 21:50:23,699 - INFO - Processing factor data...
2025-04-17 21:50:23,701 - INFO - Factor data processed
2025-04-17 21:50:23,702 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:50:23,702 - INFO - 
Training Period:
2025-04-17 21:50:23,706 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:50:23,714 - INFO - 
Testing Period:
2025-04-17 21:50:23,718 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:50:23,726 - INFO - Loading macro and market data...
2025-04-17 21:50:23,727 - INFO - Loading existing macro data...
2025-04-17 21:50:23,731 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:50:23,732 - INFO - Loading existing macro data...
2025-04-17 21:50:23,741 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:23,741 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:23,744 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:23,744 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:50:23,744 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:50:23,745 - INFO - Loading existing market data...
2025-04-17 21:50:23,749 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:23,750 - INFO - Loading existing market data...
2025-04-17 21:50:23,754 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:50:23,754 - INFO - Macro and market data loaded
2025-04-17 21:50:23,754 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:23,754 - INFO - Preparing training data for regime classification...
2025-04-17 21:50:23,755 - INFO - Loading existing macro data...
2025-04-17 21:50:23,765 - WARNING - US corporate credit spread file not found
2025-04-17 21:50:23,766 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:50:23,769 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:50:23,769 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:50:23,769 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:50:23,771 - INFO - Loading existing market data...
2025-04-17 21:50:23,775 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:50:23,785 - INFO - Prepared training data with 1536 samples
2025-04-17 21:50:23,786 - INFO - Class distribution: {0: 448, 2: 322, 4: 318, 3: 255, 1: 193}
2025-04-17 21:50:23,787 - INFO - Training data prepared
2025-04-17 21:50:23,787 - INFO - Storing data...
2025-04-17 21:50:23,787 - INFO - Aligning data indices...
2025-04-17 21:50:23,788 - INFO - Data indices aligned
2025-04-17 21:50:23,789 - INFO - Data preparation completed
2025-04-17 21:50:23,789 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:50:23,789 - INFO - Training models...
2025-04-17 21:50:23,789 - INFO - Starting model training...
2025-04-17 21:50:23,789 - INFO - Training regime classifier...
2025-04-17 21:50:23,790 - INFO - Training HMM model...
2025-04-17 21:50:24,016 - INFO - HMM model training completed
2025-04-17 21:50:24,230 - INFO - Model training completed
2025-04-17 21:50:24,232 - INFO - Model training completed
2025-04-17 21:50:24,232 - INFO - Initializing portfolio weights...
2025-04-17 21:50:24,233 - INFO - Portfolio weights initialized
2025-04-17 21:50:24,233 - INFO - Generating regime predictions for test period...
2025-04-17 21:50:24,235 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:50:24,238 - INFO - Generated 41 regime predictions
2025-04-17 21:50:24,238 - INFO - Calculating regime-specific returns...
2025-04-17 21:50:24,242 - INFO - Found 5 unique regimes
2025-04-17 21:50:24,242 - INFO - Processing regime 0...
2025-04-17 21:50:24,243 - INFO - Regime 0: 13 samples
2025-04-17 21:50:24,243 - INFO - Processing regime 1...
2025-04-17 21:50:24,244 - INFO - Regime 1: 8 samples
2025-04-17 21:50:24,244 - INFO - Processing regime 2...
2025-04-17 21:50:24,245 - INFO - Regime 2: 9 samples
2025-04-17 21:50:24,245 - INFO - Processing regime 3...
2025-04-17 21:50:24,246 - INFO - Regime 3: 7 samples
2025-04-17 21:50:24,246 - INFO - Processing regime 4...
2025-04-17 21:50:24,246 - INFO - Regime 4: 8 samples
2025-04-17 21:50:24,247 - INFO - Training portfolio optimizer...
2025-04-17 21:50:24,247 - ERROR - Error running hmm with neural and 7 regimes: 'NoneType' object has no attribute 'train'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 62, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 318, in run_strategy
    self.portfolio_optimizer.train(train_factors)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'train'
2025-04-17 21:50:24,248 - INFO - Analyzing results...
2025-04-17 21:50:24,249 - INFO - 
Strategy Performance Comparison:
2025-04-17 21:50:24,250 - INFO -   Model     Optimizer  Regimes  Sharpe Ratio  Annualized Return  Annualized Volatility  Max Drawdown
xgboost mean_variance        3       5.16876           0.086821               0.369195     -0.055897
xgboost mean_variance        5       5.16876           0.086821               0.369195     -0.055897
xgboost mean_variance        7       5.16876           0.086821               0.369195     -0.055897
    hmm mean_variance        3       5.16876           0.086821               0.369195     -0.055897
    hmm mean_variance        5       5.16876           0.086821               0.369195     -0.055897
    hmm mean_variance        7       5.16876           0.086821               0.369195     -0.055897
2025-04-17 21:50:24,766 - INFO - Results saved to strategy_results.csv
2025-04-17 21:50:24,767 - INFO - 
Summary Statistics:
2025-04-17 21:50:24,767 - INFO - 
Sharpe Ratio Statistics:
2025-04-17 21:50:24,767 - INFO - Mean: 5.1688
2025-04-17 21:50:24,768 - INFO - Std: 0.0000
2025-04-17 21:50:24,768 - INFO - Min: 5.1688
2025-04-17 21:50:24,768 - INFO - Max: 5.1688
2025-04-17 21:50:24,768 - INFO - 
Annualized Return Statistics:
2025-04-17 21:50:24,769 - INFO - Mean: 0.0868
2025-04-17 21:50:24,769 - INFO - Std: 0.0000
2025-04-17 21:50:24,769 - INFO - Min: 0.0868
2025-04-17 21:50:24,769 - INFO - Max: 0.0868
2025-04-17 21:50:24,770 - INFO - 
Annualized Volatility Statistics:
2025-04-17 21:50:24,770 - INFO - Mean: 0.3692
2025-04-17 21:50:24,770 - INFO - Std: 0.0000
2025-04-17 21:50:24,771 - INFO - Min: 0.3692
2025-04-17 21:50:24,771 - INFO - Max: 0.3692
2025-04-17 21:50:24,771 - INFO - 
Max Drawdown Statistics:
2025-04-17 21:50:24,771 - INFO - Mean: -0.0559
2025-04-17 21:50:24,772 - INFO - Std: 0.0000
2025-04-17 21:50:24,772 - INFO - Min: -0.0559
2025-04-17 21:50:24,772 - INFO - Max: -0.0559
2025-04-17 21:50:24,773 - INFO - 
Best Performing Combination:
2025-04-17 21:50:24,773 - INFO - Model: xgboost
2025-04-17 21:50:24,773 - INFO - Optimizer: mean_variance
2025-04-17 21:50:24,773 - INFO - Regimes: 3
2025-04-17 21:50:24,773 - INFO - Sharpe Ratio: 5.1688
2025-04-17 21:50:24,774 - INFO - Annualized Return: 0.0868
2025-04-17 21:50:24,774 - INFO - Factor timing strategy optimization completed
2025-04-17 21:55:44,066 - INFO - Starting factor timing strategy optimization...
2025-04-17 21:55:44,066 - INFO - Running parameter grid search...
2025-04-17 21:55:44,066 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 3 regimes
2025-04-17 21:55:44,067 - INFO - Initializing strategy...
2025-04-17 21:55:44,067 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 21:55:44,067 - ERROR - Error running lstm with mean_variance and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:55:44,069 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 5 regimes
2025-04-17 21:55:44,069 - INFO - Initializing strategy...
2025-04-17 21:55:44,070 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 21:55:44,071 - ERROR - Error running lstm with mean_variance and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:55:44,072 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 7 regimes
2025-04-17 21:55:44,072 - INFO - Initializing strategy...
2025-04-17 21:55:44,072 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 21:55:44,073 - ERROR - Error running lstm with mean_variance and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:55:44,074 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 3 regimes
2025-04-17 21:55:44,074 - INFO - Initializing strategy...
2025-04-17 21:55:44,074 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 21:55:44,075 - ERROR - Error running lstm with regime_aware and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:55:44,076 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 5 regimes
2025-04-17 21:55:44,076 - INFO - Initializing strategy...
2025-04-17 21:55:44,076 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 21:55:44,077 - ERROR - Error running lstm with regime_aware and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:55:44,078 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 7 regimes
2025-04-17 21:55:44,078 - INFO - Initializing strategy...
2025-04-17 21:55:44,079 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 21:55:44,079 - ERROR - Error running lstm with regime_aware and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:55:44,080 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 3 regimes
2025-04-17 21:55:44,080 - INFO - Initializing strategy...
2025-04-17 21:55:44,081 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 21:55:44,081 - ERROR - Error running lstm with neural_regime and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:55:44,082 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 5 regimes
2025-04-17 21:55:44,083 - INFO - Initializing strategy...
2025-04-17 21:55:44,083 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 21:55:44,083 - ERROR - Error running lstm with neural_regime and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:55:44,084 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 7 regimes
2025-04-17 21:55:44,084 - INFO - Initializing strategy...
2025-04-17 21:55:44,084 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 21:55:44,085 - ERROR - Error running lstm with neural_regime and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:55:44,086 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 21:55:44,086 - INFO - Initializing strategy...
2025-04-17 21:55:44,086 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 21:55:44,087 - ERROR - Error running lstm with autoencoder_regime and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:55:44,087 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 21:55:44,088 - INFO - Initializing strategy...
2025-04-17 21:55:44,088 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 21:55:44,089 - ERROR - Error running lstm with autoencoder_regime and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:55:44,090 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 21:55:44,090 - INFO - Initializing strategy...
2025-04-17 21:55:44,090 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 21:55:44,091 - ERROR - Error running lstm with autoencoder_regime and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:55:44,092 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 3 regimes
2025-04-17 21:55:44,092 - INFO - Initializing strategy...
2025-04-17 21:55:44,093 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 21:55:44,093 - ERROR - Error running lstm with neural and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:55:44,094 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 5 regimes
2025-04-17 21:55:44,094 - INFO - Initializing strategy...
2025-04-17 21:55:44,095 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 21:55:44,095 - ERROR - Error running lstm with neural and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:55:44,096 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 7 regimes
2025-04-17 21:55:44,096 - INFO - Initializing strategy...
2025-04-17 21:55:44,096 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 21:55:44,097 - ERROR - Error running lstm with neural and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:55:44,098 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 3 regimes
2025-04-17 21:55:44,098 - INFO - Initializing strategy...
2025-04-17 21:55:44,098 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 21:55:44,098 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:44,120 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:55:44,120 - INFO - Running strategy...
2025-04-17 21:55:44,121 - INFO - Starting strategy execution...
2025-04-17 21:55:44,121 - INFO - Preparing training and testing data...
2025-04-17 21:55:44,121 - INFO - Starting data preparation...
2025-04-17 21:55:44,122 - INFO - Loading Fama-French factors...
2025-04-17 21:55:44,138 - INFO - Fama-French factors loaded
2025-04-17 21:55:44,139 - INFO - Processing factor data...
2025-04-17 21:55:44,141 - INFO - Factor data processed
2025-04-17 21:55:44,142 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:44,142 - INFO - 
Training Period:
2025-04-17 21:55:44,147 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:44,157 - INFO - 
Testing Period:
2025-04-17 21:55:44,162 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:44,170 - INFO - Loading macro and market data...
2025-04-17 21:55:44,171 - INFO - Loading existing macro data...
2025-04-17 21:55:44,175 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:44,176 - INFO - Loading existing macro data...
2025-04-17 21:55:44,185 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:44,186 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:44,190 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:44,191 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:44,191 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:44,192 - INFO - Loading existing market data...
2025-04-17 21:55:44,196 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:44,197 - INFO - Loading existing market data...
2025-04-17 21:55:44,201 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:44,202 - INFO - Macro and market data loaded
2025-04-17 21:55:44,202 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:44,202 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:44,203 - INFO - Loading existing macro data...
2025-04-17 21:55:44,213 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:44,213 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:44,216 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:44,217 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:44,217 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:44,218 - INFO - Loading existing market data...
2025-04-17 21:55:44,222 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:44,225 - ERROR - Error running xgboost with mean_variance and 3 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:44,228 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 5 regimes
2025-04-17 21:55:44,229 - INFO - Initializing strategy...
2025-04-17 21:55:44,229 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 21:55:44,229 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:44,230 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:55:44,230 - INFO - Running strategy...
2025-04-17 21:55:44,230 - INFO - Starting strategy execution...
2025-04-17 21:55:44,230 - INFO - Preparing training and testing data...
2025-04-17 21:55:44,231 - INFO - Starting data preparation...
2025-04-17 21:55:44,231 - INFO - Loading Fama-French factors...
2025-04-17 21:55:44,240 - INFO - Fama-French factors loaded
2025-04-17 21:55:44,240 - INFO - Processing factor data...
2025-04-17 21:55:44,243 - INFO - Factor data processed
2025-04-17 21:55:44,243 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:44,244 - INFO - 
Training Period:
2025-04-17 21:55:44,249 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:44,256 - INFO - 
Testing Period:
2025-04-17 21:55:44,262 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:44,270 - INFO - Loading macro and market data...
2025-04-17 21:55:44,271 - INFO - Loading existing macro data...
2025-04-17 21:55:44,274 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:44,276 - INFO - Loading existing macro data...
2025-04-17 21:55:44,285 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:44,286 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:44,289 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:44,289 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:44,290 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:44,291 - INFO - Loading existing market data...
2025-04-17 21:55:44,295 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:44,296 - INFO - Loading existing market data...
2025-04-17 21:55:44,298 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:44,299 - INFO - Macro and market data loaded
2025-04-17 21:55:44,299 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:44,299 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:44,300 - INFO - Loading existing macro data...
2025-04-17 21:55:44,310 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:44,311 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:44,314 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:44,314 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:44,314 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:44,315 - INFO - Loading existing market data...
2025-04-17 21:55:44,318 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:44,321 - ERROR - Error running xgboost with mean_variance and 5 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:44,323 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 7 regimes
2025-04-17 21:55:44,324 - INFO - Initializing strategy...
2025-04-17 21:55:44,324 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 21:55:44,324 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:44,325 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:55:44,325 - INFO - Running strategy...
2025-04-17 21:55:44,326 - INFO - Starting strategy execution...
2025-04-17 21:55:44,326 - INFO - Preparing training and testing data...
2025-04-17 21:55:44,326 - INFO - Starting data preparation...
2025-04-17 21:55:44,326 - INFO - Loading Fama-French factors...
2025-04-17 21:55:44,337 - INFO - Fama-French factors loaded
2025-04-17 21:55:44,337 - INFO - Processing factor data...
2025-04-17 21:55:44,340 - INFO - Factor data processed
2025-04-17 21:55:44,340 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:44,340 - INFO - 
Training Period:
2025-04-17 21:55:44,345 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:44,353 - INFO - 
Testing Period:
2025-04-17 21:55:44,358 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:44,365 - INFO - Loading macro and market data...
2025-04-17 21:55:44,366 - INFO - Loading existing macro data...
2025-04-17 21:55:44,370 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:44,371 - INFO - Loading existing macro data...
2025-04-17 21:55:44,380 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:44,380 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:44,383 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:44,384 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:44,384 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:44,386 - INFO - Loading existing market data...
2025-04-17 21:55:44,389 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:44,391 - INFO - Loading existing market data...
2025-04-17 21:55:44,394 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:44,394 - INFO - Macro and market data loaded
2025-04-17 21:55:44,394 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:44,395 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:44,396 - INFO - Loading existing macro data...
2025-04-17 21:55:44,405 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:44,405 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:44,408 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:44,409 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:44,409 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:44,410 - INFO - Loading existing market data...
2025-04-17 21:55:44,415 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:44,418 - ERROR - Error running xgboost with mean_variance and 7 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:44,419 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 3 regimes
2025-04-17 21:55:44,420 - INFO - Initializing strategy...
2025-04-17 21:55:44,420 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 21:55:44,421 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:44,421 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:55:44,421 - INFO - Running strategy...
2025-04-17 21:55:44,422 - INFO - Starting strategy execution...
2025-04-17 21:55:44,422 - INFO - Preparing training and testing data...
2025-04-17 21:55:44,422 - INFO - Starting data preparation...
2025-04-17 21:55:44,422 - INFO - Loading Fama-French factors...
2025-04-17 21:55:44,431 - INFO - Fama-French factors loaded
2025-04-17 21:55:44,431 - INFO - Processing factor data...
2025-04-17 21:55:44,434 - INFO - Factor data processed
2025-04-17 21:55:44,434 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:44,435 - INFO - 
Training Period:
2025-04-17 21:55:44,439 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:44,447 - INFO - 
Testing Period:
2025-04-17 21:55:44,452 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:44,460 - INFO - Loading macro and market data...
2025-04-17 21:55:44,461 - INFO - Loading existing macro data...
2025-04-17 21:55:44,464 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:44,465 - INFO - Loading existing macro data...
2025-04-17 21:55:44,474 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:44,475 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:44,478 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:44,478 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:44,478 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:44,479 - INFO - Loading existing market data...
2025-04-17 21:55:44,484 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:44,485 - INFO - Loading existing market data...
2025-04-17 21:55:44,488 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:44,488 - INFO - Macro and market data loaded
2025-04-17 21:55:44,488 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:44,488 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:44,489 - INFO - Loading existing macro data...
2025-04-17 21:55:44,500 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:44,501 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:44,503 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:44,504 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:44,504 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:44,505 - INFO - Loading existing market data...
2025-04-17 21:55:44,510 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:44,513 - ERROR - Error running xgboost with regime_aware and 3 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:44,515 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 5 regimes
2025-04-17 21:55:44,515 - INFO - Initializing strategy...
2025-04-17 21:55:44,516 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 21:55:44,516 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:44,516 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:55:44,517 - INFO - Running strategy...
2025-04-17 21:55:44,517 - INFO - Starting strategy execution...
2025-04-17 21:55:44,517 - INFO - Preparing training and testing data...
2025-04-17 21:55:44,518 - INFO - Starting data preparation...
2025-04-17 21:55:44,518 - INFO - Loading Fama-French factors...
2025-04-17 21:55:44,527 - INFO - Fama-French factors loaded
2025-04-17 21:55:44,528 - INFO - Processing factor data...
2025-04-17 21:55:44,530 - INFO - Factor data processed
2025-04-17 21:55:44,531 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:44,531 - INFO - 
Training Period:
2025-04-17 21:55:44,535 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:44,543 - INFO - 
Testing Period:
2025-04-17 21:55:44,549 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:44,556 - INFO - Loading macro and market data...
2025-04-17 21:55:44,558 - INFO - Loading existing macro data...
2025-04-17 21:55:44,561 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:44,562 - INFO - Loading existing macro data...
2025-04-17 21:55:44,571 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:44,572 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:44,574 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:44,575 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:44,575 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:44,578 - INFO - Loading existing market data...
2025-04-17 21:55:44,582 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:44,583 - INFO - Loading existing market data...
2025-04-17 21:55:44,586 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:44,586 - INFO - Macro and market data loaded
2025-04-17 21:55:44,586 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:44,587 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:44,588 - INFO - Loading existing macro data...
2025-04-17 21:55:44,598 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:44,598 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:44,601 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:44,601 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:44,602 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:44,603 - INFO - Loading existing market data...
2025-04-17 21:55:44,606 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:44,609 - ERROR - Error running xgboost with regime_aware and 5 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:44,610 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 7 regimes
2025-04-17 21:55:44,611 - INFO - Initializing strategy...
2025-04-17 21:55:44,611 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 21:55:44,611 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:44,611 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:55:44,612 - INFO - Running strategy...
2025-04-17 21:55:44,612 - INFO - Starting strategy execution...
2025-04-17 21:55:44,612 - INFO - Preparing training and testing data...
2025-04-17 21:55:44,612 - INFO - Starting data preparation...
2025-04-17 21:55:44,613 - INFO - Loading Fama-French factors...
2025-04-17 21:55:44,622 - INFO - Fama-French factors loaded
2025-04-17 21:55:44,623 - INFO - Processing factor data...
2025-04-17 21:55:44,625 - INFO - Factor data processed
2025-04-17 21:55:44,626 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:44,626 - INFO - 
Training Period:
2025-04-17 21:55:44,630 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:44,637 - INFO - 
Testing Period:
2025-04-17 21:55:44,643 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:44,651 - INFO - Loading macro and market data...
2025-04-17 21:55:44,652 - INFO - Loading existing macro data...
2025-04-17 21:55:44,655 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:44,656 - INFO - Loading existing macro data...
2025-04-17 21:55:44,665 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:44,665 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:44,668 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:44,668 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:44,669 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:44,670 - INFO - Loading existing market data...
2025-04-17 21:55:44,673 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:44,674 - INFO - Loading existing market data...
2025-04-17 21:55:44,677 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:44,677 - INFO - Macro and market data loaded
2025-04-17 21:55:44,678 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:44,678 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:44,679 - INFO - Loading existing macro data...
2025-04-17 21:55:44,690 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:44,691 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:44,693 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:44,693 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:44,694 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:44,695 - INFO - Loading existing market data...
2025-04-17 21:55:44,699 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:44,703 - ERROR - Error running xgboost with regime_aware and 7 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:44,705 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 3 regimes
2025-04-17 21:55:44,705 - INFO - Initializing strategy...
2025-04-17 21:55:44,705 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 21:55:44,706 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:44,706 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:55:44,707 - INFO - Running strategy...
2025-04-17 21:55:44,707 - INFO - Starting strategy execution...
2025-04-17 21:55:44,707 - INFO - Preparing training and testing data...
2025-04-17 21:55:44,707 - INFO - Starting data preparation...
2025-04-17 21:55:44,707 - INFO - Loading Fama-French factors...
2025-04-17 21:55:44,717 - INFO - Fama-French factors loaded
2025-04-17 21:55:44,717 - INFO - Processing factor data...
2025-04-17 21:55:44,719 - INFO - Factor data processed
2025-04-17 21:55:44,720 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:44,720 - INFO - 
Training Period:
2025-04-17 21:55:44,725 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:44,734 - INFO - 
Testing Period:
2025-04-17 21:55:44,739 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:44,746 - INFO - Loading macro and market data...
2025-04-17 21:55:44,747 - INFO - Loading existing macro data...
2025-04-17 21:55:44,750 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:44,752 - INFO - Loading existing macro data...
2025-04-17 21:55:44,760 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:44,760 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:44,764 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:44,764 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:44,765 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:44,766 - INFO - Loading existing market data...
2025-04-17 21:55:44,769 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:44,771 - INFO - Loading existing market data...
2025-04-17 21:55:44,774 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:44,774 - INFO - Macro and market data loaded
2025-04-17 21:55:44,775 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:44,775 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:44,776 - INFO - Loading existing macro data...
2025-04-17 21:55:44,787 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:44,787 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:44,790 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:44,790 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:44,791 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:44,792 - INFO - Loading existing market data...
2025-04-17 21:55:44,795 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:44,798 - ERROR - Error running xgboost with neural_regime and 3 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:44,799 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 5 regimes
2025-04-17 21:55:44,799 - INFO - Initializing strategy...
2025-04-17 21:55:44,799 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 21:55:44,800 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:44,800 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:55:44,800 - INFO - Running strategy...
2025-04-17 21:55:44,800 - INFO - Starting strategy execution...
2025-04-17 21:55:44,801 - INFO - Preparing training and testing data...
2025-04-17 21:55:44,801 - INFO - Starting data preparation...
2025-04-17 21:55:44,801 - INFO - Loading Fama-French factors...
2025-04-17 21:55:44,812 - INFO - Fama-French factors loaded
2025-04-17 21:55:44,812 - INFO - Processing factor data...
2025-04-17 21:55:44,815 - INFO - Factor data processed
2025-04-17 21:55:44,816 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:44,816 - INFO - 
Training Period:
2025-04-17 21:55:44,820 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:44,828 - INFO - 
Testing Period:
2025-04-17 21:55:44,833 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:44,840 - INFO - Loading macro and market data...
2025-04-17 21:55:44,841 - INFO - Loading existing macro data...
2025-04-17 21:55:44,844 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:44,846 - INFO - Loading existing macro data...
2025-04-17 21:55:44,856 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:44,857 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:44,859 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:44,860 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:44,860 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:44,862 - INFO - Loading existing market data...
2025-04-17 21:55:44,865 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:44,867 - INFO - Loading existing market data...
2025-04-17 21:55:44,871 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:44,871 - INFO - Macro and market data loaded
2025-04-17 21:55:44,871 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:44,872 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:44,873 - INFO - Loading existing macro data...
2025-04-17 21:55:44,882 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:44,882 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:44,885 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:44,885 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:44,886 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:44,887 - INFO - Loading existing market data...
2025-04-17 21:55:44,891 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:44,894 - ERROR - Error running xgboost with neural_regime and 5 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:44,895 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 7 regimes
2025-04-17 21:55:44,896 - INFO - Initializing strategy...
2025-04-17 21:55:44,896 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 21:55:44,896 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:44,897 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:55:44,897 - INFO - Running strategy...
2025-04-17 21:55:44,897 - INFO - Starting strategy execution...
2025-04-17 21:55:44,898 - INFO - Preparing training and testing data...
2025-04-17 21:55:44,898 - INFO - Starting data preparation...
2025-04-17 21:55:44,898 - INFO - Loading Fama-French factors...
2025-04-17 21:55:44,907 - INFO - Fama-French factors loaded
2025-04-17 21:55:44,907 - INFO - Processing factor data...
2025-04-17 21:55:44,910 - INFO - Factor data processed
2025-04-17 21:55:44,910 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:44,911 - INFO - 
Training Period:
2025-04-17 21:55:44,915 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:44,923 - INFO - 
Testing Period:
2025-04-17 21:55:44,928 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:44,935 - INFO - Loading macro and market data...
2025-04-17 21:55:44,937 - INFO - Loading existing macro data...
2025-04-17 21:55:44,940 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:44,941 - INFO - Loading existing macro data...
2025-04-17 21:55:44,951 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:44,952 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:44,955 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:44,956 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:44,956 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:44,957 - INFO - Loading existing market data...
2025-04-17 21:55:44,961 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:44,962 - INFO - Loading existing market data...
2025-04-17 21:55:44,965 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:44,965 - INFO - Macro and market data loaded
2025-04-17 21:55:44,965 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:44,965 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:44,967 - INFO - Loading existing macro data...
2025-04-17 21:55:44,977 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:44,977 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:44,980 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:44,980 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:44,981 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:44,982 - INFO - Loading existing market data...
2025-04-17 21:55:44,986 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:44,989 - ERROR - Error running xgboost with neural_regime and 7 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:44,991 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 21:55:44,991 - INFO - Initializing strategy...
2025-04-17 21:55:44,992 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 21:55:44,992 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:44,993 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:55:44,993 - INFO - Running strategy...
2025-04-17 21:55:44,993 - INFO - Starting strategy execution...
2025-04-17 21:55:44,993 - INFO - Preparing training and testing data...
2025-04-17 21:55:44,993 - INFO - Starting data preparation...
2025-04-17 21:55:44,994 - INFO - Loading Fama-French factors...
2025-04-17 21:55:45,004 - INFO - Fama-French factors loaded
2025-04-17 21:55:45,005 - INFO - Processing factor data...
2025-04-17 21:55:45,007 - INFO - Factor data processed
2025-04-17 21:55:45,007 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:45,007 - INFO - 
Training Period:
2025-04-17 21:55:45,011 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:45,020 - INFO - 
Testing Period:
2025-04-17 21:55:45,024 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:45,032 - INFO - Loading macro and market data...
2025-04-17 21:55:45,033 - INFO - Loading existing macro data...
2025-04-17 21:55:45,036 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:45,037 - INFO - Loading existing macro data...
2025-04-17 21:55:45,046 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:45,046 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:45,049 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:45,049 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:45,050 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:45,051 - INFO - Loading existing market data...
2025-04-17 21:55:45,055 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:45,056 - INFO - Loading existing market data...
2025-04-17 21:55:45,060 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:45,060 - INFO - Macro and market data loaded
2025-04-17 21:55:45,060 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:45,060 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:45,061 - INFO - Loading existing macro data...
2025-04-17 21:55:45,071 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:45,072 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:45,075 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:45,075 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:45,076 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:45,077 - INFO - Loading existing market data...
2025-04-17 21:55:45,081 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:45,084 - ERROR - Error running xgboost with autoencoder_regime and 3 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:45,085 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 21:55:45,086 - INFO - Initializing strategy...
2025-04-17 21:55:45,086 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 21:55:45,086 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:45,087 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:55:45,087 - INFO - Running strategy...
2025-04-17 21:55:45,087 - INFO - Starting strategy execution...
2025-04-17 21:55:45,088 - INFO - Preparing training and testing data...
2025-04-17 21:55:45,088 - INFO - Starting data preparation...
2025-04-17 21:55:45,088 - INFO - Loading Fama-French factors...
2025-04-17 21:55:45,097 - INFO - Fama-French factors loaded
2025-04-17 21:55:45,097 - INFO - Processing factor data...
2025-04-17 21:55:45,100 - INFO - Factor data processed
2025-04-17 21:55:45,100 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:45,101 - INFO - 
Training Period:
2025-04-17 21:55:45,105 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:45,113 - INFO - 
Testing Period:
2025-04-17 21:55:45,119 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:45,127 - INFO - Loading macro and market data...
2025-04-17 21:55:45,129 - INFO - Loading existing macro data...
2025-04-17 21:55:45,131 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:45,133 - INFO - Loading existing macro data...
2025-04-17 21:55:45,142 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:45,143 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:45,145 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:45,145 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:45,146 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:45,147 - INFO - Loading existing market data...
2025-04-17 21:55:45,151 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:45,152 - INFO - Loading existing market data...
2025-04-17 21:55:45,155 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:45,155 - INFO - Macro and market data loaded
2025-04-17 21:55:45,155 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:45,155 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:45,156 - INFO - Loading existing macro data...
2025-04-17 21:55:45,167 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:45,167 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:45,170 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:45,171 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:45,171 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:45,172 - INFO - Loading existing market data...
2025-04-17 21:55:45,176 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:45,180 - ERROR - Error running xgboost with autoencoder_regime and 5 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:45,182 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 21:55:45,182 - INFO - Initializing strategy...
2025-04-17 21:55:45,182 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 21:55:45,183 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:45,183 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:55:45,183 - INFO - Running strategy...
2025-04-17 21:55:45,184 - INFO - Starting strategy execution...
2025-04-17 21:55:45,184 - INFO - Preparing training and testing data...
2025-04-17 21:55:45,184 - INFO - Starting data preparation...
2025-04-17 21:55:45,185 - INFO - Loading Fama-French factors...
2025-04-17 21:55:45,194 - INFO - Fama-French factors loaded
2025-04-17 21:55:45,195 - INFO - Processing factor data...
2025-04-17 21:55:45,197 - INFO - Factor data processed
2025-04-17 21:55:45,197 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:45,198 - INFO - 
Training Period:
2025-04-17 21:55:45,202 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:45,210 - INFO - 
Testing Period:
2025-04-17 21:55:45,214 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:45,223 - INFO - Loading macro and market data...
2025-04-17 21:55:45,224 - INFO - Loading existing macro data...
2025-04-17 21:55:45,227 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:45,228 - INFO - Loading existing macro data...
2025-04-17 21:55:45,237 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:45,237 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:45,241 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:45,241 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:45,241 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:45,243 - INFO - Loading existing market data...
2025-04-17 21:55:45,248 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:45,249 - INFO - Loading existing market data...
2025-04-17 21:55:45,252 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:45,252 - INFO - Macro and market data loaded
2025-04-17 21:55:45,253 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:45,253 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:45,254 - INFO - Loading existing macro data...
2025-04-17 21:55:45,264 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:45,264 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:45,267 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:45,268 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:45,268 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:45,269 - INFO - Loading existing market data...
2025-04-17 21:55:45,272 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:45,275 - ERROR - Error running xgboost with autoencoder_regime and 7 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:45,276 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 3 regimes
2025-04-17 21:55:45,276 - INFO - Initializing strategy...
2025-04-17 21:55:45,277 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 21:55:45,277 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:45,277 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:55:46,345 - INFO - Running strategy...
2025-04-17 21:55:46,345 - INFO - Starting strategy execution...
2025-04-17 21:55:46,345 - INFO - Preparing training and testing data...
2025-04-17 21:55:46,346 - INFO - Starting data preparation...
2025-04-17 21:55:46,346 - INFO - Loading Fama-French factors...
2025-04-17 21:55:46,357 - INFO - Fama-French factors loaded
2025-04-17 21:55:46,357 - INFO - Processing factor data...
2025-04-17 21:55:46,360 - INFO - Factor data processed
2025-04-17 21:55:46,361 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:46,361 - INFO - 
Training Period:
2025-04-17 21:55:46,367 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:46,377 - INFO - 
Testing Period:
2025-04-17 21:55:46,381 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:46,389 - INFO - Loading macro and market data...
2025-04-17 21:55:46,391 - INFO - Loading existing macro data...
2025-04-17 21:55:46,394 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:46,395 - INFO - Loading existing macro data...
2025-04-17 21:55:46,404 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:46,405 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:46,408 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:46,408 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:46,409 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:46,410 - INFO - Loading existing market data...
2025-04-17 21:55:46,414 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:46,415 - INFO - Loading existing market data...
2025-04-17 21:55:46,419 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:46,419 - INFO - Macro and market data loaded
2025-04-17 21:55:46,419 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:46,419 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:46,420 - INFO - Loading existing macro data...
2025-04-17 21:55:46,430 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:46,431 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:46,435 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:46,435 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:46,436 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:46,437 - INFO - Loading existing market data...
2025-04-17 21:55:46,441 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:46,444 - ERROR - Error running xgboost with neural and 3 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:46,445 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 5 regimes
2025-04-17 21:55:46,446 - INFO - Initializing strategy...
2025-04-17 21:55:46,446 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 21:55:46,446 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:46,447 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:55:46,447 - INFO - Running strategy...
2025-04-17 21:55:46,448 - INFO - Starting strategy execution...
2025-04-17 21:55:46,448 - INFO - Preparing training and testing data...
2025-04-17 21:55:46,448 - INFO - Starting data preparation...
2025-04-17 21:55:46,449 - INFO - Loading Fama-French factors...
2025-04-17 21:55:46,460 - INFO - Fama-French factors loaded
2025-04-17 21:55:46,460 - INFO - Processing factor data...
2025-04-17 21:55:46,463 - INFO - Factor data processed
2025-04-17 21:55:46,463 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:46,463 - INFO - 
Training Period:
2025-04-17 21:55:46,468 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:46,476 - INFO - 
Testing Period:
2025-04-17 21:55:46,480 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:46,487 - INFO - Loading macro and market data...
2025-04-17 21:55:46,488 - INFO - Loading existing macro data...
2025-04-17 21:55:46,491 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:46,493 - INFO - Loading existing macro data...
2025-04-17 21:55:46,503 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:46,504 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:46,507 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:46,507 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:46,508 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:46,509 - INFO - Loading existing market data...
2025-04-17 21:55:46,514 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:46,515 - INFO - Loading existing market data...
2025-04-17 21:55:46,519 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:46,519 - INFO - Macro and market data loaded
2025-04-17 21:55:46,519 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:46,519 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:46,520 - INFO - Loading existing macro data...
2025-04-17 21:55:46,530 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:46,531 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:46,533 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:46,534 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:46,534 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:46,536 - INFO - Loading existing market data...
2025-04-17 21:55:46,539 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:46,542 - ERROR - Error running xgboost with neural and 5 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:46,544 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 7 regimes
2025-04-17 21:55:46,544 - INFO - Initializing strategy...
2025-04-17 21:55:46,544 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 21:55:46,544 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:46,545 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:55:46,546 - INFO - Running strategy...
2025-04-17 21:55:46,546 - INFO - Starting strategy execution...
2025-04-17 21:55:46,546 - INFO - Preparing training and testing data...
2025-04-17 21:55:46,547 - INFO - Starting data preparation...
2025-04-17 21:55:46,547 - INFO - Loading Fama-French factors...
2025-04-17 21:55:46,557 - INFO - Fama-French factors loaded
2025-04-17 21:55:46,557 - INFO - Processing factor data...
2025-04-17 21:55:46,560 - INFO - Factor data processed
2025-04-17 21:55:46,560 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:46,560 - INFO - 
Training Period:
2025-04-17 21:55:46,565 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:46,573 - INFO - 
Testing Period:
2025-04-17 21:55:46,578 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:46,586 - INFO - Loading macro and market data...
2025-04-17 21:55:46,587 - INFO - Loading existing macro data...
2025-04-17 21:55:46,590 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:46,591 - INFO - Loading existing macro data...
2025-04-17 21:55:46,602 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:46,603 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:46,606 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:46,606 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:46,607 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:46,608 - INFO - Loading existing market data...
2025-04-17 21:55:46,612 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:46,614 - INFO - Loading existing market data...
2025-04-17 21:55:46,618 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:46,618 - INFO - Macro and market data loaded
2025-04-17 21:55:46,618 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:46,619 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:46,620 - INFO - Loading existing macro data...
2025-04-17 21:55:46,630 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:46,630 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:46,633 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:46,633 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:46,634 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:46,635 - INFO - Loading existing market data...
2025-04-17 21:55:46,640 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:46,643 - ERROR - Error running xgboost with neural and 7 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:46,644 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 3 regimes
2025-04-17 21:55:46,645 - INFO - Initializing strategy...
2025-04-17 21:55:46,645 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 21:55:46,645 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:46,646 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:55:46,646 - INFO - Running strategy...
2025-04-17 21:55:46,646 - INFO - Starting strategy execution...
2025-04-17 21:55:46,646 - INFO - Preparing training and testing data...
2025-04-17 21:55:46,647 - INFO - Starting data preparation...
2025-04-17 21:55:46,647 - INFO - Loading Fama-French factors...
2025-04-17 21:55:46,655 - INFO - Fama-French factors loaded
2025-04-17 21:55:46,656 - INFO - Processing factor data...
2025-04-17 21:55:46,658 - INFO - Factor data processed
2025-04-17 21:55:46,659 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:46,659 - INFO - 
Training Period:
2025-04-17 21:55:46,664 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:46,671 - INFO - 
Testing Period:
2025-04-17 21:55:46,676 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:46,684 - INFO - Loading macro and market data...
2025-04-17 21:55:46,685 - INFO - Loading existing macro data...
2025-04-17 21:55:46,688 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:46,689 - INFO - Loading existing macro data...
2025-04-17 21:55:46,697 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:46,698 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:46,701 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:46,702 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:46,702 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:46,703 - INFO - Loading existing market data...
2025-04-17 21:55:46,707 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:46,708 - INFO - Loading existing market data...
2025-04-17 21:55:46,711 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:46,711 - INFO - Macro and market data loaded
2025-04-17 21:55:46,711 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:46,712 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:46,712 - INFO - Loading existing macro data...
2025-04-17 21:55:46,723 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:46,724 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:46,727 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:46,727 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:46,727 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:46,728 - INFO - Loading existing market data...
2025-04-17 21:55:46,732 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:46,735 - ERROR - Error running hmm with mean_variance and 3 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:46,736 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 5 regimes
2025-04-17 21:55:46,736 - INFO - Initializing strategy...
2025-04-17 21:55:46,736 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 21:55:46,737 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:46,737 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:55:46,737 - INFO - Running strategy...
2025-04-17 21:55:46,737 - INFO - Starting strategy execution...
2025-04-17 21:55:46,738 - INFO - Preparing training and testing data...
2025-04-17 21:55:46,738 - INFO - Starting data preparation...
2025-04-17 21:55:46,738 - INFO - Loading Fama-French factors...
2025-04-17 21:55:46,747 - INFO - Fama-French factors loaded
2025-04-17 21:55:46,747 - INFO - Processing factor data...
2025-04-17 21:55:46,749 - INFO - Factor data processed
2025-04-17 21:55:46,750 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:46,750 - INFO - 
Training Period:
2025-04-17 21:55:46,754 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:46,761 - INFO - 
Testing Period:
2025-04-17 21:55:46,766 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:46,774 - INFO - Loading macro and market data...
2025-04-17 21:55:46,775 - INFO - Loading existing macro data...
2025-04-17 21:55:46,779 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:46,781 - INFO - Loading existing macro data...
2025-04-17 21:55:46,792 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:46,792 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:46,795 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:46,795 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:46,796 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:46,797 - INFO - Loading existing market data...
2025-04-17 21:55:46,800 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:46,801 - INFO - Loading existing market data...
2025-04-17 21:55:46,804 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:46,804 - INFO - Macro and market data loaded
2025-04-17 21:55:46,804 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:46,805 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:46,806 - INFO - Loading existing macro data...
2025-04-17 21:55:46,816 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:46,816 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:46,819 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:46,819 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:46,819 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:46,820 - INFO - Loading existing market data...
2025-04-17 21:55:46,824 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:46,827 - ERROR - Error running hmm with mean_variance and 5 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:46,829 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 7 regimes
2025-04-17 21:55:46,829 - INFO - Initializing strategy...
2025-04-17 21:55:46,829 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 21:55:46,829 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:46,829 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:55:46,830 - INFO - Running strategy...
2025-04-17 21:55:46,830 - INFO - Starting strategy execution...
2025-04-17 21:55:46,830 - INFO - Preparing training and testing data...
2025-04-17 21:55:46,830 - INFO - Starting data preparation...
2025-04-17 21:55:46,831 - INFO - Loading Fama-French factors...
2025-04-17 21:55:46,840 - INFO - Fama-French factors loaded
2025-04-17 21:55:46,840 - INFO - Processing factor data...
2025-04-17 21:55:46,842 - INFO - Factor data processed
2025-04-17 21:55:46,843 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:46,843 - INFO - 
Training Period:
2025-04-17 21:55:46,848 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:46,856 - INFO - 
Testing Period:
2025-04-17 21:55:46,863 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:46,871 - INFO - Loading macro and market data...
2025-04-17 21:55:46,873 - INFO - Loading existing macro data...
2025-04-17 21:55:46,875 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:46,876 - INFO - Loading existing macro data...
2025-04-17 21:55:46,885 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:46,885 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:46,888 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:46,889 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:46,889 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:46,890 - INFO - Loading existing market data...
2025-04-17 21:55:46,894 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:46,895 - INFO - Loading existing market data...
2025-04-17 21:55:46,899 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:46,899 - INFO - Macro and market data loaded
2025-04-17 21:55:46,899 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:46,899 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:46,900 - INFO - Loading existing macro data...
2025-04-17 21:55:46,911 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:46,912 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:46,914 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:46,915 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:46,915 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:46,916 - INFO - Loading existing market data...
2025-04-17 21:55:46,920 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:46,922 - ERROR - Error running hmm with mean_variance and 7 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:46,923 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 3 regimes
2025-04-17 21:55:46,924 - INFO - Initializing strategy...
2025-04-17 21:55:46,924 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 21:55:46,924 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:46,925 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:55:46,925 - INFO - Running strategy...
2025-04-17 21:55:46,925 - INFO - Starting strategy execution...
2025-04-17 21:55:46,925 - INFO - Preparing training and testing data...
2025-04-17 21:55:46,926 - INFO - Starting data preparation...
2025-04-17 21:55:46,926 - INFO - Loading Fama-French factors...
2025-04-17 21:55:46,935 - INFO - Fama-French factors loaded
2025-04-17 21:55:46,935 - INFO - Processing factor data...
2025-04-17 21:55:46,938 - INFO - Factor data processed
2025-04-17 21:55:46,938 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:46,939 - INFO - 
Training Period:
2025-04-17 21:55:46,943 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:46,951 - INFO - 
Testing Period:
2025-04-17 21:55:46,955 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:46,963 - INFO - Loading macro and market data...
2025-04-17 21:55:46,964 - INFO - Loading existing macro data...
2025-04-17 21:55:46,967 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:46,968 - INFO - Loading existing macro data...
2025-04-17 21:55:46,979 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:46,979 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:46,982 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:46,982 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:46,983 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:46,984 - INFO - Loading existing market data...
2025-04-17 21:55:46,988 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:46,989 - INFO - Loading existing market data...
2025-04-17 21:55:46,992 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:46,992 - INFO - Macro and market data loaded
2025-04-17 21:55:46,992 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:46,993 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:46,994 - INFO - Loading existing macro data...
2025-04-17 21:55:47,004 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:47,004 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:47,007 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:47,008 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:47,008 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:47,009 - INFO - Loading existing market data...
2025-04-17 21:55:47,013 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:47,016 - ERROR - Error running hmm with regime_aware and 3 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:47,017 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 5 regimes
2025-04-17 21:55:47,018 - INFO - Initializing strategy...
2025-04-17 21:55:47,018 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 21:55:47,018 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:47,019 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:55:47,019 - INFO - Running strategy...
2025-04-17 21:55:47,019 - INFO - Starting strategy execution...
2025-04-17 21:55:47,020 - INFO - Preparing training and testing data...
2025-04-17 21:55:47,020 - INFO - Starting data preparation...
2025-04-17 21:55:47,020 - INFO - Loading Fama-French factors...
2025-04-17 21:55:47,030 - INFO - Fama-French factors loaded
2025-04-17 21:55:47,030 - INFO - Processing factor data...
2025-04-17 21:55:47,032 - INFO - Factor data processed
2025-04-17 21:55:47,032 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:47,033 - INFO - 
Training Period:
2025-04-17 21:55:47,037 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:47,045 - INFO - 
Testing Period:
2025-04-17 21:55:47,049 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:47,058 - INFO - Loading macro and market data...
2025-04-17 21:55:47,059 - INFO - Loading existing macro data...
2025-04-17 21:55:47,062 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:47,063 - INFO - Loading existing macro data...
2025-04-17 21:55:47,072 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:47,072 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:47,075 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:47,075 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:47,075 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:47,076 - INFO - Loading existing market data...
2025-04-17 21:55:47,081 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:47,082 - INFO - Loading existing market data...
2025-04-17 21:55:47,085 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:47,085 - INFO - Macro and market data loaded
2025-04-17 21:55:47,085 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:47,086 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:47,087 - INFO - Loading existing macro data...
2025-04-17 21:55:47,097 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:47,097 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:47,101 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:47,101 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:47,101 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:47,102 - INFO - Loading existing market data...
2025-04-17 21:55:47,106 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:47,108 - ERROR - Error running hmm with regime_aware and 5 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:47,110 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 7 regimes
2025-04-17 21:55:47,110 - INFO - Initializing strategy...
2025-04-17 21:55:47,110 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 21:55:47,111 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:47,111 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:55:47,111 - INFO - Running strategy...
2025-04-17 21:55:47,111 - INFO - Starting strategy execution...
2025-04-17 21:55:47,111 - INFO - Preparing training and testing data...
2025-04-17 21:55:47,112 - INFO - Starting data preparation...
2025-04-17 21:55:47,112 - INFO - Loading Fama-French factors...
2025-04-17 21:55:47,121 - INFO - Fama-French factors loaded
2025-04-17 21:55:47,122 - INFO - Processing factor data...
2025-04-17 21:55:47,124 - INFO - Factor data processed
2025-04-17 21:55:47,124 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:47,124 - INFO - 
Training Period:
2025-04-17 21:55:47,130 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:47,139 - INFO - 
Testing Period:
2025-04-17 21:55:47,145 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:47,153 - INFO - Loading macro and market data...
2025-04-17 21:55:47,154 - INFO - Loading existing macro data...
2025-04-17 21:55:47,158 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:47,159 - INFO - Loading existing macro data...
2025-04-17 21:55:47,170 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:47,170 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:47,174 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:47,174 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:47,175 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:47,176 - INFO - Loading existing market data...
2025-04-17 21:55:47,180 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:47,182 - INFO - Loading existing market data...
2025-04-17 21:55:47,185 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:47,185 - INFO - Macro and market data loaded
2025-04-17 21:55:47,186 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:47,186 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:47,187 - INFO - Loading existing macro data...
2025-04-17 21:55:47,197 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:47,197 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:47,201 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:47,201 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:47,202 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:47,203 - INFO - Loading existing market data...
2025-04-17 21:55:47,207 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:47,211 - ERROR - Error running hmm with regime_aware and 7 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:47,212 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 3 regimes
2025-04-17 21:55:47,213 - INFO - Initializing strategy...
2025-04-17 21:55:47,213 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 21:55:47,213 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:47,214 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:55:47,214 - INFO - Running strategy...
2025-04-17 21:55:47,214 - INFO - Starting strategy execution...
2025-04-17 21:55:47,215 - INFO - Preparing training and testing data...
2025-04-17 21:55:47,215 - INFO - Starting data preparation...
2025-04-17 21:55:47,215 - INFO - Loading Fama-French factors...
2025-04-17 21:55:47,229 - INFO - Fama-French factors loaded
2025-04-17 21:55:47,229 - INFO - Processing factor data...
2025-04-17 21:55:47,231 - INFO - Factor data processed
2025-04-17 21:55:47,232 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:47,232 - INFO - 
Training Period:
2025-04-17 21:55:47,237 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:47,246 - INFO - 
Testing Period:
2025-04-17 21:55:47,251 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:47,258 - INFO - Loading macro and market data...
2025-04-17 21:55:47,260 - INFO - Loading existing macro data...
2025-04-17 21:55:47,264 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:47,265 - INFO - Loading existing macro data...
2025-04-17 21:55:47,274 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:47,275 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:47,278 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:47,278 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:47,278 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:47,279 - INFO - Loading existing market data...
2025-04-17 21:55:47,283 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:47,285 - INFO - Loading existing market data...
2025-04-17 21:55:47,288 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:47,288 - INFO - Macro and market data loaded
2025-04-17 21:55:47,289 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:47,289 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:47,290 - INFO - Loading existing macro data...
2025-04-17 21:55:47,301 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:47,301 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:47,305 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:47,305 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:47,305 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:47,307 - INFO - Loading existing market data...
2025-04-17 21:55:47,311 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:47,315 - ERROR - Error running hmm with neural_regime and 3 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:47,316 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 5 regimes
2025-04-17 21:55:47,317 - INFO - Initializing strategy...
2025-04-17 21:55:47,317 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 21:55:47,317 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:47,317 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:55:47,317 - INFO - Running strategy...
2025-04-17 21:55:47,318 - INFO - Starting strategy execution...
2025-04-17 21:55:47,318 - INFO - Preparing training and testing data...
2025-04-17 21:55:47,318 - INFO - Starting data preparation...
2025-04-17 21:55:47,318 - INFO - Loading Fama-French factors...
2025-04-17 21:55:47,329 - INFO - Fama-French factors loaded
2025-04-17 21:55:47,329 - INFO - Processing factor data...
2025-04-17 21:55:47,331 - INFO - Factor data processed
2025-04-17 21:55:47,331 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:47,332 - INFO - 
Training Period:
2025-04-17 21:55:47,336 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:47,345 - INFO - 
Testing Period:
2025-04-17 21:55:47,351 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:47,359 - INFO - Loading macro and market data...
2025-04-17 21:55:47,360 - INFO - Loading existing macro data...
2025-04-17 21:55:47,364 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:47,365 - INFO - Loading existing macro data...
2025-04-17 21:55:47,375 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:47,376 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:47,379 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:47,379 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:47,380 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:47,381 - INFO - Loading existing market data...
2025-04-17 21:55:47,384 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:47,385 - INFO - Loading existing market data...
2025-04-17 21:55:47,389 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:47,389 - INFO - Macro and market data loaded
2025-04-17 21:55:47,389 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:47,390 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:47,391 - INFO - Loading existing macro data...
2025-04-17 21:55:47,400 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:47,401 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:47,404 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:47,404 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:47,405 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:47,406 - INFO - Loading existing market data...
2025-04-17 21:55:47,409 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:47,413 - ERROR - Error running hmm with neural_regime and 5 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:47,414 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 7 regimes
2025-04-17 21:55:47,414 - INFO - Initializing strategy...
2025-04-17 21:55:47,415 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 21:55:47,415 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:47,415 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:55:47,415 - INFO - Running strategy...
2025-04-17 21:55:47,416 - INFO - Starting strategy execution...
2025-04-17 21:55:47,416 - INFO - Preparing training and testing data...
2025-04-17 21:55:47,416 - INFO - Starting data preparation...
2025-04-17 21:55:47,416 - INFO - Loading Fama-French factors...
2025-04-17 21:55:47,425 - INFO - Fama-French factors loaded
2025-04-17 21:55:47,426 - INFO - Processing factor data...
2025-04-17 21:55:47,428 - INFO - Factor data processed
2025-04-17 21:55:47,429 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:47,429 - INFO - 
Training Period:
2025-04-17 21:55:47,434 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:47,442 - INFO - 
Testing Period:
2025-04-17 21:55:47,447 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:47,455 - INFO - Loading macro and market data...
2025-04-17 21:55:47,457 - INFO - Loading existing macro data...
2025-04-17 21:55:47,460 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:47,461 - INFO - Loading existing macro data...
2025-04-17 21:55:47,470 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:47,471 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:47,474 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:47,474 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:47,475 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:47,476 - INFO - Loading existing market data...
2025-04-17 21:55:47,482 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:47,483 - INFO - Loading existing market data...
2025-04-17 21:55:47,486 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:47,487 - INFO - Macro and market data loaded
2025-04-17 21:55:47,487 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:47,487 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:47,488 - INFO - Loading existing macro data...
2025-04-17 21:55:47,499 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:47,500 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:47,503 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:47,503 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:47,504 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:47,505 - INFO - Loading existing market data...
2025-04-17 21:55:47,508 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:47,511 - ERROR - Error running hmm with neural_regime and 7 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:47,512 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 21:55:47,512 - INFO - Initializing strategy...
2025-04-17 21:55:47,513 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 21:55:47,513 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:47,513 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:55:47,513 - INFO - Running strategy...
2025-04-17 21:55:47,514 - INFO - Starting strategy execution...
2025-04-17 21:55:47,514 - INFO - Preparing training and testing data...
2025-04-17 21:55:47,514 - INFO - Starting data preparation...
2025-04-17 21:55:47,515 - INFO - Loading Fama-French factors...
2025-04-17 21:55:47,524 - INFO - Fama-French factors loaded
2025-04-17 21:55:47,524 - INFO - Processing factor data...
2025-04-17 21:55:47,527 - INFO - Factor data processed
2025-04-17 21:55:47,527 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:47,527 - INFO - 
Training Period:
2025-04-17 21:55:47,532 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:47,540 - INFO - 
Testing Period:
2025-04-17 21:55:47,544 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:47,552 - INFO - Loading macro and market data...
2025-04-17 21:55:47,553 - INFO - Loading existing macro data...
2025-04-17 21:55:47,557 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:47,558 - INFO - Loading existing macro data...
2025-04-17 21:55:47,566 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:47,567 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:47,569 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:47,570 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:47,570 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:47,571 - INFO - Loading existing market data...
2025-04-17 21:55:47,575 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:47,577 - INFO - Loading existing market data...
2025-04-17 21:55:47,580 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:47,581 - INFO - Macro and market data loaded
2025-04-17 21:55:47,581 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:47,581 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:47,582 - INFO - Loading existing macro data...
2025-04-17 21:55:47,593 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:47,593 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:47,596 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:47,596 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:47,596 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:47,597 - INFO - Loading existing market data...
2025-04-17 21:55:47,601 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:47,604 - ERROR - Error running hmm with autoencoder_regime and 3 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:47,606 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 21:55:47,606 - INFO - Initializing strategy...
2025-04-17 21:55:47,607 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 21:55:47,607 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:47,607 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:55:47,608 - INFO - Running strategy...
2025-04-17 21:55:47,608 - INFO - Starting strategy execution...
2025-04-17 21:55:47,608 - INFO - Preparing training and testing data...
2025-04-17 21:55:47,609 - INFO - Starting data preparation...
2025-04-17 21:55:47,609 - INFO - Loading Fama-French factors...
2025-04-17 21:55:47,618 - INFO - Fama-French factors loaded
2025-04-17 21:55:47,619 - INFO - Processing factor data...
2025-04-17 21:55:47,621 - INFO - Factor data processed
2025-04-17 21:55:47,622 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:47,622 - INFO - 
Training Period:
2025-04-17 21:55:47,627 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:47,635 - INFO - 
Testing Period:
2025-04-17 21:55:47,641 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:47,648 - INFO - Loading macro and market data...
2025-04-17 21:55:47,650 - INFO - Loading existing macro data...
2025-04-17 21:55:47,653 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:47,655 - INFO - Loading existing macro data...
2025-04-17 21:55:47,665 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:47,666 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:47,668 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:47,669 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:47,669 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:47,670 - INFO - Loading existing market data...
2025-04-17 21:55:47,673 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:47,674 - INFO - Loading existing market data...
2025-04-17 21:55:47,678 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:47,678 - INFO - Macro and market data loaded
2025-04-17 21:55:47,678 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:47,679 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:47,680 - INFO - Loading existing macro data...
2025-04-17 21:55:47,690 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:47,691 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:47,693 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:47,694 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:47,694 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:47,695 - INFO - Loading existing market data...
2025-04-17 21:55:47,698 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:47,702 - ERROR - Error running hmm with autoencoder_regime and 5 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:47,704 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 21:55:47,704 - INFO - Initializing strategy...
2025-04-17 21:55:47,704 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 21:55:47,705 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:47,705 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:55:47,706 - INFO - Running strategy...
2025-04-17 21:55:47,706 - INFO - Starting strategy execution...
2025-04-17 21:55:47,706 - INFO - Preparing training and testing data...
2025-04-17 21:55:47,706 - INFO - Starting data preparation...
2025-04-17 21:55:47,706 - INFO - Loading Fama-French factors...
2025-04-17 21:55:47,715 - INFO - Fama-French factors loaded
2025-04-17 21:55:47,715 - INFO - Processing factor data...
2025-04-17 21:55:47,718 - INFO - Factor data processed
2025-04-17 21:55:47,718 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:47,718 - INFO - 
Training Period:
2025-04-17 21:55:47,723 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:47,731 - INFO - 
Testing Period:
2025-04-17 21:55:47,735 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:47,743 - INFO - Loading macro and market data...
2025-04-17 21:55:47,744 - INFO - Loading existing macro data...
2025-04-17 21:55:47,747 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:47,749 - INFO - Loading existing macro data...
2025-04-17 21:55:47,758 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:47,758 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:47,761 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:47,762 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:47,762 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:47,763 - INFO - Loading existing market data...
2025-04-17 21:55:47,768 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:47,769 - INFO - Loading existing market data...
2025-04-17 21:55:47,773 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:47,773 - INFO - Macro and market data loaded
2025-04-17 21:55:47,773 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:47,773 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:47,774 - INFO - Loading existing macro data...
2025-04-17 21:55:47,784 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:47,785 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:47,788 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:47,788 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:47,788 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:47,789 - INFO - Loading existing market data...
2025-04-17 21:55:47,793 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:47,795 - ERROR - Error running hmm with autoencoder_regime and 7 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:47,797 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 3 regimes
2025-04-17 21:55:47,797 - INFO - Initializing strategy...
2025-04-17 21:55:47,798 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 21:55:47,798 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:47,798 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:55:47,799 - INFO - Running strategy...
2025-04-17 21:55:47,799 - INFO - Starting strategy execution...
2025-04-17 21:55:47,800 - INFO - Preparing training and testing data...
2025-04-17 21:55:47,800 - INFO - Starting data preparation...
2025-04-17 21:55:47,800 - INFO - Loading Fama-French factors...
2025-04-17 21:55:47,810 - INFO - Fama-French factors loaded
2025-04-17 21:55:47,811 - INFO - Processing factor data...
2025-04-17 21:55:47,814 - INFO - Factor data processed
2025-04-17 21:55:47,814 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:47,814 - INFO - 
Training Period:
2025-04-17 21:55:47,818 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:47,827 - INFO - 
Testing Period:
2025-04-17 21:55:47,832 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:47,840 - INFO - Loading macro and market data...
2025-04-17 21:55:47,841 - INFO - Loading existing macro data...
2025-04-17 21:55:47,844 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:47,846 - INFO - Loading existing macro data...
2025-04-17 21:55:47,855 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:47,855 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:47,858 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:47,858 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:47,859 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:47,860 - INFO - Loading existing market data...
2025-04-17 21:55:47,863 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:47,865 - INFO - Loading existing market data...
2025-04-17 21:55:47,868 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:47,868 - INFO - Macro and market data loaded
2025-04-17 21:55:47,868 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:47,868 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:47,870 - INFO - Loading existing macro data...
2025-04-17 21:55:47,880 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:47,880 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:47,883 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:47,883 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:47,883 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:47,885 - INFO - Loading existing market data...
2025-04-17 21:55:47,888 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:47,892 - ERROR - Error running hmm with neural and 3 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:47,893 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 5 regimes
2025-04-17 21:55:47,894 - INFO - Initializing strategy...
2025-04-17 21:55:47,894 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 21:55:47,894 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:47,894 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:55:47,895 - INFO - Running strategy...
2025-04-17 21:55:47,895 - INFO - Starting strategy execution...
2025-04-17 21:55:47,895 - INFO - Preparing training and testing data...
2025-04-17 21:55:47,896 - INFO - Starting data preparation...
2025-04-17 21:55:47,896 - INFO - Loading Fama-French factors...
2025-04-17 21:55:47,904 - INFO - Fama-French factors loaded
2025-04-17 21:55:47,905 - INFO - Processing factor data...
2025-04-17 21:55:47,908 - INFO - Factor data processed
2025-04-17 21:55:47,908 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:47,908 - INFO - 
Training Period:
2025-04-17 21:55:47,913 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:47,921 - INFO - 
Testing Period:
2025-04-17 21:55:47,927 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:47,934 - INFO - Loading macro and market data...
2025-04-17 21:55:47,935 - INFO - Loading existing macro data...
2025-04-17 21:55:47,939 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:47,940 - INFO - Loading existing macro data...
2025-04-17 21:55:47,949 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:47,949 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:47,952 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:47,953 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:47,953 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:47,955 - INFO - Loading existing market data...
2025-04-17 21:55:47,958 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:47,960 - INFO - Loading existing market data...
2025-04-17 21:55:47,962 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:47,962 - INFO - Macro and market data loaded
2025-04-17 21:55:47,963 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:47,963 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:47,964 - INFO - Loading existing macro data...
2025-04-17 21:55:47,974 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:47,975 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:47,978 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:47,978 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:47,978 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:47,980 - INFO - Loading existing market data...
2025-04-17 21:55:47,985 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:47,988 - ERROR - Error running hmm with neural and 5 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:47,990 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 7 regimes
2025-04-17 21:55:47,990 - INFO - Initializing strategy...
2025-04-17 21:55:47,991 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 21:55:47,991 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:55:47,991 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:55:47,992 - INFO - Running strategy...
2025-04-17 21:55:47,993 - INFO - Starting strategy execution...
2025-04-17 21:55:47,993 - INFO - Preparing training and testing data...
2025-04-17 21:55:47,993 - INFO - Starting data preparation...
2025-04-17 21:55:47,993 - INFO - Loading Fama-French factors...
2025-04-17 21:55:48,003 - INFO - Fama-French factors loaded
2025-04-17 21:55:48,003 - INFO - Processing factor data...
2025-04-17 21:55:48,006 - INFO - Factor data processed
2025-04-17 21:55:48,006 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:55:48,006 - INFO - 
Training Period:
2025-04-17 21:55:48,011 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:55:48,020 - INFO - 
Testing Period:
2025-04-17 21:55:48,025 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:55:48,032 - INFO - Loading macro and market data...
2025-04-17 21:55:48,033 - INFO - Loading existing macro data...
2025-04-17 21:55:48,037 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:55:48,038 - INFO - Loading existing macro data...
2025-04-17 21:55:48,047 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:48,048 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:48,051 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:48,052 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:55:48,052 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:55:48,053 - INFO - Loading existing market data...
2025-04-17 21:55:48,058 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:48,059 - INFO - Loading existing market data...
2025-04-17 21:55:48,062 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:55:48,062 - INFO - Macro and market data loaded
2025-04-17 21:55:48,062 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:48,063 - INFO - Preparing training data for regime classification...
2025-04-17 21:55:48,064 - INFO - Loading existing macro data...
2025-04-17 21:55:48,073 - WARNING - US corporate credit spread file not found
2025-04-17 21:55:48,074 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:55:48,077 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:55:48,077 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:55:48,077 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:55:48,078 - INFO - Loading existing market data...
2025-04-17 21:55:48,082 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:55:48,085 - ERROR - Error running hmm with neural and 7 regimes: Cannot set a DataFrame with multiple columns to the single column momentum
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 385, in prepare_training_data
    features['momentum'] = returns.rolling(window=20).mean()
    ~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4301, in __setitem__
    self._set_item_frame_value(key, value)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\pandas\core\frame.py", line 4459, in _set_item_frame_value
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Cannot set a DataFrame with multiple columns to the single column momentum
2025-04-17 21:55:48,086 - ERROR - No valid results obtained from parameter grid search
2025-04-17 21:55:48,087 - ERROR - No valid results obtained from parameter grid search
2025-04-17 21:55:48,087 - INFO - Factor timing strategy optimization completed
2025-04-17 21:56:19,236 - INFO - Starting factor timing strategy optimization...
2025-04-17 21:56:19,236 - INFO - Running parameter grid search...
2025-04-17 21:56:19,236 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 3 regimes
2025-04-17 21:56:19,236 - INFO - Initializing strategy...
2025-04-17 21:56:19,237 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 21:56:19,237 - ERROR - Error running lstm with mean_variance and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:56:19,238 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 5 regimes
2025-04-17 21:56:19,238 - INFO - Initializing strategy...
2025-04-17 21:56:19,239 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 21:56:19,239 - ERROR - Error running lstm with mean_variance and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:56:19,240 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 7 regimes
2025-04-17 21:56:19,240 - INFO - Initializing strategy...
2025-04-17 21:56:19,240 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 21:56:19,241 - ERROR - Error running lstm with mean_variance and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:56:19,242 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 3 regimes
2025-04-17 21:56:19,242 - INFO - Initializing strategy...
2025-04-17 21:56:19,242 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 21:56:19,242 - ERROR - Error running lstm with regime_aware and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:56:19,243 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 5 regimes
2025-04-17 21:56:19,244 - INFO - Initializing strategy...
2025-04-17 21:56:19,244 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 21:56:19,244 - ERROR - Error running lstm with regime_aware and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:56:19,245 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 7 regimes
2025-04-17 21:56:19,245 - INFO - Initializing strategy...
2025-04-17 21:56:19,245 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 21:56:19,246 - ERROR - Error running lstm with regime_aware and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:56:19,247 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 3 regimes
2025-04-17 21:56:19,247 - INFO - Initializing strategy...
2025-04-17 21:56:19,247 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 21:56:19,247 - ERROR - Error running lstm with neural_regime and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:56:19,248 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 5 regimes
2025-04-17 21:56:19,248 - INFO - Initializing strategy...
2025-04-17 21:56:19,248 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 21:56:19,249 - ERROR - Error running lstm with neural_regime and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:56:19,250 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 7 regimes
2025-04-17 21:56:19,250 - INFO - Initializing strategy...
2025-04-17 21:56:19,250 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 21:56:19,251 - ERROR - Error running lstm with neural_regime and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:56:19,251 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 21:56:19,252 - INFO - Initializing strategy...
2025-04-17 21:56:19,252 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 21:56:19,252 - ERROR - Error running lstm with autoencoder_regime and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:56:19,253 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 21:56:19,253 - INFO - Initializing strategy...
2025-04-17 21:56:19,254 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 21:56:19,254 - ERROR - Error running lstm with autoencoder_regime and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:56:19,255 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 21:56:19,255 - INFO - Initializing strategy...
2025-04-17 21:56:19,255 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 21:56:19,256 - ERROR - Error running lstm with autoencoder_regime and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:56:19,256 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 3 regimes
2025-04-17 21:56:19,257 - INFO - Initializing strategy...
2025-04-17 21:56:19,257 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 21:56:19,257 - ERROR - Error running lstm with neural and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:56:19,258 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 5 regimes
2025-04-17 21:56:19,258 - INFO - Initializing strategy...
2025-04-17 21:56:19,259 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 21:56:19,259 - ERROR - Error running lstm with neural and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:56:19,260 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 7 regimes
2025-04-17 21:56:19,260 - INFO - Initializing strategy...
2025-04-17 21:56:19,261 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 21:56:19,261 - ERROR - Error running lstm with neural and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:56:19,262 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 3 regimes
2025-04-17 21:56:19,262 - INFO - Initializing strategy...
2025-04-17 21:56:19,263 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 21:56:19,263 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:19,284 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:56:19,285 - INFO - Running strategy...
2025-04-17 21:56:19,285 - INFO - Starting strategy execution...
2025-04-17 21:56:19,285 - INFO - Preparing training and testing data...
2025-04-17 21:56:19,285 - INFO - Starting data preparation...
2025-04-17 21:56:19,286 - INFO - Loading Fama-French factors...
2025-04-17 21:56:19,302 - INFO - Fama-French factors loaded
2025-04-17 21:56:19,302 - INFO - Processing factor data...
2025-04-17 21:56:19,305 - INFO - Factor data processed
2025-04-17 21:56:19,305 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:19,305 - INFO - 
Training Period:
2025-04-17 21:56:19,311 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:19,321 - INFO - 
Testing Period:
2025-04-17 21:56:19,326 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:19,333 - INFO - Loading macro and market data...
2025-04-17 21:56:19,335 - INFO - Loading existing macro data...
2025-04-17 21:56:19,339 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:19,340 - INFO - Loading existing macro data...
2025-04-17 21:56:19,349 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:19,350 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:19,354 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:19,354 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:19,355 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:19,356 - INFO - Loading existing market data...
2025-04-17 21:56:19,360 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:19,361 - INFO - Loading existing market data...
2025-04-17 21:56:19,366 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:19,366 - INFO - Macro and market data loaded
2025-04-17 21:56:19,367 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:19,367 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:19,368 - INFO - Loading existing macro data...
2025-04-17 21:56:19,378 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:19,378 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:19,381 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:19,381 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:19,382 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:19,384 - INFO - Loading existing market data...
2025-04-17 21:56:19,387 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:19,391 - ERROR - Error running xgboost with mean_variance and 3 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:19,398 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 5 regimes
2025-04-17 21:56:19,398 - INFO - Initializing strategy...
2025-04-17 21:56:19,398 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 21:56:19,399 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:19,399 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:56:19,399 - INFO - Running strategy...
2025-04-17 21:56:19,400 - INFO - Starting strategy execution...
2025-04-17 21:56:19,400 - INFO - Preparing training and testing data...
2025-04-17 21:56:19,400 - INFO - Starting data preparation...
2025-04-17 21:56:19,401 - INFO - Loading Fama-French factors...
2025-04-17 21:56:19,412 - INFO - Fama-French factors loaded
2025-04-17 21:56:19,413 - INFO - Processing factor data...
2025-04-17 21:56:19,415 - INFO - Factor data processed
2025-04-17 21:56:19,416 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:19,416 - INFO - 
Training Period:
2025-04-17 21:56:19,422 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:19,432 - INFO - 
Testing Period:
2025-04-17 21:56:19,436 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:19,444 - INFO - Loading macro and market data...
2025-04-17 21:56:19,446 - INFO - Loading existing macro data...
2025-04-17 21:56:19,449 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:19,450 - INFO - Loading existing macro data...
2025-04-17 21:56:19,459 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:19,459 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:19,463 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:19,463 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:19,463 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:19,464 - INFO - Loading existing market data...
2025-04-17 21:56:19,469 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:19,470 - INFO - Loading existing market data...
2025-04-17 21:56:19,472 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:19,473 - INFO - Macro and market data loaded
2025-04-17 21:56:19,473 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:19,473 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:19,474 - INFO - Loading existing macro data...
2025-04-17 21:56:19,484 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:19,484 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:19,487 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:19,488 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:19,488 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:19,489 - INFO - Loading existing market data...
2025-04-17 21:56:19,493 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:19,497 - ERROR - Error running xgboost with mean_variance and 5 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:19,499 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 7 regimes
2025-04-17 21:56:19,499 - INFO - Initializing strategy...
2025-04-17 21:56:19,499 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 21:56:19,500 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:19,500 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:56:19,500 - INFO - Running strategy...
2025-04-17 21:56:19,500 - INFO - Starting strategy execution...
2025-04-17 21:56:19,501 - INFO - Preparing training and testing data...
2025-04-17 21:56:19,501 - INFO - Starting data preparation...
2025-04-17 21:56:19,501 - INFO - Loading Fama-French factors...
2025-04-17 21:56:19,511 - INFO - Fama-French factors loaded
2025-04-17 21:56:19,511 - INFO - Processing factor data...
2025-04-17 21:56:19,514 - INFO - Factor data processed
2025-04-17 21:56:19,515 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:19,515 - INFO - 
Training Period:
2025-04-17 21:56:19,520 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:19,529 - INFO - 
Testing Period:
2025-04-17 21:56:19,534 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:19,544 - INFO - Loading macro and market data...
2025-04-17 21:56:19,545 - INFO - Loading existing macro data...
2025-04-17 21:56:19,548 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:19,549 - INFO - Loading existing macro data...
2025-04-17 21:56:19,559 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:19,560 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:19,563 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:19,563 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:19,563 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:19,564 - INFO - Loading existing market data...
2025-04-17 21:56:19,568 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:19,570 - INFO - Loading existing market data...
2025-04-17 21:56:19,573 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:19,573 - INFO - Macro and market data loaded
2025-04-17 21:56:19,573 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:19,574 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:19,575 - INFO - Loading existing macro data...
2025-04-17 21:56:19,586 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:19,586 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:19,589 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:19,590 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:19,590 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:19,592 - INFO - Loading existing market data...
2025-04-17 21:56:19,596 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:19,599 - ERROR - Error running xgboost with mean_variance and 7 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:19,602 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 3 regimes
2025-04-17 21:56:19,602 - INFO - Initializing strategy...
2025-04-17 21:56:19,602 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 21:56:19,603 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:19,603 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:56:19,604 - INFO - Running strategy...
2025-04-17 21:56:19,604 - INFO - Starting strategy execution...
2025-04-17 21:56:19,604 - INFO - Preparing training and testing data...
2025-04-17 21:56:19,604 - INFO - Starting data preparation...
2025-04-17 21:56:19,605 - INFO - Loading Fama-French factors...
2025-04-17 21:56:19,615 - INFO - Fama-French factors loaded
2025-04-17 21:56:19,615 - INFO - Processing factor data...
2025-04-17 21:56:19,618 - INFO - Factor data processed
2025-04-17 21:56:19,618 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:19,619 - INFO - 
Training Period:
2025-04-17 21:56:19,624 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:19,634 - INFO - 
Testing Period:
2025-04-17 21:56:19,640 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:19,647 - INFO - Loading macro and market data...
2025-04-17 21:56:19,649 - INFO - Loading existing macro data...
2025-04-17 21:56:19,652 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:19,653 - INFO - Loading existing macro data...
2025-04-17 21:56:19,662 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:19,663 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:19,666 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:19,666 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:19,666 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:19,668 - INFO - Loading existing market data...
2025-04-17 21:56:19,671 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:19,672 - INFO - Loading existing market data...
2025-04-17 21:56:19,676 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:19,676 - INFO - Macro and market data loaded
2025-04-17 21:56:19,676 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:19,676 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:19,678 - INFO - Loading existing macro data...
2025-04-17 21:56:19,687 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:19,688 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:19,691 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:19,691 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:19,692 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:19,693 - INFO - Loading existing market data...
2025-04-17 21:56:19,697 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:19,700 - ERROR - Error running xgboost with regime_aware and 3 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:19,702 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 5 regimes
2025-04-17 21:56:19,703 - INFO - Initializing strategy...
2025-04-17 21:56:19,703 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 21:56:19,704 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:19,704 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:56:19,704 - INFO - Running strategy...
2025-04-17 21:56:19,705 - INFO - Starting strategy execution...
2025-04-17 21:56:19,705 - INFO - Preparing training and testing data...
2025-04-17 21:56:19,705 - INFO - Starting data preparation...
2025-04-17 21:56:19,706 - INFO - Loading Fama-French factors...
2025-04-17 21:56:19,716 - INFO - Fama-French factors loaded
2025-04-17 21:56:19,717 - INFO - Processing factor data...
2025-04-17 21:56:19,719 - INFO - Factor data processed
2025-04-17 21:56:19,719 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:19,720 - INFO - 
Training Period:
2025-04-17 21:56:19,725 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:19,733 - INFO - 
Testing Period:
2025-04-17 21:56:19,739 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:19,747 - INFO - Loading macro and market data...
2025-04-17 21:56:19,748 - INFO - Loading existing macro data...
2025-04-17 21:56:19,751 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:19,753 - INFO - Loading existing macro data...
2025-04-17 21:56:19,763 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:19,764 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:19,767 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:19,768 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:19,768 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:19,769 - INFO - Loading existing market data...
2025-04-17 21:56:19,773 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:19,774 - INFO - Loading existing market data...
2025-04-17 21:56:19,777 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:19,777 - INFO - Macro and market data loaded
2025-04-17 21:56:19,778 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:19,778 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:19,779 - INFO - Loading existing macro data...
2025-04-17 21:56:19,789 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:19,789 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:19,792 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:19,792 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:19,793 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:19,794 - INFO - Loading existing market data...
2025-04-17 21:56:19,798 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:19,802 - ERROR - Error running xgboost with regime_aware and 5 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:19,804 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 7 regimes
2025-04-17 21:56:19,805 - INFO - Initializing strategy...
2025-04-17 21:56:19,805 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 21:56:19,805 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:19,806 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:56:19,806 - INFO - Running strategy...
2025-04-17 21:56:19,806 - INFO - Starting strategy execution...
2025-04-17 21:56:19,807 - INFO - Preparing training and testing data...
2025-04-17 21:56:19,807 - INFO - Starting data preparation...
2025-04-17 21:56:19,807 - INFO - Loading Fama-French factors...
2025-04-17 21:56:19,817 - INFO - Fama-French factors loaded
2025-04-17 21:56:19,818 - INFO - Processing factor data...
2025-04-17 21:56:19,821 - INFO - Factor data processed
2025-04-17 21:56:19,822 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:19,822 - INFO - 
Training Period:
2025-04-17 21:56:19,826 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:19,835 - INFO - 
Testing Period:
2025-04-17 21:56:19,839 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:19,848 - INFO - Loading macro and market data...
2025-04-17 21:56:19,850 - INFO - Loading existing macro data...
2025-04-17 21:56:19,852 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:19,853 - INFO - Loading existing macro data...
2025-04-17 21:56:19,865 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:19,865 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:19,868 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:19,869 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:19,869 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:19,871 - INFO - Loading existing market data...
2025-04-17 21:56:19,874 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:19,875 - INFO - Loading existing market data...
2025-04-17 21:56:19,878 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:19,878 - INFO - Macro and market data loaded
2025-04-17 21:56:19,879 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:19,879 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:19,880 - INFO - Loading existing macro data...
2025-04-17 21:56:19,892 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:19,892 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:19,895 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:19,896 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:19,896 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:19,897 - INFO - Loading existing market data...
2025-04-17 21:56:19,901 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:19,905 - ERROR - Error running xgboost with regime_aware and 7 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:19,907 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 3 regimes
2025-04-17 21:56:19,908 - INFO - Initializing strategy...
2025-04-17 21:56:19,908 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 21:56:19,908 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:19,908 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:56:19,909 - INFO - Running strategy...
2025-04-17 21:56:19,909 - INFO - Starting strategy execution...
2025-04-17 21:56:19,909 - INFO - Preparing training and testing data...
2025-04-17 21:56:19,910 - INFO - Starting data preparation...
2025-04-17 21:56:19,910 - INFO - Loading Fama-French factors...
2025-04-17 21:56:19,920 - INFO - Fama-French factors loaded
2025-04-17 21:56:19,920 - INFO - Processing factor data...
2025-04-17 21:56:19,922 - INFO - Factor data processed
2025-04-17 21:56:19,922 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:19,923 - INFO - 
Training Period:
2025-04-17 21:56:19,927 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:19,936 - INFO - 
Testing Period:
2025-04-17 21:56:19,940 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:19,949 - INFO - Loading macro and market data...
2025-04-17 21:56:19,950 - INFO - Loading existing macro data...
2025-04-17 21:56:19,954 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:19,955 - INFO - Loading existing macro data...
2025-04-17 21:56:19,964 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:19,964 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:19,968 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:19,968 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:19,969 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:19,970 - INFO - Loading existing market data...
2025-04-17 21:56:19,974 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:19,975 - INFO - Loading existing market data...
2025-04-17 21:56:19,978 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:19,978 - INFO - Macro and market data loaded
2025-04-17 21:56:19,978 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:19,979 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:19,979 - INFO - Loading existing macro data...
2025-04-17 21:56:19,989 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:19,990 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:19,993 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:19,993 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:19,993 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:19,995 - INFO - Loading existing market data...
2025-04-17 21:56:19,998 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:20,001 - ERROR - Error running xgboost with neural_regime and 3 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:20,003 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 5 regimes
2025-04-17 21:56:20,004 - INFO - Initializing strategy...
2025-04-17 21:56:20,004 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 21:56:20,005 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:20,005 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:56:20,005 - INFO - Running strategy...
2025-04-17 21:56:20,006 - INFO - Starting strategy execution...
2025-04-17 21:56:20,006 - INFO - Preparing training and testing data...
2025-04-17 21:56:20,006 - INFO - Starting data preparation...
2025-04-17 21:56:20,007 - INFO - Loading Fama-French factors...
2025-04-17 21:56:20,016 - INFO - Fama-French factors loaded
2025-04-17 21:56:20,016 - INFO - Processing factor data...
2025-04-17 21:56:20,019 - INFO - Factor data processed
2025-04-17 21:56:20,019 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:20,019 - INFO - 
Training Period:
2025-04-17 21:56:20,024 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:20,032 - INFO - 
Testing Period:
2025-04-17 21:56:20,038 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:20,047 - INFO - Loading macro and market data...
2025-04-17 21:56:20,048 - INFO - Loading existing macro data...
2025-04-17 21:56:20,051 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:20,052 - INFO - Loading existing macro data...
2025-04-17 21:56:20,064 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:20,065 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:20,068 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:20,068 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:20,068 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:20,070 - INFO - Loading existing market data...
2025-04-17 21:56:20,074 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:20,075 - INFO - Loading existing market data...
2025-04-17 21:56:20,079 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:20,079 - INFO - Macro and market data loaded
2025-04-17 21:56:20,080 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:20,080 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:20,081 - INFO - Loading existing macro data...
2025-04-17 21:56:20,090 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:20,091 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:20,094 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:20,094 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:20,094 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:20,096 - INFO - Loading existing market data...
2025-04-17 21:56:20,100 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:20,103 - ERROR - Error running xgboost with neural_regime and 5 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:20,105 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 7 regimes
2025-04-17 21:56:20,106 - INFO - Initializing strategy...
2025-04-17 21:56:20,106 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 21:56:20,106 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:20,107 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:56:20,107 - INFO - Running strategy...
2025-04-17 21:56:20,108 - INFO - Starting strategy execution...
2025-04-17 21:56:20,108 - INFO - Preparing training and testing data...
2025-04-17 21:56:20,108 - INFO - Starting data preparation...
2025-04-17 21:56:20,109 - INFO - Loading Fama-French factors...
2025-04-17 21:56:20,118 - INFO - Fama-French factors loaded
2025-04-17 21:56:20,119 - INFO - Processing factor data...
2025-04-17 21:56:20,121 - INFO - Factor data processed
2025-04-17 21:56:20,122 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:20,122 - INFO - 
Training Period:
2025-04-17 21:56:20,127 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:20,136 - INFO - 
Testing Period:
2025-04-17 21:56:20,141 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:20,150 - INFO - Loading macro and market data...
2025-04-17 21:56:20,151 - INFO - Loading existing macro data...
2025-04-17 21:56:20,155 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:20,156 - INFO - Loading existing macro data...
2025-04-17 21:56:20,166 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:20,166 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:20,169 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:20,170 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:20,170 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:20,171 - INFO - Loading existing market data...
2025-04-17 21:56:20,175 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:20,177 - INFO - Loading existing market data...
2025-04-17 21:56:20,179 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:20,180 - INFO - Macro and market data loaded
2025-04-17 21:56:20,180 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:20,180 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:20,181 - INFO - Loading existing macro data...
2025-04-17 21:56:20,192 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:20,192 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:20,195 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:20,196 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:20,196 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:20,197 - INFO - Loading existing market data...
2025-04-17 21:56:20,201 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:20,205 - ERROR - Error running xgboost with neural_regime and 7 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:20,207 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 21:56:20,207 - INFO - Initializing strategy...
2025-04-17 21:56:20,208 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 21:56:20,208 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:20,209 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:56:20,209 - INFO - Running strategy...
2025-04-17 21:56:20,209 - INFO - Starting strategy execution...
2025-04-17 21:56:20,209 - INFO - Preparing training and testing data...
2025-04-17 21:56:20,210 - INFO - Starting data preparation...
2025-04-17 21:56:20,210 - INFO - Loading Fama-French factors...
2025-04-17 21:56:20,220 - INFO - Fama-French factors loaded
2025-04-17 21:56:20,220 - INFO - Processing factor data...
2025-04-17 21:56:20,223 - INFO - Factor data processed
2025-04-17 21:56:20,224 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:20,224 - INFO - 
Training Period:
2025-04-17 21:56:20,228 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:20,237 - INFO - 
Testing Period:
2025-04-17 21:56:20,241 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:20,250 - INFO - Loading macro and market data...
2025-04-17 21:56:20,252 - INFO - Loading existing macro data...
2025-04-17 21:56:20,255 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:20,256 - INFO - Loading existing macro data...
2025-04-17 21:56:20,265 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:20,265 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:20,269 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:20,270 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:20,270 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:20,271 - INFO - Loading existing market data...
2025-04-17 21:56:20,276 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:20,277 - INFO - Loading existing market data...
2025-04-17 21:56:20,280 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:20,281 - INFO - Macro and market data loaded
2025-04-17 21:56:20,281 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:20,281 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:20,282 - INFO - Loading existing macro data...
2025-04-17 21:56:20,293 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:20,294 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:20,297 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:20,297 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:20,297 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:20,298 - INFO - Loading existing market data...
2025-04-17 21:56:20,303 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:20,308 - ERROR - Error running xgboost with autoencoder_regime and 3 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:20,311 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 21:56:20,311 - INFO - Initializing strategy...
2025-04-17 21:56:20,311 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 21:56:20,312 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:20,312 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:56:20,313 - INFO - Running strategy...
2025-04-17 21:56:20,313 - INFO - Starting strategy execution...
2025-04-17 21:56:20,313 - INFO - Preparing training and testing data...
2025-04-17 21:56:20,313 - INFO - Starting data preparation...
2025-04-17 21:56:20,314 - INFO - Loading Fama-French factors...
2025-04-17 21:56:20,325 - INFO - Fama-French factors loaded
2025-04-17 21:56:20,325 - INFO - Processing factor data...
2025-04-17 21:56:20,328 - INFO - Factor data processed
2025-04-17 21:56:20,329 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:20,329 - INFO - 
Training Period:
2025-04-17 21:56:20,335 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:20,342 - INFO - 
Testing Period:
2025-04-17 21:56:20,347 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:20,356 - INFO - Loading macro and market data...
2025-04-17 21:56:20,357 - INFO - Loading existing macro data...
2025-04-17 21:56:20,360 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:20,362 - INFO - Loading existing macro data...
2025-04-17 21:56:20,372 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:20,373 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:20,376 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:20,376 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:20,377 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:20,378 - INFO - Loading existing market data...
2025-04-17 21:56:20,383 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:20,384 - INFO - Loading existing market data...
2025-04-17 21:56:20,387 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:20,387 - INFO - Macro and market data loaded
2025-04-17 21:56:20,387 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:20,387 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:20,388 - INFO - Loading existing macro data...
2025-04-17 21:56:20,399 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:20,400 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:20,402 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:20,402 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:20,403 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:20,404 - INFO - Loading existing market data...
2025-04-17 21:56:20,408 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:20,411 - ERROR - Error running xgboost with autoencoder_regime and 5 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:20,414 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 21:56:20,414 - INFO - Initializing strategy...
2025-04-17 21:56:20,414 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 21:56:20,415 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:20,415 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:56:20,415 - INFO - Running strategy...
2025-04-17 21:56:20,415 - INFO - Starting strategy execution...
2025-04-17 21:56:20,415 - INFO - Preparing training and testing data...
2025-04-17 21:56:20,415 - INFO - Starting data preparation...
2025-04-17 21:56:20,416 - INFO - Loading Fama-French factors...
2025-04-17 21:56:20,425 - INFO - Fama-French factors loaded
2025-04-17 21:56:20,426 - INFO - Processing factor data...
2025-04-17 21:56:20,428 - INFO - Factor data processed
2025-04-17 21:56:20,428 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:20,428 - INFO - 
Training Period:
2025-04-17 21:56:20,434 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:20,442 - INFO - 
Testing Period:
2025-04-17 21:56:20,447 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:20,455 - INFO - Loading macro and market data...
2025-04-17 21:56:20,456 - INFO - Loading existing macro data...
2025-04-17 21:56:20,460 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:20,460 - INFO - Loading existing macro data...
2025-04-17 21:56:20,469 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:20,470 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:20,473 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:20,473 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:20,473 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:20,474 - INFO - Loading existing market data...
2025-04-17 21:56:20,478 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:20,479 - INFO - Loading existing market data...
2025-04-17 21:56:20,482 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:20,482 - INFO - Macro and market data loaded
2025-04-17 21:56:20,483 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:20,483 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:20,484 - INFO - Loading existing macro data...
2025-04-17 21:56:20,493 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:20,493 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:20,497 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:20,497 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:20,498 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:20,499 - INFO - Loading existing market data...
2025-04-17 21:56:20,503 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:20,506 - ERROR - Error running xgboost with autoencoder_regime and 7 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:20,508 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 3 regimes
2025-04-17 21:56:20,508 - INFO - Initializing strategy...
2025-04-17 21:56:20,509 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 21:56:20,509 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:20,509 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:56:21,591 - INFO - Running strategy...
2025-04-17 21:56:21,591 - INFO - Starting strategy execution...
2025-04-17 21:56:21,591 - INFO - Preparing training and testing data...
2025-04-17 21:56:21,592 - INFO - Starting data preparation...
2025-04-17 21:56:21,592 - INFO - Loading Fama-French factors...
2025-04-17 21:56:21,603 - INFO - Fama-French factors loaded
2025-04-17 21:56:21,603 - INFO - Processing factor data...
2025-04-17 21:56:21,606 - INFO - Factor data processed
2025-04-17 21:56:21,606 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:21,606 - INFO - 
Training Period:
2025-04-17 21:56:21,611 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:21,621 - INFO - 
Testing Period:
2025-04-17 21:56:21,627 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:21,635 - INFO - Loading macro and market data...
2025-04-17 21:56:21,636 - INFO - Loading existing macro data...
2025-04-17 21:56:21,640 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:21,641 - INFO - Loading existing macro data...
2025-04-17 21:56:21,652 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:21,652 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:21,655 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:21,656 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:21,656 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:21,657 - INFO - Loading existing market data...
2025-04-17 21:56:21,662 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:21,663 - INFO - Loading existing market data...
2025-04-17 21:56:21,666 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:21,666 - INFO - Macro and market data loaded
2025-04-17 21:56:21,666 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:21,666 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:21,667 - INFO - Loading existing macro data...
2025-04-17 21:56:21,677 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:21,677 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:21,680 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:21,680 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:21,681 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:21,682 - INFO - Loading existing market data...
2025-04-17 21:56:21,687 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:21,691 - ERROR - Error running xgboost with neural and 3 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:21,693 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 5 regimes
2025-04-17 21:56:21,693 - INFO - Initializing strategy...
2025-04-17 21:56:21,694 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 21:56:21,694 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:21,694 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:56:21,695 - INFO - Running strategy...
2025-04-17 21:56:21,695 - INFO - Starting strategy execution...
2025-04-17 21:56:21,695 - INFO - Preparing training and testing data...
2025-04-17 21:56:21,696 - INFO - Starting data preparation...
2025-04-17 21:56:21,696 - INFO - Loading Fama-French factors...
2025-04-17 21:56:21,704 - INFO - Fama-French factors loaded
2025-04-17 21:56:21,705 - INFO - Processing factor data...
2025-04-17 21:56:21,707 - INFO - Factor data processed
2025-04-17 21:56:21,707 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:21,707 - INFO - 
Training Period:
2025-04-17 21:56:21,713 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:21,721 - INFO - 
Testing Period:
2025-04-17 21:56:21,726 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:21,734 - INFO - Loading macro and market data...
2025-04-17 21:56:21,735 - INFO - Loading existing macro data...
2025-04-17 21:56:21,738 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:21,739 - INFO - Loading existing macro data...
2025-04-17 21:56:21,749 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:21,750 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:21,753 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:21,753 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:21,754 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:21,755 - INFO - Loading existing market data...
2025-04-17 21:56:21,758 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:21,759 - INFO - Loading existing market data...
2025-04-17 21:56:21,762 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:21,762 - INFO - Macro and market data loaded
2025-04-17 21:56:21,762 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:21,762 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:21,763 - INFO - Loading existing macro data...
2025-04-17 21:56:21,773 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:21,774 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:21,776 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:21,776 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:21,777 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:21,778 - INFO - Loading existing market data...
2025-04-17 21:56:21,782 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:21,785 - ERROR - Error running xgboost with neural and 5 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:21,788 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 7 regimes
2025-04-17 21:56:21,788 - INFO - Initializing strategy...
2025-04-17 21:56:21,788 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 21:56:21,788 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:21,789 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:56:21,789 - INFO - Running strategy...
2025-04-17 21:56:21,790 - INFO - Starting strategy execution...
2025-04-17 21:56:21,790 - INFO - Preparing training and testing data...
2025-04-17 21:56:21,790 - INFO - Starting data preparation...
2025-04-17 21:56:21,790 - INFO - Loading Fama-French factors...
2025-04-17 21:56:21,801 - INFO - Fama-French factors loaded
2025-04-17 21:56:21,801 - INFO - Processing factor data...
2025-04-17 21:56:21,804 - INFO - Factor data processed
2025-04-17 21:56:21,804 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:21,804 - INFO - 
Training Period:
2025-04-17 21:56:21,809 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:21,817 - INFO - 
Testing Period:
2025-04-17 21:56:21,821 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:21,829 - INFO - Loading macro and market data...
2025-04-17 21:56:21,830 - INFO - Loading existing macro data...
2025-04-17 21:56:21,833 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:21,835 - INFO - Loading existing macro data...
2025-04-17 21:56:21,843 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:21,844 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:21,847 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:21,847 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:21,847 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:21,849 - INFO - Loading existing market data...
2025-04-17 21:56:21,852 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:21,853 - INFO - Loading existing market data...
2025-04-17 21:56:21,857 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:21,857 - INFO - Macro and market data loaded
2025-04-17 21:56:21,857 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:21,858 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:21,859 - INFO - Loading existing macro data...
2025-04-17 21:56:21,870 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:21,871 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:21,874 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:21,874 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:21,875 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:21,876 - INFO - Loading existing market data...
2025-04-17 21:56:21,880 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:21,883 - ERROR - Error running xgboost with neural and 7 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:21,886 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 3 regimes
2025-04-17 21:56:21,886 - INFO - Initializing strategy...
2025-04-17 21:56:21,886 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 21:56:21,886 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:21,886 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:56:21,887 - INFO - Running strategy...
2025-04-17 21:56:21,887 - INFO - Starting strategy execution...
2025-04-17 21:56:21,887 - INFO - Preparing training and testing data...
2025-04-17 21:56:21,887 - INFO - Starting data preparation...
2025-04-17 21:56:21,887 - INFO - Loading Fama-French factors...
2025-04-17 21:56:21,899 - INFO - Fama-French factors loaded
2025-04-17 21:56:21,899 - INFO - Processing factor data...
2025-04-17 21:56:21,902 - INFO - Factor data processed
2025-04-17 21:56:21,902 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:21,902 - INFO - 
Training Period:
2025-04-17 21:56:21,907 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:21,917 - INFO - 
Testing Period:
2025-04-17 21:56:21,921 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:21,929 - INFO - Loading macro and market data...
2025-04-17 21:56:21,931 - INFO - Loading existing macro data...
2025-04-17 21:56:21,935 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:21,936 - INFO - Loading existing macro data...
2025-04-17 21:56:21,945 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:21,946 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:21,950 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:21,950 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:21,950 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:21,952 - INFO - Loading existing market data...
2025-04-17 21:56:21,957 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:21,958 - INFO - Loading existing market data...
2025-04-17 21:56:21,962 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:21,962 - INFO - Macro and market data loaded
2025-04-17 21:56:21,963 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:21,963 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:21,964 - INFO - Loading existing macro data...
2025-04-17 21:56:21,975 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:21,975 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:21,978 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:21,978 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:21,978 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:21,980 - INFO - Loading existing market data...
2025-04-17 21:56:21,985 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:21,989 - ERROR - Error running hmm with mean_variance and 3 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:21,991 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 5 regimes
2025-04-17 21:56:21,991 - INFO - Initializing strategy...
2025-04-17 21:56:21,991 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 21:56:21,992 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:21,992 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:56:21,992 - INFO - Running strategy...
2025-04-17 21:56:21,992 - INFO - Starting strategy execution...
2025-04-17 21:56:21,993 - INFO - Preparing training and testing data...
2025-04-17 21:56:21,993 - INFO - Starting data preparation...
2025-04-17 21:56:21,993 - INFO - Loading Fama-French factors...
2025-04-17 21:56:22,002 - INFO - Fama-French factors loaded
2025-04-17 21:56:22,003 - INFO - Processing factor data...
2025-04-17 21:56:22,005 - INFO - Factor data processed
2025-04-17 21:56:22,005 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:22,005 - INFO - 
Training Period:
2025-04-17 21:56:22,010 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:22,017 - INFO - 
Testing Period:
2025-04-17 21:56:22,022 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:22,029 - INFO - Loading macro and market data...
2025-04-17 21:56:22,031 - INFO - Loading existing macro data...
2025-04-17 21:56:22,034 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:22,035 - INFO - Loading existing macro data...
2025-04-17 21:56:22,044 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:22,044 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:22,047 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:22,047 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:22,048 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:22,049 - INFO - Loading existing market data...
2025-04-17 21:56:22,053 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:22,054 - INFO - Loading existing market data...
2025-04-17 21:56:22,057 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:22,057 - INFO - Macro and market data loaded
2025-04-17 21:56:22,057 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:22,058 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:22,059 - INFO - Loading existing macro data...
2025-04-17 21:56:22,069 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:22,069 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:22,072 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:22,073 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:22,073 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:22,074 - INFO - Loading existing market data...
2025-04-17 21:56:22,077 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:22,080 - ERROR - Error running hmm with mean_variance and 5 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:22,083 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 7 regimes
2025-04-17 21:56:22,084 - INFO - Initializing strategy...
2025-04-17 21:56:22,084 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 21:56:22,085 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:22,085 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:56:22,085 - INFO - Running strategy...
2025-04-17 21:56:22,085 - INFO - Starting strategy execution...
2025-04-17 21:56:22,085 - INFO - Preparing training and testing data...
2025-04-17 21:56:22,086 - INFO - Starting data preparation...
2025-04-17 21:56:22,086 - INFO - Loading Fama-French factors...
2025-04-17 21:56:22,095 - INFO - Fama-French factors loaded
2025-04-17 21:56:22,095 - INFO - Processing factor data...
2025-04-17 21:56:22,099 - INFO - Factor data processed
2025-04-17 21:56:22,099 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:22,099 - INFO - 
Training Period:
2025-04-17 21:56:22,104 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:22,112 - INFO - 
Testing Period:
2025-04-17 21:56:22,119 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:22,126 - INFO - Loading macro and market data...
2025-04-17 21:56:22,128 - INFO - Loading existing macro data...
2025-04-17 21:56:22,131 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:22,133 - INFO - Loading existing macro data...
2025-04-17 21:56:22,141 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:22,142 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:22,146 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:22,146 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:22,147 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:22,148 - INFO - Loading existing market data...
2025-04-17 21:56:22,153 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:22,154 - INFO - Loading existing market data...
2025-04-17 21:56:22,157 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:22,157 - INFO - Macro and market data loaded
2025-04-17 21:56:22,158 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:22,158 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:22,159 - INFO - Loading existing macro data...
2025-04-17 21:56:22,169 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:22,170 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:22,173 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:22,173 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:22,173 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:22,174 - INFO - Loading existing market data...
2025-04-17 21:56:22,178 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:22,182 - ERROR - Error running hmm with mean_variance and 7 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:22,185 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 3 regimes
2025-04-17 21:56:22,185 - INFO - Initializing strategy...
2025-04-17 21:56:22,185 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 21:56:22,186 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:22,186 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:56:22,187 - INFO - Running strategy...
2025-04-17 21:56:22,187 - INFO - Starting strategy execution...
2025-04-17 21:56:22,187 - INFO - Preparing training and testing data...
2025-04-17 21:56:22,187 - INFO - Starting data preparation...
2025-04-17 21:56:22,187 - INFO - Loading Fama-French factors...
2025-04-17 21:56:22,197 - INFO - Fama-French factors loaded
2025-04-17 21:56:22,198 - INFO - Processing factor data...
2025-04-17 21:56:22,201 - INFO - Factor data processed
2025-04-17 21:56:22,201 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:22,201 - INFO - 
Training Period:
2025-04-17 21:56:22,206 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:22,214 - INFO - 
Testing Period:
2025-04-17 21:56:22,219 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:22,226 - INFO - Loading macro and market data...
2025-04-17 21:56:22,227 - INFO - Loading existing macro data...
2025-04-17 21:56:22,231 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:22,232 - INFO - Loading existing macro data...
2025-04-17 21:56:22,241 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:22,241 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:22,244 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:22,244 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:22,244 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:22,246 - INFO - Loading existing market data...
2025-04-17 21:56:22,249 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:22,250 - INFO - Loading existing market data...
2025-04-17 21:56:22,255 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:22,255 - INFO - Macro and market data loaded
2025-04-17 21:56:22,255 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:22,256 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:22,256 - INFO - Loading existing macro data...
2025-04-17 21:56:22,266 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:22,266 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:22,269 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:22,269 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:22,270 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:22,271 - INFO - Loading existing market data...
2025-04-17 21:56:22,275 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:22,278 - ERROR - Error running hmm with regime_aware and 3 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:22,281 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 5 regimes
2025-04-17 21:56:22,281 - INFO - Initializing strategy...
2025-04-17 21:56:22,281 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 21:56:22,282 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:22,282 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:56:22,282 - INFO - Running strategy...
2025-04-17 21:56:22,282 - INFO - Starting strategy execution...
2025-04-17 21:56:22,283 - INFO - Preparing training and testing data...
2025-04-17 21:56:22,283 - INFO - Starting data preparation...
2025-04-17 21:56:22,283 - INFO - Loading Fama-French factors...
2025-04-17 21:56:22,295 - INFO - Fama-French factors loaded
2025-04-17 21:56:22,296 - INFO - Processing factor data...
2025-04-17 21:56:22,298 - INFO - Factor data processed
2025-04-17 21:56:22,298 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:22,299 - INFO - 
Training Period:
2025-04-17 21:56:22,304 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:22,312 - INFO - 
Testing Period:
2025-04-17 21:56:22,316 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:22,326 - INFO - Loading macro and market data...
2025-04-17 21:56:22,327 - INFO - Loading existing macro data...
2025-04-17 21:56:22,330 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:22,331 - INFO - Loading existing macro data...
2025-04-17 21:56:22,341 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:22,341 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:22,344 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:22,344 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:22,345 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:22,346 - INFO - Loading existing market data...
2025-04-17 21:56:22,350 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:22,351 - INFO - Loading existing market data...
2025-04-17 21:56:22,355 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:22,355 - INFO - Macro and market data loaded
2025-04-17 21:56:22,355 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:22,355 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:22,356 - INFO - Loading existing macro data...
2025-04-17 21:56:22,367 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:22,368 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:22,371 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:22,371 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:22,371 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:22,372 - INFO - Loading existing market data...
2025-04-17 21:56:22,376 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:22,381 - ERROR - Error running hmm with regime_aware and 5 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:22,383 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 7 regimes
2025-04-17 21:56:22,384 - INFO - Initializing strategy...
2025-04-17 21:56:22,384 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 21:56:22,384 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:22,385 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:56:22,385 - INFO - Running strategy...
2025-04-17 21:56:22,385 - INFO - Starting strategy execution...
2025-04-17 21:56:22,385 - INFO - Preparing training and testing data...
2025-04-17 21:56:22,386 - INFO - Starting data preparation...
2025-04-17 21:56:22,386 - INFO - Loading Fama-French factors...
2025-04-17 21:56:22,399 - INFO - Fama-French factors loaded
2025-04-17 21:56:22,399 - INFO - Processing factor data...
2025-04-17 21:56:22,402 - INFO - Factor data processed
2025-04-17 21:56:22,402 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:22,402 - INFO - 
Training Period:
2025-04-17 21:56:22,407 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:22,415 - INFO - 
Testing Period:
2025-04-17 21:56:22,421 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:22,429 - INFO - Loading macro and market data...
2025-04-17 21:56:22,430 - INFO - Loading existing macro data...
2025-04-17 21:56:22,433 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:22,435 - INFO - Loading existing macro data...
2025-04-17 21:56:22,444 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:22,444 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:22,447 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:22,447 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:22,448 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:22,448 - INFO - Loading existing market data...
2025-04-17 21:56:22,452 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:22,453 - INFO - Loading existing market data...
2025-04-17 21:56:22,457 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:22,457 - INFO - Macro and market data loaded
2025-04-17 21:56:22,457 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:22,457 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:22,458 - INFO - Loading existing macro data...
2025-04-17 21:56:22,469 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:22,469 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:22,473 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:22,473 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:22,473 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:22,475 - INFO - Loading existing market data...
2025-04-17 21:56:22,479 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:22,484 - ERROR - Error running hmm with regime_aware and 7 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:22,487 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 3 regimes
2025-04-17 21:56:22,487 - INFO - Initializing strategy...
2025-04-17 21:56:22,487 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 21:56:22,488 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:22,488 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:56:22,488 - INFO - Running strategy...
2025-04-17 21:56:22,488 - INFO - Starting strategy execution...
2025-04-17 21:56:22,489 - INFO - Preparing training and testing data...
2025-04-17 21:56:22,489 - INFO - Starting data preparation...
2025-04-17 21:56:22,489 - INFO - Loading Fama-French factors...
2025-04-17 21:56:22,499 - INFO - Fama-French factors loaded
2025-04-17 21:56:22,499 - INFO - Processing factor data...
2025-04-17 21:56:22,503 - INFO - Factor data processed
2025-04-17 21:56:22,503 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:22,504 - INFO - 
Training Period:
2025-04-17 21:56:22,509 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:22,519 - INFO - 
Testing Period:
2025-04-17 21:56:22,525 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:22,532 - INFO - Loading macro and market data...
2025-04-17 21:56:22,533 - INFO - Loading existing macro data...
2025-04-17 21:56:22,536 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:22,538 - INFO - Loading existing macro data...
2025-04-17 21:56:22,549 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:22,549 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:22,552 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:22,552 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:22,553 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:22,554 - INFO - Loading existing market data...
2025-04-17 21:56:22,558 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:22,560 - INFO - Loading existing market data...
2025-04-17 21:56:22,563 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:22,564 - INFO - Macro and market data loaded
2025-04-17 21:56:22,564 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:22,564 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:22,565 - INFO - Loading existing macro data...
2025-04-17 21:56:22,575 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:22,575 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:22,579 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:22,579 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:22,580 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:22,581 - INFO - Loading existing market data...
2025-04-17 21:56:22,585 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:22,589 - ERROR - Error running hmm with neural_regime and 3 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:22,592 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 5 regimes
2025-04-17 21:56:22,592 - INFO - Initializing strategy...
2025-04-17 21:56:22,592 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 21:56:22,592 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:22,593 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:56:22,593 - INFO - Running strategy...
2025-04-17 21:56:22,593 - INFO - Starting strategy execution...
2025-04-17 21:56:22,593 - INFO - Preparing training and testing data...
2025-04-17 21:56:22,594 - INFO - Starting data preparation...
2025-04-17 21:56:22,594 - INFO - Loading Fama-French factors...
2025-04-17 21:56:22,603 - INFO - Fama-French factors loaded
2025-04-17 21:56:22,603 - INFO - Processing factor data...
2025-04-17 21:56:22,606 - INFO - Factor data processed
2025-04-17 21:56:22,607 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:22,607 - INFO - 
Training Period:
2025-04-17 21:56:22,613 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:22,621 - INFO - 
Testing Period:
2025-04-17 21:56:22,626 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:22,635 - INFO - Loading macro and market data...
2025-04-17 21:56:22,636 - INFO - Loading existing macro data...
2025-04-17 21:56:22,638 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:22,640 - INFO - Loading existing macro data...
2025-04-17 21:56:22,649 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:22,649 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:22,652 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:22,652 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:22,653 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:22,654 - INFO - Loading existing market data...
2025-04-17 21:56:22,657 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:22,658 - INFO - Loading existing market data...
2025-04-17 21:56:22,661 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:22,662 - INFO - Macro and market data loaded
2025-04-17 21:56:22,662 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:22,664 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:22,665 - INFO - Loading existing macro data...
2025-04-17 21:56:22,676 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:22,677 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:22,680 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:22,680 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:22,680 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:22,681 - INFO - Loading existing market data...
2025-04-17 21:56:22,684 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:22,688 - ERROR - Error running hmm with neural_regime and 5 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:22,691 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 7 regimes
2025-04-17 21:56:22,691 - INFO - Initializing strategy...
2025-04-17 21:56:22,691 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 21:56:22,692 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:22,692 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:56:22,692 - INFO - Running strategy...
2025-04-17 21:56:22,692 - INFO - Starting strategy execution...
2025-04-17 21:56:22,693 - INFO - Preparing training and testing data...
2025-04-17 21:56:22,693 - INFO - Starting data preparation...
2025-04-17 21:56:22,693 - INFO - Loading Fama-French factors...
2025-04-17 21:56:22,702 - INFO - Fama-French factors loaded
2025-04-17 21:56:22,702 - INFO - Processing factor data...
2025-04-17 21:56:22,704 - INFO - Factor data processed
2025-04-17 21:56:22,705 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:22,705 - INFO - 
Training Period:
2025-04-17 21:56:22,710 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:22,717 - INFO - 
Testing Period:
2025-04-17 21:56:22,722 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:22,731 - INFO - Loading macro and market data...
2025-04-17 21:56:22,732 - INFO - Loading existing macro data...
2025-04-17 21:56:22,735 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:22,736 - INFO - Loading existing macro data...
2025-04-17 21:56:22,746 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:22,746 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:22,751 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:22,752 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:22,752 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:22,754 - INFO - Loading existing market data...
2025-04-17 21:56:22,757 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:22,759 - INFO - Loading existing market data...
2025-04-17 21:56:22,761 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:22,762 - INFO - Macro and market data loaded
2025-04-17 21:56:22,762 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:22,762 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:22,763 - INFO - Loading existing macro data...
2025-04-17 21:56:22,773 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:22,773 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:22,776 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:22,776 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:22,777 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:22,777 - INFO - Loading existing market data...
2025-04-17 21:56:22,781 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:22,784 - ERROR - Error running hmm with neural_regime and 7 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:22,787 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 21:56:22,787 - INFO - Initializing strategy...
2025-04-17 21:56:22,788 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 21:56:22,788 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:22,788 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:56:22,789 - INFO - Running strategy...
2025-04-17 21:56:22,789 - INFO - Starting strategy execution...
2025-04-17 21:56:22,789 - INFO - Preparing training and testing data...
2025-04-17 21:56:22,790 - INFO - Starting data preparation...
2025-04-17 21:56:22,790 - INFO - Loading Fama-French factors...
2025-04-17 21:56:22,801 - INFO - Fama-French factors loaded
2025-04-17 21:56:22,801 - INFO - Processing factor data...
2025-04-17 21:56:22,803 - INFO - Factor data processed
2025-04-17 21:56:22,804 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:22,804 - INFO - 
Training Period:
2025-04-17 21:56:22,809 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:22,816 - INFO - 
Testing Period:
2025-04-17 21:56:22,822 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:22,836 - INFO - Loading macro and market data...
2025-04-17 21:56:22,838 - INFO - Loading existing macro data...
2025-04-17 21:56:22,843 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:22,844 - INFO - Loading existing macro data...
2025-04-17 21:56:22,858 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:22,858 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:22,863 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:22,863 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:22,863 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:22,866 - INFO - Loading existing market data...
2025-04-17 21:56:22,871 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:22,873 - INFO - Loading existing market data...
2025-04-17 21:56:22,876 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:22,877 - INFO - Macro and market data loaded
2025-04-17 21:56:22,877 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:22,877 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:22,879 - INFO - Loading existing macro data...
2025-04-17 21:56:22,891 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:22,892 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:22,897 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:22,897 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:22,898 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:22,899 - INFO - Loading existing market data...
2025-04-17 21:56:22,904 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:22,908 - ERROR - Error running hmm with autoencoder_regime and 3 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:22,910 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 21:56:22,911 - INFO - Initializing strategy...
2025-04-17 21:56:22,911 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 21:56:22,912 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:22,912 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:56:22,913 - INFO - Running strategy...
2025-04-17 21:56:22,913 - INFO - Starting strategy execution...
2025-04-17 21:56:22,913 - INFO - Preparing training and testing data...
2025-04-17 21:56:22,913 - INFO - Starting data preparation...
2025-04-17 21:56:22,913 - INFO - Loading Fama-French factors...
2025-04-17 21:56:22,928 - INFO - Fama-French factors loaded
2025-04-17 21:56:22,929 - INFO - Processing factor data...
2025-04-17 21:56:22,933 - INFO - Factor data processed
2025-04-17 21:56:22,933 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:22,934 - INFO - 
Training Period:
2025-04-17 21:56:22,941 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:22,951 - INFO - 
Testing Period:
2025-04-17 21:56:22,958 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:22,967 - INFO - Loading macro and market data...
2025-04-17 21:56:22,968 - INFO - Loading existing macro data...
2025-04-17 21:56:22,972 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:22,973 - INFO - Loading existing macro data...
2025-04-17 21:56:22,983 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:22,984 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:22,988 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:22,988 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:22,988 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:22,990 - INFO - Loading existing market data...
2025-04-17 21:56:22,993 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:22,994 - INFO - Loading existing market data...
2025-04-17 21:56:22,997 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:22,998 - INFO - Macro and market data loaded
2025-04-17 21:56:22,998 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:22,998 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:22,999 - INFO - Loading existing macro data...
2025-04-17 21:56:23,010 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:23,010 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:23,013 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:23,013 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:23,014 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:23,015 - INFO - Loading existing market data...
2025-04-17 21:56:23,018 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:23,022 - ERROR - Error running hmm with autoencoder_regime and 5 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:23,025 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 21:56:23,025 - INFO - Initializing strategy...
2025-04-17 21:56:23,025 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 21:56:23,026 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:23,026 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:56:23,026 - INFO - Running strategy...
2025-04-17 21:56:23,026 - INFO - Starting strategy execution...
2025-04-17 21:56:23,027 - INFO - Preparing training and testing data...
2025-04-17 21:56:23,027 - INFO - Starting data preparation...
2025-04-17 21:56:23,027 - INFO - Loading Fama-French factors...
2025-04-17 21:56:23,037 - INFO - Fama-French factors loaded
2025-04-17 21:56:23,038 - INFO - Processing factor data...
2025-04-17 21:56:23,040 - INFO - Factor data processed
2025-04-17 21:56:23,041 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:23,041 - INFO - 
Training Period:
2025-04-17 21:56:23,047 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:23,055 - INFO - 
Testing Period:
2025-04-17 21:56:23,060 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:23,067 - INFO - Loading macro and market data...
2025-04-17 21:56:23,068 - INFO - Loading existing macro data...
2025-04-17 21:56:23,072 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:23,073 - INFO - Loading existing macro data...
2025-04-17 21:56:23,081 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:23,082 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:23,085 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:23,085 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:23,086 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:23,087 - INFO - Loading existing market data...
2025-04-17 21:56:23,090 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:23,092 - INFO - Loading existing market data...
2025-04-17 21:56:23,095 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:23,095 - INFO - Macro and market data loaded
2025-04-17 21:56:23,095 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:23,095 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:23,096 - INFO - Loading existing macro data...
2025-04-17 21:56:23,107 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:23,107 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:23,110 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:23,111 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:23,111 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:23,112 - INFO - Loading existing market data...
2025-04-17 21:56:23,116 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:23,119 - ERROR - Error running hmm with autoencoder_regime and 7 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:23,121 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 3 regimes
2025-04-17 21:56:23,122 - INFO - Initializing strategy...
2025-04-17 21:56:23,122 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 21:56:23,122 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:23,123 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:56:23,123 - INFO - Running strategy...
2025-04-17 21:56:23,124 - INFO - Starting strategy execution...
2025-04-17 21:56:23,124 - INFO - Preparing training and testing data...
2025-04-17 21:56:23,124 - INFO - Starting data preparation...
2025-04-17 21:56:23,125 - INFO - Loading Fama-French factors...
2025-04-17 21:56:23,135 - INFO - Fama-French factors loaded
2025-04-17 21:56:23,135 - INFO - Processing factor data...
2025-04-17 21:56:23,137 - INFO - Factor data processed
2025-04-17 21:56:23,138 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:23,138 - INFO - 
Training Period:
2025-04-17 21:56:23,142 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:23,151 - INFO - 
Testing Period:
2025-04-17 21:56:23,157 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:23,164 - INFO - Loading macro and market data...
2025-04-17 21:56:23,165 - INFO - Loading existing macro data...
2025-04-17 21:56:23,169 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:23,170 - INFO - Loading existing macro data...
2025-04-17 21:56:23,180 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:23,180 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:23,183 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:23,184 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:23,184 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:23,185 - INFO - Loading existing market data...
2025-04-17 21:56:23,189 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:23,190 - INFO - Loading existing market data...
2025-04-17 21:56:23,192 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:23,193 - INFO - Macro and market data loaded
2025-04-17 21:56:23,193 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:23,193 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:23,194 - INFO - Loading existing macro data...
2025-04-17 21:56:23,204 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:23,204 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:23,207 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:23,207 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:23,208 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:23,209 - INFO - Loading existing market data...
2025-04-17 21:56:23,214 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:23,217 - ERROR - Error running hmm with neural and 3 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:23,220 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 5 regimes
2025-04-17 21:56:23,220 - INFO - Initializing strategy...
2025-04-17 21:56:23,220 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 21:56:23,220 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:23,221 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:56:23,221 - INFO - Running strategy...
2025-04-17 21:56:23,222 - INFO - Starting strategy execution...
2025-04-17 21:56:23,222 - INFO - Preparing training and testing data...
2025-04-17 21:56:23,222 - INFO - Starting data preparation...
2025-04-17 21:56:23,222 - INFO - Loading Fama-French factors...
2025-04-17 21:56:23,232 - INFO - Fama-French factors loaded
2025-04-17 21:56:23,232 - INFO - Processing factor data...
2025-04-17 21:56:23,235 - INFO - Factor data processed
2025-04-17 21:56:23,235 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:23,236 - INFO - 
Training Period:
2025-04-17 21:56:23,240 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:23,248 - INFO - 
Testing Period:
2025-04-17 21:56:23,252 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:23,260 - INFO - Loading macro and market data...
2025-04-17 21:56:23,261 - INFO - Loading existing macro data...
2025-04-17 21:56:23,264 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:23,265 - INFO - Loading existing macro data...
2025-04-17 21:56:23,277 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:23,277 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:23,280 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:23,280 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:23,281 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:23,282 - INFO - Loading existing market data...
2025-04-17 21:56:23,285 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:23,286 - INFO - Loading existing market data...
2025-04-17 21:56:23,289 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:23,289 - INFO - Macro and market data loaded
2025-04-17 21:56:23,289 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:23,289 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:23,291 - INFO - Loading existing macro data...
2025-04-17 21:56:23,301 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:23,302 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:23,304 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:23,305 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:23,305 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:23,307 - INFO - Loading existing market data...
2025-04-17 21:56:23,311 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:23,314 - ERROR - Error running hmm with neural and 5 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:23,317 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 7 regimes
2025-04-17 21:56:23,317 - INFO - Initializing strategy...
2025-04-17 21:56:23,317 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 21:56:23,317 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:56:23,318 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:56:23,319 - INFO - Running strategy...
2025-04-17 21:56:23,319 - INFO - Starting strategy execution...
2025-04-17 21:56:23,319 - INFO - Preparing training and testing data...
2025-04-17 21:56:23,319 - INFO - Starting data preparation...
2025-04-17 21:56:23,319 - INFO - Loading Fama-French factors...
2025-04-17 21:56:23,331 - INFO - Fama-French factors loaded
2025-04-17 21:56:23,331 - INFO - Processing factor data...
2025-04-17 21:56:23,334 - INFO - Factor data processed
2025-04-17 21:56:23,334 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:56:23,334 - INFO - 
Training Period:
2025-04-17 21:56:23,340 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:56:23,347 - INFO - 
Testing Period:
2025-04-17 21:56:23,351 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:56:23,359 - INFO - Loading macro and market data...
2025-04-17 21:56:23,360 - INFO - Loading existing macro data...
2025-04-17 21:56:23,363 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:56:23,364 - INFO - Loading existing macro data...
2025-04-17 21:56:23,376 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:23,376 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:23,379 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:23,380 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:56:23,380 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:56:23,382 - INFO - Loading existing market data...
2025-04-17 21:56:23,386 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:23,387 - INFO - Loading existing market data...
2025-04-17 21:56:23,390 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:56:23,390 - INFO - Macro and market data loaded
2025-04-17 21:56:23,390 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:23,390 - INFO - Preparing training data for regime classification...
2025-04-17 21:56:23,391 - INFO - Loading existing macro data...
2025-04-17 21:56:23,402 - WARNING - US corporate credit spread file not found
2025-04-17 21:56:23,403 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:56:23,406 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:56:23,406 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:56:23,407 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:56:23,407 - INFO - Loading existing market data...
2025-04-17 21:56:23,411 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:56:23,414 - ERROR - Error running hmm with neural and 7 regimes: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 143, in prepare_data
    train_X, train_y = self.data_loader.prepare_training_data()
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\data\data_loader.py", line 396, in prepare_training_data
    regime_labels = self.kmeans_model.fit_predict(features)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1064, in fit_predict
    return self.fit(X, sample_weight=sample_weight).labels_
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\cluster\_kmeans.py", line 1454, in fit
    X = validate_data(
        self,
    ...<5 lines>...
        accept_large_sparse=False,
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2944, in validate_data
    out = check_array(X, input_name="X", **check_params)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 1107, in check_array
    _assert_all_finite(
    ~~~~~~~~~~~~~~~~~~^
        array,
        ^^^^^^
    ...<2 lines>...
        allow_nan=ensure_all_finite == "allow-nan",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 120, in _assert_all_finite
    _assert_all_finite_element_wise(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        X,
        ^^
    ...<4 lines>...
        input_name=input_name,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 169, in _assert_all_finite_element_wise
    raise ValueError(msg_err)
ValueError: Input X contains NaN.
KMeans does not accept missing values encoded as NaN natively. For supervised learning, you might want to consider sklearn.ensemble.HistGradientBoostingClassifier and Regressor which accept missing values encoded as NaNs natively. Alternatively, it is possible to preprocess the data, for instance by using an imputer transformer in a pipeline or drop samples with missing values. See https://scikit-learn.org/stable/modules/impute.html You can find a list of all estimators that handle NaN values at the following page: https://scikit-learn.org/stable/modules/impute.html#estimators-that-handle-nan-values
2025-04-17 21:56:23,416 - ERROR - No valid results obtained from parameter grid search
2025-04-17 21:56:23,417 - ERROR - No valid results obtained from parameter grid search
2025-04-17 21:56:23,417 - INFO - Factor timing strategy optimization completed
2025-04-17 21:57:09,379 - INFO - Starting factor timing strategy optimization...
2025-04-17 21:57:09,380 - INFO - Running parameter grid search...
2025-04-17 21:57:09,380 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 3 regimes
2025-04-17 21:57:09,380 - INFO - Initializing strategy...
2025-04-17 21:57:09,380 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 21:57:09,380 - ERROR - Error running lstm with mean_variance and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:57:09,382 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 5 regimes
2025-04-17 21:57:09,382 - INFO - Initializing strategy...
2025-04-17 21:57:09,382 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 21:57:09,382 - ERROR - Error running lstm with mean_variance and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:57:09,383 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 7 regimes
2025-04-17 21:57:09,384 - INFO - Initializing strategy...
2025-04-17 21:57:09,384 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 21:57:09,384 - ERROR - Error running lstm with mean_variance and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:57:09,385 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 3 regimes
2025-04-17 21:57:09,385 - INFO - Initializing strategy...
2025-04-17 21:57:09,386 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 21:57:09,386 - ERROR - Error running lstm with regime_aware and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:57:09,387 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 5 regimes
2025-04-17 21:57:09,388 - INFO - Initializing strategy...
2025-04-17 21:57:09,388 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 21:57:09,388 - ERROR - Error running lstm with regime_aware and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:57:09,389 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 7 regimes
2025-04-17 21:57:09,389 - INFO - Initializing strategy...
2025-04-17 21:57:09,390 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 21:57:09,390 - ERROR - Error running lstm with regime_aware and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:57:09,391 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 3 regimes
2025-04-17 21:57:09,391 - INFO - Initializing strategy...
2025-04-17 21:57:09,392 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 21:57:09,392 - ERROR - Error running lstm with neural_regime and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:57:09,393 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 5 regimes
2025-04-17 21:57:09,393 - INFO - Initializing strategy...
2025-04-17 21:57:09,393 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 21:57:09,394 - ERROR - Error running lstm with neural_regime and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:57:09,395 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 7 regimes
2025-04-17 21:57:09,395 - INFO - Initializing strategy...
2025-04-17 21:57:09,395 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 21:57:09,396 - ERROR - Error running lstm with neural_regime and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:57:09,396 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 21:57:09,396 - INFO - Initializing strategy...
2025-04-17 21:57:09,397 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 21:57:09,397 - ERROR - Error running lstm with autoencoder_regime and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:57:09,398 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 21:57:09,398 - INFO - Initializing strategy...
2025-04-17 21:57:09,398 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 21:57:09,398 - ERROR - Error running lstm with autoencoder_regime and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:57:09,399 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 21:57:09,399 - INFO - Initializing strategy...
2025-04-17 21:57:09,400 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 21:57:09,400 - ERROR - Error running lstm with autoencoder_regime and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:57:09,400 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 3 regimes
2025-04-17 21:57:09,401 - INFO - Initializing strategy...
2025-04-17 21:57:09,401 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 21:57:09,401 - ERROR - Error running lstm with neural and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:57:09,402 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 5 regimes
2025-04-17 21:57:09,402 - INFO - Initializing strategy...
2025-04-17 21:57:09,402 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 21:57:09,402 - ERROR - Error running lstm with neural and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:57:09,403 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 7 regimes
2025-04-17 21:57:09,403 - INFO - Initializing strategy...
2025-04-17 21:57:09,403 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 21:57:09,403 - ERROR - Error running lstm with neural and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:57:09,404 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 3 regimes
2025-04-17 21:57:09,404 - INFO - Initializing strategy...
2025-04-17 21:57:09,404 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 21:57:09,405 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:09,424 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:57:09,424 - INFO - Running strategy...
2025-04-17 21:57:09,425 - INFO - Starting strategy execution...
2025-04-17 21:57:09,425 - INFO - Preparing training and testing data...
2025-04-17 21:57:09,425 - INFO - Starting data preparation...
2025-04-17 21:57:09,426 - INFO - Loading Fama-French factors...
2025-04-17 21:57:09,439 - INFO - Fama-French factors loaded
2025-04-17 21:57:09,439 - INFO - Processing factor data...
2025-04-17 21:57:09,442 - INFO - Factor data processed
2025-04-17 21:57:09,442 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:09,443 - INFO - 
Training Period:
2025-04-17 21:57:09,448 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:09,458 - INFO - 
Testing Period:
2025-04-17 21:57:09,462 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:09,470 - INFO - Loading macro and market data...
2025-04-17 21:57:09,471 - INFO - Loading existing macro data...
2025-04-17 21:57:09,474 - INFO - Loaded existing macro data with 72 rows
2025-04-17 21:57:09,476 - INFO - Loading existing macro data...
2025-04-17 21:57:09,486 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:09,486 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:09,491 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:09,491 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:09,491 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:09,492 - INFO - Loading existing market data...
2025-04-17 21:57:09,496 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:09,497 - INFO - Loading existing market data...
2025-04-17 21:57:09,500 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:09,500 - INFO - Macro and market data loaded
2025-04-17 21:57:09,501 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:09,501 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:09,502 - INFO - Loading existing macro data...
2025-04-17 21:57:09,512 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:09,512 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:09,515 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:09,516 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:09,516 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:09,517 - INFO - Loading existing market data...
2025-04-17 21:57:09,521 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:09,674 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:09,674 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:09,675 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:09,675 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:09,676 - INFO - Loading existing macro data...
2025-04-17 21:57:09,690 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:09,690 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:09,694 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:09,695 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:09,695 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:09,697 - INFO - Loading existing market data...
2025-04-17 21:57:09,701 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:09,713 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:09,713 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:09,713 - INFO - Test data prepared
2025-04-17 21:57:09,714 - INFO - Storing data...
2025-04-17 21:57:09,714 - INFO - Aligning data indices...
2025-04-17 21:57:09,715 - INFO - Data indices aligned
2025-04-17 21:57:09,715 - INFO - Data preparation completed
2025-04-17 21:57:09,716 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:09,716 - INFO - Training models...
2025-04-17 21:57:09,716 - INFO - Starting model training...
2025-04-17 21:57:09,716 - INFO - Training regime classifier...
2025-04-17 21:57:09,716 - INFO - Training XGBoost model...
2025-04-17 21:57:09,716 - INFO - Preparing features...
2025-04-17 21:57:09,717 - INFO - Input shape: (1536, 8)
2025-04-17 21:57:09,717 - INFO - Handling missing values...
2025-04-17 21:57:09,718 - INFO - Missing values: 0 -> 0
2025-04-17 21:57:09,718 - INFO - Scaling features...
2025-04-17 21:57:09,720 - INFO - Fitted new scaler
2025-04-17 21:57:09,721 - INFO - Output shape: (1536, 8)
2025-04-17 21:57:11,147 - INFO - XGBoost model training completed
2025-04-17 21:57:11,512 - INFO - Model training completed
2025-04-17 21:57:11,515 - INFO - Model training completed
2025-04-17 21:57:11,516 - INFO - Initializing portfolio weights...
2025-04-17 21:57:11,518 - INFO - Portfolio weights initialized
2025-04-17 21:57:11,519 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:11,523 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:11,523 - ERROR - Error running xgboost with mean_variance and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:11,527 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 5 regimes
2025-04-17 21:57:11,527 - INFO - Initializing strategy...
2025-04-17 21:57:11,528 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 21:57:11,528 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:11,529 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:57:11,530 - INFO - Running strategy...
2025-04-17 21:57:11,530 - INFO - Starting strategy execution...
2025-04-17 21:57:11,530 - INFO - Preparing training and testing data...
2025-04-17 21:57:11,531 - INFO - Starting data preparation...
2025-04-17 21:57:11,531 - INFO - Loading Fama-French factors...
2025-04-17 21:57:11,548 - INFO - Fama-French factors loaded
2025-04-17 21:57:11,549 - INFO - Processing factor data...
2025-04-17 21:57:11,551 - INFO - Factor data processed
2025-04-17 21:57:11,551 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:11,552 - INFO - 
Training Period:
2025-04-17 21:57:11,556 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:11,564 - INFO - 
Testing Period:
2025-04-17 21:57:11,568 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:11,576 - INFO - Loading macro and market data...
2025-04-17 21:57:11,577 - INFO - Loading existing macro data...
2025-04-17 21:57:11,590 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:11,591 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:11,594 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:11,594 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:11,594 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:11,595 - INFO - Loading existing macro data...
2025-04-17 21:57:11,605 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:11,605 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:11,608 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:11,608 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:11,609 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:11,610 - INFO - Loading existing market data...
2025-04-17 21:57:11,614 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:11,615 - INFO - Loading existing market data...
2025-04-17 21:57:11,618 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:11,618 - INFO - Macro and market data loaded
2025-04-17 21:57:11,619 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:11,619 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:11,620 - INFO - Loading existing macro data...
2025-04-17 21:57:11,630 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:11,630 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:11,634 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:11,634 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:11,634 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:11,635 - INFO - Loading existing market data...
2025-04-17 21:57:11,638 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:11,662 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:11,662 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:11,662 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:11,663 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:11,665 - INFO - Loading existing macro data...
2025-04-17 21:57:11,697 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:11,712 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:11,720 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:11,721 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:11,721 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:11,724 - INFO - Loading existing market data...
2025-04-17 21:57:11,731 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:11,757 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:11,758 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:11,758 - INFO - Test data prepared
2025-04-17 21:57:11,758 - INFO - Storing data...
2025-04-17 21:57:11,759 - INFO - Aligning data indices...
2025-04-17 21:57:11,761 - INFO - Data indices aligned
2025-04-17 21:57:11,761 - INFO - Data preparation completed
2025-04-17 21:57:11,761 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:11,762 - INFO - Training models...
2025-04-17 21:57:11,762 - INFO - Starting model training...
2025-04-17 21:57:11,762 - INFO - Training regime classifier...
2025-04-17 21:57:11,762 - INFO - Training XGBoost model...
2025-04-17 21:57:11,762 - INFO - Preparing features...
2025-04-17 21:57:11,763 - INFO - Input shape: (1536, 8)
2025-04-17 21:57:11,763 - INFO - Handling missing values...
2025-04-17 21:57:11,765 - INFO - Missing values: 0 -> 0
2025-04-17 21:57:11,765 - INFO - Scaling features...
2025-04-17 21:57:11,767 - INFO - Fitted new scaler
2025-04-17 21:57:11,768 - INFO - Output shape: (1536, 8)
2025-04-17 21:57:12,072 - INFO - XGBoost model training completed
2025-04-17 21:57:12,461 - INFO - Model training completed
2025-04-17 21:57:12,463 - INFO - Model training completed
2025-04-17 21:57:12,463 - INFO - Initializing portfolio weights...
2025-04-17 21:57:12,464 - INFO - Portfolio weights initialized
2025-04-17 21:57:12,464 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:12,466 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:12,466 - ERROR - Error running xgboost with mean_variance and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:12,468 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 7 regimes
2025-04-17 21:57:12,468 - INFO - Initializing strategy...
2025-04-17 21:57:12,469 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 21:57:12,469 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:12,469 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:57:12,469 - INFO - Running strategy...
2025-04-17 21:57:12,470 - INFO - Starting strategy execution...
2025-04-17 21:57:12,470 - INFO - Preparing training and testing data...
2025-04-17 21:57:12,470 - INFO - Starting data preparation...
2025-04-17 21:57:12,470 - INFO - Loading Fama-French factors...
2025-04-17 21:57:12,482 - INFO - Fama-French factors loaded
2025-04-17 21:57:12,482 - INFO - Processing factor data...
2025-04-17 21:57:12,485 - INFO - Factor data processed
2025-04-17 21:57:12,485 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:12,485 - INFO - 
Training Period:
2025-04-17 21:57:12,490 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:12,500 - INFO - 
Testing Period:
2025-04-17 21:57:12,507 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:12,515 - INFO - Loading macro and market data...
2025-04-17 21:57:12,517 - INFO - Loading existing macro data...
2025-04-17 21:57:12,529 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:12,530 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:12,532 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:12,533 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:12,533 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:12,534 - INFO - Loading existing macro data...
2025-04-17 21:57:12,545 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:12,545 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:12,548 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:12,548 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:12,549 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:12,549 - INFO - Loading existing market data...
2025-04-17 21:57:12,553 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:12,554 - INFO - Loading existing market data...
2025-04-17 21:57:12,557 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:12,558 - INFO - Macro and market data loaded
2025-04-17 21:57:12,558 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:12,558 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:12,559 - INFO - Loading existing macro data...
2025-04-17 21:57:12,569 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:12,569 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:12,572 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:12,572 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:12,573 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:12,574 - INFO - Loading existing market data...
2025-04-17 21:57:12,577 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:12,593 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:12,593 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:12,594 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:12,594 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:12,595 - INFO - Loading existing macro data...
2025-04-17 21:57:12,609 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:12,609 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:12,612 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:12,613 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:12,613 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:12,614 - INFO - Loading existing market data...
2025-04-17 21:57:12,618 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:12,631 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:12,631 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:12,631 - INFO - Test data prepared
2025-04-17 21:57:12,631 - INFO - Storing data...
2025-04-17 21:57:12,632 - INFO - Aligning data indices...
2025-04-17 21:57:12,634 - INFO - Data indices aligned
2025-04-17 21:57:12,634 - INFO - Data preparation completed
2025-04-17 21:57:12,634 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:12,634 - INFO - Training models...
2025-04-17 21:57:12,635 - INFO - Starting model training...
2025-04-17 21:57:12,635 - INFO - Training regime classifier...
2025-04-17 21:57:12,635 - INFO - Training XGBoost model...
2025-04-17 21:57:12,635 - INFO - Preparing features...
2025-04-17 21:57:12,635 - INFO - Input shape: (1536, 8)
2025-04-17 21:57:12,636 - INFO - Handling missing values...
2025-04-17 21:57:12,637 - INFO - Missing values: 0 -> 0
2025-04-17 21:57:12,638 - INFO - Scaling features...
2025-04-17 21:57:12,639 - INFO - Fitted new scaler
2025-04-17 21:57:12,640 - INFO - Output shape: (1536, 8)
2025-04-17 21:57:12,810 - INFO - XGBoost model training completed
2025-04-17 21:57:13,086 - INFO - Model training completed
2025-04-17 21:57:13,087 - INFO - Model training completed
2025-04-17 21:57:13,088 - INFO - Initializing portfolio weights...
2025-04-17 21:57:13,088 - INFO - Portfolio weights initialized
2025-04-17 21:57:13,089 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:13,090 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:13,090 - ERROR - Error running xgboost with mean_variance and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:13,092 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 3 regimes
2025-04-17 21:57:13,092 - INFO - Initializing strategy...
2025-04-17 21:57:13,093 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 21:57:13,093 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:13,093 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:57:13,094 - INFO - Running strategy...
2025-04-17 21:57:13,094 - INFO - Starting strategy execution...
2025-04-17 21:57:13,095 - INFO - Preparing training and testing data...
2025-04-17 21:57:13,095 - INFO - Starting data preparation...
2025-04-17 21:57:13,095 - INFO - Loading Fama-French factors...
2025-04-17 21:57:13,108 - INFO - Fama-French factors loaded
2025-04-17 21:57:13,108 - INFO - Processing factor data...
2025-04-17 21:57:13,111 - INFO - Factor data processed
2025-04-17 21:57:13,111 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:13,111 - INFO - 
Training Period:
2025-04-17 21:57:13,116 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:13,124 - INFO - 
Testing Period:
2025-04-17 21:57:13,130 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:13,138 - INFO - Loading macro and market data...
2025-04-17 21:57:13,139 - INFO - Loading existing macro data...
2025-04-17 21:57:13,150 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:13,150 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:13,154 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:13,154 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:13,154 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:13,155 - INFO - Loading existing macro data...
2025-04-17 21:57:13,166 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:13,166 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:13,169 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:13,170 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:13,170 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:13,171 - INFO - Loading existing market data...
2025-04-17 21:57:13,175 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:13,176 - INFO - Loading existing market data...
2025-04-17 21:57:13,181 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:13,181 - INFO - Macro and market data loaded
2025-04-17 21:57:13,181 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:13,182 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:13,183 - INFO - Loading existing macro data...
2025-04-17 21:57:13,192 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:13,193 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:13,196 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:13,196 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:13,196 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:13,197 - INFO - Loading existing market data...
2025-04-17 21:57:13,201 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:13,219 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:13,220 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:13,220 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:13,220 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:13,222 - INFO - Loading existing macro data...
2025-04-17 21:57:13,236 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:13,237 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:13,241 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:13,241 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:13,241 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:13,243 - INFO - Loading existing market data...
2025-04-17 21:57:13,246 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:13,260 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:13,260 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:13,261 - INFO - Test data prepared
2025-04-17 21:57:13,262 - INFO - Storing data...
2025-04-17 21:57:13,262 - INFO - Aligning data indices...
2025-04-17 21:57:13,263 - INFO - Data indices aligned
2025-04-17 21:57:13,264 - INFO - Data preparation completed
2025-04-17 21:57:13,264 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:13,264 - INFO - Training models...
2025-04-17 21:57:13,265 - INFO - Starting model training...
2025-04-17 21:57:13,265 - INFO - Training regime classifier...
2025-04-17 21:57:13,265 - INFO - Training XGBoost model...
2025-04-17 21:57:13,265 - INFO - Preparing features...
2025-04-17 21:57:13,266 - INFO - Input shape: (1536, 8)
2025-04-17 21:57:13,266 - INFO - Handling missing values...
2025-04-17 21:57:13,268 - INFO - Missing values: 0 -> 0
2025-04-17 21:57:13,268 - INFO - Scaling features...
2025-04-17 21:57:13,270 - INFO - Fitted new scaler
2025-04-17 21:57:13,272 - INFO - Output shape: (1536, 8)
2025-04-17 21:57:13,535 - INFO - XGBoost model training completed
2025-04-17 21:57:13,797 - INFO - Model training completed
2025-04-17 21:57:13,799 - INFO - Model training completed
2025-04-17 21:57:13,799 - INFO - Initializing portfolio weights...
2025-04-17 21:57:13,800 - INFO - Portfolio weights initialized
2025-04-17 21:57:13,801 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:13,802 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:13,802 - ERROR - Error running xgboost with regime_aware and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:13,804 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 5 regimes
2025-04-17 21:57:13,804 - INFO - Initializing strategy...
2025-04-17 21:57:13,804 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 21:57:13,805 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:13,805 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:57:13,806 - INFO - Running strategy...
2025-04-17 21:57:13,806 - INFO - Starting strategy execution...
2025-04-17 21:57:13,806 - INFO - Preparing training and testing data...
2025-04-17 21:57:13,806 - INFO - Starting data preparation...
2025-04-17 21:57:13,806 - INFO - Loading Fama-French factors...
2025-04-17 21:57:13,816 - INFO - Fama-French factors loaded
2025-04-17 21:57:13,816 - INFO - Processing factor data...
2025-04-17 21:57:13,820 - INFO - Factor data processed
2025-04-17 21:57:13,820 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:13,820 - INFO - 
Training Period:
2025-04-17 21:57:13,826 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:13,837 - INFO - 
Testing Period:
2025-04-17 21:57:13,842 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:13,850 - INFO - Loading macro and market data...
2025-04-17 21:57:13,852 - INFO - Loading existing macro data...
2025-04-17 21:57:13,862 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:13,862 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:13,866 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:13,867 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:13,867 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:13,869 - INFO - Loading existing macro data...
2025-04-17 21:57:13,879 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:13,879 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:13,883 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:13,883 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:13,884 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:13,885 - INFO - Loading existing market data...
2025-04-17 21:57:13,888 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:13,890 - INFO - Loading existing market data...
2025-04-17 21:57:13,893 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:13,893 - INFO - Macro and market data loaded
2025-04-17 21:57:13,893 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:13,894 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:13,894 - INFO - Loading existing macro data...
2025-04-17 21:57:13,906 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:13,907 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:13,909 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:13,910 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:13,910 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:13,911 - INFO - Loading existing market data...
2025-04-17 21:57:13,915 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:13,931 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:13,932 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:13,932 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:13,932 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:13,934 - INFO - Loading existing macro data...
2025-04-17 21:57:13,948 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:13,948 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:13,952 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:13,952 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:13,952 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:13,954 - INFO - Loading existing market data...
2025-04-17 21:57:13,958 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:13,970 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:13,971 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:13,971 - INFO - Test data prepared
2025-04-17 21:57:13,971 - INFO - Storing data...
2025-04-17 21:57:13,972 - INFO - Aligning data indices...
2025-04-17 21:57:13,974 - INFO - Data indices aligned
2025-04-17 21:57:13,974 - INFO - Data preparation completed
2025-04-17 21:57:13,974 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:13,974 - INFO - Training models...
2025-04-17 21:57:13,975 - INFO - Starting model training...
2025-04-17 21:57:13,975 - INFO - Training regime classifier...
2025-04-17 21:57:13,975 - INFO - Training XGBoost model...
2025-04-17 21:57:13,975 - INFO - Preparing features...
2025-04-17 21:57:13,975 - INFO - Input shape: (1536, 8)
2025-04-17 21:57:13,975 - INFO - Handling missing values...
2025-04-17 21:57:13,977 - INFO - Missing values: 0 -> 0
2025-04-17 21:57:13,977 - INFO - Scaling features...
2025-04-17 21:57:13,979 - INFO - Fitted new scaler
2025-04-17 21:57:13,980 - INFO - Output shape: (1536, 8)
2025-04-17 21:57:14,156 - INFO - XGBoost model training completed
2025-04-17 21:57:14,424 - INFO - Model training completed
2025-04-17 21:57:14,426 - INFO - Model training completed
2025-04-17 21:57:14,427 - INFO - Initializing portfolio weights...
2025-04-17 21:57:14,427 - INFO - Portfolio weights initialized
2025-04-17 21:57:14,428 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:14,429 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:14,430 - ERROR - Error running xgboost with regime_aware and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:14,431 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 7 regimes
2025-04-17 21:57:14,432 - INFO - Initializing strategy...
2025-04-17 21:57:14,432 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 21:57:14,432 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:14,433 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:57:14,433 - INFO - Running strategy...
2025-04-17 21:57:14,434 - INFO - Starting strategy execution...
2025-04-17 21:57:14,434 - INFO - Preparing training and testing data...
2025-04-17 21:57:14,434 - INFO - Starting data preparation...
2025-04-17 21:57:14,434 - INFO - Loading Fama-French factors...
2025-04-17 21:57:14,444 - INFO - Fama-French factors loaded
2025-04-17 21:57:14,445 - INFO - Processing factor data...
2025-04-17 21:57:14,447 - INFO - Factor data processed
2025-04-17 21:57:14,447 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:14,447 - INFO - 
Training Period:
2025-04-17 21:57:14,452 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:14,461 - INFO - 
Testing Period:
2025-04-17 21:57:14,470 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:14,479 - INFO - Loading macro and market data...
2025-04-17 21:57:14,480 - INFO - Loading existing macro data...
2025-04-17 21:57:14,490 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:14,491 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:14,494 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:14,495 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:14,495 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:14,496 - INFO - Loading existing macro data...
2025-04-17 21:57:14,506 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:14,507 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:14,510 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:14,511 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:14,511 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:14,512 - INFO - Loading existing market data...
2025-04-17 21:57:14,516 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:14,518 - INFO - Loading existing market data...
2025-04-17 21:57:14,521 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:14,521 - INFO - Macro and market data loaded
2025-04-17 21:57:14,522 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:14,522 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:14,523 - INFO - Loading existing macro data...
2025-04-17 21:57:14,534 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:14,535 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:14,538 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:14,539 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:14,539 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:14,540 - INFO - Loading existing market data...
2025-04-17 21:57:14,544 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:14,561 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:14,561 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:14,561 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:14,562 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:14,563 - INFO - Loading existing macro data...
2025-04-17 21:57:14,578 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:14,578 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:14,581 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:14,582 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:14,582 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:14,583 - INFO - Loading existing market data...
2025-04-17 21:57:14,587 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:14,601 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:14,601 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:14,601 - INFO - Test data prepared
2025-04-17 21:57:14,601 - INFO - Storing data...
2025-04-17 21:57:14,602 - INFO - Aligning data indices...
2025-04-17 21:57:14,603 - INFO - Data indices aligned
2025-04-17 21:57:14,603 - INFO - Data preparation completed
2025-04-17 21:57:14,604 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:14,604 - INFO - Training models...
2025-04-17 21:57:14,604 - INFO - Starting model training...
2025-04-17 21:57:14,604 - INFO - Training regime classifier...
2025-04-17 21:57:14,604 - INFO - Training XGBoost model...
2025-04-17 21:57:14,605 - INFO - Preparing features...
2025-04-17 21:57:14,605 - INFO - Input shape: (1536, 8)
2025-04-17 21:57:14,605 - INFO - Handling missing values...
2025-04-17 21:57:14,606 - INFO - Missing values: 0 -> 0
2025-04-17 21:57:14,607 - INFO - Scaling features...
2025-04-17 21:57:14,608 - INFO - Fitted new scaler
2025-04-17 21:57:14,609 - INFO - Output shape: (1536, 8)
2025-04-17 21:57:14,773 - INFO - XGBoost model training completed
2025-04-17 21:57:15,043 - INFO - Model training completed
2025-04-17 21:57:15,046 - INFO - Model training completed
2025-04-17 21:57:15,046 - INFO - Initializing portfolio weights...
2025-04-17 21:57:15,047 - INFO - Portfolio weights initialized
2025-04-17 21:57:15,047 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:15,048 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:15,049 - ERROR - Error running xgboost with regime_aware and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:15,051 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 3 regimes
2025-04-17 21:57:15,051 - INFO - Initializing strategy...
2025-04-17 21:57:15,051 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 21:57:15,051 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:15,051 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:57:15,052 - INFO - Running strategy...
2025-04-17 21:57:15,052 - INFO - Starting strategy execution...
2025-04-17 21:57:15,052 - INFO - Preparing training and testing data...
2025-04-17 21:57:15,052 - INFO - Starting data preparation...
2025-04-17 21:57:15,052 - INFO - Loading Fama-French factors...
2025-04-17 21:57:15,062 - INFO - Fama-French factors loaded
2025-04-17 21:57:15,063 - INFO - Processing factor data...
2025-04-17 21:57:15,065 - INFO - Factor data processed
2025-04-17 21:57:15,066 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:15,066 - INFO - 
Training Period:
2025-04-17 21:57:15,071 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:15,079 - INFO - 
Testing Period:
2025-04-17 21:57:15,085 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:15,092 - INFO - Loading macro and market data...
2025-04-17 21:57:15,093 - INFO - Loading existing macro data...
2025-04-17 21:57:15,105 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:15,105 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:15,108 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:15,108 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:15,109 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:15,110 - INFO - Loading existing macro data...
2025-04-17 21:57:15,120 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:15,120 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:15,124 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:15,124 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:15,124 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:15,126 - INFO - Loading existing market data...
2025-04-17 21:57:15,129 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:15,130 - INFO - Loading existing market data...
2025-04-17 21:57:15,134 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:15,134 - INFO - Macro and market data loaded
2025-04-17 21:57:15,135 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:15,135 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:15,136 - INFO - Loading existing macro data...
2025-04-17 21:57:15,147 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:15,148 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:15,151 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:15,151 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:15,152 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:15,153 - INFO - Loading existing market data...
2025-04-17 21:57:15,157 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:15,177 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:15,177 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:15,178 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:15,178 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:15,179 - INFO - Loading existing macro data...
2025-04-17 21:57:15,193 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:15,193 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:15,198 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:15,198 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:15,198 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:15,200 - INFO - Loading existing market data...
2025-04-17 21:57:15,204 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:15,216 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:15,216 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:15,217 - INFO - Test data prepared
2025-04-17 21:57:15,217 - INFO - Storing data...
2025-04-17 21:57:15,217 - INFO - Aligning data indices...
2025-04-17 21:57:15,219 - INFO - Data indices aligned
2025-04-17 21:57:15,219 - INFO - Data preparation completed
2025-04-17 21:57:15,219 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:15,219 - INFO - Training models...
2025-04-17 21:57:15,219 - INFO - Starting model training...
2025-04-17 21:57:15,219 - INFO - Training regime classifier...
2025-04-17 21:57:15,220 - INFO - Training XGBoost model...
2025-04-17 21:57:15,220 - INFO - Preparing features...
2025-04-17 21:57:15,220 - INFO - Input shape: (1536, 8)
2025-04-17 21:57:15,220 - INFO - Handling missing values...
2025-04-17 21:57:15,222 - INFO - Missing values: 0 -> 0
2025-04-17 21:57:15,222 - INFO - Scaling features...
2025-04-17 21:57:15,223 - INFO - Fitted new scaler
2025-04-17 21:57:15,224 - INFO - Output shape: (1536, 8)
2025-04-17 21:57:15,394 - INFO - XGBoost model training completed
2025-04-17 21:57:15,675 - INFO - Model training completed
2025-04-17 21:57:15,676 - INFO - Model training completed
2025-04-17 21:57:15,677 - INFO - Initializing portfolio weights...
2025-04-17 21:57:15,677 - INFO - Portfolio weights initialized
2025-04-17 21:57:15,677 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:15,679 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:15,679 - ERROR - Error running xgboost with neural_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:15,681 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 5 regimes
2025-04-17 21:57:15,681 - INFO - Initializing strategy...
2025-04-17 21:57:15,681 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 21:57:15,682 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:15,682 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:57:15,682 - INFO - Running strategy...
2025-04-17 21:57:15,683 - INFO - Starting strategy execution...
2025-04-17 21:57:15,683 - INFO - Preparing training and testing data...
2025-04-17 21:57:15,683 - INFO - Starting data preparation...
2025-04-17 21:57:15,683 - INFO - Loading Fama-French factors...
2025-04-17 21:57:15,692 - INFO - Fama-French factors loaded
2025-04-17 21:57:15,693 - INFO - Processing factor data...
2025-04-17 21:57:15,695 - INFO - Factor data processed
2025-04-17 21:57:15,696 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:15,696 - INFO - 
Training Period:
2025-04-17 21:57:15,700 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:15,708 - INFO - 
Testing Period:
2025-04-17 21:57:15,712 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:15,720 - INFO - Loading macro and market data...
2025-04-17 21:57:15,721 - INFO - Loading existing macro data...
2025-04-17 21:57:15,731 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:15,731 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:15,734 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:15,735 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:15,735 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:15,736 - INFO - Loading existing macro data...
2025-04-17 21:57:15,749 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:15,749 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:15,752 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:15,752 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:15,753 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:15,754 - INFO - Loading existing market data...
2025-04-17 21:57:15,759 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:15,760 - INFO - Loading existing market data...
2025-04-17 21:57:15,762 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:15,763 - INFO - Macro and market data loaded
2025-04-17 21:57:15,763 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:15,763 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:15,764 - INFO - Loading existing macro data...
2025-04-17 21:57:15,776 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:15,777 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:15,781 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:15,781 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:15,781 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:15,783 - INFO - Loading existing market data...
2025-04-17 21:57:15,786 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:15,804 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:15,804 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:15,804 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:15,805 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:15,806 - INFO - Loading existing macro data...
2025-04-17 21:57:15,820 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:15,821 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:15,825 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:15,825 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:15,826 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:15,828 - INFO - Loading existing market data...
2025-04-17 21:57:15,832 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:15,845 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:15,845 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:15,846 - INFO - Test data prepared
2025-04-17 21:57:15,846 - INFO - Storing data...
2025-04-17 21:57:15,846 - INFO - Aligning data indices...
2025-04-17 21:57:15,848 - INFO - Data indices aligned
2025-04-17 21:57:15,848 - INFO - Data preparation completed
2025-04-17 21:57:15,848 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:15,848 - INFO - Training models...
2025-04-17 21:57:15,849 - INFO - Starting model training...
2025-04-17 21:57:15,849 - INFO - Training regime classifier...
2025-04-17 21:57:15,849 - INFO - Training XGBoost model...
2025-04-17 21:57:15,849 - INFO - Preparing features...
2025-04-17 21:57:15,849 - INFO - Input shape: (1536, 8)
2025-04-17 21:57:15,850 - INFO - Handling missing values...
2025-04-17 21:57:15,851 - INFO - Missing values: 0 -> 0
2025-04-17 21:57:15,851 - INFO - Scaling features...
2025-04-17 21:57:15,852 - INFO - Fitted new scaler
2025-04-17 21:57:15,854 - INFO - Output shape: (1536, 8)
2025-04-17 21:57:16,028 - INFO - XGBoost model training completed
2025-04-17 21:57:16,302 - INFO - Model training completed
2025-04-17 21:57:16,304 - INFO - Model training completed
2025-04-17 21:57:16,305 - INFO - Initializing portfolio weights...
2025-04-17 21:57:16,305 - INFO - Portfolio weights initialized
2025-04-17 21:57:16,306 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:16,307 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:16,308 - ERROR - Error running xgboost with neural_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:16,310 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 7 regimes
2025-04-17 21:57:16,310 - INFO - Initializing strategy...
2025-04-17 21:57:16,311 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 21:57:16,311 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:16,311 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:57:16,312 - INFO - Running strategy...
2025-04-17 21:57:16,313 - INFO - Starting strategy execution...
2025-04-17 21:57:16,313 - INFO - Preparing training and testing data...
2025-04-17 21:57:16,313 - INFO - Starting data preparation...
2025-04-17 21:57:16,313 - INFO - Loading Fama-French factors...
2025-04-17 21:57:16,325 - INFO - Fama-French factors loaded
2025-04-17 21:57:16,325 - INFO - Processing factor data...
2025-04-17 21:57:16,328 - INFO - Factor data processed
2025-04-17 21:57:16,328 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:16,328 - INFO - 
Training Period:
2025-04-17 21:57:16,334 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:16,342 - INFO - 
Testing Period:
2025-04-17 21:57:16,347 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:16,355 - INFO - Loading macro and market data...
2025-04-17 21:57:16,357 - INFO - Loading existing macro data...
2025-04-17 21:57:16,368 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:16,368 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:16,371 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:16,371 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:16,372 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:16,373 - INFO - Loading existing macro data...
2025-04-17 21:57:16,385 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:16,385 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:16,388 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:16,388 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:16,389 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:16,390 - INFO - Loading existing market data...
2025-04-17 21:57:16,394 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:16,395 - INFO - Loading existing market data...
2025-04-17 21:57:16,398 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:16,398 - INFO - Macro and market data loaded
2025-04-17 21:57:16,398 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:16,398 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:16,399 - INFO - Loading existing macro data...
2025-04-17 21:57:16,411 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:16,412 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:16,414 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:16,415 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:16,415 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:16,416 - INFO - Loading existing market data...
2025-04-17 21:57:16,420 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:16,436 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:16,436 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:16,437 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:16,437 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:16,438 - INFO - Loading existing macro data...
2025-04-17 21:57:16,451 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:16,452 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:16,456 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:16,456 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:16,456 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:16,457 - INFO - Loading existing market data...
2025-04-17 21:57:16,462 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:16,474 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:16,475 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:16,475 - INFO - Test data prepared
2025-04-17 21:57:16,475 - INFO - Storing data...
2025-04-17 21:57:16,475 - INFO - Aligning data indices...
2025-04-17 21:57:16,476 - INFO - Data indices aligned
2025-04-17 21:57:16,477 - INFO - Data preparation completed
2025-04-17 21:57:16,477 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:16,477 - INFO - Training models...
2025-04-17 21:57:16,477 - INFO - Starting model training...
2025-04-17 21:57:16,477 - INFO - Training regime classifier...
2025-04-17 21:57:16,477 - INFO - Training XGBoost model...
2025-04-17 21:57:16,477 - INFO - Preparing features...
2025-04-17 21:57:16,477 - INFO - Input shape: (1536, 8)
2025-04-17 21:57:16,478 - INFO - Handling missing values...
2025-04-17 21:57:16,479 - INFO - Missing values: 0 -> 0
2025-04-17 21:57:16,479 - INFO - Scaling features...
2025-04-17 21:57:16,480 - INFO - Fitted new scaler
2025-04-17 21:57:16,482 - INFO - Output shape: (1536, 8)
2025-04-17 21:57:16,658 - INFO - XGBoost model training completed
2025-04-17 21:57:16,956 - INFO - Model training completed
2025-04-17 21:57:16,959 - INFO - Model training completed
2025-04-17 21:57:16,959 - INFO - Initializing portfolio weights...
2025-04-17 21:57:16,960 - INFO - Portfolio weights initialized
2025-04-17 21:57:16,960 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:16,962 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:16,962 - ERROR - Error running xgboost with neural_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:16,964 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 21:57:16,964 - INFO - Initializing strategy...
2025-04-17 21:57:16,965 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 21:57:16,965 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:16,965 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:57:16,966 - INFO - Running strategy...
2025-04-17 21:57:16,966 - INFO - Starting strategy execution...
2025-04-17 21:57:16,967 - INFO - Preparing training and testing data...
2025-04-17 21:57:16,967 - INFO - Starting data preparation...
2025-04-17 21:57:16,967 - INFO - Loading Fama-French factors...
2025-04-17 21:57:16,978 - INFO - Fama-French factors loaded
2025-04-17 21:57:16,978 - INFO - Processing factor data...
2025-04-17 21:57:16,980 - INFO - Factor data processed
2025-04-17 21:57:16,981 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:16,981 - INFO - 
Training Period:
2025-04-17 21:57:16,985 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:16,996 - INFO - 
Testing Period:
2025-04-17 21:57:17,000 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:17,008 - INFO - Loading macro and market data...
2025-04-17 21:57:17,009 - INFO - Loading existing macro data...
2025-04-17 21:57:17,020 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:17,020 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:17,023 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:17,024 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:17,024 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:17,025 - INFO - Loading existing macro data...
2025-04-17 21:57:17,034 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:17,034 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:17,038 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:17,038 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:17,038 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:17,040 - INFO - Loading existing market data...
2025-04-17 21:57:17,043 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:17,044 - INFO - Loading existing market data...
2025-04-17 21:57:17,047 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:17,048 - INFO - Macro and market data loaded
2025-04-17 21:57:17,048 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:17,048 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:17,049 - INFO - Loading existing macro data...
2025-04-17 21:57:17,059 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:17,059 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:17,063 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:17,063 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:17,063 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:17,064 - INFO - Loading existing market data...
2025-04-17 21:57:17,068 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:17,085 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:17,085 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:17,086 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:17,086 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:17,087 - INFO - Loading existing macro data...
2025-04-17 21:57:17,100 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:17,100 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:17,103 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:17,104 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:17,104 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:17,106 - INFO - Loading existing market data...
2025-04-17 21:57:17,109 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:17,123 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:17,123 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:17,124 - INFO - Test data prepared
2025-04-17 21:57:17,124 - INFO - Storing data...
2025-04-17 21:57:17,124 - INFO - Aligning data indices...
2025-04-17 21:57:17,126 - INFO - Data indices aligned
2025-04-17 21:57:17,126 - INFO - Data preparation completed
2025-04-17 21:57:17,126 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:17,127 - INFO - Training models...
2025-04-17 21:57:17,127 - INFO - Starting model training...
2025-04-17 21:57:17,127 - INFO - Training regime classifier...
2025-04-17 21:57:17,127 - INFO - Training XGBoost model...
2025-04-17 21:57:17,128 - INFO - Preparing features...
2025-04-17 21:57:17,128 - INFO - Input shape: (1536, 8)
2025-04-17 21:57:17,128 - INFO - Handling missing values...
2025-04-17 21:57:17,129 - INFO - Missing values: 0 -> 0
2025-04-17 21:57:17,130 - INFO - Scaling features...
2025-04-17 21:57:17,131 - INFO - Fitted new scaler
2025-04-17 21:57:17,132 - INFO - Output shape: (1536, 8)
2025-04-17 21:57:17,309 - INFO - XGBoost model training completed
2025-04-17 21:57:17,595 - INFO - Model training completed
2025-04-17 21:57:17,596 - INFO - Model training completed
2025-04-17 21:57:17,597 - INFO - Initializing portfolio weights...
2025-04-17 21:57:17,597 - INFO - Portfolio weights initialized
2025-04-17 21:57:17,597 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:17,599 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:17,599 - ERROR - Error running xgboost with autoencoder_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:17,601 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 21:57:17,601 - INFO - Initializing strategy...
2025-04-17 21:57:17,601 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 21:57:17,602 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:17,602 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:57:17,603 - INFO - Running strategy...
2025-04-17 21:57:17,603 - INFO - Starting strategy execution...
2025-04-17 21:57:17,603 - INFO - Preparing training and testing data...
2025-04-17 21:57:17,603 - INFO - Starting data preparation...
2025-04-17 21:57:17,603 - INFO - Loading Fama-French factors...
2025-04-17 21:57:17,616 - INFO - Fama-French factors loaded
2025-04-17 21:57:17,616 - INFO - Processing factor data...
2025-04-17 21:57:17,619 - INFO - Factor data processed
2025-04-17 21:57:17,620 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:17,620 - INFO - 
Training Period:
2025-04-17 21:57:17,624 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:17,632 - INFO - 
Testing Period:
2025-04-17 21:57:17,637 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:17,644 - INFO - Loading macro and market data...
2025-04-17 21:57:17,646 - INFO - Loading existing macro data...
2025-04-17 21:57:17,657 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:17,658 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:17,661 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:17,661 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:17,662 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:17,663 - INFO - Loading existing macro data...
2025-04-17 21:57:17,672 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:17,673 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:17,676 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:17,676 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:17,676 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:17,678 - INFO - Loading existing market data...
2025-04-17 21:57:17,682 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:17,683 - INFO - Loading existing market data...
2025-04-17 21:57:17,686 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:17,686 - INFO - Macro and market data loaded
2025-04-17 21:57:17,686 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:17,687 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:17,688 - INFO - Loading existing macro data...
2025-04-17 21:57:17,698 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:17,699 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:17,701 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:17,702 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:17,702 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:17,703 - INFO - Loading existing market data...
2025-04-17 21:57:17,707 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:17,725 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:17,726 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:17,726 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:17,726 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:17,727 - INFO - Loading existing macro data...
2025-04-17 21:57:17,741 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:17,742 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:17,746 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:17,746 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:17,746 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:17,748 - INFO - Loading existing market data...
2025-04-17 21:57:17,751 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:17,764 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:17,764 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:17,765 - INFO - Test data prepared
2025-04-17 21:57:17,765 - INFO - Storing data...
2025-04-17 21:57:17,765 - INFO - Aligning data indices...
2025-04-17 21:57:17,767 - INFO - Data indices aligned
2025-04-17 21:57:17,767 - INFO - Data preparation completed
2025-04-17 21:57:17,767 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:17,768 - INFO - Training models...
2025-04-17 21:57:17,768 - INFO - Starting model training...
2025-04-17 21:57:17,768 - INFO - Training regime classifier...
2025-04-17 21:57:17,768 - INFO - Training XGBoost model...
2025-04-17 21:57:17,768 - INFO - Preparing features...
2025-04-17 21:57:17,769 - INFO - Input shape: (1536, 8)
2025-04-17 21:57:17,769 - INFO - Handling missing values...
2025-04-17 21:57:17,770 - INFO - Missing values: 0 -> 0
2025-04-17 21:57:17,771 - INFO - Scaling features...
2025-04-17 21:57:17,772 - INFO - Fitted new scaler
2025-04-17 21:57:17,773 - INFO - Output shape: (1536, 8)
2025-04-17 21:57:17,947 - INFO - XGBoost model training completed
2025-04-17 21:57:18,212 - INFO - Model training completed
2025-04-17 21:57:18,214 - INFO - Model training completed
2025-04-17 21:57:18,214 - INFO - Initializing portfolio weights...
2025-04-17 21:57:18,215 - INFO - Portfolio weights initialized
2025-04-17 21:57:18,215 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:18,216 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:18,217 - ERROR - Error running xgboost with autoencoder_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:18,218 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 21:57:18,219 - INFO - Initializing strategy...
2025-04-17 21:57:18,219 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 21:57:18,219 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:18,219 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:57:18,220 - INFO - Running strategy...
2025-04-17 21:57:18,220 - INFO - Starting strategy execution...
2025-04-17 21:57:18,220 - INFO - Preparing training and testing data...
2025-04-17 21:57:18,220 - INFO - Starting data preparation...
2025-04-17 21:57:18,221 - INFO - Loading Fama-French factors...
2025-04-17 21:57:18,232 - INFO - Fama-French factors loaded
2025-04-17 21:57:18,232 - INFO - Processing factor data...
2025-04-17 21:57:18,235 - INFO - Factor data processed
2025-04-17 21:57:18,235 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:18,235 - INFO - 
Training Period:
2025-04-17 21:57:18,240 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:18,248 - INFO - 
Testing Period:
2025-04-17 21:57:18,254 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:18,261 - INFO - Loading macro and market data...
2025-04-17 21:57:18,262 - INFO - Loading existing macro data...
2025-04-17 21:57:18,273 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:18,273 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:18,277 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:18,277 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:18,277 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:18,278 - INFO - Loading existing macro data...
2025-04-17 21:57:18,290 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:18,290 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:18,293 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:18,294 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:18,294 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:18,295 - INFO - Loading existing market data...
2025-04-17 21:57:18,300 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:18,301 - INFO - Loading existing market data...
2025-04-17 21:57:18,305 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:18,305 - INFO - Macro and market data loaded
2025-04-17 21:57:18,305 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:18,306 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:18,307 - INFO - Loading existing macro data...
2025-04-17 21:57:18,318 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:18,318 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:18,321 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:18,322 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:18,322 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:18,323 - INFO - Loading existing market data...
2025-04-17 21:57:18,328 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:18,346 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:18,346 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:18,346 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:18,347 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:18,349 - INFO - Loading existing macro data...
2025-04-17 21:57:18,364 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:18,364 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:18,368 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:18,368 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:18,369 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:18,370 - INFO - Loading existing market data...
2025-04-17 21:57:18,375 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:18,389 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:18,390 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:18,390 - INFO - Test data prepared
2025-04-17 21:57:18,390 - INFO - Storing data...
2025-04-17 21:57:18,390 - INFO - Aligning data indices...
2025-04-17 21:57:18,392 - INFO - Data indices aligned
2025-04-17 21:57:18,393 - INFO - Data preparation completed
2025-04-17 21:57:18,393 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:18,393 - INFO - Training models...
2025-04-17 21:57:18,393 - INFO - Starting model training...
2025-04-17 21:57:18,393 - INFO - Training regime classifier...
2025-04-17 21:57:18,393 - INFO - Training XGBoost model...
2025-04-17 21:57:18,393 - INFO - Preparing features...
2025-04-17 21:57:18,394 - INFO - Input shape: (1536, 8)
2025-04-17 21:57:18,394 - INFO - Handling missing values...
2025-04-17 21:57:18,396 - INFO - Missing values: 0 -> 0
2025-04-17 21:57:18,396 - INFO - Scaling features...
2025-04-17 21:57:18,398 - INFO - Fitted new scaler
2025-04-17 21:57:18,399 - INFO - Output shape: (1536, 8)
2025-04-17 21:57:18,574 - INFO - XGBoost model training completed
2025-04-17 21:57:18,858 - INFO - Model training completed
2025-04-17 21:57:18,861 - INFO - Model training completed
2025-04-17 21:57:18,861 - INFO - Initializing portfolio weights...
2025-04-17 21:57:18,862 - INFO - Portfolio weights initialized
2025-04-17 21:57:18,863 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:18,864 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:18,864 - ERROR - Error running xgboost with autoencoder_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:18,866 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 3 regimes
2025-04-17 21:57:18,867 - INFO - Initializing strategy...
2025-04-17 21:57:18,867 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 21:57:18,867 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:18,867 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:57:19,857 - INFO - Running strategy...
2025-04-17 21:57:19,858 - INFO - Starting strategy execution...
2025-04-17 21:57:19,858 - INFO - Preparing training and testing data...
2025-04-17 21:57:19,858 - INFO - Starting data preparation...
2025-04-17 21:57:19,858 - INFO - Loading Fama-French factors...
2025-04-17 21:57:19,871 - INFO - Fama-French factors loaded
2025-04-17 21:57:19,871 - INFO - Processing factor data...
2025-04-17 21:57:19,873 - INFO - Factor data processed
2025-04-17 21:57:19,874 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:19,874 - INFO - 
Training Period:
2025-04-17 21:57:19,880 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:19,888 - INFO - 
Testing Period:
2025-04-17 21:57:19,893 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:19,902 - INFO - Loading macro and market data...
2025-04-17 21:57:19,904 - INFO - Loading existing macro data...
2025-04-17 21:57:19,917 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:19,917 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:19,920 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:19,920 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:19,921 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:19,922 - INFO - Loading existing macro data...
2025-04-17 21:57:19,932 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:19,932 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:19,935 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:19,935 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:19,936 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:19,937 - INFO - Loading existing market data...
2025-04-17 21:57:19,941 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:19,942 - INFO - Loading existing market data...
2025-04-17 21:57:19,947 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:19,947 - INFO - Macro and market data loaded
2025-04-17 21:57:19,947 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:19,948 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:19,949 - INFO - Loading existing macro data...
2025-04-17 21:57:19,961 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:19,961 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:19,964 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:19,964 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:19,965 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:19,966 - INFO - Loading existing market data...
2025-04-17 21:57:19,970 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:19,986 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:19,986 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:19,987 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:19,987 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:19,988 - INFO - Loading existing macro data...
2025-04-17 21:57:20,001 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:20,001 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:20,005 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:20,005 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:20,005 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:20,007 - INFO - Loading existing market data...
2025-04-17 21:57:20,012 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:20,032 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:20,032 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:20,033 - INFO - Test data prepared
2025-04-17 21:57:20,034 - INFO - Storing data...
2025-04-17 21:57:20,034 - INFO - Aligning data indices...
2025-04-17 21:57:20,036 - INFO - Data indices aligned
2025-04-17 21:57:20,036 - ERROR - Error running xgboost with neural and 3 regimes: 'NeuralPortfolioOptimizer' object has no attribute 'update_input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 180, in prepare_data
    self.portfolio_optimizer.update_input_size(input_size)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NeuralPortfolioOptimizer' object has no attribute 'update_input_size'
2025-04-17 21:57:20,038 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 5 regimes
2025-04-17 21:57:20,038 - INFO - Initializing strategy...
2025-04-17 21:57:20,038 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 21:57:20,038 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:20,038 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:57:20,039 - INFO - Running strategy...
2025-04-17 21:57:20,040 - INFO - Starting strategy execution...
2025-04-17 21:57:20,040 - INFO - Preparing training and testing data...
2025-04-17 21:57:20,040 - INFO - Starting data preparation...
2025-04-17 21:57:20,041 - INFO - Loading Fama-French factors...
2025-04-17 21:57:20,057 - INFO - Fama-French factors loaded
2025-04-17 21:57:20,057 - INFO - Processing factor data...
2025-04-17 21:57:20,062 - INFO - Factor data processed
2025-04-17 21:57:20,062 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:20,062 - INFO - 
Training Period:
2025-04-17 21:57:20,069 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:20,083 - INFO - 
Testing Period:
2025-04-17 21:57:20,091 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:20,107 - INFO - Loading macro and market data...
2025-04-17 21:57:20,108 - INFO - Loading existing macro data...
2025-04-17 21:57:20,125 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:20,125 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:20,129 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:20,130 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:20,130 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:20,131 - INFO - Loading existing macro data...
2025-04-17 21:57:20,142 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:20,142 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:20,145 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:20,145 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:20,146 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:20,147 - INFO - Loading existing market data...
2025-04-17 21:57:20,151 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:20,152 - INFO - Loading existing market data...
2025-04-17 21:57:20,156 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:20,157 - INFO - Macro and market data loaded
2025-04-17 21:57:20,157 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:20,157 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:20,158 - INFO - Loading existing macro data...
2025-04-17 21:57:20,171 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:20,172 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:20,175 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:20,175 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:20,176 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:20,177 - INFO - Loading existing market data...
2025-04-17 21:57:20,182 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:20,199 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:20,200 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:20,200 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:20,200 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:20,202 - INFO - Loading existing macro data...
2025-04-17 21:57:20,216 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:20,217 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:20,220 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:20,220 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:20,221 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:20,222 - INFO - Loading existing market data...
2025-04-17 21:57:20,227 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:20,241 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:20,241 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:20,241 - INFO - Test data prepared
2025-04-17 21:57:20,241 - INFO - Storing data...
2025-04-17 21:57:20,241 - INFO - Aligning data indices...
2025-04-17 21:57:20,243 - INFO - Data indices aligned
2025-04-17 21:57:20,243 - ERROR - Error running xgboost with neural and 5 regimes: 'NeuralPortfolioOptimizer' object has no attribute 'update_input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 180, in prepare_data
    self.portfolio_optimizer.update_input_size(input_size)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NeuralPortfolioOptimizer' object has no attribute 'update_input_size'
2025-04-17 21:57:20,244 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 7 regimes
2025-04-17 21:57:20,244 - INFO - Initializing strategy...
2025-04-17 21:57:20,245 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 21:57:20,245 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:20,245 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:57:20,246 - INFO - Running strategy...
2025-04-17 21:57:20,246 - INFO - Starting strategy execution...
2025-04-17 21:57:20,246 - INFO - Preparing training and testing data...
2025-04-17 21:57:20,246 - INFO - Starting data preparation...
2025-04-17 21:57:20,246 - INFO - Loading Fama-French factors...
2025-04-17 21:57:20,259 - INFO - Fama-French factors loaded
2025-04-17 21:57:20,259 - INFO - Processing factor data...
2025-04-17 21:57:20,262 - INFO - Factor data processed
2025-04-17 21:57:20,262 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:20,262 - INFO - 
Training Period:
2025-04-17 21:57:20,268 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:20,276 - INFO - 
Testing Period:
2025-04-17 21:57:20,281 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:20,290 - INFO - Loading macro and market data...
2025-04-17 21:57:20,292 - INFO - Loading existing macro data...
2025-04-17 21:57:20,304 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:20,305 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:20,308 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:20,309 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:20,309 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:20,310 - INFO - Loading existing macro data...
2025-04-17 21:57:20,321 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:20,321 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:20,325 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:20,325 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:20,325 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:20,327 - INFO - Loading existing market data...
2025-04-17 21:57:20,330 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:20,331 - INFO - Loading existing market data...
2025-04-17 21:57:20,335 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:20,335 - INFO - Macro and market data loaded
2025-04-17 21:57:20,335 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:20,336 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:20,337 - INFO - Loading existing macro data...
2025-04-17 21:57:20,348 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:20,348 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:20,351 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:20,351 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:20,351 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:20,352 - INFO - Loading existing market data...
2025-04-17 21:57:20,356 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:20,371 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:20,371 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:20,371 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:20,372 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:20,373 - INFO - Loading existing macro data...
2025-04-17 21:57:20,390 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:20,391 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:20,394 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:20,395 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:20,395 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:20,396 - INFO - Loading existing market data...
2025-04-17 21:57:20,400 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:20,412 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:20,412 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:20,413 - INFO - Test data prepared
2025-04-17 21:57:20,413 - INFO - Storing data...
2025-04-17 21:57:20,413 - INFO - Aligning data indices...
2025-04-17 21:57:20,415 - INFO - Data indices aligned
2025-04-17 21:57:20,415 - ERROR - Error running xgboost with neural and 7 regimes: 'NeuralPortfolioOptimizer' object has no attribute 'update_input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 180, in prepare_data
    self.portfolio_optimizer.update_input_size(input_size)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NeuralPortfolioOptimizer' object has no attribute 'update_input_size'
2025-04-17 21:57:20,416 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 3 regimes
2025-04-17 21:57:20,417 - INFO - Initializing strategy...
2025-04-17 21:57:20,417 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 21:57:20,417 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:20,418 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:57:20,418 - INFO - Running strategy...
2025-04-17 21:57:20,418 - INFO - Starting strategy execution...
2025-04-17 21:57:20,419 - INFO - Preparing training and testing data...
2025-04-17 21:57:20,419 - INFO - Starting data preparation...
2025-04-17 21:57:20,419 - INFO - Loading Fama-French factors...
2025-04-17 21:57:20,431 - INFO - Fama-French factors loaded
2025-04-17 21:57:20,431 - INFO - Processing factor data...
2025-04-17 21:57:20,434 - INFO - Factor data processed
2025-04-17 21:57:20,434 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:20,434 - INFO - 
Training Period:
2025-04-17 21:57:20,440 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:20,450 - INFO - 
Testing Period:
2025-04-17 21:57:20,456 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:20,465 - INFO - Loading macro and market data...
2025-04-17 21:57:20,467 - INFO - Loading existing macro data...
2025-04-17 21:57:20,480 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:20,480 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:20,484 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:20,484 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:20,485 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:20,486 - INFO - Loading existing macro data...
2025-04-17 21:57:20,496 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:20,497 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:20,502 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:20,502 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:20,503 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:20,504 - INFO - Loading existing market data...
2025-04-17 21:57:20,509 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:20,510 - INFO - Loading existing market data...
2025-04-17 21:57:20,513 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:20,513 - INFO - Macro and market data loaded
2025-04-17 21:57:20,513 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:20,514 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:20,515 - INFO - Loading existing macro data...
2025-04-17 21:57:20,527 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:20,527 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:20,531 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:20,531 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:20,531 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:20,532 - INFO - Loading existing market data...
2025-04-17 21:57:20,535 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:20,550 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:20,551 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:20,551 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:20,551 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:20,552 - INFO - Loading existing macro data...
2025-04-17 21:57:20,566 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:20,566 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:20,570 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:20,570 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:20,570 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:20,572 - INFO - Loading existing market data...
2025-04-17 21:57:20,577 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:20,590 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:20,590 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:20,590 - INFO - Test data prepared
2025-04-17 21:57:20,591 - INFO - Storing data...
2025-04-17 21:57:20,591 - INFO - Aligning data indices...
2025-04-17 21:57:20,593 - INFO - Data indices aligned
2025-04-17 21:57:20,593 - INFO - Data preparation completed
2025-04-17 21:57:20,593 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:20,594 - INFO - Training models...
2025-04-17 21:57:20,594 - INFO - Starting model training...
2025-04-17 21:57:20,594 - INFO - Training regime classifier...
2025-04-17 21:57:20,594 - INFO - Training HMM model...
2025-04-17 21:57:20,845 - INFO - HMM model training completed
2025-04-17 21:57:21,057 - INFO - Model training completed
2025-04-17 21:57:21,059 - INFO - Model training completed
2025-04-17 21:57:21,060 - INFO - Initializing portfolio weights...
2025-04-17 21:57:21,060 - INFO - Portfolio weights initialized
2025-04-17 21:57:21,061 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:21,062 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:21,063 - ERROR - Error running hmm with mean_variance and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:21,065 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 5 regimes
2025-04-17 21:57:21,065 - INFO - Initializing strategy...
2025-04-17 21:57:21,065 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 21:57:21,065 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:21,066 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:57:21,066 - INFO - Running strategy...
2025-04-17 21:57:21,066 - INFO - Starting strategy execution...
2025-04-17 21:57:21,066 - INFO - Preparing training and testing data...
2025-04-17 21:57:21,066 - INFO - Starting data preparation...
2025-04-17 21:57:21,066 - INFO - Loading Fama-French factors...
2025-04-17 21:57:21,076 - INFO - Fama-French factors loaded
2025-04-17 21:57:21,077 - INFO - Processing factor data...
2025-04-17 21:57:21,079 - INFO - Factor data processed
2025-04-17 21:57:21,079 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:21,080 - INFO - 
Training Period:
2025-04-17 21:57:21,084 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:21,093 - INFO - 
Testing Period:
2025-04-17 21:57:21,097 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:21,104 - INFO - Loading macro and market data...
2025-04-17 21:57:21,106 - INFO - Loading existing macro data...
2025-04-17 21:57:21,116 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:21,117 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:21,120 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:21,121 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:21,121 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:21,122 - INFO - Loading existing macro data...
2025-04-17 21:57:21,133 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:21,133 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:21,136 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:21,136 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:21,137 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:21,138 - INFO - Loading existing market data...
2025-04-17 21:57:21,142 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:21,143 - INFO - Loading existing market data...
2025-04-17 21:57:21,146 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:21,146 - INFO - Macro and market data loaded
2025-04-17 21:57:21,146 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:21,147 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:21,148 - INFO - Loading existing macro data...
2025-04-17 21:57:21,158 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:21,158 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:21,161 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:21,162 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:21,162 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:21,163 - INFO - Loading existing market data...
2025-04-17 21:57:21,166 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:21,183 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:21,183 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:21,183 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:21,183 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:21,185 - INFO - Loading existing macro data...
2025-04-17 21:57:21,198 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:21,199 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:21,202 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:21,202 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:21,202 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:21,204 - INFO - Loading existing market data...
2025-04-17 21:57:21,208 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:21,223 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:21,223 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:21,224 - INFO - Test data prepared
2025-04-17 21:57:21,224 - INFO - Storing data...
2025-04-17 21:57:21,225 - INFO - Aligning data indices...
2025-04-17 21:57:21,226 - INFO - Data indices aligned
2025-04-17 21:57:21,227 - INFO - Data preparation completed
2025-04-17 21:57:21,227 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:21,228 - INFO - Training models...
2025-04-17 21:57:21,228 - INFO - Starting model training...
2025-04-17 21:57:21,229 - INFO - Training regime classifier...
2025-04-17 21:57:21,229 - INFO - Training HMM model...
2025-04-17 21:57:21,491 - INFO - HMM model training completed
2025-04-17 21:57:21,711 - INFO - Model training completed
2025-04-17 21:57:21,713 - INFO - Model training completed
2025-04-17 21:57:21,713 - INFO - Initializing portfolio weights...
2025-04-17 21:57:21,714 - INFO - Portfolio weights initialized
2025-04-17 21:57:21,714 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:21,716 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:21,716 - ERROR - Error running hmm with mean_variance and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:21,718 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 7 regimes
2025-04-17 21:57:21,718 - INFO - Initializing strategy...
2025-04-17 21:57:21,718 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 21:57:21,718 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:21,718 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:57:21,719 - INFO - Running strategy...
2025-04-17 21:57:21,719 - INFO - Starting strategy execution...
2025-04-17 21:57:21,719 - INFO - Preparing training and testing data...
2025-04-17 21:57:21,719 - INFO - Starting data preparation...
2025-04-17 21:57:21,719 - INFO - Loading Fama-French factors...
2025-04-17 21:57:21,728 - INFO - Fama-French factors loaded
2025-04-17 21:57:21,729 - INFO - Processing factor data...
2025-04-17 21:57:21,731 - INFO - Factor data processed
2025-04-17 21:57:21,732 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:21,732 - INFO - 
Training Period:
2025-04-17 21:57:21,736 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:21,744 - INFO - 
Testing Period:
2025-04-17 21:57:21,749 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:21,756 - INFO - Loading macro and market data...
2025-04-17 21:57:21,757 - INFO - Loading existing macro data...
2025-04-17 21:57:21,768 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:21,768 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:21,771 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:21,771 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:21,771 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:21,772 - INFO - Loading existing macro data...
2025-04-17 21:57:21,782 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:21,783 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:21,786 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:21,786 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:21,786 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:21,787 - INFO - Loading existing market data...
2025-04-17 21:57:21,791 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:21,792 - INFO - Loading existing market data...
2025-04-17 21:57:21,795 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:21,795 - INFO - Macro and market data loaded
2025-04-17 21:57:21,795 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:21,796 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:21,796 - INFO - Loading existing macro data...
2025-04-17 21:57:21,807 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:21,807 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:21,810 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:21,810 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:21,810 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:21,811 - INFO - Loading existing market data...
2025-04-17 21:57:21,814 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:21,829 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:21,829 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:21,830 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:21,830 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:21,831 - INFO - Loading existing macro data...
2025-04-17 21:57:21,844 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:21,844 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:21,849 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:21,849 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:21,849 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:21,851 - INFO - Loading existing market data...
2025-04-17 21:57:21,855 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:21,869 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:21,869 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:21,870 - INFO - Test data prepared
2025-04-17 21:57:21,870 - INFO - Storing data...
2025-04-17 21:57:21,870 - INFO - Aligning data indices...
2025-04-17 21:57:21,872 - INFO - Data indices aligned
2025-04-17 21:57:21,872 - INFO - Data preparation completed
2025-04-17 21:57:21,873 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:21,873 - INFO - Training models...
2025-04-17 21:57:21,873 - INFO - Starting model training...
2025-04-17 21:57:21,873 - INFO - Training regime classifier...
2025-04-17 21:57:21,874 - INFO - Training HMM model...
2025-04-17 21:57:22,128 - INFO - HMM model training completed
2025-04-17 21:57:22,345 - INFO - Model training completed
2025-04-17 21:57:22,347 - INFO - Model training completed
2025-04-17 21:57:22,347 - INFO - Initializing portfolio weights...
2025-04-17 21:57:22,348 - INFO - Portfolio weights initialized
2025-04-17 21:57:22,348 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:22,350 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:22,350 - ERROR - Error running hmm with mean_variance and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:22,352 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 3 regimes
2025-04-17 21:57:22,352 - INFO - Initializing strategy...
2025-04-17 21:57:22,352 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 21:57:22,352 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:22,352 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:57:22,353 - INFO - Running strategy...
2025-04-17 21:57:22,353 - INFO - Starting strategy execution...
2025-04-17 21:57:22,353 - INFO - Preparing training and testing data...
2025-04-17 21:57:22,353 - INFO - Starting data preparation...
2025-04-17 21:57:22,353 - INFO - Loading Fama-French factors...
2025-04-17 21:57:22,364 - INFO - Fama-French factors loaded
2025-04-17 21:57:22,364 - INFO - Processing factor data...
2025-04-17 21:57:22,366 - INFO - Factor data processed
2025-04-17 21:57:22,367 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:22,367 - INFO - 
Training Period:
2025-04-17 21:57:22,372 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:22,380 - INFO - 
Testing Period:
2025-04-17 21:57:22,385 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:22,393 - INFO - Loading macro and market data...
2025-04-17 21:57:22,394 - INFO - Loading existing macro data...
2025-04-17 21:57:22,405 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:22,405 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:22,409 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:22,410 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:22,410 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:22,412 - INFO - Loading existing macro data...
2025-04-17 21:57:22,424 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:22,424 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:22,427 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:22,428 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:22,428 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:22,429 - INFO - Loading existing market data...
2025-04-17 21:57:22,434 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:22,435 - INFO - Loading existing market data...
2025-04-17 21:57:22,437 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:22,438 - INFO - Macro and market data loaded
2025-04-17 21:57:22,438 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:22,438 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:22,439 - INFO - Loading existing macro data...
2025-04-17 21:57:22,449 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:22,449 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:22,452 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:22,452 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:22,453 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:22,454 - INFO - Loading existing market data...
2025-04-17 21:57:22,457 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:22,471 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:22,472 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:22,472 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:22,472 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:22,474 - INFO - Loading existing macro data...
2025-04-17 21:57:22,487 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:22,488 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:22,492 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:22,492 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:22,493 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:22,494 - INFO - Loading existing market data...
2025-04-17 21:57:22,499 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:22,511 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:22,512 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:22,512 - INFO - Test data prepared
2025-04-17 21:57:22,512 - INFO - Storing data...
2025-04-17 21:57:22,512 - INFO - Aligning data indices...
2025-04-17 21:57:22,514 - INFO - Data indices aligned
2025-04-17 21:57:22,514 - INFO - Data preparation completed
2025-04-17 21:57:22,514 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:22,514 - INFO - Training models...
2025-04-17 21:57:22,515 - INFO - Starting model training...
2025-04-17 21:57:22,515 - INFO - Training regime classifier...
2025-04-17 21:57:22,515 - INFO - Training HMM model...
2025-04-17 21:57:22,788 - INFO - HMM model training completed
2025-04-17 21:57:23,173 - INFO - Model training completed
2025-04-17 21:57:23,176 - INFO - Model training completed
2025-04-17 21:57:23,176 - INFO - Initializing portfolio weights...
2025-04-17 21:57:23,176 - INFO - Portfolio weights initialized
2025-04-17 21:57:23,177 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:23,179 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:23,179 - ERROR - Error running hmm with regime_aware and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:23,181 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 5 regimes
2025-04-17 21:57:23,181 - INFO - Initializing strategy...
2025-04-17 21:57:23,182 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 21:57:23,182 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:23,182 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:57:23,182 - INFO - Running strategy...
2025-04-17 21:57:23,182 - INFO - Starting strategy execution...
2025-04-17 21:57:23,182 - INFO - Preparing training and testing data...
2025-04-17 21:57:23,183 - INFO - Starting data preparation...
2025-04-17 21:57:23,183 - INFO - Loading Fama-French factors...
2025-04-17 21:57:23,196 - INFO - Fama-French factors loaded
2025-04-17 21:57:23,196 - INFO - Processing factor data...
2025-04-17 21:57:23,199 - INFO - Factor data processed
2025-04-17 21:57:23,199 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:23,199 - INFO - 
Training Period:
2025-04-17 21:57:23,204 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:23,214 - INFO - 
Testing Period:
2025-04-17 21:57:23,219 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:23,229 - INFO - Loading macro and market data...
2025-04-17 21:57:23,231 - INFO - Loading existing macro data...
2025-04-17 21:57:23,241 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:23,242 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:23,246 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:23,246 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:23,247 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:23,248 - INFO - Loading existing macro data...
2025-04-17 21:57:23,260 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:23,261 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:23,264 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:23,264 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:23,265 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:23,267 - INFO - Loading existing market data...
2025-04-17 21:57:23,272 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:23,273 - INFO - Loading existing market data...
2025-04-17 21:57:23,276 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:23,276 - INFO - Macro and market data loaded
2025-04-17 21:57:23,277 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:23,277 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:23,278 - INFO - Loading existing macro data...
2025-04-17 21:57:23,290 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:23,290 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:23,293 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:23,293 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:23,294 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:23,295 - INFO - Loading existing market data...
2025-04-17 21:57:23,299 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:23,317 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:23,317 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:23,318 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:23,318 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:23,319 - INFO - Loading existing macro data...
2025-04-17 21:57:23,333 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:23,333 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:23,337 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:23,337 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:23,337 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:23,339 - INFO - Loading existing market data...
2025-04-17 21:57:23,342 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:23,355 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:23,355 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:23,356 - INFO - Test data prepared
2025-04-17 21:57:23,356 - INFO - Storing data...
2025-04-17 21:57:23,356 - INFO - Aligning data indices...
2025-04-17 21:57:23,358 - INFO - Data indices aligned
2025-04-17 21:57:23,359 - INFO - Data preparation completed
2025-04-17 21:57:23,359 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:23,360 - INFO - Training models...
2025-04-17 21:57:23,360 - INFO - Starting model training...
2025-04-17 21:57:23,360 - INFO - Training regime classifier...
2025-04-17 21:57:23,361 - INFO - Training HMM model...
2025-04-17 21:57:23,625 - INFO - HMM model training completed
2025-04-17 21:57:23,841 - INFO - Model training completed
2025-04-17 21:57:23,842 - INFO - Model training completed
2025-04-17 21:57:23,843 - INFO - Initializing portfolio weights...
2025-04-17 21:57:23,843 - INFO - Portfolio weights initialized
2025-04-17 21:57:23,844 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:23,846 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:23,846 - ERROR - Error running hmm with regime_aware and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:23,848 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 7 regimes
2025-04-17 21:57:23,849 - INFO - Initializing strategy...
2025-04-17 21:57:23,849 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 21:57:23,849 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:23,849 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:57:23,849 - INFO - Running strategy...
2025-04-17 21:57:23,849 - INFO - Starting strategy execution...
2025-04-17 21:57:23,850 - INFO - Preparing training and testing data...
2025-04-17 21:57:23,850 - INFO - Starting data preparation...
2025-04-17 21:57:23,850 - INFO - Loading Fama-French factors...
2025-04-17 21:57:23,861 - INFO - Fama-French factors loaded
2025-04-17 21:57:23,861 - INFO - Processing factor data...
2025-04-17 21:57:23,865 - INFO - Factor data processed
2025-04-17 21:57:23,865 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:23,865 - INFO - 
Training Period:
2025-04-17 21:57:23,871 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:23,879 - INFO - 
Testing Period:
2025-04-17 21:57:23,884 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:23,892 - INFO - Loading macro and market data...
2025-04-17 21:57:23,894 - INFO - Loading existing macro data...
2025-04-17 21:57:23,904 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:23,905 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:23,908 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:23,908 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:23,909 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:23,909 - INFO - Loading existing macro data...
2025-04-17 21:57:23,920 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:23,920 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:23,923 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:23,923 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:23,923 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:23,925 - INFO - Loading existing market data...
2025-04-17 21:57:23,930 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:23,931 - INFO - Loading existing market data...
2025-04-17 21:57:23,934 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:23,935 - INFO - Macro and market data loaded
2025-04-17 21:57:23,935 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:23,935 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:23,936 - INFO - Loading existing macro data...
2025-04-17 21:57:23,947 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:23,948 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:23,951 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:23,951 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:23,951 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:23,952 - INFO - Loading existing market data...
2025-04-17 21:57:23,957 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:23,972 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:23,973 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:23,973 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:23,973 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:23,974 - INFO - Loading existing macro data...
2025-04-17 21:57:23,987 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:23,988 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:23,991 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:23,991 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:23,991 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:23,993 - INFO - Loading existing market data...
2025-04-17 21:57:23,997 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:24,010 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:24,011 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:24,011 - INFO - Test data prepared
2025-04-17 21:57:24,012 - INFO - Storing data...
2025-04-17 21:57:24,012 - INFO - Aligning data indices...
2025-04-17 21:57:24,013 - INFO - Data indices aligned
2025-04-17 21:57:24,013 - INFO - Data preparation completed
2025-04-17 21:57:24,014 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:24,014 - INFO - Training models...
2025-04-17 21:57:24,014 - INFO - Starting model training...
2025-04-17 21:57:24,014 - INFO - Training regime classifier...
2025-04-17 21:57:24,015 - INFO - Training HMM model...
2025-04-17 21:57:24,273 - INFO - HMM model training completed
2025-04-17 21:57:24,505 - INFO - Model training completed
2025-04-17 21:57:24,507 - INFO - Model training completed
2025-04-17 21:57:24,507 - INFO - Initializing portfolio weights...
2025-04-17 21:57:24,508 - INFO - Portfolio weights initialized
2025-04-17 21:57:24,508 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:24,510 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:24,510 - ERROR - Error running hmm with regime_aware and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:24,512 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 3 regimes
2025-04-17 21:57:24,512 - INFO - Initializing strategy...
2025-04-17 21:57:24,512 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 21:57:24,513 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:24,513 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:57:24,513 - INFO - Running strategy...
2025-04-17 21:57:24,514 - INFO - Starting strategy execution...
2025-04-17 21:57:24,514 - INFO - Preparing training and testing data...
2025-04-17 21:57:24,514 - INFO - Starting data preparation...
2025-04-17 21:57:24,514 - INFO - Loading Fama-French factors...
2025-04-17 21:57:24,526 - INFO - Fama-French factors loaded
2025-04-17 21:57:24,526 - INFO - Processing factor data...
2025-04-17 21:57:24,529 - INFO - Factor data processed
2025-04-17 21:57:24,529 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:24,529 - INFO - 
Training Period:
2025-04-17 21:57:24,535 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:24,544 - INFO - 
Testing Period:
2025-04-17 21:57:24,550 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:24,557 - INFO - Loading macro and market data...
2025-04-17 21:57:24,558 - INFO - Loading existing macro data...
2025-04-17 21:57:24,570 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:24,571 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:24,574 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:24,574 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:24,574 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:24,575 - INFO - Loading existing macro data...
2025-04-17 21:57:24,586 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:24,586 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:24,589 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:24,589 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:24,589 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:24,591 - INFO - Loading existing market data...
2025-04-17 21:57:24,595 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:24,596 - INFO - Loading existing market data...
2025-04-17 21:57:24,600 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:24,600 - INFO - Macro and market data loaded
2025-04-17 21:57:24,600 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:24,600 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:24,601 - INFO - Loading existing macro data...
2025-04-17 21:57:24,613 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:24,614 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:24,616 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:24,617 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:24,617 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:24,618 - INFO - Loading existing market data...
2025-04-17 21:57:24,621 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:24,637 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:24,637 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:24,637 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:24,638 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:24,639 - INFO - Loading existing macro data...
2025-04-17 21:57:24,653 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:24,653 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:24,657 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:24,657 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:24,657 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:24,659 - INFO - Loading existing market data...
2025-04-17 21:57:24,662 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:24,675 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:24,675 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:24,675 - INFO - Test data prepared
2025-04-17 21:57:24,676 - INFO - Storing data...
2025-04-17 21:57:24,676 - INFO - Aligning data indices...
2025-04-17 21:57:24,677 - INFO - Data indices aligned
2025-04-17 21:57:24,677 - INFO - Data preparation completed
2025-04-17 21:57:24,677 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:24,677 - INFO - Training models...
2025-04-17 21:57:24,678 - INFO - Starting model training...
2025-04-17 21:57:24,678 - INFO - Training regime classifier...
2025-04-17 21:57:24,678 - INFO - Training HMM model...
2025-04-17 21:57:24,897 - WARNING - Model is not converging.  Current: 6604.339029574297 is not greater than 21507.42426688071. Delta is -14903.085237306412
2025-04-17 21:57:24,897 - INFO - HMM model training completed
2025-04-17 21:57:25,102 - INFO - Model training completed
2025-04-17 21:57:25,104 - INFO - Model training completed
2025-04-17 21:57:25,104 - INFO - Initializing portfolio weights...
2025-04-17 21:57:25,105 - INFO - Portfolio weights initialized
2025-04-17 21:57:25,105 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:25,107 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:25,108 - ERROR - Error running hmm with neural_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:25,109 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 5 regimes
2025-04-17 21:57:25,110 - INFO - Initializing strategy...
2025-04-17 21:57:25,110 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 21:57:25,110 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:25,110 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:57:25,111 - INFO - Running strategy...
2025-04-17 21:57:25,111 - INFO - Starting strategy execution...
2025-04-17 21:57:25,111 - INFO - Preparing training and testing data...
2025-04-17 21:57:25,111 - INFO - Starting data preparation...
2025-04-17 21:57:25,112 - INFO - Loading Fama-French factors...
2025-04-17 21:57:25,122 - INFO - Fama-French factors loaded
2025-04-17 21:57:25,122 - INFO - Processing factor data...
2025-04-17 21:57:25,126 - INFO - Factor data processed
2025-04-17 21:57:25,126 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:25,126 - INFO - 
Training Period:
2025-04-17 21:57:25,131 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:25,138 - INFO - 
Testing Period:
2025-04-17 21:57:25,145 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:25,152 - INFO - Loading macro and market data...
2025-04-17 21:57:25,153 - INFO - Loading existing macro data...
2025-04-17 21:57:25,166 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:25,166 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:25,170 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:25,171 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:25,171 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:25,172 - INFO - Loading existing macro data...
2025-04-17 21:57:25,183 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:25,183 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:25,186 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:25,187 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:25,187 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:25,189 - INFO - Loading existing market data...
2025-04-17 21:57:25,192 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:25,193 - INFO - Loading existing market data...
2025-04-17 21:57:25,196 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:25,197 - INFO - Macro and market data loaded
2025-04-17 21:57:25,197 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:25,197 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:25,198 - INFO - Loading existing macro data...
2025-04-17 21:57:25,209 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:25,210 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:25,213 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:25,213 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:25,213 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:25,214 - INFO - Loading existing market data...
2025-04-17 21:57:25,219 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:25,235 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:25,235 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:25,235 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:25,235 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:25,237 - INFO - Loading existing macro data...
2025-04-17 21:57:25,250 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:25,250 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:25,254 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:25,254 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:25,254 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:25,256 - INFO - Loading existing market data...
2025-04-17 21:57:25,260 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:25,273 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:25,273 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:25,273 - INFO - Test data prepared
2025-04-17 21:57:25,274 - INFO - Storing data...
2025-04-17 21:57:25,274 - INFO - Aligning data indices...
2025-04-17 21:57:25,275 - INFO - Data indices aligned
2025-04-17 21:57:25,275 - INFO - Data preparation completed
2025-04-17 21:57:25,276 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:25,276 - INFO - Training models...
2025-04-17 21:57:25,276 - INFO - Starting model training...
2025-04-17 21:57:25,276 - INFO - Training regime classifier...
2025-04-17 21:57:25,276 - INFO - Training HMM model...
2025-04-17 21:57:25,530 - INFO - HMM model training completed
2025-04-17 21:57:25,740 - INFO - Model training completed
2025-04-17 21:57:25,742 - INFO - Model training completed
2025-04-17 21:57:25,743 - INFO - Initializing portfolio weights...
2025-04-17 21:57:25,744 - INFO - Portfolio weights initialized
2025-04-17 21:57:25,744 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:25,746 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:25,747 - ERROR - Error running hmm with neural_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:25,748 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 7 regimes
2025-04-17 21:57:25,748 - INFO - Initializing strategy...
2025-04-17 21:57:25,748 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 21:57:25,749 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:25,749 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:57:25,749 - INFO - Running strategy...
2025-04-17 21:57:25,749 - INFO - Starting strategy execution...
2025-04-17 21:57:25,749 - INFO - Preparing training and testing data...
2025-04-17 21:57:25,749 - INFO - Starting data preparation...
2025-04-17 21:57:25,750 - INFO - Loading Fama-French factors...
2025-04-17 21:57:25,759 - INFO - Fama-French factors loaded
2025-04-17 21:57:25,760 - INFO - Processing factor data...
2025-04-17 21:57:25,762 - INFO - Factor data processed
2025-04-17 21:57:25,762 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:25,762 - INFO - 
Training Period:
2025-04-17 21:57:25,767 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:25,776 - INFO - 
Testing Period:
2025-04-17 21:57:25,782 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:25,790 - INFO - Loading macro and market data...
2025-04-17 21:57:25,791 - INFO - Loading existing macro data...
2025-04-17 21:57:25,801 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:25,801 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:25,805 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:25,805 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:25,806 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:25,807 - INFO - Loading existing macro data...
2025-04-17 21:57:25,817 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:25,818 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:25,821 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:25,821 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:25,822 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:25,824 - INFO - Loading existing market data...
2025-04-17 21:57:25,828 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:25,829 - INFO - Loading existing market data...
2025-04-17 21:57:25,832 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:25,832 - INFO - Macro and market data loaded
2025-04-17 21:57:25,832 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:25,832 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:25,833 - INFO - Loading existing macro data...
2025-04-17 21:57:25,844 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:25,844 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:25,848 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:25,848 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:25,849 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:25,850 - INFO - Loading existing market data...
2025-04-17 21:57:25,853 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:25,868 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:25,868 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:25,869 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:25,869 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:25,870 - INFO - Loading existing macro data...
2025-04-17 21:57:25,883 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:25,884 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:25,888 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:25,888 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:25,888 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:25,890 - INFO - Loading existing market data...
2025-04-17 21:57:25,894 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:25,908 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:25,908 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:25,909 - INFO - Test data prepared
2025-04-17 21:57:25,909 - INFO - Storing data...
2025-04-17 21:57:25,909 - INFO - Aligning data indices...
2025-04-17 21:57:25,911 - INFO - Data indices aligned
2025-04-17 21:57:25,911 - INFO - Data preparation completed
2025-04-17 21:57:25,912 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:25,912 - INFO - Training models...
2025-04-17 21:57:25,912 - INFO - Starting model training...
2025-04-17 21:57:25,912 - INFO - Training regime classifier...
2025-04-17 21:57:25,913 - INFO - Training HMM model...
2025-04-17 21:57:26,174 - INFO - HMM model training completed
2025-04-17 21:57:26,390 - INFO - Model training completed
2025-04-17 21:57:26,391 - INFO - Model training completed
2025-04-17 21:57:26,392 - INFO - Initializing portfolio weights...
2025-04-17 21:57:26,392 - INFO - Portfolio weights initialized
2025-04-17 21:57:26,393 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:26,395 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:26,395 - ERROR - Error running hmm with neural_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:26,397 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 21:57:26,398 - INFO - Initializing strategy...
2025-04-17 21:57:26,398 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 21:57:26,398 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:26,399 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:57:26,399 - INFO - Running strategy...
2025-04-17 21:57:26,400 - INFO - Starting strategy execution...
2025-04-17 21:57:26,400 - INFO - Preparing training and testing data...
2025-04-17 21:57:26,400 - INFO - Starting data preparation...
2025-04-17 21:57:26,401 - INFO - Loading Fama-French factors...
2025-04-17 21:57:26,412 - INFO - Fama-French factors loaded
2025-04-17 21:57:26,413 - INFO - Processing factor data...
2025-04-17 21:57:26,416 - INFO - Factor data processed
2025-04-17 21:57:26,416 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:26,416 - INFO - 
Training Period:
2025-04-17 21:57:26,421 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:26,428 - INFO - 
Testing Period:
2025-04-17 21:57:26,434 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:26,443 - INFO - Loading macro and market data...
2025-04-17 21:57:26,445 - INFO - Loading existing macro data...
2025-04-17 21:57:26,456 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:26,457 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:26,460 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:26,460 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:26,461 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:26,462 - INFO - Loading existing macro data...
2025-04-17 21:57:26,474 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:26,474 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:26,478 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:26,478 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:26,478 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:26,480 - INFO - Loading existing market data...
2025-04-17 21:57:26,483 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:26,484 - INFO - Loading existing market data...
2025-04-17 21:57:26,487 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:26,487 - INFO - Macro and market data loaded
2025-04-17 21:57:26,488 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:26,488 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:26,489 - INFO - Loading existing macro data...
2025-04-17 21:57:26,499 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:26,499 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:26,503 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:26,503 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:26,503 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:26,504 - INFO - Loading existing market data...
2025-04-17 21:57:26,509 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:26,525 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:26,525 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:26,525 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:26,525 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:26,527 - INFO - Loading existing macro data...
2025-04-17 21:57:26,540 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:26,541 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:26,545 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:26,545 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:26,545 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:26,547 - INFO - Loading existing market data...
2025-04-17 21:57:26,551 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:26,566 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:26,566 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:26,567 - INFO - Test data prepared
2025-04-17 21:57:26,567 - INFO - Storing data...
2025-04-17 21:57:26,567 - INFO - Aligning data indices...
2025-04-17 21:57:26,568 - INFO - Data indices aligned
2025-04-17 21:57:26,569 - INFO - Data preparation completed
2025-04-17 21:57:26,570 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:26,570 - INFO - Training models...
2025-04-17 21:57:26,570 - INFO - Starting model training...
2025-04-17 21:57:26,570 - INFO - Training regime classifier...
2025-04-17 21:57:26,571 - INFO - Training HMM model...
2025-04-17 21:57:26,789 - WARNING - Model is not converging.  Current: 6604.3390295956715 is not greater than 21507.42426475046. Delta is -14903.085235154791
2025-04-17 21:57:26,789 - INFO - HMM model training completed
2025-04-17 21:57:26,995 - INFO - Model training completed
2025-04-17 21:57:26,998 - INFO - Model training completed
2025-04-17 21:57:26,998 - INFO - Initializing portfolio weights...
2025-04-17 21:57:26,999 - INFO - Portfolio weights initialized
2025-04-17 21:57:26,999 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:27,000 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:27,001 - ERROR - Error running hmm with autoencoder_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:27,003 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 21:57:27,003 - INFO - Initializing strategy...
2025-04-17 21:57:27,003 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 21:57:27,004 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:27,004 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:57:27,005 - INFO - Running strategy...
2025-04-17 21:57:27,005 - INFO - Starting strategy execution...
2025-04-17 21:57:27,005 - INFO - Preparing training and testing data...
2025-04-17 21:57:27,005 - INFO - Starting data preparation...
2025-04-17 21:57:27,005 - INFO - Loading Fama-French factors...
2025-04-17 21:57:27,016 - INFO - Fama-French factors loaded
2025-04-17 21:57:27,016 - INFO - Processing factor data...
2025-04-17 21:57:27,018 - INFO - Factor data processed
2025-04-17 21:57:27,019 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:27,019 - INFO - 
Training Period:
2025-04-17 21:57:27,024 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:27,032 - INFO - 
Testing Period:
2025-04-17 21:57:27,038 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:27,047 - INFO - Loading macro and market data...
2025-04-17 21:57:27,048 - INFO - Loading existing macro data...
2025-04-17 21:57:27,059 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:27,059 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:27,062 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:27,063 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:27,063 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:27,064 - INFO - Loading existing macro data...
2025-04-17 21:57:27,074 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:27,075 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:27,078 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:27,078 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:27,079 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:27,080 - INFO - Loading existing market data...
2025-04-17 21:57:27,084 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:27,085 - INFO - Loading existing market data...
2025-04-17 21:57:27,088 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:27,088 - INFO - Macro and market data loaded
2025-04-17 21:57:27,089 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:27,089 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:27,090 - INFO - Loading existing macro data...
2025-04-17 21:57:27,100 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:27,100 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:27,103 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:27,104 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:27,104 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:27,105 - INFO - Loading existing market data...
2025-04-17 21:57:27,109 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:27,123 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:27,124 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:27,124 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:27,124 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:27,126 - INFO - Loading existing macro data...
2025-04-17 21:57:27,140 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:27,140 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:27,144 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:27,145 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:27,145 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:27,147 - INFO - Loading existing market data...
2025-04-17 21:57:27,151 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:27,166 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:27,166 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:27,166 - INFO - Test data prepared
2025-04-17 21:57:27,166 - INFO - Storing data...
2025-04-17 21:57:27,166 - INFO - Aligning data indices...
2025-04-17 21:57:27,169 - INFO - Data indices aligned
2025-04-17 21:57:27,169 - INFO - Data preparation completed
2025-04-17 21:57:27,169 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:27,170 - INFO - Training models...
2025-04-17 21:57:27,170 - INFO - Starting model training...
2025-04-17 21:57:27,171 - INFO - Training regime classifier...
2025-04-17 21:57:27,171 - INFO - Training HMM model...
2025-04-17 21:57:27,426 - INFO - HMM model training completed
2025-04-17 21:57:27,645 - INFO - Model training completed
2025-04-17 21:57:27,647 - INFO - Model training completed
2025-04-17 21:57:27,647 - INFO - Initializing portfolio weights...
2025-04-17 21:57:27,648 - INFO - Portfolio weights initialized
2025-04-17 21:57:27,648 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:27,650 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:27,651 - ERROR - Error running hmm with autoencoder_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:27,652 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 21:57:27,652 - INFO - Initializing strategy...
2025-04-17 21:57:27,653 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 21:57:27,653 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:27,653 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:57:27,654 - INFO - Running strategy...
2025-04-17 21:57:27,654 - INFO - Starting strategy execution...
2025-04-17 21:57:27,654 - INFO - Preparing training and testing data...
2025-04-17 21:57:27,654 - INFO - Starting data preparation...
2025-04-17 21:57:27,655 - INFO - Loading Fama-French factors...
2025-04-17 21:57:27,667 - INFO - Fama-French factors loaded
2025-04-17 21:57:27,668 - INFO - Processing factor data...
2025-04-17 21:57:27,670 - INFO - Factor data processed
2025-04-17 21:57:27,670 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:27,671 - INFO - 
Training Period:
2025-04-17 21:57:27,676 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:27,685 - INFO - 
Testing Period:
2025-04-17 21:57:27,691 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:27,699 - INFO - Loading macro and market data...
2025-04-17 21:57:27,700 - INFO - Loading existing macro data...
2025-04-17 21:57:27,712 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:27,713 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:27,716 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:27,716 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:27,716 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:27,717 - INFO - Loading existing macro data...
2025-04-17 21:57:27,728 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:27,728 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:27,731 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:27,732 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:27,732 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:27,733 - INFO - Loading existing market data...
2025-04-17 21:57:27,738 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:27,739 - INFO - Loading existing market data...
2025-04-17 21:57:27,742 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:27,742 - INFO - Macro and market data loaded
2025-04-17 21:57:27,742 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:27,742 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:27,743 - INFO - Loading existing macro data...
2025-04-17 21:57:27,753 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:27,754 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:27,756 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:27,757 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:27,757 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:27,758 - INFO - Loading existing market data...
2025-04-17 21:57:27,762 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:27,779 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:27,780 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:27,780 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:27,780 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:27,782 - INFO - Loading existing macro data...
2025-04-17 21:57:27,796 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:27,796 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:27,802 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:27,802 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:27,803 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:27,804 - INFO - Loading existing market data...
2025-04-17 21:57:27,808 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:27,821 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:27,821 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:27,821 - INFO - Test data prepared
2025-04-17 21:57:27,822 - INFO - Storing data...
2025-04-17 21:57:27,822 - INFO - Aligning data indices...
2025-04-17 21:57:27,824 - INFO - Data indices aligned
2025-04-17 21:57:27,824 - INFO - Data preparation completed
2025-04-17 21:57:27,824 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:57:27,824 - INFO - Training models...
2025-04-17 21:57:27,824 - INFO - Starting model training...
2025-04-17 21:57:27,824 - INFO - Training regime classifier...
2025-04-17 21:57:27,825 - INFO - Training HMM model...
2025-04-17 21:57:28,078 - INFO - HMM model training completed
2025-04-17 21:57:28,296 - INFO - Model training completed
2025-04-17 21:57:28,298 - INFO - Model training completed
2025-04-17 21:57:28,298 - INFO - Initializing portfolio weights...
2025-04-17 21:57:28,299 - INFO - Portfolio weights initialized
2025-04-17 21:57:28,299 - INFO - Generating regime predictions for test period...
2025-04-17 21:57:28,300 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:57:28,301 - ERROR - Error running hmm with autoencoder_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:57:28,303 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 3 regimes
2025-04-17 21:57:28,303 - INFO - Initializing strategy...
2025-04-17 21:57:28,303 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 21:57:28,304 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:28,304 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:57:28,305 - INFO - Running strategy...
2025-04-17 21:57:28,305 - INFO - Starting strategy execution...
2025-04-17 21:57:28,305 - INFO - Preparing training and testing data...
2025-04-17 21:57:28,305 - INFO - Starting data preparation...
2025-04-17 21:57:28,305 - INFO - Loading Fama-French factors...
2025-04-17 21:57:28,315 - INFO - Fama-French factors loaded
2025-04-17 21:57:28,316 - INFO - Processing factor data...
2025-04-17 21:57:28,319 - INFO - Factor data processed
2025-04-17 21:57:28,319 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:28,319 - INFO - 
Training Period:
2025-04-17 21:57:28,323 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:28,331 - INFO - 
Testing Period:
2025-04-17 21:57:28,336 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:28,343 - INFO - Loading macro and market data...
2025-04-17 21:57:28,345 - INFO - Loading existing macro data...
2025-04-17 21:57:28,355 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:28,356 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:28,359 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:28,359 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:28,359 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:28,361 - INFO - Loading existing macro data...
2025-04-17 21:57:28,371 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:28,371 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:28,375 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:28,375 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:28,376 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:28,377 - INFO - Loading existing market data...
2025-04-17 21:57:28,382 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:28,383 - INFO - Loading existing market data...
2025-04-17 21:57:28,386 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:28,386 - INFO - Macro and market data loaded
2025-04-17 21:57:28,386 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:28,387 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:28,388 - INFO - Loading existing macro data...
2025-04-17 21:57:28,399 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:28,399 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:28,402 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:28,402 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:28,403 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:28,404 - INFO - Loading existing market data...
2025-04-17 21:57:28,407 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:28,423 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:28,423 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:28,424 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:28,424 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:28,426 - INFO - Loading existing macro data...
2025-04-17 21:57:28,440 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:28,440 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:28,444 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:28,445 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:28,445 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:28,446 - INFO - Loading existing market data...
2025-04-17 21:57:28,450 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:28,464 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:28,464 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:28,465 - INFO - Test data prepared
2025-04-17 21:57:28,465 - INFO - Storing data...
2025-04-17 21:57:28,465 - INFO - Aligning data indices...
2025-04-17 21:57:28,467 - INFO - Data indices aligned
2025-04-17 21:57:28,467 - ERROR - Error running hmm with neural and 3 regimes: 'NeuralPortfolioOptimizer' object has no attribute 'update_input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 180, in prepare_data
    self.portfolio_optimizer.update_input_size(input_size)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NeuralPortfolioOptimizer' object has no attribute 'update_input_size'
2025-04-17 21:57:28,468 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 5 regimes
2025-04-17 21:57:28,468 - INFO - Initializing strategy...
2025-04-17 21:57:28,468 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 21:57:28,469 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:28,469 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:57:28,470 - INFO - Running strategy...
2025-04-17 21:57:28,470 - INFO - Starting strategy execution...
2025-04-17 21:57:28,470 - INFO - Preparing training and testing data...
2025-04-17 21:57:28,470 - INFO - Starting data preparation...
2025-04-17 21:57:28,470 - INFO - Loading Fama-French factors...
2025-04-17 21:57:28,481 - INFO - Fama-French factors loaded
2025-04-17 21:57:28,481 - INFO - Processing factor data...
2025-04-17 21:57:28,484 - INFO - Factor data processed
2025-04-17 21:57:28,485 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:28,485 - INFO - 
Training Period:
2025-04-17 21:57:28,491 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:28,501 - INFO - 
Testing Period:
2025-04-17 21:57:28,505 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:28,514 - INFO - Loading macro and market data...
2025-04-17 21:57:28,515 - INFO - Loading existing macro data...
2025-04-17 21:57:28,527 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:28,528 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:28,531 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:28,532 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:28,532 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:28,534 - INFO - Loading existing macro data...
2025-04-17 21:57:28,546 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:28,547 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:28,550 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:28,550 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:28,551 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:28,552 - INFO - Loading existing market data...
2025-04-17 21:57:28,555 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:28,557 - INFO - Loading existing market data...
2025-04-17 21:57:28,560 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:28,560 - INFO - Macro and market data loaded
2025-04-17 21:57:28,560 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:28,561 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:28,562 - INFO - Loading existing macro data...
2025-04-17 21:57:28,571 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:28,572 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:28,574 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:28,575 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:28,575 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:28,576 - INFO - Loading existing market data...
2025-04-17 21:57:28,579 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:28,593 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:28,593 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:28,594 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:28,594 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:28,595 - INFO - Loading existing macro data...
2025-04-17 21:57:28,610 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:28,610 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:28,615 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:28,615 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:28,615 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:28,617 - INFO - Loading existing market data...
2025-04-17 21:57:28,621 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:28,634 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:28,634 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:28,634 - INFO - Test data prepared
2025-04-17 21:57:28,635 - INFO - Storing data...
2025-04-17 21:57:28,635 - INFO - Aligning data indices...
2025-04-17 21:57:28,636 - INFO - Data indices aligned
2025-04-17 21:57:28,637 - ERROR - Error running hmm with neural and 5 regimes: 'NeuralPortfolioOptimizer' object has no attribute 'update_input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 180, in prepare_data
    self.portfolio_optimizer.update_input_size(input_size)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NeuralPortfolioOptimizer' object has no attribute 'update_input_size'
2025-04-17 21:57:28,638 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 7 regimes
2025-04-17 21:57:28,638 - INFO - Initializing strategy...
2025-04-17 21:57:28,638 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 21:57:28,639 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:57:28,639 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:57:28,640 - INFO - Running strategy...
2025-04-17 21:57:28,640 - INFO - Starting strategy execution...
2025-04-17 21:57:28,640 - INFO - Preparing training and testing data...
2025-04-17 21:57:28,641 - INFO - Starting data preparation...
2025-04-17 21:57:28,641 - INFO - Loading Fama-French factors...
2025-04-17 21:57:28,654 - INFO - Fama-French factors loaded
2025-04-17 21:57:28,655 - INFO - Processing factor data...
2025-04-17 21:57:28,657 - INFO - Factor data processed
2025-04-17 21:57:28,658 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:57:28,658 - INFO - 
Training Period:
2025-04-17 21:57:28,662 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:57:28,671 - INFO - 
Testing Period:
2025-04-17 21:57:28,677 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:57:28,685 - INFO - Loading macro and market data...
2025-04-17 21:57:28,686 - INFO - Loading existing macro data...
2025-04-17 21:57:28,698 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:28,698 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:28,701 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:28,701 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:28,702 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:28,703 - INFO - Loading existing macro data...
2025-04-17 21:57:28,714 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:28,714 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:28,717 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:28,718 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:28,718 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:28,719 - INFO - Loading existing market data...
2025-04-17 21:57:28,723 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:28,724 - INFO - Loading existing market data...
2025-04-17 21:57:28,727 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:28,728 - INFO - Macro and market data loaded
2025-04-17 21:57:28,728 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:28,728 - INFO - Preparing training data for regime classification...
2025-04-17 21:57:28,729 - INFO - Loading existing macro data...
2025-04-17 21:57:28,740 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:28,740 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:28,743 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:28,743 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:57:28,743 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:57:28,744 - INFO - Loading existing market data...
2025-04-17 21:57:28,748 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:57:28,762 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:57:28,762 - INFO - Prepared training data with 1536 samples
2025-04-17 21:57:28,762 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:28,762 - INFO - Preparing test data for regime classification...
2025-04-17 21:57:28,764 - INFO - Loading existing macro data...
2025-04-17 21:57:28,779 - WARNING - US corporate credit spread file not found
2025-04-17 21:57:28,779 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:57:28,783 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:57:28,783 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:57:28,784 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:57:28,785 - INFO - Loading existing market data...
2025-04-17 21:57:28,790 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:57:28,803 - INFO - Test class distribution: {0: np.int64(618), 4: np.int64(286), 2: np.int64(154), 3: np.int64(137), 1: np.int64(81)}
2025-04-17 21:57:28,803 - INFO - Prepared test data with 1276 samples
2025-04-17 21:57:28,803 - INFO - Test data prepared
2025-04-17 21:57:28,804 - INFO - Storing data...
2025-04-17 21:57:28,804 - INFO - Aligning data indices...
2025-04-17 21:57:28,805 - INFO - Data indices aligned
2025-04-17 21:57:28,805 - ERROR - Error running hmm with neural and 7 regimes: 'NeuralPortfolioOptimizer' object has no attribute 'update_input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 249, in run_strategy
    train_factors, test_factors = self.prepare_data()
                                  ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 180, in prepare_data
    self.portfolio_optimizer.update_input_size(input_size)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NeuralPortfolioOptimizer' object has no attribute 'update_input_size'
2025-04-17 21:57:28,807 - ERROR - No valid results obtained from parameter grid search
2025-04-17 21:57:28,807 - ERROR - No valid results obtained from parameter grid search
2025-04-17 21:57:28,807 - INFO - Factor timing strategy optimization completed
2025-04-17 21:59:07,150 - INFO - Starting factor timing strategy optimization...
2025-04-17 21:59:07,150 - INFO - Running parameter grid search...
2025-04-17 21:59:07,151 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 3 regimes
2025-04-17 21:59:07,151 - INFO - Initializing strategy...
2025-04-17 21:59:07,151 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 21:59:07,151 - ERROR - Error running lstm with mean_variance and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:59:07,152 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 5 regimes
2025-04-17 21:59:07,152 - INFO - Initializing strategy...
2025-04-17 21:59:07,153 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 21:59:07,153 - ERROR - Error running lstm with mean_variance and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:59:07,154 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 7 regimes
2025-04-17 21:59:07,154 - INFO - Initializing strategy...
2025-04-17 21:59:07,154 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 21:59:07,154 - ERROR - Error running lstm with mean_variance and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:59:07,155 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 3 regimes
2025-04-17 21:59:07,155 - INFO - Initializing strategy...
2025-04-17 21:59:07,155 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 21:59:07,156 - ERROR - Error running lstm with regime_aware and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:59:07,156 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 5 regimes
2025-04-17 21:59:07,156 - INFO - Initializing strategy...
2025-04-17 21:59:07,157 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 21:59:07,157 - ERROR - Error running lstm with regime_aware and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:59:07,157 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 7 regimes
2025-04-17 21:59:07,158 - INFO - Initializing strategy...
2025-04-17 21:59:07,158 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 21:59:07,158 - ERROR - Error running lstm with regime_aware and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:59:07,159 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 3 regimes
2025-04-17 21:59:07,159 - INFO - Initializing strategy...
2025-04-17 21:59:07,159 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 21:59:07,159 - ERROR - Error running lstm with neural_regime and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:59:07,160 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 5 regimes
2025-04-17 21:59:07,160 - INFO - Initializing strategy...
2025-04-17 21:59:07,160 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 21:59:07,160 - ERROR - Error running lstm with neural_regime and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:59:07,161 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 7 regimes
2025-04-17 21:59:07,161 - INFO - Initializing strategy...
2025-04-17 21:59:07,161 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 21:59:07,161 - ERROR - Error running lstm with neural_regime and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:59:07,162 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 21:59:07,162 - INFO - Initializing strategy...
2025-04-17 21:59:07,162 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 21:59:07,163 - ERROR - Error running lstm with autoencoder_regime and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:59:07,164 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 21:59:07,164 - INFO - Initializing strategy...
2025-04-17 21:59:07,164 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 21:59:07,164 - ERROR - Error running lstm with autoencoder_regime and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:59:07,165 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 21:59:07,165 - INFO - Initializing strategy...
2025-04-17 21:59:07,165 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 21:59:07,165 - ERROR - Error running lstm with autoencoder_regime and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:59:07,166 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 3 regimes
2025-04-17 21:59:07,166 - INFO - Initializing strategy...
2025-04-17 21:59:07,167 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 21:59:07,167 - ERROR - Error running lstm with neural and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:59:07,168 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 5 regimes
2025-04-17 21:59:07,168 - INFO - Initializing strategy...
2025-04-17 21:59:07,168 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 21:59:07,168 - ERROR - Error running lstm with neural and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:59:07,169 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 7 regimes
2025-04-17 21:59:07,170 - INFO - Initializing strategy...
2025-04-17 21:59:07,170 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 21:59:07,170 - ERROR - Error running lstm with neural and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 21:59:07,171 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 3 regimes
2025-04-17 21:59:07,171 - INFO - Initializing strategy...
2025-04-17 21:59:07,172 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 21:59:07,172 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:07,193 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:59:07,193 - INFO - Running strategy...
2025-04-17 21:59:07,194 - INFO - Starting strategy execution...
2025-04-17 21:59:07,194 - INFO - Preparing training and testing data...
2025-04-17 21:59:07,195 - INFO - Starting data preparation...
2025-04-17 21:59:07,195 - INFO - Loading Fama-French factors...
2025-04-17 21:59:07,218 - INFO - Fama-French factors loaded
2025-04-17 21:59:07,219 - INFO - Processing factor data...
2025-04-17 21:59:07,224 - INFO - Factor data processed
2025-04-17 21:59:07,224 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:07,224 - INFO - 
Training Period:
2025-04-17 21:59:07,231 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:07,243 - INFO - 
Testing Period:
2025-04-17 21:59:07,250 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:07,258 - INFO - Loading macro and market data...
2025-04-17 21:59:07,260 - INFO - Loading existing macro data...
2025-04-17 21:59:07,273 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:07,274 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:07,279 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:07,279 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:07,280 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:07,281 - INFO - Loading existing macro data...
2025-04-17 21:59:07,292 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:07,292 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:07,295 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:07,295 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:07,296 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:07,297 - INFO - Loading existing market data...
2025-04-17 21:59:07,301 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:07,302 - INFO - Loading existing market data...
2025-04-17 21:59:07,305 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:07,305 - INFO - Macro and market data loaded
2025-04-17 21:59:07,305 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:07,305 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:07,307 - INFO - Loading existing macro data...
2025-04-17 21:59:07,317 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:07,318 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:07,320 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:07,321 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:07,321 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:07,322 - INFO - Loading existing market data...
2025-04-17 21:59:07,327 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:07,484 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:07,485 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:07,485 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:07,486 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:07,487 - INFO - Loading existing macro data...
2025-04-17 21:59:07,504 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:07,504 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:07,508 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:07,508 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:07,509 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:07,510 - INFO - Loading existing market data...
2025-04-17 21:59:07,515 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:07,533 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:07,533 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:07,533 - INFO - Test data prepared
2025-04-17 21:59:07,534 - INFO - Storing data...
2025-04-17 21:59:07,534 - INFO - Aligning data indices...
2025-04-17 21:59:07,536 - INFO - Data indices aligned
2025-04-17 21:59:07,536 - INFO - Data preparation completed
2025-04-17 21:59:07,537 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:07,537 - INFO - Training models...
2025-04-17 21:59:07,538 - INFO - Starting model training...
2025-04-17 21:59:07,538 - INFO - Training regime classifier...
2025-04-17 21:59:07,538 - INFO - Training XGBoost model...
2025-04-17 21:59:07,539 - INFO - Preparing features...
2025-04-17 21:59:07,539 - INFO - Input shape: (1536, 8)
2025-04-17 21:59:07,540 - INFO - Handling missing values...
2025-04-17 21:59:07,541 - INFO - Missing values: 0 -> 0
2025-04-17 21:59:07,542 - INFO - Scaling features...
2025-04-17 21:59:07,543 - INFO - Fitted new scaler
2025-04-17 21:59:07,545 - INFO - Output shape: (1536, 8)
2025-04-17 21:59:08,957 - INFO - XGBoost model training completed
2025-04-17 21:59:09,323 - INFO - Model training completed
2025-04-17 21:59:09,325 - INFO - Model training completed
2025-04-17 21:59:09,326 - INFO - Initializing portfolio weights...
2025-04-17 21:59:09,326 - INFO - Portfolio weights initialized
2025-04-17 21:59:09,327 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:09,329 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:09,330 - ERROR - Error running xgboost with mean_variance and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:09,335 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 5 regimes
2025-04-17 21:59:09,335 - INFO - Initializing strategy...
2025-04-17 21:59:09,335 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 21:59:09,335 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:09,336 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:59:09,337 - INFO - Running strategy...
2025-04-17 21:59:09,337 - INFO - Starting strategy execution...
2025-04-17 21:59:09,338 - INFO - Preparing training and testing data...
2025-04-17 21:59:09,338 - INFO - Starting data preparation...
2025-04-17 21:59:09,338 - INFO - Loading Fama-French factors...
2025-04-17 21:59:09,350 - INFO - Fama-French factors loaded
2025-04-17 21:59:09,350 - INFO - Processing factor data...
2025-04-17 21:59:09,352 - INFO - Factor data processed
2025-04-17 21:59:09,353 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:09,353 - INFO - 
Training Period:
2025-04-17 21:59:09,358 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:09,366 - INFO - 
Testing Period:
2025-04-17 21:59:09,370 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:09,379 - INFO - Loading macro and market data...
2025-04-17 21:59:09,381 - INFO - Loading existing macro data...
2025-04-17 21:59:09,392 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:09,392 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:09,396 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:09,396 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:09,397 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:09,398 - INFO - Loading existing macro data...
2025-04-17 21:59:09,407 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:09,408 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:09,410 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:09,411 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:09,411 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:09,412 - INFO - Loading existing market data...
2025-04-17 21:59:09,417 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:09,418 - INFO - Loading existing market data...
2025-04-17 21:59:09,421 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:09,421 - INFO - Macro and market data loaded
2025-04-17 21:59:09,421 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:09,422 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:09,423 - INFO - Loading existing macro data...
2025-04-17 21:59:09,433 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:09,433 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:09,436 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:09,437 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:09,437 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:09,438 - INFO - Loading existing market data...
2025-04-17 21:59:09,441 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:09,459 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:09,460 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:09,460 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:09,460 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:09,461 - INFO - Loading existing macro data...
2025-04-17 21:59:09,480 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:09,480 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:09,484 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:09,484 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:09,484 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:09,486 - INFO - Loading existing market data...
2025-04-17 21:59:09,490 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:09,506 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:09,506 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:09,506 - INFO - Test data prepared
2025-04-17 21:59:09,507 - INFO - Storing data...
2025-04-17 21:59:09,507 - INFO - Aligning data indices...
2025-04-17 21:59:09,508 - INFO - Data indices aligned
2025-04-17 21:59:09,509 - INFO - Data preparation completed
2025-04-17 21:59:09,509 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:09,509 - INFO - Training models...
2025-04-17 21:59:09,509 - INFO - Starting model training...
2025-04-17 21:59:09,510 - INFO - Training regime classifier...
2025-04-17 21:59:09,510 - INFO - Training XGBoost model...
2025-04-17 21:59:09,510 - INFO - Preparing features...
2025-04-17 21:59:09,510 - INFO - Input shape: (1536, 8)
2025-04-17 21:59:09,511 - INFO - Handling missing values...
2025-04-17 21:59:09,512 - INFO - Missing values: 0 -> 0
2025-04-17 21:59:09,512 - INFO - Scaling features...
2025-04-17 21:59:09,514 - INFO - Fitted new scaler
2025-04-17 21:59:09,515 - INFO - Output shape: (1536, 8)
2025-04-17 21:59:09,730 - INFO - XGBoost model training completed
2025-04-17 21:59:10,136 - INFO - Model training completed
2025-04-17 21:59:10,138 - INFO - Model training completed
2025-04-17 21:59:10,138 - INFO - Initializing portfolio weights...
2025-04-17 21:59:10,139 - INFO - Portfolio weights initialized
2025-04-17 21:59:10,139 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:10,141 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:10,141 - ERROR - Error running xgboost with mean_variance and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:10,142 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 7 regimes
2025-04-17 21:59:10,143 - INFO - Initializing strategy...
2025-04-17 21:59:10,143 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 21:59:10,143 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:10,143 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:59:10,144 - INFO - Running strategy...
2025-04-17 21:59:10,144 - INFO - Starting strategy execution...
2025-04-17 21:59:10,144 - INFO - Preparing training and testing data...
2025-04-17 21:59:10,144 - INFO - Starting data preparation...
2025-04-17 21:59:10,145 - INFO - Loading Fama-French factors...
2025-04-17 21:59:10,154 - INFO - Fama-French factors loaded
2025-04-17 21:59:10,154 - INFO - Processing factor data...
2025-04-17 21:59:10,157 - INFO - Factor data processed
2025-04-17 21:59:10,157 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:10,158 - INFO - 
Training Period:
2025-04-17 21:59:10,162 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:10,170 - INFO - 
Testing Period:
2025-04-17 21:59:10,175 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:10,183 - INFO - Loading macro and market data...
2025-04-17 21:59:10,184 - INFO - Loading existing macro data...
2025-04-17 21:59:10,195 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:10,196 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:10,199 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:10,199 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:10,199 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:10,201 - INFO - Loading existing macro data...
2025-04-17 21:59:10,234 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:10,235 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:10,240 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:10,241 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:10,241 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:10,243 - INFO - Loading existing market data...
2025-04-17 21:59:10,251 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:10,260 - INFO - Loading existing market data...
2025-04-17 21:59:10,266 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:10,267 - INFO - Macro and market data loaded
2025-04-17 21:59:10,267 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:10,268 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:10,270 - INFO - Loading existing macro data...
2025-04-17 21:59:10,286 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:10,287 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:10,292 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:10,292 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:10,292 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:10,294 - INFO - Loading existing market data...
2025-04-17 21:59:10,301 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:10,323 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:10,324 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:10,324 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:10,325 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:10,326 - INFO - Loading existing macro data...
2025-04-17 21:59:10,345 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:10,346 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:10,352 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:10,352 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:10,353 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:10,355 - INFO - Loading existing market data...
2025-04-17 21:59:10,359 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:10,369 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:10,370 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:10,370 - INFO - Test data prepared
2025-04-17 21:59:10,370 - INFO - Storing data...
2025-04-17 21:59:10,370 - INFO - Aligning data indices...
2025-04-17 21:59:10,372 - INFO - Data indices aligned
2025-04-17 21:59:10,372 - INFO - Data preparation completed
2025-04-17 21:59:10,372 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:10,373 - INFO - Training models...
2025-04-17 21:59:10,373 - INFO - Starting model training...
2025-04-17 21:59:10,373 - INFO - Training regime classifier...
2025-04-17 21:59:10,373 - INFO - Training XGBoost model...
2025-04-17 21:59:10,373 - INFO - Preparing features...
2025-04-17 21:59:10,373 - INFO - Input shape: (1536, 8)
2025-04-17 21:59:10,374 - INFO - Handling missing values...
2025-04-17 21:59:10,375 - INFO - Missing values: 0 -> 0
2025-04-17 21:59:10,375 - INFO - Scaling features...
2025-04-17 21:59:10,376 - INFO - Fitted new scaler
2025-04-17 21:59:10,377 - INFO - Output shape: (1536, 8)
2025-04-17 21:59:10,574 - INFO - XGBoost model training completed
2025-04-17 21:59:10,879 - INFO - Model training completed
2025-04-17 21:59:10,881 - INFO - Model training completed
2025-04-17 21:59:10,881 - INFO - Initializing portfolio weights...
2025-04-17 21:59:10,882 - INFO - Portfolio weights initialized
2025-04-17 21:59:10,882 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:10,885 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:10,885 - ERROR - Error running xgboost with mean_variance and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:10,887 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 3 regimes
2025-04-17 21:59:10,887 - INFO - Initializing strategy...
2025-04-17 21:59:10,888 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 21:59:10,888 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:10,888 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:59:10,889 - INFO - Running strategy...
2025-04-17 21:59:10,889 - INFO - Starting strategy execution...
2025-04-17 21:59:10,889 - INFO - Preparing training and testing data...
2025-04-17 21:59:10,889 - INFO - Starting data preparation...
2025-04-17 21:59:10,890 - INFO - Loading Fama-French factors...
2025-04-17 21:59:10,899 - INFO - Fama-French factors loaded
2025-04-17 21:59:10,899 - INFO - Processing factor data...
2025-04-17 21:59:10,902 - INFO - Factor data processed
2025-04-17 21:59:10,902 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:10,903 - INFO - 
Training Period:
2025-04-17 21:59:10,907 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:10,914 - INFO - 
Testing Period:
2025-04-17 21:59:10,920 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:10,928 - INFO - Loading macro and market data...
2025-04-17 21:59:10,929 - INFO - Loading existing macro data...
2025-04-17 21:59:10,941 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:10,941 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:10,945 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:10,945 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:10,945 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:10,946 - INFO - Loading existing macro data...
2025-04-17 21:59:10,957 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:10,957 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:10,960 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:10,961 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:10,961 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:10,962 - INFO - Loading existing market data...
2025-04-17 21:59:10,966 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:10,967 - INFO - Loading existing market data...
2025-04-17 21:59:10,971 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:10,972 - INFO - Macro and market data loaded
2025-04-17 21:59:10,972 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:10,972 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:10,973 - INFO - Loading existing macro data...
2025-04-17 21:59:10,984 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:10,984 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:10,988 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:10,989 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:10,989 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:10,990 - INFO - Loading existing market data...
2025-04-17 21:59:10,994 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:11,013 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:11,014 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:11,014 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:11,015 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:11,016 - INFO - Loading existing macro data...
2025-04-17 21:59:11,031 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:11,032 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:11,036 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:11,036 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:11,036 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:11,038 - INFO - Loading existing market data...
2025-04-17 21:59:11,043 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:11,057 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:11,058 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:11,058 - INFO - Test data prepared
2025-04-17 21:59:11,058 - INFO - Storing data...
2025-04-17 21:59:11,058 - INFO - Aligning data indices...
2025-04-17 21:59:11,060 - INFO - Data indices aligned
2025-04-17 21:59:11,060 - INFO - Data preparation completed
2025-04-17 21:59:11,060 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:11,061 - INFO - Training models...
2025-04-17 21:59:11,061 - INFO - Starting model training...
2025-04-17 21:59:11,061 - INFO - Training regime classifier...
2025-04-17 21:59:11,061 - INFO - Training XGBoost model...
2025-04-17 21:59:11,061 - INFO - Preparing features...
2025-04-17 21:59:11,062 - INFO - Input shape: (1536, 8)
2025-04-17 21:59:11,062 - INFO - Handling missing values...
2025-04-17 21:59:11,064 - INFO - Missing values: 0 -> 0
2025-04-17 21:59:11,064 - INFO - Scaling features...
2025-04-17 21:59:11,065 - INFO - Fitted new scaler
2025-04-17 21:59:11,066 - INFO - Output shape: (1536, 8)
2025-04-17 21:59:11,272 - INFO - XGBoost model training completed
2025-04-17 21:59:11,549 - INFO - Model training completed
2025-04-17 21:59:11,551 - INFO - Model training completed
2025-04-17 21:59:11,551 - INFO - Initializing portfolio weights...
2025-04-17 21:59:11,552 - INFO - Portfolio weights initialized
2025-04-17 21:59:11,552 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:11,553 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:11,553 - ERROR - Error running xgboost with regime_aware and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:11,555 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 5 regimes
2025-04-17 21:59:11,555 - INFO - Initializing strategy...
2025-04-17 21:59:11,555 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 21:59:11,555 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:11,556 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:59:11,556 - INFO - Running strategy...
2025-04-17 21:59:11,556 - INFO - Starting strategy execution...
2025-04-17 21:59:11,556 - INFO - Preparing training and testing data...
2025-04-17 21:59:11,557 - INFO - Starting data preparation...
2025-04-17 21:59:11,557 - INFO - Loading Fama-French factors...
2025-04-17 21:59:11,567 - INFO - Fama-French factors loaded
2025-04-17 21:59:11,567 - INFO - Processing factor data...
2025-04-17 21:59:11,570 - INFO - Factor data processed
2025-04-17 21:59:11,570 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:11,570 - INFO - 
Training Period:
2025-04-17 21:59:11,575 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:11,583 - INFO - 
Testing Period:
2025-04-17 21:59:11,588 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:11,596 - INFO - Loading macro and market data...
2025-04-17 21:59:11,598 - INFO - Loading existing macro data...
2025-04-17 21:59:11,611 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:11,614 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:11,617 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:11,617 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:11,617 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:11,618 - INFO - Loading existing macro data...
2025-04-17 21:59:11,629 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:11,629 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:11,632 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:11,632 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:11,632 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:11,634 - INFO - Loading existing market data...
2025-04-17 21:59:11,638 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:11,639 - INFO - Loading existing market data...
2025-04-17 21:59:11,642 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:11,643 - INFO - Macro and market data loaded
2025-04-17 21:59:11,643 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:11,643 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:11,644 - INFO - Loading existing macro data...
2025-04-17 21:59:11,654 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:11,655 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:11,658 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:11,658 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:11,658 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:11,659 - INFO - Loading existing market data...
2025-04-17 21:59:11,664 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:11,684 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:11,685 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:11,685 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:11,685 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:11,687 - INFO - Loading existing macro data...
2025-04-17 21:59:11,705 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:11,706 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:11,710 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:11,710 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:11,711 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:11,713 - INFO - Loading existing market data...
2025-04-17 21:59:11,718 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:11,733 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:11,734 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:11,734 - INFO - Test data prepared
2025-04-17 21:59:11,735 - INFO - Storing data...
2025-04-17 21:59:11,735 - INFO - Aligning data indices...
2025-04-17 21:59:11,737 - INFO - Data indices aligned
2025-04-17 21:59:11,737 - INFO - Data preparation completed
2025-04-17 21:59:11,738 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:11,738 - INFO - Training models...
2025-04-17 21:59:11,739 - INFO - Starting model training...
2025-04-17 21:59:11,739 - INFO - Training regime classifier...
2025-04-17 21:59:11,739 - INFO - Training XGBoost model...
2025-04-17 21:59:11,740 - INFO - Preparing features...
2025-04-17 21:59:11,740 - INFO - Input shape: (1536, 8)
2025-04-17 21:59:11,741 - INFO - Handling missing values...
2025-04-17 21:59:11,742 - INFO - Missing values: 0 -> 0
2025-04-17 21:59:11,742 - INFO - Scaling features...
2025-04-17 21:59:11,744 - INFO - Fitted new scaler
2025-04-17 21:59:11,745 - INFO - Output shape: (1536, 8)
2025-04-17 21:59:11,944 - INFO - XGBoost model training completed
2025-04-17 21:59:12,217 - INFO - Model training completed
2025-04-17 21:59:12,219 - INFO - Model training completed
2025-04-17 21:59:12,220 - INFO - Initializing portfolio weights...
2025-04-17 21:59:12,220 - INFO - Portfolio weights initialized
2025-04-17 21:59:12,220 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:12,222 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:12,222 - ERROR - Error running xgboost with regime_aware and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:12,223 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 7 regimes
2025-04-17 21:59:12,223 - INFO - Initializing strategy...
2025-04-17 21:59:12,224 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 21:59:12,224 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:12,224 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:59:12,225 - INFO - Running strategy...
2025-04-17 21:59:12,225 - INFO - Starting strategy execution...
2025-04-17 21:59:12,225 - INFO - Preparing training and testing data...
2025-04-17 21:59:12,225 - INFO - Starting data preparation...
2025-04-17 21:59:12,225 - INFO - Loading Fama-French factors...
2025-04-17 21:59:12,236 - INFO - Fama-French factors loaded
2025-04-17 21:59:12,237 - INFO - Processing factor data...
2025-04-17 21:59:12,240 - INFO - Factor data processed
2025-04-17 21:59:12,240 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:12,240 - INFO - 
Training Period:
2025-04-17 21:59:12,246 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:12,255 - INFO - 
Testing Period:
2025-04-17 21:59:12,260 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:12,271 - INFO - Loading macro and market data...
2025-04-17 21:59:12,273 - INFO - Loading existing macro data...
2025-04-17 21:59:12,289 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:12,290 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:12,295 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:12,296 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:12,297 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:12,299 - INFO - Loading existing macro data...
2025-04-17 21:59:12,311 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:12,312 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:12,315 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:12,316 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:12,316 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:12,318 - INFO - Loading existing market data...
2025-04-17 21:59:12,323 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:12,324 - INFO - Loading existing market data...
2025-04-17 21:59:12,328 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:12,328 - INFO - Macro and market data loaded
2025-04-17 21:59:12,329 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:12,329 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:12,331 - INFO - Loading existing macro data...
2025-04-17 21:59:12,342 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:12,343 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:12,346 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:12,346 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:12,347 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:12,348 - INFO - Loading existing market data...
2025-04-17 21:59:12,352 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:12,373 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:12,374 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:12,374 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:12,375 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:12,377 - INFO - Loading existing macro data...
2025-04-17 21:59:12,392 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:12,392 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:12,397 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:12,397 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:12,398 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:12,399 - INFO - Loading existing market data...
2025-04-17 21:59:12,404 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:12,417 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:12,417 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:12,418 - INFO - Test data prepared
2025-04-17 21:59:12,418 - INFO - Storing data...
2025-04-17 21:59:12,418 - INFO - Aligning data indices...
2025-04-17 21:59:12,420 - INFO - Data indices aligned
2025-04-17 21:59:12,420 - INFO - Data preparation completed
2025-04-17 21:59:12,420 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:12,421 - INFO - Training models...
2025-04-17 21:59:12,421 - INFO - Starting model training...
2025-04-17 21:59:12,421 - INFO - Training regime classifier...
2025-04-17 21:59:12,421 - INFO - Training XGBoost model...
2025-04-17 21:59:12,421 - INFO - Preparing features...
2025-04-17 21:59:12,421 - INFO - Input shape: (1536, 8)
2025-04-17 21:59:12,422 - INFO - Handling missing values...
2025-04-17 21:59:12,423 - INFO - Missing values: 0 -> 0
2025-04-17 21:59:12,423 - INFO - Scaling features...
2025-04-17 21:59:12,425 - INFO - Fitted new scaler
2025-04-17 21:59:12,426 - INFO - Output shape: (1536, 8)
2025-04-17 21:59:12,634 - INFO - XGBoost model training completed
2025-04-17 21:59:12,924 - INFO - Model training completed
2025-04-17 21:59:12,926 - INFO - Model training completed
2025-04-17 21:59:12,926 - INFO - Initializing portfolio weights...
2025-04-17 21:59:12,927 - INFO - Portfolio weights initialized
2025-04-17 21:59:12,927 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:12,929 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:12,929 - ERROR - Error running xgboost with regime_aware and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:12,931 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 3 regimes
2025-04-17 21:59:12,931 - INFO - Initializing strategy...
2025-04-17 21:59:12,931 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 21:59:12,931 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:12,931 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:59:12,932 - INFO - Running strategy...
2025-04-17 21:59:12,932 - INFO - Starting strategy execution...
2025-04-17 21:59:12,932 - INFO - Preparing training and testing data...
2025-04-17 21:59:12,932 - INFO - Starting data preparation...
2025-04-17 21:59:12,933 - INFO - Loading Fama-French factors...
2025-04-17 21:59:12,942 - INFO - Fama-French factors loaded
2025-04-17 21:59:12,943 - INFO - Processing factor data...
2025-04-17 21:59:12,946 - INFO - Factor data processed
2025-04-17 21:59:12,946 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:12,947 - INFO - 
Training Period:
2025-04-17 21:59:12,952 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:12,959 - INFO - 
Testing Period:
2025-04-17 21:59:12,963 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:12,977 - INFO - Loading macro and market data...
2025-04-17 21:59:12,978 - INFO - Loading existing macro data...
2025-04-17 21:59:12,989 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:12,989 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:12,992 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:12,993 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:12,993 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:12,994 - INFO - Loading existing macro data...
2025-04-17 21:59:13,005 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:13,006 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:13,010 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:13,010 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:13,010 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:13,012 - INFO - Loading existing market data...
2025-04-17 21:59:13,015 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:13,017 - INFO - Loading existing market data...
2025-04-17 21:59:13,020 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:13,021 - INFO - Macro and market data loaded
2025-04-17 21:59:13,021 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:13,021 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:13,022 - INFO - Loading existing macro data...
2025-04-17 21:59:13,033 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:13,033 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:13,036 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:13,037 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:13,037 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:13,038 - INFO - Loading existing market data...
2025-04-17 21:59:13,043 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:13,059 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:13,060 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:13,060 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:13,061 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:13,062 - INFO - Loading existing macro data...
2025-04-17 21:59:13,075 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:13,076 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:13,079 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:13,080 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:13,080 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:13,082 - INFO - Loading existing market data...
2025-04-17 21:59:13,086 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:13,099 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:13,099 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:13,100 - INFO - Test data prepared
2025-04-17 21:59:13,100 - INFO - Storing data...
2025-04-17 21:59:13,100 - INFO - Aligning data indices...
2025-04-17 21:59:13,101 - INFO - Data indices aligned
2025-04-17 21:59:13,102 - INFO - Data preparation completed
2025-04-17 21:59:13,102 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:13,102 - INFO - Training models...
2025-04-17 21:59:13,102 - INFO - Starting model training...
2025-04-17 21:59:13,103 - INFO - Training regime classifier...
2025-04-17 21:59:13,103 - INFO - Training XGBoost model...
2025-04-17 21:59:13,103 - INFO - Preparing features...
2025-04-17 21:59:13,103 - INFO - Input shape: (1536, 8)
2025-04-17 21:59:13,103 - INFO - Handling missing values...
2025-04-17 21:59:13,105 - INFO - Missing values: 0 -> 0
2025-04-17 21:59:13,105 - INFO - Scaling features...
2025-04-17 21:59:13,107 - INFO - Fitted new scaler
2025-04-17 21:59:13,108 - INFO - Output shape: (1536, 8)
2025-04-17 21:59:13,286 - INFO - XGBoost model training completed
2025-04-17 21:59:13,565 - INFO - Model training completed
2025-04-17 21:59:13,567 - INFO - Model training completed
2025-04-17 21:59:13,567 - INFO - Initializing portfolio weights...
2025-04-17 21:59:13,568 - INFO - Portfolio weights initialized
2025-04-17 21:59:13,568 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:13,570 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:13,570 - ERROR - Error running xgboost with neural_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:13,571 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 5 regimes
2025-04-17 21:59:13,572 - INFO - Initializing strategy...
2025-04-17 21:59:13,572 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 21:59:13,572 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:13,572 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:59:13,573 - INFO - Running strategy...
2025-04-17 21:59:13,573 - INFO - Starting strategy execution...
2025-04-17 21:59:13,573 - INFO - Preparing training and testing data...
2025-04-17 21:59:13,574 - INFO - Starting data preparation...
2025-04-17 21:59:13,574 - INFO - Loading Fama-French factors...
2025-04-17 21:59:13,587 - INFO - Fama-French factors loaded
2025-04-17 21:59:13,588 - INFO - Processing factor data...
2025-04-17 21:59:13,590 - INFO - Factor data processed
2025-04-17 21:59:13,591 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:13,591 - INFO - 
Training Period:
2025-04-17 21:59:13,597 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:13,605 - INFO - 
Testing Period:
2025-04-17 21:59:13,611 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:13,620 - INFO - Loading macro and market data...
2025-04-17 21:59:13,622 - INFO - Loading existing macro data...
2025-04-17 21:59:13,633 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:13,633 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:13,636 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:13,637 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:13,637 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:13,638 - INFO - Loading existing macro data...
2025-04-17 21:59:13,648 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:13,649 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:13,653 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:13,653 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:13,653 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:13,655 - INFO - Loading existing market data...
2025-04-17 21:59:13,659 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:13,660 - INFO - Loading existing market data...
2025-04-17 21:59:13,663 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:13,663 - INFO - Macro and market data loaded
2025-04-17 21:59:13,664 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:13,664 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:13,665 - INFO - Loading existing macro data...
2025-04-17 21:59:13,676 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:13,676 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:13,679 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:13,680 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:13,680 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:13,682 - INFO - Loading existing market data...
2025-04-17 21:59:13,686 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:13,705 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:13,706 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:13,706 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:13,706 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:13,708 - INFO - Loading existing macro data...
2025-04-17 21:59:13,722 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:13,722 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:13,725 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:13,726 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:13,726 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:13,728 - INFO - Loading existing market data...
2025-04-17 21:59:13,732 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:13,743 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:13,744 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:13,744 - INFO - Test data prepared
2025-04-17 21:59:13,744 - INFO - Storing data...
2025-04-17 21:59:13,744 - INFO - Aligning data indices...
2025-04-17 21:59:13,746 - INFO - Data indices aligned
2025-04-17 21:59:13,746 - INFO - Data preparation completed
2025-04-17 21:59:13,746 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:13,746 - INFO - Training models...
2025-04-17 21:59:13,746 - INFO - Starting model training...
2025-04-17 21:59:13,747 - INFO - Training regime classifier...
2025-04-17 21:59:13,747 - INFO - Training XGBoost model...
2025-04-17 21:59:13,747 - INFO - Preparing features...
2025-04-17 21:59:13,747 - INFO - Input shape: (1536, 8)
2025-04-17 21:59:13,747 - INFO - Handling missing values...
2025-04-17 21:59:13,749 - INFO - Missing values: 0 -> 0
2025-04-17 21:59:13,749 - INFO - Scaling features...
2025-04-17 21:59:13,750 - INFO - Fitted new scaler
2025-04-17 21:59:13,752 - INFO - Output shape: (1536, 8)
2025-04-17 21:59:13,950 - INFO - XGBoost model training completed
2025-04-17 21:59:14,240 - INFO - Model training completed
2025-04-17 21:59:14,242 - INFO - Model training completed
2025-04-17 21:59:14,242 - INFO - Initializing portfolio weights...
2025-04-17 21:59:14,242 - INFO - Portfolio weights initialized
2025-04-17 21:59:14,243 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:14,244 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:14,245 - ERROR - Error running xgboost with neural_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:14,247 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 7 regimes
2025-04-17 21:59:14,247 - INFO - Initializing strategy...
2025-04-17 21:59:14,247 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 21:59:14,248 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:14,248 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:59:14,249 - INFO - Running strategy...
2025-04-17 21:59:14,249 - INFO - Starting strategy execution...
2025-04-17 21:59:14,249 - INFO - Preparing training and testing data...
2025-04-17 21:59:14,250 - INFO - Starting data preparation...
2025-04-17 21:59:14,250 - INFO - Loading Fama-French factors...
2025-04-17 21:59:14,260 - INFO - Fama-French factors loaded
2025-04-17 21:59:14,261 - INFO - Processing factor data...
2025-04-17 21:59:14,264 - INFO - Factor data processed
2025-04-17 21:59:14,264 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:14,264 - INFO - 
Training Period:
2025-04-17 21:59:14,269 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:14,279 - INFO - 
Testing Period:
2025-04-17 21:59:14,284 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:14,291 - INFO - Loading macro and market data...
2025-04-17 21:59:14,293 - INFO - Loading existing macro data...
2025-04-17 21:59:14,303 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:14,304 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:14,307 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:14,307 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:14,308 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:14,309 - INFO - Loading existing macro data...
2025-04-17 21:59:14,319 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:14,319 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:14,323 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:14,323 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:14,323 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:14,325 - INFO - Loading existing market data...
2025-04-17 21:59:14,331 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:14,333 - INFO - Loading existing market data...
2025-04-17 21:59:14,337 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:14,337 - INFO - Macro and market data loaded
2025-04-17 21:59:14,337 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:14,337 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:14,339 - INFO - Loading existing macro data...
2025-04-17 21:59:14,352 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:14,352 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:14,355 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:14,356 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:14,356 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:14,357 - INFO - Loading existing market data...
2025-04-17 21:59:14,361 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:14,379 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:14,380 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:14,380 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:14,381 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:14,382 - INFO - Loading existing macro data...
2025-04-17 21:59:14,399 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:14,400 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:14,405 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:14,406 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:14,406 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:14,408 - INFO - Loading existing market data...
2025-04-17 21:59:14,414 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:14,430 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:14,430 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:14,431 - INFO - Test data prepared
2025-04-17 21:59:14,431 - INFO - Storing data...
2025-04-17 21:59:14,432 - INFO - Aligning data indices...
2025-04-17 21:59:14,434 - INFO - Data indices aligned
2025-04-17 21:59:14,434 - INFO - Data preparation completed
2025-04-17 21:59:14,434 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:14,435 - INFO - Training models...
2025-04-17 21:59:14,435 - INFO - Starting model training...
2025-04-17 21:59:14,435 - INFO - Training regime classifier...
2025-04-17 21:59:14,435 - INFO - Training XGBoost model...
2025-04-17 21:59:14,436 - INFO - Preparing features...
2025-04-17 21:59:14,436 - INFO - Input shape: (1536, 8)
2025-04-17 21:59:14,436 - INFO - Handling missing values...
2025-04-17 21:59:14,438 - INFO - Missing values: 0 -> 0
2025-04-17 21:59:14,438 - INFO - Scaling features...
2025-04-17 21:59:14,440 - INFO - Fitted new scaler
2025-04-17 21:59:14,441 - INFO - Output shape: (1536, 8)
2025-04-17 21:59:14,660 - INFO - XGBoost model training completed
2025-04-17 21:59:14,940 - INFO - Model training completed
2025-04-17 21:59:14,942 - INFO - Model training completed
2025-04-17 21:59:14,942 - INFO - Initializing portfolio weights...
2025-04-17 21:59:14,943 - INFO - Portfolio weights initialized
2025-04-17 21:59:14,943 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:14,945 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:14,945 - ERROR - Error running xgboost with neural_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:14,947 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 21:59:14,947 - INFO - Initializing strategy...
2025-04-17 21:59:14,948 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 21:59:14,948 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:14,948 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:59:14,949 - INFO - Running strategy...
2025-04-17 21:59:14,949 - INFO - Starting strategy execution...
2025-04-17 21:59:14,949 - INFO - Preparing training and testing data...
2025-04-17 21:59:14,949 - INFO - Starting data preparation...
2025-04-17 21:59:14,950 - INFO - Loading Fama-French factors...
2025-04-17 21:59:14,962 - INFO - Fama-French factors loaded
2025-04-17 21:59:14,963 - INFO - Processing factor data...
2025-04-17 21:59:14,966 - INFO - Factor data processed
2025-04-17 21:59:14,966 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:14,966 - INFO - 
Training Period:
2025-04-17 21:59:14,972 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:14,979 - INFO - 
Testing Period:
2025-04-17 21:59:14,984 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:14,993 - INFO - Loading macro and market data...
2025-04-17 21:59:14,995 - INFO - Loading existing macro data...
2025-04-17 21:59:15,007 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:15,007 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:15,011 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:15,011 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:15,011 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:15,013 - INFO - Loading existing macro data...
2025-04-17 21:59:15,024 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:15,024 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:15,028 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:15,028 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:15,029 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:15,030 - INFO - Loading existing market data...
2025-04-17 21:59:15,035 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:15,036 - INFO - Loading existing market data...
2025-04-17 21:59:15,041 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:15,042 - INFO - Macro and market data loaded
2025-04-17 21:59:15,042 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:15,042 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:15,043 - INFO - Loading existing macro data...
2025-04-17 21:59:15,057 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:15,058 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:15,061 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:15,062 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:15,062 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:15,063 - INFO - Loading existing market data...
2025-04-17 21:59:15,067 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:15,086 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:15,086 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:15,087 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:15,087 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:15,088 - INFO - Loading existing macro data...
2025-04-17 21:59:15,101 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:15,102 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:15,106 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:15,106 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:15,106 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:15,108 - INFO - Loading existing market data...
2025-04-17 21:59:15,111 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:15,123 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:15,123 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:15,124 - INFO - Test data prepared
2025-04-17 21:59:15,124 - INFO - Storing data...
2025-04-17 21:59:15,124 - INFO - Aligning data indices...
2025-04-17 21:59:15,126 - INFO - Data indices aligned
2025-04-17 21:59:15,126 - INFO - Data preparation completed
2025-04-17 21:59:15,127 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:15,127 - INFO - Training models...
2025-04-17 21:59:15,128 - INFO - Starting model training...
2025-04-17 21:59:15,128 - INFO - Training regime classifier...
2025-04-17 21:59:15,128 - INFO - Training XGBoost model...
2025-04-17 21:59:15,128 - INFO - Preparing features...
2025-04-17 21:59:15,129 - INFO - Input shape: (1536, 8)
2025-04-17 21:59:15,129 - INFO - Handling missing values...
2025-04-17 21:59:15,130 - INFO - Missing values: 0 -> 0
2025-04-17 21:59:15,130 - INFO - Scaling features...
2025-04-17 21:59:15,131 - INFO - Fitted new scaler
2025-04-17 21:59:15,133 - INFO - Output shape: (1536, 8)
2025-04-17 21:59:15,310 - INFO - XGBoost model training completed
2025-04-17 21:59:15,591 - INFO - Model training completed
2025-04-17 21:59:15,594 - INFO - Model training completed
2025-04-17 21:59:15,594 - INFO - Initializing portfolio weights...
2025-04-17 21:59:15,595 - INFO - Portfolio weights initialized
2025-04-17 21:59:15,595 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:15,597 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:15,597 - ERROR - Error running xgboost with autoencoder_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:15,599 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 21:59:15,599 - INFO - Initializing strategy...
2025-04-17 21:59:15,599 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 21:59:15,600 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:15,600 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:59:15,600 - INFO - Running strategy...
2025-04-17 21:59:15,601 - INFO - Starting strategy execution...
2025-04-17 21:59:15,601 - INFO - Preparing training and testing data...
2025-04-17 21:59:15,601 - INFO - Starting data preparation...
2025-04-17 21:59:15,601 - INFO - Loading Fama-French factors...
2025-04-17 21:59:15,612 - INFO - Fama-French factors loaded
2025-04-17 21:59:15,612 - INFO - Processing factor data...
2025-04-17 21:59:15,615 - INFO - Factor data processed
2025-04-17 21:59:15,615 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:15,616 - INFO - 
Training Period:
2025-04-17 21:59:15,620 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:15,629 - INFO - 
Testing Period:
2025-04-17 21:59:15,634 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:15,642 - INFO - Loading macro and market data...
2025-04-17 21:59:15,643 - INFO - Loading existing macro data...
2025-04-17 21:59:15,654 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:15,655 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:15,659 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:15,659 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:15,659 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:15,660 - INFO - Loading existing macro data...
2025-04-17 21:59:15,670 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:15,670 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:15,673 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:15,674 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:15,674 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:15,676 - INFO - Loading existing market data...
2025-04-17 21:59:15,679 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:15,680 - INFO - Loading existing market data...
2025-04-17 21:59:15,684 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:15,684 - INFO - Macro and market data loaded
2025-04-17 21:59:15,685 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:15,685 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:15,686 - INFO - Loading existing macro data...
2025-04-17 21:59:15,698 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:15,698 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:15,701 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:15,701 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:15,702 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:15,703 - INFO - Loading existing market data...
2025-04-17 21:59:15,707 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:15,724 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:15,724 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:15,725 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:15,725 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:15,726 - INFO - Loading existing macro data...
2025-04-17 21:59:15,740 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:15,741 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:15,744 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:15,744 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:15,745 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:15,746 - INFO - Loading existing market data...
2025-04-17 21:59:15,750 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:15,762 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:15,762 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:15,763 - INFO - Test data prepared
2025-04-17 21:59:15,763 - INFO - Storing data...
2025-04-17 21:59:15,763 - INFO - Aligning data indices...
2025-04-17 21:59:15,765 - INFO - Data indices aligned
2025-04-17 21:59:15,765 - INFO - Data preparation completed
2025-04-17 21:59:15,765 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:15,765 - INFO - Training models...
2025-04-17 21:59:15,765 - INFO - Starting model training...
2025-04-17 21:59:15,765 - INFO - Training regime classifier...
2025-04-17 21:59:15,766 - INFO - Training XGBoost model...
2025-04-17 21:59:15,766 - INFO - Preparing features...
2025-04-17 21:59:15,766 - INFO - Input shape: (1536, 8)
2025-04-17 21:59:15,767 - INFO - Handling missing values...
2025-04-17 21:59:15,768 - INFO - Missing values: 0 -> 0
2025-04-17 21:59:15,768 - INFO - Scaling features...
2025-04-17 21:59:15,770 - INFO - Fitted new scaler
2025-04-17 21:59:15,771 - INFO - Output shape: (1536, 8)
2025-04-17 21:59:15,956 - INFO - XGBoost model training completed
2025-04-17 21:59:16,246 - INFO - Model training completed
2025-04-17 21:59:16,247 - INFO - Model training completed
2025-04-17 21:59:16,248 - INFO - Initializing portfolio weights...
2025-04-17 21:59:16,248 - INFO - Portfolio weights initialized
2025-04-17 21:59:16,248 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:16,250 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:16,250 - ERROR - Error running xgboost with autoencoder_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:16,252 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 21:59:16,252 - INFO - Initializing strategy...
2025-04-17 21:59:16,252 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 21:59:16,252 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:16,253 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:59:16,254 - INFO - Running strategy...
2025-04-17 21:59:16,254 - INFO - Starting strategy execution...
2025-04-17 21:59:16,254 - INFO - Preparing training and testing data...
2025-04-17 21:59:16,254 - INFO - Starting data preparation...
2025-04-17 21:59:16,254 - INFO - Loading Fama-French factors...
2025-04-17 21:59:16,263 - INFO - Fama-French factors loaded
2025-04-17 21:59:16,264 - INFO - Processing factor data...
2025-04-17 21:59:16,267 - INFO - Factor data processed
2025-04-17 21:59:16,267 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:16,267 - INFO - 
Training Period:
2025-04-17 21:59:16,273 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:16,281 - INFO - 
Testing Period:
2025-04-17 21:59:16,287 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:16,294 - INFO - Loading macro and market data...
2025-04-17 21:59:16,297 - INFO - Loading existing macro data...
2025-04-17 21:59:16,310 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:16,310 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:16,314 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:16,315 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:16,315 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:16,316 - INFO - Loading existing macro data...
2025-04-17 21:59:16,327 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:16,327 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:16,331 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:16,331 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:16,331 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:16,333 - INFO - Loading existing market data...
2025-04-17 21:59:16,338 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:16,340 - INFO - Loading existing market data...
2025-04-17 21:59:16,343 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:16,343 - INFO - Macro and market data loaded
2025-04-17 21:59:16,343 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:16,344 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:16,345 - INFO - Loading existing macro data...
2025-04-17 21:59:16,355 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:16,356 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:16,359 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:16,359 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:16,359 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:16,361 - INFO - Loading existing market data...
2025-04-17 21:59:16,365 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:16,385 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:16,385 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:16,385 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:16,385 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:16,387 - INFO - Loading existing macro data...
2025-04-17 21:59:16,401 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:16,401 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:16,405 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:16,405 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:16,405 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:16,407 - INFO - Loading existing market data...
2025-04-17 21:59:16,411 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:16,422 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:16,423 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:16,423 - INFO - Test data prepared
2025-04-17 21:59:16,423 - INFO - Storing data...
2025-04-17 21:59:16,423 - INFO - Aligning data indices...
2025-04-17 21:59:16,425 - INFO - Data indices aligned
2025-04-17 21:59:16,425 - INFO - Data preparation completed
2025-04-17 21:59:16,425 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:16,426 - INFO - Training models...
2025-04-17 21:59:16,426 - INFO - Starting model training...
2025-04-17 21:59:16,426 - INFO - Training regime classifier...
2025-04-17 21:59:16,426 - INFO - Training XGBoost model...
2025-04-17 21:59:16,426 - INFO - Preparing features...
2025-04-17 21:59:16,426 - INFO - Input shape: (1536, 8)
2025-04-17 21:59:16,426 - INFO - Handling missing values...
2025-04-17 21:59:16,428 - INFO - Missing values: 0 -> 0
2025-04-17 21:59:16,428 - INFO - Scaling features...
2025-04-17 21:59:16,429 - INFO - Fitted new scaler
2025-04-17 21:59:16,430 - INFO - Output shape: (1536, 8)
2025-04-17 21:59:16,614 - INFO - XGBoost model training completed
2025-04-17 21:59:16,905 - INFO - Model training completed
2025-04-17 21:59:16,907 - INFO - Model training completed
2025-04-17 21:59:16,907 - INFO - Initializing portfolio weights...
2025-04-17 21:59:16,908 - INFO - Portfolio weights initialized
2025-04-17 21:59:16,908 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:16,910 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:16,910 - ERROR - Error running xgboost with autoencoder_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:16,912 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 3 regimes
2025-04-17 21:59:16,913 - INFO - Initializing strategy...
2025-04-17 21:59:16,913 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 21:59:16,913 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:16,913 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:59:17,952 - INFO - Running strategy...
2025-04-17 21:59:17,952 - INFO - Starting strategy execution...
2025-04-17 21:59:17,953 - INFO - Preparing training and testing data...
2025-04-17 21:59:17,953 - INFO - Starting data preparation...
2025-04-17 21:59:17,954 - INFO - Loading Fama-French factors...
2025-04-17 21:59:17,967 - INFO - Fama-French factors loaded
2025-04-17 21:59:17,967 - INFO - Processing factor data...
2025-04-17 21:59:17,969 - INFO - Factor data processed
2025-04-17 21:59:17,970 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:17,970 - INFO - 
Training Period:
2025-04-17 21:59:17,974 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:17,984 - INFO - 
Testing Period:
2025-04-17 21:59:17,989 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:17,997 - INFO - Loading macro and market data...
2025-04-17 21:59:17,999 - INFO - Loading existing macro data...
2025-04-17 21:59:18,010 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:18,011 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:18,014 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:18,014 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:18,015 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:18,015 - INFO - Loading existing macro data...
2025-04-17 21:59:18,029 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:18,029 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:18,033 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:18,033 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:18,033 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:18,035 - INFO - Loading existing market data...
2025-04-17 21:59:18,040 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:18,041 - INFO - Loading existing market data...
2025-04-17 21:59:18,044 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:18,045 - INFO - Macro and market data loaded
2025-04-17 21:59:18,045 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:18,045 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:18,047 - INFO - Loading existing macro data...
2025-04-17 21:59:18,064 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:18,064 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:18,069 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:18,070 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:18,070 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:18,072 - INFO - Loading existing market data...
2025-04-17 21:59:18,078 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:18,102 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:18,103 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:18,103 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:18,103 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:18,105 - INFO - Loading existing macro data...
2025-04-17 21:59:18,121 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:18,121 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:18,126 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:18,126 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:18,126 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:18,128 - INFO - Loading existing market data...
2025-04-17 21:59:18,133 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:18,149 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:18,149 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:18,150 - INFO - Test data prepared
2025-04-17 21:59:18,150 - INFO - Storing data...
2025-04-17 21:59:18,150 - INFO - Aligning data indices...
2025-04-17 21:59:18,153 - INFO - Data indices aligned
2025-04-17 21:59:18,154 - INFO - Updated neural optimizer input size to 8
2025-04-17 21:59:18,154 - INFO - Data preparation completed
2025-04-17 21:59:18,154 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:18,155 - INFO - Training models...
2025-04-17 21:59:18,155 - INFO - Starting model training...
2025-04-17 21:59:18,155 - INFO - Training regime classifier...
2025-04-17 21:59:18,155 - INFO - Training XGBoost model...
2025-04-17 21:59:18,156 - INFO - Preparing features...
2025-04-17 21:59:18,156 - INFO - Input shape: (1536, 8)
2025-04-17 21:59:18,156 - INFO - Handling missing values...
2025-04-17 21:59:18,158 - INFO - Missing values: 0 -> 0
2025-04-17 21:59:18,158 - INFO - Scaling features...
2025-04-17 21:59:18,160 - INFO - Fitted new scaler
2025-04-17 21:59:18,161 - INFO - Output shape: (1536, 8)
2025-04-17 21:59:18,365 - INFO - XGBoost model training completed
2025-04-17 21:59:18,653 - INFO - Training neural portfolio optimizer...
2025-04-17 21:59:18,653 - INFO - Neural portfolio optimizer training completed
2025-04-17 21:59:18,653 - INFO - Model training completed
2025-04-17 21:59:18,655 - INFO - Model training completed
2025-04-17 21:59:18,656 - INFO - Initializing portfolio weights...
2025-04-17 21:59:18,656 - INFO - Portfolio weights initialized
2025-04-17 21:59:18,657 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:18,659 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:18,659 - ERROR - Error running xgboost with neural and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:18,661 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 5 regimes
2025-04-17 21:59:18,662 - INFO - Initializing strategy...
2025-04-17 21:59:18,662 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 21:59:18,662 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:18,662 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:59:18,663 - INFO - Running strategy...
2025-04-17 21:59:18,664 - INFO - Starting strategy execution...
2025-04-17 21:59:18,664 - INFO - Preparing training and testing data...
2025-04-17 21:59:18,664 - INFO - Starting data preparation...
2025-04-17 21:59:18,664 - INFO - Loading Fama-French factors...
2025-04-17 21:59:18,676 - INFO - Fama-French factors loaded
2025-04-17 21:59:18,677 - INFO - Processing factor data...
2025-04-17 21:59:18,679 - INFO - Factor data processed
2025-04-17 21:59:18,680 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:18,680 - INFO - 
Training Period:
2025-04-17 21:59:18,685 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:18,694 - INFO - 
Testing Period:
2025-04-17 21:59:18,699 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:18,708 - INFO - Loading macro and market data...
2025-04-17 21:59:18,709 - INFO - Loading existing macro data...
2025-04-17 21:59:18,723 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:18,723 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:18,727 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:18,727 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:18,728 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:18,729 - INFO - Loading existing macro data...
2025-04-17 21:59:18,739 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:18,740 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:18,743 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:18,743 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:18,744 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:18,745 - INFO - Loading existing market data...
2025-04-17 21:59:18,749 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:18,750 - INFO - Loading existing market data...
2025-04-17 21:59:18,753 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:18,753 - INFO - Macro and market data loaded
2025-04-17 21:59:18,753 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:18,754 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:18,755 - INFO - Loading existing macro data...
2025-04-17 21:59:18,766 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:18,766 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:18,769 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:18,769 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:18,770 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:18,771 - INFO - Loading existing market data...
2025-04-17 21:59:18,775 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:18,792 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:18,792 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:18,792 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:18,792 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:18,794 - INFO - Loading existing macro data...
2025-04-17 21:59:18,808 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:18,808 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:18,812 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:18,813 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:18,813 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:18,815 - INFO - Loading existing market data...
2025-04-17 21:59:18,819 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:18,832 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:18,833 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:18,833 - INFO - Test data prepared
2025-04-17 21:59:18,833 - INFO - Storing data...
2025-04-17 21:59:18,833 - INFO - Aligning data indices...
2025-04-17 21:59:18,835 - INFO - Data indices aligned
2025-04-17 21:59:18,836 - INFO - Updated neural optimizer input size to 8
2025-04-17 21:59:18,836 - INFO - Data preparation completed
2025-04-17 21:59:18,836 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:18,837 - INFO - Training models...
2025-04-17 21:59:18,837 - INFO - Starting model training...
2025-04-17 21:59:18,837 - INFO - Training regime classifier...
2025-04-17 21:59:18,837 - INFO - Training XGBoost model...
2025-04-17 21:59:18,837 - INFO - Preparing features...
2025-04-17 21:59:18,837 - INFO - Input shape: (1536, 8)
2025-04-17 21:59:18,838 - INFO - Handling missing values...
2025-04-17 21:59:18,839 - INFO - Missing values: 0 -> 0
2025-04-17 21:59:18,839 - INFO - Scaling features...
2025-04-17 21:59:18,841 - INFO - Fitted new scaler
2025-04-17 21:59:18,841 - INFO - Output shape: (1536, 8)
2025-04-17 21:59:19,032 - INFO - XGBoost model training completed
2025-04-17 21:59:19,298 - INFO - Training neural portfolio optimizer...
2025-04-17 21:59:19,298 - INFO - Neural portfolio optimizer training completed
2025-04-17 21:59:19,299 - INFO - Model training completed
2025-04-17 21:59:19,300 - INFO - Model training completed
2025-04-17 21:59:19,300 - INFO - Initializing portfolio weights...
2025-04-17 21:59:19,301 - INFO - Portfolio weights initialized
2025-04-17 21:59:19,301 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:19,303 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:19,303 - ERROR - Error running xgboost with neural and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:19,305 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 7 regimes
2025-04-17 21:59:19,305 - INFO - Initializing strategy...
2025-04-17 21:59:19,305 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 21:59:19,305 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:19,305 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 21:59:19,306 - INFO - Running strategy...
2025-04-17 21:59:19,307 - INFO - Starting strategy execution...
2025-04-17 21:59:19,307 - INFO - Preparing training and testing data...
2025-04-17 21:59:19,307 - INFO - Starting data preparation...
2025-04-17 21:59:19,307 - INFO - Loading Fama-French factors...
2025-04-17 21:59:19,321 - INFO - Fama-French factors loaded
2025-04-17 21:59:19,321 - INFO - Processing factor data...
2025-04-17 21:59:19,325 - INFO - Factor data processed
2025-04-17 21:59:19,325 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:19,326 - INFO - 
Training Period:
2025-04-17 21:59:19,330 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:19,338 - INFO - 
Testing Period:
2025-04-17 21:59:19,344 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:19,353 - INFO - Loading macro and market data...
2025-04-17 21:59:19,354 - INFO - Loading existing macro data...
2025-04-17 21:59:19,364 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:19,365 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:19,369 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:19,369 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:19,369 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:19,371 - INFO - Loading existing macro data...
2025-04-17 21:59:19,383 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:19,384 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:19,388 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:19,389 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:19,389 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:19,391 - INFO - Loading existing market data...
2025-04-17 21:59:19,395 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:19,397 - INFO - Loading existing market data...
2025-04-17 21:59:19,400 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:19,400 - INFO - Macro and market data loaded
2025-04-17 21:59:19,400 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:19,400 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:19,402 - INFO - Loading existing macro data...
2025-04-17 21:59:19,412 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:19,412 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:19,415 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:19,415 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:19,416 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:19,417 - INFO - Loading existing market data...
2025-04-17 21:59:19,421 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:19,438 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:19,438 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:19,438 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:19,438 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:19,440 - INFO - Loading existing macro data...
2025-04-17 21:59:19,455 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:19,455 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:19,459 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:19,459 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:19,459 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:19,461 - INFO - Loading existing market data...
2025-04-17 21:59:19,465 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:19,477 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:19,477 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:19,478 - INFO - Test data prepared
2025-04-17 21:59:19,478 - INFO - Storing data...
2025-04-17 21:59:19,478 - INFO - Aligning data indices...
2025-04-17 21:59:19,480 - INFO - Data indices aligned
2025-04-17 21:59:19,481 - INFO - Updated neural optimizer input size to 8
2025-04-17 21:59:19,482 - INFO - Data preparation completed
2025-04-17 21:59:19,482 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:19,482 - INFO - Training models...
2025-04-17 21:59:19,483 - INFO - Starting model training...
2025-04-17 21:59:19,483 - INFO - Training regime classifier...
2025-04-17 21:59:19,483 - INFO - Training XGBoost model...
2025-04-17 21:59:19,483 - INFO - Preparing features...
2025-04-17 21:59:19,484 - INFO - Input shape: (1536, 8)
2025-04-17 21:59:19,484 - INFO - Handling missing values...
2025-04-17 21:59:19,485 - INFO - Missing values: 0 -> 0
2025-04-17 21:59:19,486 - INFO - Scaling features...
2025-04-17 21:59:19,488 - INFO - Fitted new scaler
2025-04-17 21:59:19,489 - INFO - Output shape: (1536, 8)
2025-04-17 21:59:19,663 - INFO - XGBoost model training completed
2025-04-17 21:59:19,936 - INFO - Training neural portfolio optimizer...
2025-04-17 21:59:19,937 - INFO - Neural portfolio optimizer training completed
2025-04-17 21:59:19,937 - INFO - Model training completed
2025-04-17 21:59:19,939 - INFO - Model training completed
2025-04-17 21:59:19,940 - INFO - Initializing portfolio weights...
2025-04-17 21:59:19,940 - INFO - Portfolio weights initialized
2025-04-17 21:59:19,941 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:19,942 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:19,943 - ERROR - Error running xgboost with neural and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:19,945 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 3 regimes
2025-04-17 21:59:19,945 - INFO - Initializing strategy...
2025-04-17 21:59:19,945 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 21:59:19,945 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:19,946 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:59:19,947 - INFO - Running strategy...
2025-04-17 21:59:19,947 - INFO - Starting strategy execution...
2025-04-17 21:59:19,947 - INFO - Preparing training and testing data...
2025-04-17 21:59:19,947 - INFO - Starting data preparation...
2025-04-17 21:59:19,948 - INFO - Loading Fama-French factors...
2025-04-17 21:59:19,959 - INFO - Fama-French factors loaded
2025-04-17 21:59:19,959 - INFO - Processing factor data...
2025-04-17 21:59:19,962 - INFO - Factor data processed
2025-04-17 21:59:19,962 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:19,962 - INFO - 
Training Period:
2025-04-17 21:59:19,968 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:19,976 - INFO - 
Testing Period:
2025-04-17 21:59:19,980 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:19,988 - INFO - Loading macro and market data...
2025-04-17 21:59:19,989 - INFO - Loading existing macro data...
2025-04-17 21:59:20,001 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:20,001 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:20,005 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:20,005 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:20,005 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:20,007 - INFO - Loading existing macro data...
2025-04-17 21:59:20,020 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:20,020 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:20,025 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:20,025 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:20,025 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:20,026 - INFO - Loading existing market data...
2025-04-17 21:59:20,030 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:20,031 - INFO - Loading existing market data...
2025-04-17 21:59:20,034 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:20,035 - INFO - Macro and market data loaded
2025-04-17 21:59:20,035 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:20,035 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:20,036 - INFO - Loading existing macro data...
2025-04-17 21:59:20,046 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:20,047 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:20,050 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:20,050 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:20,050 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:20,052 - INFO - Loading existing market data...
2025-04-17 21:59:20,055 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:20,075 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:20,076 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:20,076 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:20,076 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:20,077 - INFO - Loading existing macro data...
2025-04-17 21:59:20,091 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:20,091 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:20,096 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:20,096 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:20,096 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:20,098 - INFO - Loading existing market data...
2025-04-17 21:59:20,103 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:20,116 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:20,117 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:20,117 - INFO - Test data prepared
2025-04-17 21:59:20,118 - INFO - Storing data...
2025-04-17 21:59:20,118 - INFO - Aligning data indices...
2025-04-17 21:59:20,120 - INFO - Data indices aligned
2025-04-17 21:59:20,120 - INFO - Data preparation completed
2025-04-17 21:59:20,120 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:20,121 - INFO - Training models...
2025-04-17 21:59:20,121 - INFO - Starting model training...
2025-04-17 21:59:20,121 - INFO - Training regime classifier...
2025-04-17 21:59:20,121 - INFO - Training HMM model...
2025-04-17 21:59:20,376 - INFO - HMM model training completed
2025-04-17 21:59:20,765 - INFO - Model training completed
2025-04-17 21:59:20,767 - INFO - Model training completed
2025-04-17 21:59:20,767 - INFO - Initializing portfolio weights...
2025-04-17 21:59:20,768 - INFO - Portfolio weights initialized
2025-04-17 21:59:20,768 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:20,770 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:20,771 - ERROR - Error running hmm with mean_variance and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:20,773 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 5 regimes
2025-04-17 21:59:20,773 - INFO - Initializing strategy...
2025-04-17 21:59:20,774 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 21:59:20,774 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:20,775 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:59:20,775 - INFO - Running strategy...
2025-04-17 21:59:20,775 - INFO - Starting strategy execution...
2025-04-17 21:59:20,776 - INFO - Preparing training and testing data...
2025-04-17 21:59:20,776 - INFO - Starting data preparation...
2025-04-17 21:59:20,776 - INFO - Loading Fama-French factors...
2025-04-17 21:59:20,788 - INFO - Fama-French factors loaded
2025-04-17 21:59:20,788 - INFO - Processing factor data...
2025-04-17 21:59:20,791 - INFO - Factor data processed
2025-04-17 21:59:20,791 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:20,791 - INFO - 
Training Period:
2025-04-17 21:59:20,797 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:20,805 - INFO - 
Testing Period:
2025-04-17 21:59:20,810 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:20,819 - INFO - Loading macro and market data...
2025-04-17 21:59:20,820 - INFO - Loading existing macro data...
2025-04-17 21:59:20,833 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:20,834 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:20,838 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:20,838 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:20,838 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:20,840 - INFO - Loading existing macro data...
2025-04-17 21:59:20,850 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:20,851 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:20,855 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:20,855 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:20,855 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:20,857 - INFO - Loading existing market data...
2025-04-17 21:59:20,861 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:20,862 - INFO - Loading existing market data...
2025-04-17 21:59:20,865 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:20,865 - INFO - Macro and market data loaded
2025-04-17 21:59:20,865 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:20,865 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:20,866 - INFO - Loading existing macro data...
2025-04-17 21:59:20,877 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:20,877 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:20,880 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:20,881 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:20,881 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:20,882 - INFO - Loading existing market data...
2025-04-17 21:59:20,886 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:20,903 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:20,903 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:20,904 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:20,904 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:20,905 - INFO - Loading existing macro data...
2025-04-17 21:59:20,920 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:20,920 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:20,926 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:20,926 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:20,926 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:20,928 - INFO - Loading existing market data...
2025-04-17 21:59:20,933 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:20,946 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:20,946 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:20,946 - INFO - Test data prepared
2025-04-17 21:59:20,947 - INFO - Storing data...
2025-04-17 21:59:20,947 - INFO - Aligning data indices...
2025-04-17 21:59:20,949 - INFO - Data indices aligned
2025-04-17 21:59:20,949 - INFO - Data preparation completed
2025-04-17 21:59:20,950 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:20,950 - INFO - Training models...
2025-04-17 21:59:20,951 - INFO - Starting model training...
2025-04-17 21:59:20,951 - INFO - Training regime classifier...
2025-04-17 21:59:20,951 - INFO - Training HMM model...
2025-04-17 21:59:21,225 - INFO - HMM model training completed
2025-04-17 21:59:21,429 - INFO - Model training completed
2025-04-17 21:59:21,431 - INFO - Model training completed
2025-04-17 21:59:21,432 - INFO - Initializing portfolio weights...
2025-04-17 21:59:21,432 - INFO - Portfolio weights initialized
2025-04-17 21:59:21,432 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:21,435 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:21,435 - ERROR - Error running hmm with mean_variance and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:21,437 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 7 regimes
2025-04-17 21:59:21,437 - INFO - Initializing strategy...
2025-04-17 21:59:21,438 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 21:59:21,438 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:21,438 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:59:21,438 - INFO - Running strategy...
2025-04-17 21:59:21,439 - INFO - Starting strategy execution...
2025-04-17 21:59:21,439 - INFO - Preparing training and testing data...
2025-04-17 21:59:21,439 - INFO - Starting data preparation...
2025-04-17 21:59:21,439 - INFO - Loading Fama-French factors...
2025-04-17 21:59:21,453 - INFO - Fama-French factors loaded
2025-04-17 21:59:21,453 - INFO - Processing factor data...
2025-04-17 21:59:21,455 - INFO - Factor data processed
2025-04-17 21:59:21,455 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:21,456 - INFO - 
Training Period:
2025-04-17 21:59:21,462 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:21,470 - INFO - 
Testing Period:
2025-04-17 21:59:21,475 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:21,485 - INFO - Loading macro and market data...
2025-04-17 21:59:21,486 - INFO - Loading existing macro data...
2025-04-17 21:59:21,498 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:21,498 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:21,502 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:21,502 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:21,503 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:21,504 - INFO - Loading existing macro data...
2025-04-17 21:59:21,517 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:21,518 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:21,521 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:21,521 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:21,521 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:21,522 - INFO - Loading existing market data...
2025-04-17 21:59:21,526 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:21,528 - INFO - Loading existing market data...
2025-04-17 21:59:21,532 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:21,532 - INFO - Macro and market data loaded
2025-04-17 21:59:21,532 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:21,533 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:21,534 - INFO - Loading existing macro data...
2025-04-17 21:59:21,545 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:21,546 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:21,550 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:21,550 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:21,550 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:21,551 - INFO - Loading existing market data...
2025-04-17 21:59:21,555 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:21,572 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:21,572 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:21,573 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:21,573 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:21,575 - INFO - Loading existing macro data...
2025-04-17 21:59:21,588 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:21,588 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:21,592 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:21,592 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:21,593 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:21,594 - INFO - Loading existing market data...
2025-04-17 21:59:21,599 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:21,610 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:21,611 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:21,611 - INFO - Test data prepared
2025-04-17 21:59:21,611 - INFO - Storing data...
2025-04-17 21:59:21,612 - INFO - Aligning data indices...
2025-04-17 21:59:21,613 - INFO - Data indices aligned
2025-04-17 21:59:21,613 - INFO - Data preparation completed
2025-04-17 21:59:21,613 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:21,613 - INFO - Training models...
2025-04-17 21:59:21,613 - INFO - Starting model training...
2025-04-17 21:59:21,614 - INFO - Training regime classifier...
2025-04-17 21:59:21,614 - INFO - Training HMM model...
2025-04-17 21:59:21,844 - WARNING - Model is not converging.  Current: 6604.339029588863 is not greater than 21507.424263949077. Delta is -14903.085234360213
2025-04-17 21:59:21,844 - INFO - HMM model training completed
2025-04-17 21:59:22,067 - INFO - Model training completed
2025-04-17 21:59:22,069 - INFO - Model training completed
2025-04-17 21:59:22,069 - INFO - Initializing portfolio weights...
2025-04-17 21:59:22,070 - INFO - Portfolio weights initialized
2025-04-17 21:59:22,070 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:22,072 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:22,072 - ERROR - Error running hmm with mean_variance and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:22,074 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 3 regimes
2025-04-17 21:59:22,075 - INFO - Initializing strategy...
2025-04-17 21:59:22,075 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 21:59:22,075 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:22,075 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:59:22,076 - INFO - Running strategy...
2025-04-17 21:59:22,076 - INFO - Starting strategy execution...
2025-04-17 21:59:22,076 - INFO - Preparing training and testing data...
2025-04-17 21:59:22,076 - INFO - Starting data preparation...
2025-04-17 21:59:22,077 - INFO - Loading Fama-French factors...
2025-04-17 21:59:22,089 - INFO - Fama-French factors loaded
2025-04-17 21:59:22,090 - INFO - Processing factor data...
2025-04-17 21:59:22,093 - INFO - Factor data processed
2025-04-17 21:59:22,094 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:22,094 - INFO - 
Training Period:
2025-04-17 21:59:22,099 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:22,107 - INFO - 
Testing Period:
2025-04-17 21:59:22,112 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:22,121 - INFO - Loading macro and market data...
2025-04-17 21:59:22,122 - INFO - Loading existing macro data...
2025-04-17 21:59:22,134 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:22,134 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:22,138 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:22,138 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:22,138 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:22,140 - INFO - Loading existing macro data...
2025-04-17 21:59:22,152 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:22,152 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:22,155 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:22,156 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:22,156 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:22,157 - INFO - Loading existing market data...
2025-04-17 21:59:22,161 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:22,162 - INFO - Loading existing market data...
2025-04-17 21:59:22,165 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:22,166 - INFO - Macro and market data loaded
2025-04-17 21:59:22,166 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:22,166 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:22,168 - INFO - Loading existing macro data...
2025-04-17 21:59:22,178 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:22,178 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:22,182 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:22,182 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:22,182 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:22,184 - INFO - Loading existing market data...
2025-04-17 21:59:22,187 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:22,204 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:22,204 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:22,204 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:22,205 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:22,206 - INFO - Loading existing macro data...
2025-04-17 21:59:22,219 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:22,219 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:22,223 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:22,224 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:22,224 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:22,225 - INFO - Loading existing market data...
2025-04-17 21:59:22,230 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:22,244 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:22,244 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:22,244 - INFO - Test data prepared
2025-04-17 21:59:22,245 - INFO - Storing data...
2025-04-17 21:59:22,245 - INFO - Aligning data indices...
2025-04-17 21:59:22,246 - INFO - Data indices aligned
2025-04-17 21:59:22,247 - INFO - Data preparation completed
2025-04-17 21:59:22,247 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:22,247 - INFO - Training models...
2025-04-17 21:59:22,248 - INFO - Starting model training...
2025-04-17 21:59:22,248 - INFO - Training regime classifier...
2025-04-17 21:59:22,248 - INFO - Training HMM model...
2025-04-17 21:59:22,510 - INFO - HMM model training completed
2025-04-17 21:59:22,713 - INFO - Model training completed
2025-04-17 21:59:22,714 - INFO - Model training completed
2025-04-17 21:59:22,715 - INFO - Initializing portfolio weights...
2025-04-17 21:59:22,715 - INFO - Portfolio weights initialized
2025-04-17 21:59:22,715 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:22,717 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:22,718 - ERROR - Error running hmm with regime_aware and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:22,720 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 5 regimes
2025-04-17 21:59:22,720 - INFO - Initializing strategy...
2025-04-17 21:59:22,720 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 21:59:22,720 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:22,720 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:59:22,721 - INFO - Running strategy...
2025-04-17 21:59:22,721 - INFO - Starting strategy execution...
2025-04-17 21:59:22,721 - INFO - Preparing training and testing data...
2025-04-17 21:59:22,721 - INFO - Starting data preparation...
2025-04-17 21:59:22,721 - INFO - Loading Fama-French factors...
2025-04-17 21:59:22,732 - INFO - Fama-French factors loaded
2025-04-17 21:59:22,732 - INFO - Processing factor data...
2025-04-17 21:59:22,735 - INFO - Factor data processed
2025-04-17 21:59:22,735 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:22,735 - INFO - 
Training Period:
2025-04-17 21:59:22,740 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:22,749 - INFO - 
Testing Period:
2025-04-17 21:59:22,756 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:22,767 - INFO - Loading macro and market data...
2025-04-17 21:59:22,769 - INFO - Loading existing macro data...
2025-04-17 21:59:22,781 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:22,781 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:22,785 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:22,786 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:22,786 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:22,788 - INFO - Loading existing macro data...
2025-04-17 21:59:22,798 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:22,799 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:22,803 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:22,803 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:22,804 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:22,805 - INFO - Loading existing market data...
2025-04-17 21:59:22,810 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:22,811 - INFO - Loading existing market data...
2025-04-17 21:59:22,815 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:22,816 - INFO - Macro and market data loaded
2025-04-17 21:59:22,816 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:22,816 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:22,817 - INFO - Loading existing macro data...
2025-04-17 21:59:22,831 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:22,832 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:22,835 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:22,835 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:22,835 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:22,837 - INFO - Loading existing market data...
2025-04-17 21:59:22,840 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:22,855 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:22,856 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:22,856 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:22,856 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:22,858 - INFO - Loading existing macro data...
2025-04-17 21:59:22,871 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:22,871 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:22,875 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:22,875 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:22,875 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:22,877 - INFO - Loading existing market data...
2025-04-17 21:59:22,882 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:22,892 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:22,892 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:22,893 - INFO - Test data prepared
2025-04-17 21:59:22,893 - INFO - Storing data...
2025-04-17 21:59:22,893 - INFO - Aligning data indices...
2025-04-17 21:59:22,895 - INFO - Data indices aligned
2025-04-17 21:59:22,895 - INFO - Data preparation completed
2025-04-17 21:59:22,896 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:22,896 - INFO - Training models...
2025-04-17 21:59:22,896 - INFO - Starting model training...
2025-04-17 21:59:22,896 - INFO - Training regime classifier...
2025-04-17 21:59:22,897 - INFO - Training HMM model...
2025-04-17 21:59:23,160 - INFO - HMM model training completed
2025-04-17 21:59:23,405 - INFO - Model training completed
2025-04-17 21:59:23,407 - INFO - Model training completed
2025-04-17 21:59:23,408 - INFO - Initializing portfolio weights...
2025-04-17 21:59:23,408 - INFO - Portfolio weights initialized
2025-04-17 21:59:23,409 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:23,410 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:23,411 - ERROR - Error running hmm with regime_aware and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:23,413 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 7 regimes
2025-04-17 21:59:23,413 - INFO - Initializing strategy...
2025-04-17 21:59:23,413 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 21:59:23,414 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:23,414 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:59:23,414 - INFO - Running strategy...
2025-04-17 21:59:23,414 - INFO - Starting strategy execution...
2025-04-17 21:59:23,414 - INFO - Preparing training and testing data...
2025-04-17 21:59:23,414 - INFO - Starting data preparation...
2025-04-17 21:59:23,415 - INFO - Loading Fama-French factors...
2025-04-17 21:59:23,429 - INFO - Fama-French factors loaded
2025-04-17 21:59:23,429 - INFO - Processing factor data...
2025-04-17 21:59:23,432 - INFO - Factor data processed
2025-04-17 21:59:23,432 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:23,433 - INFO - 
Training Period:
2025-04-17 21:59:23,438 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:23,447 - INFO - 
Testing Period:
2025-04-17 21:59:23,452 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:23,464 - INFO - Loading macro and market data...
2025-04-17 21:59:23,465 - INFO - Loading existing macro data...
2025-04-17 21:59:23,481 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:23,482 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:23,486 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:23,487 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:23,487 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:23,489 - INFO - Loading existing macro data...
2025-04-17 21:59:23,505 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:23,506 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:23,510 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:23,510 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:23,511 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:23,512 - INFO - Loading existing market data...
2025-04-17 21:59:23,517 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:23,519 - INFO - Loading existing market data...
2025-04-17 21:59:23,524 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:23,524 - INFO - Macro and market data loaded
2025-04-17 21:59:23,524 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:23,525 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:23,526 - INFO - Loading existing macro data...
2025-04-17 21:59:23,540 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:23,541 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:23,545 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:23,545 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:23,545 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:23,548 - INFO - Loading existing market data...
2025-04-17 21:59:23,552 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:23,574 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:23,574 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:23,575 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:23,575 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:23,577 - INFO - Loading existing macro data...
2025-04-17 21:59:23,595 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:23,595 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:23,600 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:23,600 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:23,600 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:23,602 - INFO - Loading existing market data...
2025-04-17 21:59:23,608 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:23,621 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:23,622 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:23,622 - INFO - Test data prepared
2025-04-17 21:59:23,622 - INFO - Storing data...
2025-04-17 21:59:23,622 - INFO - Aligning data indices...
2025-04-17 21:59:23,624 - INFO - Data indices aligned
2025-04-17 21:59:23,625 - INFO - Data preparation completed
2025-04-17 21:59:23,625 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:23,625 - INFO - Training models...
2025-04-17 21:59:23,625 - INFO - Starting model training...
2025-04-17 21:59:23,625 - INFO - Training regime classifier...
2025-04-17 21:59:23,626 - INFO - Training HMM model...
2025-04-17 21:59:23,947 - INFO - HMM model training completed
2025-04-17 21:59:24,237 - INFO - Model training completed
2025-04-17 21:59:24,240 - INFO - Model training completed
2025-04-17 21:59:24,240 - INFO - Initializing portfolio weights...
2025-04-17 21:59:24,241 - INFO - Portfolio weights initialized
2025-04-17 21:59:24,241 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:24,243 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:24,244 - ERROR - Error running hmm with regime_aware and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:24,247 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 3 regimes
2025-04-17 21:59:24,247 - INFO - Initializing strategy...
2025-04-17 21:59:24,247 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 21:59:24,248 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:24,248 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:59:24,248 - INFO - Running strategy...
2025-04-17 21:59:24,249 - INFO - Starting strategy execution...
2025-04-17 21:59:24,249 - INFO - Preparing training and testing data...
2025-04-17 21:59:24,249 - INFO - Starting data preparation...
2025-04-17 21:59:24,250 - INFO - Loading Fama-French factors...
2025-04-17 21:59:24,263 - INFO - Fama-French factors loaded
2025-04-17 21:59:24,264 - INFO - Processing factor data...
2025-04-17 21:59:24,267 - INFO - Factor data processed
2025-04-17 21:59:24,268 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:24,268 - INFO - 
Training Period:
2025-04-17 21:59:24,274 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:24,285 - INFO - 
Testing Period:
2025-04-17 21:59:24,292 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:24,302 - INFO - Loading macro and market data...
2025-04-17 21:59:24,303 - INFO - Loading existing macro data...
2025-04-17 21:59:24,320 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:24,320 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:24,327 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:24,327 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:24,328 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:24,329 - INFO - Loading existing macro data...
2025-04-17 21:59:24,347 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:24,347 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:24,351 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:24,351 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:24,352 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:24,354 - INFO - Loading existing market data...
2025-04-17 21:59:24,360 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:24,362 - INFO - Loading existing market data...
2025-04-17 21:59:24,367 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:24,368 - INFO - Macro and market data loaded
2025-04-17 21:59:24,368 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:24,369 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:24,371 - INFO - Loading existing macro data...
2025-04-17 21:59:24,385 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:24,386 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:24,390 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:24,390 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:24,390 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:24,392 - INFO - Loading existing market data...
2025-04-17 21:59:24,399 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:24,418 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:24,419 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:24,419 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:24,419 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:24,421 - INFO - Loading existing macro data...
2025-04-17 21:59:24,436 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:24,437 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:24,442 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:24,442 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:24,442 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:24,443 - INFO - Loading existing market data...
2025-04-17 21:59:24,448 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:24,462 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:24,463 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:24,463 - INFO - Test data prepared
2025-04-17 21:59:24,463 - INFO - Storing data...
2025-04-17 21:59:24,464 - INFO - Aligning data indices...
2025-04-17 21:59:24,465 - INFO - Data indices aligned
2025-04-17 21:59:24,465 - INFO - Data preparation completed
2025-04-17 21:59:24,466 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:24,466 - INFO - Training models...
2025-04-17 21:59:24,466 - INFO - Starting model training...
2025-04-17 21:59:24,467 - INFO - Training regime classifier...
2025-04-17 21:59:24,467 - INFO - Training HMM model...
2025-04-17 21:59:24,779 - INFO - HMM model training completed
2025-04-17 21:59:25,071 - INFO - Model training completed
2025-04-17 21:59:25,074 - INFO - Model training completed
2025-04-17 21:59:25,075 - INFO - Initializing portfolio weights...
2025-04-17 21:59:25,076 - INFO - Portfolio weights initialized
2025-04-17 21:59:25,076 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:25,079 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:25,079 - ERROR - Error running hmm with neural_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:25,082 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 5 regimes
2025-04-17 21:59:25,083 - INFO - Initializing strategy...
2025-04-17 21:59:25,083 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 21:59:25,084 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:25,084 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:59:25,084 - INFO - Running strategy...
2025-04-17 21:59:25,085 - INFO - Starting strategy execution...
2025-04-17 21:59:25,085 - INFO - Preparing training and testing data...
2025-04-17 21:59:25,085 - INFO - Starting data preparation...
2025-04-17 21:59:25,086 - INFO - Loading Fama-French factors...
2025-04-17 21:59:25,100 - INFO - Fama-French factors loaded
2025-04-17 21:59:25,100 - INFO - Processing factor data...
2025-04-17 21:59:25,104 - INFO - Factor data processed
2025-04-17 21:59:25,104 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:25,104 - INFO - 
Training Period:
2025-04-17 21:59:25,110 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:25,122 - INFO - 
Testing Period:
2025-04-17 21:59:25,129 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:25,139 - INFO - Loading macro and market data...
2025-04-17 21:59:25,141 - INFO - Loading existing macro data...
2025-04-17 21:59:25,156 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:25,156 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:25,161 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:25,162 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:25,162 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:25,164 - INFO - Loading existing macro data...
2025-04-17 21:59:25,179 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:25,179 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:25,184 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:25,184 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:25,185 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:25,186 - INFO - Loading existing market data...
2025-04-17 21:59:25,191 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:25,193 - INFO - Loading existing market data...
2025-04-17 21:59:25,197 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:25,197 - INFO - Macro and market data loaded
2025-04-17 21:59:25,198 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:25,198 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:25,199 - INFO - Loading existing macro data...
2025-04-17 21:59:25,212 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:25,213 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:25,218 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:25,218 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:25,219 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:25,221 - INFO - Loading existing market data...
2025-04-17 21:59:25,225 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:25,248 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:25,249 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:25,249 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:25,250 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:25,251 - INFO - Loading existing macro data...
2025-04-17 21:59:25,266 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:25,267 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:25,270 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:25,271 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:25,271 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:25,273 - INFO - Loading existing market data...
2025-04-17 21:59:25,278 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:25,291 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:25,292 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:25,292 - INFO - Test data prepared
2025-04-17 21:59:25,292 - INFO - Storing data...
2025-04-17 21:59:25,292 - INFO - Aligning data indices...
2025-04-17 21:59:25,294 - INFO - Data indices aligned
2025-04-17 21:59:25,295 - INFO - Data preparation completed
2025-04-17 21:59:25,295 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:25,295 - INFO - Training models...
2025-04-17 21:59:25,295 - INFO - Starting model training...
2025-04-17 21:59:25,296 - INFO - Training regime classifier...
2025-04-17 21:59:25,296 - INFO - Training HMM model...
2025-04-17 21:59:25,550 - WARNING - Model is not converging.  Current: 6604.339029599374 is not greater than 21507.42426409928. Delta is -14903.085234499908
2025-04-17 21:59:25,551 - INFO - HMM model training completed
2025-04-17 21:59:25,859 - INFO - Model training completed
2025-04-17 21:59:25,861 - INFO - Model training completed
2025-04-17 21:59:25,862 - INFO - Initializing portfolio weights...
2025-04-17 21:59:25,863 - INFO - Portfolio weights initialized
2025-04-17 21:59:25,863 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:25,865 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:25,866 - ERROR - Error running hmm with neural_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:25,868 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 7 regimes
2025-04-17 21:59:25,868 - INFO - Initializing strategy...
2025-04-17 21:59:25,868 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 21:59:25,869 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:25,869 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:59:25,870 - INFO - Running strategy...
2025-04-17 21:59:25,870 - INFO - Starting strategy execution...
2025-04-17 21:59:25,870 - INFO - Preparing training and testing data...
2025-04-17 21:59:25,870 - INFO - Starting data preparation...
2025-04-17 21:59:25,871 - INFO - Loading Fama-French factors...
2025-04-17 21:59:25,887 - INFO - Fama-French factors loaded
2025-04-17 21:59:25,887 - INFO - Processing factor data...
2025-04-17 21:59:25,890 - INFO - Factor data processed
2025-04-17 21:59:25,891 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:25,891 - INFO - 
Training Period:
2025-04-17 21:59:25,898 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:25,909 - INFO - 
Testing Period:
2025-04-17 21:59:25,918 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:25,934 - INFO - Loading macro and market data...
2025-04-17 21:59:25,935 - INFO - Loading existing macro data...
2025-04-17 21:59:25,948 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:25,949 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:25,953 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:25,953 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:25,954 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:25,955 - INFO - Loading existing macro data...
2025-04-17 21:59:25,969 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:25,969 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:25,973 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:25,973 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:25,974 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:25,975 - INFO - Loading existing market data...
2025-04-17 21:59:25,982 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:25,984 - INFO - Loading existing market data...
2025-04-17 21:59:25,989 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:25,989 - INFO - Macro and market data loaded
2025-04-17 21:59:25,990 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:25,990 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:25,991 - INFO - Loading existing macro data...
2025-04-17 21:59:26,008 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:26,009 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:26,014 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:26,014 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:26,015 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:26,017 - INFO - Loading existing market data...
2025-04-17 21:59:26,023 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:26,044 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:26,044 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:26,045 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:26,045 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:26,047 - INFO - Loading existing macro data...
2025-04-17 21:59:26,066 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:26,066 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:26,072 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:26,073 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:26,073 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:26,074 - INFO - Loading existing market data...
2025-04-17 21:59:26,079 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:26,094 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:26,094 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:26,095 - INFO - Test data prepared
2025-04-17 21:59:26,095 - INFO - Storing data...
2025-04-17 21:59:26,095 - INFO - Aligning data indices...
2025-04-17 21:59:26,097 - INFO - Data indices aligned
2025-04-17 21:59:26,097 - INFO - Data preparation completed
2025-04-17 21:59:26,097 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:26,098 - INFO - Training models...
2025-04-17 21:59:26,098 - INFO - Starting model training...
2025-04-17 21:59:26,098 - INFO - Training regime classifier...
2025-04-17 21:59:26,098 - INFO - Training HMM model...
2025-04-17 21:59:26,348 - WARNING - Model is not converging.  Current: 6604.339029588307 is not greater than 21507.424265055313. Delta is -14903.085235467006
2025-04-17 21:59:26,349 - INFO - HMM model training completed
2025-04-17 21:59:26,663 - INFO - Model training completed
2025-04-17 21:59:26,666 - INFO - Model training completed
2025-04-17 21:59:26,666 - INFO - Initializing portfolio weights...
2025-04-17 21:59:26,667 - INFO - Portfolio weights initialized
2025-04-17 21:59:26,667 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:26,669 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:26,670 - ERROR - Error running hmm with neural_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:26,672 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 21:59:26,672 - INFO - Initializing strategy...
2025-04-17 21:59:26,672 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 21:59:26,673 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:26,673 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:59:26,674 - INFO - Running strategy...
2025-04-17 21:59:26,674 - INFO - Starting strategy execution...
2025-04-17 21:59:26,674 - INFO - Preparing training and testing data...
2025-04-17 21:59:26,674 - INFO - Starting data preparation...
2025-04-17 21:59:26,675 - INFO - Loading Fama-French factors...
2025-04-17 21:59:26,693 - INFO - Fama-French factors loaded
2025-04-17 21:59:26,693 - INFO - Processing factor data...
2025-04-17 21:59:26,696 - INFO - Factor data processed
2025-04-17 21:59:26,696 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:26,697 - INFO - 
Training Period:
2025-04-17 21:59:26,704 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:26,716 - INFO - 
Testing Period:
2025-04-17 21:59:26,721 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:26,732 - INFO - Loading macro and market data...
2025-04-17 21:59:26,734 - INFO - Loading existing macro data...
2025-04-17 21:59:26,748 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:26,749 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:26,753 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:26,754 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:26,754 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:26,756 - INFO - Loading existing macro data...
2025-04-17 21:59:26,773 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:26,773 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:26,777 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:26,777 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:26,778 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:26,780 - INFO - Loading existing market data...
2025-04-17 21:59:26,785 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:26,786 - INFO - Loading existing market data...
2025-04-17 21:59:26,791 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:26,792 - INFO - Macro and market data loaded
2025-04-17 21:59:26,792 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:26,792 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:26,794 - INFO - Loading existing macro data...
2025-04-17 21:59:26,807 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:26,808 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:26,812 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:26,812 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:26,813 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:26,814 - INFO - Loading existing market data...
2025-04-17 21:59:26,819 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:26,841 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:26,842 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:26,842 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:26,842 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:26,844 - INFO - Loading existing macro data...
2025-04-17 21:59:26,863 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:26,864 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:26,869 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:26,869 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:26,870 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:26,871 - INFO - Loading existing market data...
2025-04-17 21:59:26,876 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:26,889 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:26,890 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:26,890 - INFO - Test data prepared
2025-04-17 21:59:26,891 - INFO - Storing data...
2025-04-17 21:59:26,891 - INFO - Aligning data indices...
2025-04-17 21:59:26,893 - INFO - Data indices aligned
2025-04-17 21:59:26,893 - INFO - Data preparation completed
2025-04-17 21:59:26,893 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:26,893 - INFO - Training models...
2025-04-17 21:59:26,893 - INFO - Starting model training...
2025-04-17 21:59:26,894 - INFO - Training regime classifier...
2025-04-17 21:59:26,894 - INFO - Training HMM model...
2025-04-17 21:59:27,193 - INFO - HMM model training completed
2025-04-17 21:59:27,490 - INFO - Model training completed
2025-04-17 21:59:27,492 - INFO - Model training completed
2025-04-17 21:59:27,492 - INFO - Initializing portfolio weights...
2025-04-17 21:59:27,493 - INFO - Portfolio weights initialized
2025-04-17 21:59:27,494 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:27,496 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:27,497 - ERROR - Error running hmm with autoencoder_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:27,499 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 21:59:27,499 - INFO - Initializing strategy...
2025-04-17 21:59:27,500 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 21:59:27,500 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:27,501 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:59:27,501 - INFO - Running strategy...
2025-04-17 21:59:27,501 - INFO - Starting strategy execution...
2025-04-17 21:59:27,502 - INFO - Preparing training and testing data...
2025-04-17 21:59:27,502 - INFO - Starting data preparation...
2025-04-17 21:59:27,502 - INFO - Loading Fama-French factors...
2025-04-17 21:59:27,518 - INFO - Fama-French factors loaded
2025-04-17 21:59:27,518 - INFO - Processing factor data...
2025-04-17 21:59:27,521 - INFO - Factor data processed
2025-04-17 21:59:27,521 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:27,522 - INFO - 
Training Period:
2025-04-17 21:59:27,528 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:27,540 - INFO - 
Testing Period:
2025-04-17 21:59:27,548 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:27,562 - INFO - Loading macro and market data...
2025-04-17 21:59:27,564 - INFO - Loading existing macro data...
2025-04-17 21:59:27,580 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:27,581 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:27,586 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:27,586 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:27,587 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:27,588 - INFO - Loading existing macro data...
2025-04-17 21:59:27,601 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:27,602 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:27,606 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:27,607 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:27,607 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:27,609 - INFO - Loading existing market data...
2025-04-17 21:59:27,615 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:27,616 - INFO - Loading existing market data...
2025-04-17 21:59:27,621 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:27,621 - INFO - Macro and market data loaded
2025-04-17 21:59:27,622 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:27,622 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:27,623 - INFO - Loading existing macro data...
2025-04-17 21:59:27,637 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:27,637 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:27,642 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:27,642 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:27,643 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:27,645 - INFO - Loading existing market data...
2025-04-17 21:59:27,651 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:27,672 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:27,672 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:27,672 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:27,673 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:27,675 - INFO - Loading existing macro data...
2025-04-17 21:59:27,692 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:27,692 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:27,697 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:27,698 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:27,698 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:27,700 - INFO - Loading existing market data...
2025-04-17 21:59:27,705 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:27,718 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:27,719 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:27,719 - INFO - Test data prepared
2025-04-17 21:59:27,719 - INFO - Storing data...
2025-04-17 21:59:27,720 - INFO - Aligning data indices...
2025-04-17 21:59:27,721 - INFO - Data indices aligned
2025-04-17 21:59:27,721 - INFO - Data preparation completed
2025-04-17 21:59:27,721 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:27,722 - INFO - Training models...
2025-04-17 21:59:27,722 - INFO - Starting model training...
2025-04-17 21:59:27,722 - INFO - Training regime classifier...
2025-04-17 21:59:27,722 - INFO - Training HMM model...
2025-04-17 21:59:28,032 - INFO - HMM model training completed
2025-04-17 21:59:28,338 - INFO - Model training completed
2025-04-17 21:59:28,340 - INFO - Model training completed
2025-04-17 21:59:28,340 - INFO - Initializing portfolio weights...
2025-04-17 21:59:28,341 - INFO - Portfolio weights initialized
2025-04-17 21:59:28,342 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:28,345 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:28,346 - ERROR - Error running hmm with autoencoder_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:28,348 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 21:59:28,348 - INFO - Initializing strategy...
2025-04-17 21:59:28,348 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 21:59:28,349 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:28,349 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:59:28,349 - INFO - Running strategy...
2025-04-17 21:59:28,349 - INFO - Starting strategy execution...
2025-04-17 21:59:28,350 - INFO - Preparing training and testing data...
2025-04-17 21:59:28,350 - INFO - Starting data preparation...
2025-04-17 21:59:28,350 - INFO - Loading Fama-French factors...
2025-04-17 21:59:28,366 - INFO - Fama-French factors loaded
2025-04-17 21:59:28,366 - INFO - Processing factor data...
2025-04-17 21:59:28,371 - INFO - Factor data processed
2025-04-17 21:59:28,371 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:28,371 - INFO - 
Training Period:
2025-04-17 21:59:28,377 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:28,389 - INFO - 
Testing Period:
2025-04-17 21:59:28,399 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:28,410 - INFO - Loading macro and market data...
2025-04-17 21:59:28,412 - INFO - Loading existing macro data...
2025-04-17 21:59:28,429 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:28,430 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:28,435 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:28,435 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:28,435 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:28,437 - INFO - Loading existing macro data...
2025-04-17 21:59:28,456 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:28,457 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:28,461 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:28,462 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:28,462 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:28,464 - INFO - Loading existing market data...
2025-04-17 21:59:28,471 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:28,472 - INFO - Loading existing market data...
2025-04-17 21:59:28,476 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:28,476 - INFO - Macro and market data loaded
2025-04-17 21:59:28,477 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:28,477 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:28,478 - INFO - Loading existing macro data...
2025-04-17 21:59:28,492 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:28,493 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:28,496 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:28,497 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:28,497 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:28,498 - INFO - Loading existing market data...
2025-04-17 21:59:28,503 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:28,523 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:28,524 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:28,524 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:28,524 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:28,526 - INFO - Loading existing macro data...
2025-04-17 21:59:28,542 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:28,543 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:28,547 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:28,548 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:28,548 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:28,549 - INFO - Loading existing market data...
2025-04-17 21:59:28,554 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:28,568 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:28,568 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:28,568 - INFO - Test data prepared
2025-04-17 21:59:28,569 - INFO - Storing data...
2025-04-17 21:59:28,569 - INFO - Aligning data indices...
2025-04-17 21:59:28,571 - INFO - Data indices aligned
2025-04-17 21:59:28,571 - INFO - Data preparation completed
2025-04-17 21:59:28,572 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:28,572 - INFO - Training models...
2025-04-17 21:59:28,572 - INFO - Starting model training...
2025-04-17 21:59:28,572 - INFO - Training regime classifier...
2025-04-17 21:59:28,573 - INFO - Training HMM model...
2025-04-17 21:59:28,881 - INFO - HMM model training completed
2025-04-17 21:59:29,201 - INFO - Model training completed
2025-04-17 21:59:29,203 - INFO - Model training completed
2025-04-17 21:59:29,204 - INFO - Initializing portfolio weights...
2025-04-17 21:59:29,204 - INFO - Portfolio weights initialized
2025-04-17 21:59:29,205 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:29,206 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:29,207 - ERROR - Error running hmm with autoencoder_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:29,210 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 3 regimes
2025-04-17 21:59:29,210 - INFO - Initializing strategy...
2025-04-17 21:59:29,211 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 21:59:29,211 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:29,212 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:59:29,213 - INFO - Running strategy...
2025-04-17 21:59:29,213 - INFO - Starting strategy execution...
2025-04-17 21:59:29,213 - INFO - Preparing training and testing data...
2025-04-17 21:59:29,214 - INFO - Starting data preparation...
2025-04-17 21:59:29,214 - INFO - Loading Fama-French factors...
2025-04-17 21:59:29,228 - INFO - Fama-French factors loaded
2025-04-17 21:59:29,229 - INFO - Processing factor data...
2025-04-17 21:59:29,232 - INFO - Factor data processed
2025-04-17 21:59:29,233 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:29,233 - INFO - 
Training Period:
2025-04-17 21:59:29,239 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:29,251 - INFO - 
Testing Period:
2025-04-17 21:59:29,257 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:29,267 - INFO - Loading macro and market data...
2025-04-17 21:59:29,268 - INFO - Loading existing macro data...
2025-04-17 21:59:29,284 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:29,285 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:29,290 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:29,291 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:29,291 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:29,293 - INFO - Loading existing macro data...
2025-04-17 21:59:29,306 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:29,307 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:29,311 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:29,311 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:29,312 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:29,313 - INFO - Loading existing market data...
2025-04-17 21:59:29,319 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:29,320 - INFO - Loading existing market data...
2025-04-17 21:59:29,325 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:29,325 - INFO - Macro and market data loaded
2025-04-17 21:59:29,325 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:29,326 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:29,327 - INFO - Loading existing macro data...
2025-04-17 21:59:29,343 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:29,343 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:29,348 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:29,348 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:29,348 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:29,350 - INFO - Loading existing market data...
2025-04-17 21:59:29,357 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:29,378 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:29,378 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:29,378 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:29,379 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:29,380 - INFO - Loading existing macro data...
2025-04-17 21:59:29,396 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:29,397 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:29,402 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:29,402 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:29,402 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:29,404 - INFO - Loading existing market data...
2025-04-17 21:59:29,409 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:29,422 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:29,423 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:29,423 - INFO - Test data prepared
2025-04-17 21:59:29,424 - INFO - Storing data...
2025-04-17 21:59:29,424 - INFO - Aligning data indices...
2025-04-17 21:59:29,426 - INFO - Data indices aligned
2025-04-17 21:59:29,427 - INFO - Updated neural optimizer input size to 8
2025-04-17 21:59:29,427 - INFO - Data preparation completed
2025-04-17 21:59:29,427 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:29,428 - INFO - Training models...
2025-04-17 21:59:29,428 - INFO - Starting model training...
2025-04-17 21:59:29,428 - INFO - Training regime classifier...
2025-04-17 21:59:29,428 - INFO - Training HMM model...
2025-04-17 21:59:29,739 - INFO - HMM model training completed
2025-04-17 21:59:30,052 - INFO - Training neural portfolio optimizer...
2025-04-17 21:59:30,053 - INFO - Neural portfolio optimizer training completed
2025-04-17 21:59:30,053 - INFO - Model training completed
2025-04-17 21:59:30,055 - INFO - Model training completed
2025-04-17 21:59:30,055 - INFO - Initializing portfolio weights...
2025-04-17 21:59:30,056 - INFO - Portfolio weights initialized
2025-04-17 21:59:30,057 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:30,059 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:30,060 - ERROR - Error running hmm with neural and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:30,063 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 5 regimes
2025-04-17 21:59:30,063 - INFO - Initializing strategy...
2025-04-17 21:59:30,064 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 21:59:30,064 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:30,064 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:59:30,065 - INFO - Running strategy...
2025-04-17 21:59:30,066 - INFO - Starting strategy execution...
2025-04-17 21:59:30,066 - INFO - Preparing training and testing data...
2025-04-17 21:59:30,066 - INFO - Starting data preparation...
2025-04-17 21:59:30,067 - INFO - Loading Fama-French factors...
2025-04-17 21:59:30,085 - INFO - Fama-French factors loaded
2025-04-17 21:59:30,086 - INFO - Processing factor data...
2025-04-17 21:59:30,090 - INFO - Factor data processed
2025-04-17 21:59:30,090 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:30,090 - INFO - 
Training Period:
2025-04-17 21:59:30,097 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:30,109 - INFO - 
Testing Period:
2025-04-17 21:59:30,119 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:30,131 - INFO - Loading macro and market data...
2025-04-17 21:59:30,133 - INFO - Loading existing macro data...
2025-04-17 21:59:30,150 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:30,151 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:30,157 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:30,157 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:30,158 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:30,160 - INFO - Loading existing macro data...
2025-04-17 21:59:30,178 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:30,178 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:30,183 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:30,184 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:30,184 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:30,185 - INFO - Loading existing market data...
2025-04-17 21:59:30,190 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:30,192 - INFO - Loading existing market data...
2025-04-17 21:59:30,197 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:30,198 - INFO - Macro and market data loaded
2025-04-17 21:59:30,198 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:30,199 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:30,201 - INFO - Loading existing macro data...
2025-04-17 21:59:30,215 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:30,215 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:30,219 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:30,219 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:30,220 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:30,222 - INFO - Loading existing market data...
2025-04-17 21:59:30,227 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:30,248 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:30,248 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:30,249 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:30,249 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:30,251 - INFO - Loading existing macro data...
2025-04-17 21:59:30,268 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:30,268 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:30,272 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:30,273 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:30,273 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:30,275 - INFO - Loading existing market data...
2025-04-17 21:59:30,280 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:30,294 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:30,295 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:30,295 - INFO - Test data prepared
2025-04-17 21:59:30,296 - INFO - Storing data...
2025-04-17 21:59:30,296 - INFO - Aligning data indices...
2025-04-17 21:59:30,298 - INFO - Data indices aligned
2025-04-17 21:59:30,298 - INFO - Updated neural optimizer input size to 8
2025-04-17 21:59:30,299 - INFO - Data preparation completed
2025-04-17 21:59:30,299 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:30,299 - INFO - Training models...
2025-04-17 21:59:30,299 - INFO - Starting model training...
2025-04-17 21:59:30,299 - INFO - Training regime classifier...
2025-04-17 21:59:30,300 - INFO - Training HMM model...
2025-04-17 21:59:30,605 - INFO - HMM model training completed
2025-04-17 21:59:30,916 - INFO - Training neural portfolio optimizer...
2025-04-17 21:59:30,917 - INFO - Neural portfolio optimizer training completed
2025-04-17 21:59:30,917 - INFO - Model training completed
2025-04-17 21:59:30,919 - INFO - Model training completed
2025-04-17 21:59:30,919 - INFO - Initializing portfolio weights...
2025-04-17 21:59:30,920 - INFO - Portfolio weights initialized
2025-04-17 21:59:30,921 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:30,923 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:30,924 - ERROR - Error running hmm with neural and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:30,927 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 7 regimes
2025-04-17 21:59:30,927 - INFO - Initializing strategy...
2025-04-17 21:59:30,927 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 21:59:30,928 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 21:59:30,928 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 21:59:30,929 - INFO - Running strategy...
2025-04-17 21:59:30,930 - INFO - Starting strategy execution...
2025-04-17 21:59:30,930 - INFO - Preparing training and testing data...
2025-04-17 21:59:30,930 - INFO - Starting data preparation...
2025-04-17 21:59:30,930 - INFO - Loading Fama-French factors...
2025-04-17 21:59:30,950 - INFO - Fama-French factors loaded
2025-04-17 21:59:30,950 - INFO - Processing factor data...
2025-04-17 21:59:30,954 - INFO - Factor data processed
2025-04-17 21:59:30,954 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 21:59:30,954 - INFO - 
Training Period:
2025-04-17 21:59:30,963 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 21:59:30,974 - INFO - 
Testing Period:
2025-04-17 21:59:30,981 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 21:59:30,991 - INFO - Loading macro and market data...
2025-04-17 21:59:30,993 - INFO - Loading existing macro data...
2025-04-17 21:59:31,008 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:31,008 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:31,012 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:31,013 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:31,013 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:31,015 - INFO - Loading existing macro data...
2025-04-17 21:59:31,030 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:31,031 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:31,035 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:31,035 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:31,036 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:31,037 - INFO - Loading existing market data...
2025-04-17 21:59:31,043 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:31,045 - INFO - Loading existing market data...
2025-04-17 21:59:31,048 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:31,049 - INFO - Macro and market data loaded
2025-04-17 21:59:31,049 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:31,049 - INFO - Preparing training data for regime classification...
2025-04-17 21:59:31,051 - INFO - Loading existing macro data...
2025-04-17 21:59:31,064 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:31,064 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:31,069 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:31,069 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 21:59:31,070 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 21:59:31,071 - INFO - Loading existing market data...
2025-04-17 21:59:31,075 - INFO - Loaded existing market data with 1509 rows
2025-04-17 21:59:31,100 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 21:59:31,100 - INFO - Prepared training data with 1536 samples
2025-04-17 21:59:31,101 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:31,101 - INFO - Preparing test data for regime classification...
2025-04-17 21:59:31,103 - INFO - Loading existing macro data...
2025-04-17 21:59:31,121 - WARNING - US corporate credit spread file not found
2025-04-17 21:59:31,121 - WARNING - 10-year Treasury rate file not found
2025-04-17 21:59:31,125 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 21:59:31,125 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 21:59:31,126 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 21:59:31,127 - INFO - Loading existing market data...
2025-04-17 21:59:31,132 - INFO - Loaded existing market data with 1257 rows
2025-04-17 21:59:31,146 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 21:59:31,146 - INFO - Prepared test data with 1276 samples
2025-04-17 21:59:31,147 - INFO - Test data prepared
2025-04-17 21:59:31,147 - INFO - Storing data...
2025-04-17 21:59:31,147 - INFO - Aligning data indices...
2025-04-17 21:59:31,149 - INFO - Data indices aligned
2025-04-17 21:59:31,150 - INFO - Updated neural optimizer input size to 8
2025-04-17 21:59:31,150 - INFO - Data preparation completed
2025-04-17 21:59:31,150 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 21:59:31,151 - INFO - Training models...
2025-04-17 21:59:31,151 - INFO - Starting model training...
2025-04-17 21:59:31,151 - INFO - Training regime classifier...
2025-04-17 21:59:31,151 - INFO - Training HMM model...
2025-04-17 21:59:31,457 - INFO - HMM model training completed
2025-04-17 21:59:31,749 - INFO - Training neural portfolio optimizer...
2025-04-17 21:59:31,749 - INFO - Neural portfolio optimizer training completed
2025-04-17 21:59:31,749 - INFO - Model training completed
2025-04-17 21:59:31,751 - INFO - Model training completed
2025-04-17 21:59:31,752 - INFO - Initializing portfolio weights...
2025-04-17 21:59:31,753 - INFO - Portfolio weights initialized
2025-04-17 21:59:31,753 - INFO - Generating regime predictions for test period...
2025-04-17 21:59:31,755 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 21:59:31,756 - ERROR - Error running hmm with neural and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 21:59:31,758 - ERROR - No valid results obtained from parameter grid search
2025-04-17 21:59:31,759 - ERROR - No valid results obtained from parameter grid search
2025-04-17 21:59:31,759 - INFO - Factor timing strategy optimization completed
2025-04-17 22:18:48,118 - INFO - Starting factor timing strategy optimization...
2025-04-17 22:18:48,118 - INFO - Running parameter grid search...
2025-04-17 22:18:48,119 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 3 regimes
2025-04-17 22:18:48,119 - INFO - Initializing strategy...
2025-04-17 22:18:48,119 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 22:18:48,119 - ERROR - Error running lstm with mean_variance and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:18:48,121 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 5 regimes
2025-04-17 22:18:48,121 - INFO - Initializing strategy...
2025-04-17 22:18:48,121 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 22:18:48,122 - ERROR - Error running lstm with mean_variance and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:18:48,123 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 7 regimes
2025-04-17 22:18:48,123 - INFO - Initializing strategy...
2025-04-17 22:18:48,124 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 22:18:48,124 - ERROR - Error running lstm with mean_variance and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:18:48,125 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 3 regimes
2025-04-17 22:18:48,125 - INFO - Initializing strategy...
2025-04-17 22:18:48,125 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 22:18:48,126 - ERROR - Error running lstm with regime_aware and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:18:48,127 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 5 regimes
2025-04-17 22:18:48,127 - INFO - Initializing strategy...
2025-04-17 22:18:48,127 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 22:18:48,128 - ERROR - Error running lstm with regime_aware and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:18:48,129 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 7 regimes
2025-04-17 22:18:48,129 - INFO - Initializing strategy...
2025-04-17 22:18:48,129 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 22:18:48,130 - ERROR - Error running lstm with regime_aware and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:18:48,131 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 3 regimes
2025-04-17 22:18:48,131 - INFO - Initializing strategy...
2025-04-17 22:18:48,132 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 22:18:48,132 - ERROR - Error running lstm with neural_regime and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:18:48,134 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 5 regimes
2025-04-17 22:18:48,134 - INFO - Initializing strategy...
2025-04-17 22:18:48,134 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 22:18:48,134 - ERROR - Error running lstm with neural_regime and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:18:48,135 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 7 regimes
2025-04-17 22:18:48,136 - INFO - Initializing strategy...
2025-04-17 22:18:48,136 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 22:18:48,136 - ERROR - Error running lstm with neural_regime and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:18:48,137 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 22:18:48,138 - INFO - Initializing strategy...
2025-04-17 22:18:48,138 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 22:18:48,138 - ERROR - Error running lstm with autoencoder_regime and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:18:48,139 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 22:18:48,140 - INFO - Initializing strategy...
2025-04-17 22:18:48,140 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 22:18:48,140 - ERROR - Error running lstm with autoencoder_regime and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:18:48,142 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 22:18:48,142 - INFO - Initializing strategy...
2025-04-17 22:18:48,142 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 22:18:48,143 - ERROR - Error running lstm with autoencoder_regime and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:18:48,144 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 3 regimes
2025-04-17 22:18:48,144 - INFO - Initializing strategy...
2025-04-17 22:18:48,144 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 22:18:48,144 - ERROR - Error running lstm with neural and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:18:48,145 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 5 regimes
2025-04-17 22:18:48,146 - INFO - Initializing strategy...
2025-04-17 22:18:48,146 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 22:18:48,146 - ERROR - Error running lstm with neural and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:18:48,147 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 7 regimes
2025-04-17 22:18:48,147 - INFO - Initializing strategy...
2025-04-17 22:18:48,147 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 22:18:48,147 - ERROR - Error running lstm with neural and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:18:48,148 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 3 regimes
2025-04-17 22:18:48,149 - INFO - Initializing strategy...
2025-04-17 22:18:48,149 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 22:18:48,149 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:18:48,183 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:18:48,183 - INFO - Running strategy...
2025-04-17 22:18:48,184 - INFO - Starting strategy execution...
2025-04-17 22:18:48,184 - INFO - Preparing training and testing data...
2025-04-17 22:18:48,184 - INFO - Starting data preparation...
2025-04-17 22:18:48,184 - INFO - Loading Fama-French factors...
2025-04-17 22:18:48,204 - INFO - Fama-French factors loaded
2025-04-17 22:18:48,204 - INFO - Processing factor data...
2025-04-17 22:18:48,209 - INFO - Factor data processed
2025-04-17 22:18:48,209 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:18:48,209 - INFO - 
Training Period:
2025-04-17 22:18:48,217 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:18:48,230 - INFO - 
Testing Period:
2025-04-17 22:18:48,236 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:18:48,248 - INFO - Loading macro and market data...
2025-04-17 22:18:48,249 - INFO - Loading existing macro data...
2025-04-17 22:18:48,268 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:48,269 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:48,275 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:48,276 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:48,276 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:48,278 - INFO - Loading existing macro data...
2025-04-17 22:18:48,293 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:48,294 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:48,298 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:48,299 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:48,300 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:48,301 - INFO - Loading existing market data...
2025-04-17 22:18:48,308 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:48,310 - INFO - Loading existing market data...
2025-04-17 22:18:48,314 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:48,315 - INFO - Macro and market data loaded
2025-04-17 22:18:48,315 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:48,315 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:48,316 - INFO - Loading existing macro data...
2025-04-17 22:18:48,332 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:48,333 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:48,337 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:48,338 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:48,338 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:48,340 - INFO - Loading existing market data...
2025-04-17 22:18:48,344 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:48,576 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:18:48,576 - INFO - Prepared training data with 1536 samples
2025-04-17 22:18:48,577 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:48,577 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:48,579 - INFO - Loading existing macro data...
2025-04-17 22:18:48,600 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:48,600 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:48,606 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:48,606 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:48,607 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:48,609 - INFO - Loading existing market data...
2025-04-17 22:18:48,616 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:48,629 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:18:48,630 - INFO - Prepared test data with 1276 samples
2025-04-17 22:18:48,630 - INFO - Test data prepared
2025-04-17 22:18:48,630 - INFO - Storing data...
2025-04-17 22:18:48,631 - INFO - Aligning data indices...
2025-04-17 22:18:48,633 - INFO - Data indices aligned
2025-04-17 22:18:48,633 - INFO - Data preparation completed
2025-04-17 22:18:48,634 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:18:48,634 - INFO - Training models...
2025-04-17 22:18:48,635 - INFO - Starting model training...
2025-04-17 22:18:48,635 - INFO - Training regime classifier...
2025-04-17 22:18:48,635 - INFO - Training XGBoost model...
2025-04-17 22:18:48,636 - INFO - Preparing features...
2025-04-17 22:18:48,636 - INFO - Input shape: (1536, 8)
2025-04-17 22:18:48,637 - INFO - Handling missing values...
2025-04-17 22:18:48,639 - INFO - Missing values: 0 -> 0
2025-04-17 22:18:48,639 - INFO - Scaling features...
2025-04-17 22:18:48,641 - INFO - Fitted new scaler
2025-04-17 22:18:48,642 - INFO - Output shape: (1536, 8)
2025-04-17 22:18:49,518 - INFO - XGBoost model training completed
2025-04-17 22:18:49,991 - INFO - Model training completed
2025-04-17 22:18:49,994 - INFO - Model training completed
2025-04-17 22:18:49,994 - INFO - Initializing portfolio weights...
2025-04-17 22:18:49,995 - INFO - Portfolio weights initialized
2025-04-17 22:18:49,996 - INFO - Generating regime predictions for test period...
2025-04-17 22:18:49,998 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:18:49,999 - ERROR - Error running xgboost with mean_variance and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:18:50,003 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 5 regimes
2025-04-17 22:18:50,003 - INFO - Initializing strategy...
2025-04-17 22:18:50,003 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 22:18:50,004 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:18:50,004 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:18:50,005 - INFO - Running strategy...
2025-04-17 22:18:50,005 - INFO - Starting strategy execution...
2025-04-17 22:18:50,006 - INFO - Preparing training and testing data...
2025-04-17 22:18:50,006 - INFO - Starting data preparation...
2025-04-17 22:18:50,006 - INFO - Loading Fama-French factors...
2025-04-17 22:18:50,021 - INFO - Fama-French factors loaded
2025-04-17 22:18:50,021 - INFO - Processing factor data...
2025-04-17 22:18:50,024 - INFO - Factor data processed
2025-04-17 22:18:50,025 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:18:50,025 - INFO - 
Training Period:
2025-04-17 22:18:50,031 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:18:50,041 - INFO - 
Testing Period:
2025-04-17 22:18:50,047 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:18:50,057 - INFO - Loading macro and market data...
2025-04-17 22:18:50,059 - INFO - Loading existing macro data...
2025-04-17 22:18:50,072 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:50,073 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:50,077 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:50,077 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:50,078 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:50,079 - INFO - Loading existing macro data...
2025-04-17 22:18:50,093 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:50,093 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:50,097 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:50,098 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:50,098 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:50,100 - INFO - Loading existing market data...
2025-04-17 22:18:50,104 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:50,106 - INFO - Loading existing market data...
2025-04-17 22:18:50,109 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:50,110 - INFO - Macro and market data loaded
2025-04-17 22:18:50,110 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:50,110 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:50,111 - INFO - Loading existing macro data...
2025-04-17 22:18:50,125 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:50,126 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:50,129 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:50,130 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:50,130 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:50,132 - INFO - Loading existing market data...
2025-04-17 22:18:50,138 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:50,160 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:18:50,163 - INFO - Prepared training data with 1536 samples
2025-04-17 22:18:50,164 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:50,164 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:50,166 - INFO - Loading existing macro data...
2025-04-17 22:18:50,189 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:50,190 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:50,195 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:50,196 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:50,196 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:50,206 - INFO - Loading existing market data...
2025-04-17 22:18:50,222 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:50,238 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:18:50,239 - INFO - Prepared test data with 1276 samples
2025-04-17 22:18:50,239 - INFO - Test data prepared
2025-04-17 22:18:50,241 - INFO - Storing data...
2025-04-17 22:18:50,242 - INFO - Aligning data indices...
2025-04-17 22:18:50,244 - INFO - Data indices aligned
2025-04-17 22:18:50,244 - INFO - Data preparation completed
2025-04-17 22:18:50,244 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:18:50,245 - INFO - Training models...
2025-04-17 22:18:50,245 - INFO - Starting model training...
2025-04-17 22:18:50,245 - INFO - Training regime classifier...
2025-04-17 22:18:50,245 - INFO - Training XGBoost model...
2025-04-17 22:18:50,246 - INFO - Preparing features...
2025-04-17 22:18:50,246 - INFO - Input shape: (1536, 8)
2025-04-17 22:18:50,247 - INFO - Handling missing values...
2025-04-17 22:18:50,249 - INFO - Missing values: 0 -> 0
2025-04-17 22:18:50,267 - INFO - Scaling features...
2025-04-17 22:18:50,275 - INFO - Fitted new scaler
2025-04-17 22:18:50,277 - INFO - Output shape: (1536, 8)
2025-04-17 22:18:50,526 - INFO - XGBoost model training completed
2025-04-17 22:18:51,038 - INFO - Model training completed
2025-04-17 22:18:51,041 - INFO - Model training completed
2025-04-17 22:18:51,041 - INFO - Initializing portfolio weights...
2025-04-17 22:18:51,042 - INFO - Portfolio weights initialized
2025-04-17 22:18:51,042 - INFO - Generating regime predictions for test period...
2025-04-17 22:18:51,044 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:18:51,045 - ERROR - Error running xgboost with mean_variance and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:18:51,047 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 7 regimes
2025-04-17 22:18:51,048 - INFO - Initializing strategy...
2025-04-17 22:18:51,048 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 22:18:51,048 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:18:51,049 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:18:51,049 - INFO - Running strategy...
2025-04-17 22:18:51,049 - INFO - Starting strategy execution...
2025-04-17 22:18:51,050 - INFO - Preparing training and testing data...
2025-04-17 22:18:51,050 - INFO - Starting data preparation...
2025-04-17 22:18:51,050 - INFO - Loading Fama-French factors...
2025-04-17 22:18:51,064 - INFO - Fama-French factors loaded
2025-04-17 22:18:51,064 - INFO - Processing factor data...
2025-04-17 22:18:51,068 - INFO - Factor data processed
2025-04-17 22:18:51,069 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:18:51,069 - INFO - 
Training Period:
2025-04-17 22:18:51,077 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:18:51,089 - INFO - 
Testing Period:
2025-04-17 22:18:51,097 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:18:51,109 - INFO - Loading macro and market data...
2025-04-17 22:18:51,111 - INFO - Loading existing macro data...
2025-04-17 22:18:51,125 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:51,126 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:51,131 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:51,131 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:51,132 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:51,133 - INFO - Loading existing macro data...
2025-04-17 22:18:51,148 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:51,149 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:51,154 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:51,154 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:51,155 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:51,156 - INFO - Loading existing market data...
2025-04-17 22:18:51,162 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:51,164 - INFO - Loading existing market data...
2025-04-17 22:18:51,169 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:51,169 - INFO - Macro and market data loaded
2025-04-17 22:18:51,170 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:51,170 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:51,172 - INFO - Loading existing macro data...
2025-04-17 22:18:51,187 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:51,188 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:51,192 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:51,193 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:51,193 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:51,195 - INFO - Loading existing market data...
2025-04-17 22:18:51,200 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:51,225 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:18:51,225 - INFO - Prepared training data with 1536 samples
2025-04-17 22:18:51,226 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:51,226 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:51,228 - INFO - Loading existing macro data...
2025-04-17 22:18:51,246 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:51,246 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:51,251 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:51,252 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:51,252 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:51,254 - INFO - Loading existing market data...
2025-04-17 22:18:51,259 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:51,272 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:18:51,272 - INFO - Prepared test data with 1276 samples
2025-04-17 22:18:51,273 - INFO - Test data prepared
2025-04-17 22:18:51,273 - INFO - Storing data...
2025-04-17 22:18:51,273 - INFO - Aligning data indices...
2025-04-17 22:18:51,275 - INFO - Data indices aligned
2025-04-17 22:18:51,276 - INFO - Data preparation completed
2025-04-17 22:18:51,276 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:18:51,276 - INFO - Training models...
2025-04-17 22:18:51,276 - INFO - Starting model training...
2025-04-17 22:18:51,277 - INFO - Training regime classifier...
2025-04-17 22:18:51,277 - INFO - Training XGBoost model...
2025-04-17 22:18:51,277 - INFO - Preparing features...
2025-04-17 22:18:51,278 - INFO - Input shape: (1536, 8)
2025-04-17 22:18:51,278 - INFO - Handling missing values...
2025-04-17 22:18:51,279 - INFO - Missing values: 0 -> 0
2025-04-17 22:18:51,279 - INFO - Scaling features...
2025-04-17 22:18:51,281 - INFO - Fitted new scaler
2025-04-17 22:18:51,282 - INFO - Output shape: (1536, 8)
2025-04-17 22:18:51,443 - INFO - XGBoost model training completed
2025-04-17 22:18:51,775 - INFO - Model training completed
2025-04-17 22:18:51,778 - INFO - Model training completed
2025-04-17 22:18:51,778 - INFO - Initializing portfolio weights...
2025-04-17 22:18:51,779 - INFO - Portfolio weights initialized
2025-04-17 22:18:51,780 - INFO - Generating regime predictions for test period...
2025-04-17 22:18:51,781 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:18:51,782 - ERROR - Error running xgboost with mean_variance and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:18:51,784 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 3 regimes
2025-04-17 22:18:51,784 - INFO - Initializing strategy...
2025-04-17 22:18:51,784 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 22:18:51,785 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:18:51,785 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:18:51,786 - INFO - Running strategy...
2025-04-17 22:18:51,786 - INFO - Starting strategy execution...
2025-04-17 22:18:51,787 - INFO - Preparing training and testing data...
2025-04-17 22:18:51,787 - INFO - Starting data preparation...
2025-04-17 22:18:51,787 - INFO - Loading Fama-French factors...
2025-04-17 22:18:51,802 - INFO - Fama-French factors loaded
2025-04-17 22:18:51,802 - INFO - Processing factor data...
2025-04-17 22:18:51,806 - INFO - Factor data processed
2025-04-17 22:18:51,806 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:18:51,806 - INFO - 
Training Period:
2025-04-17 22:18:51,813 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:18:51,823 - INFO - 
Testing Period:
2025-04-17 22:18:51,830 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:18:51,840 - INFO - Loading macro and market data...
2025-04-17 22:18:51,842 - INFO - Loading existing macro data...
2025-04-17 22:18:51,856 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:51,856 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:51,861 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:51,862 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:51,862 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:51,864 - INFO - Loading existing macro data...
2025-04-17 22:18:51,882 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:51,882 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:51,887 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:51,888 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:51,888 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:51,890 - INFO - Loading existing market data...
2025-04-17 22:18:51,895 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:51,896 - INFO - Loading existing market data...
2025-04-17 22:18:51,901 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:51,901 - INFO - Macro and market data loaded
2025-04-17 22:18:51,901 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:51,901 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:51,903 - INFO - Loading existing macro data...
2025-04-17 22:18:51,918 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:51,919 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:51,924 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:51,925 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:51,925 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:51,926 - INFO - Loading existing market data...
2025-04-17 22:18:51,932 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:51,951 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:18:51,952 - INFO - Prepared training data with 1536 samples
2025-04-17 22:18:51,953 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:51,953 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:51,954 - INFO - Loading existing macro data...
2025-04-17 22:18:51,972 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:51,973 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:51,978 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:51,978 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:51,978 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:51,980 - INFO - Loading existing market data...
2025-04-17 22:18:51,985 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:51,998 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:18:51,998 - INFO - Prepared test data with 1276 samples
2025-04-17 22:18:51,999 - INFO - Test data prepared
2025-04-17 22:18:51,999 - INFO - Storing data...
2025-04-17 22:18:52,000 - INFO - Aligning data indices...
2025-04-17 22:18:52,001 - INFO - Data indices aligned
2025-04-17 22:18:52,001 - INFO - Data preparation completed
2025-04-17 22:18:52,002 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:18:52,002 - INFO - Training models...
2025-04-17 22:18:52,002 - INFO - Starting model training...
2025-04-17 22:18:52,003 - INFO - Training regime classifier...
2025-04-17 22:18:52,003 - INFO - Training XGBoost model...
2025-04-17 22:18:52,003 - INFO - Preparing features...
2025-04-17 22:18:52,004 - INFO - Input shape: (1536, 8)
2025-04-17 22:18:52,004 - INFO - Handling missing values...
2025-04-17 22:18:52,006 - INFO - Missing values: 0 -> 0
2025-04-17 22:18:52,007 - INFO - Scaling features...
2025-04-17 22:18:52,008 - INFO - Fitted new scaler
2025-04-17 22:18:52,010 - INFO - Output shape: (1536, 8)
2025-04-17 22:18:52,166 - INFO - XGBoost model training completed
2025-04-17 22:18:52,500 - INFO - Model training completed
2025-04-17 22:18:52,503 - INFO - Model training completed
2025-04-17 22:18:52,503 - INFO - Initializing portfolio weights...
2025-04-17 22:18:52,504 - INFO - Portfolio weights initialized
2025-04-17 22:18:52,505 - INFO - Generating regime predictions for test period...
2025-04-17 22:18:52,508 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:18:52,508 - ERROR - Error running xgboost with regime_aware and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:18:52,511 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 5 regimes
2025-04-17 22:18:52,511 - INFO - Initializing strategy...
2025-04-17 22:18:52,512 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 22:18:52,512 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:18:52,512 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:18:52,513 - INFO - Running strategy...
2025-04-17 22:18:52,513 - INFO - Starting strategy execution...
2025-04-17 22:18:52,514 - INFO - Preparing training and testing data...
2025-04-17 22:18:52,514 - INFO - Starting data preparation...
2025-04-17 22:18:52,514 - INFO - Loading Fama-French factors...
2025-04-17 22:18:52,527 - INFO - Fama-French factors loaded
2025-04-17 22:18:52,528 - INFO - Processing factor data...
2025-04-17 22:18:52,531 - INFO - Factor data processed
2025-04-17 22:18:52,531 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:18:52,533 - INFO - 
Training Period:
2025-04-17 22:18:52,541 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:18:52,552 - INFO - 
Testing Period:
2025-04-17 22:18:52,558 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:18:52,569 - INFO - Loading macro and market data...
2025-04-17 22:18:52,571 - INFO - Loading existing macro data...
2025-04-17 22:18:52,587 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:52,588 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:52,592 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:52,593 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:52,593 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:52,596 - INFO - Loading existing macro data...
2025-04-17 22:18:52,610 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:52,610 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:52,615 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:52,615 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:52,616 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:52,617 - INFO - Loading existing market data...
2025-04-17 22:18:52,624 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:52,625 - INFO - Loading existing market data...
2025-04-17 22:18:52,631 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:52,631 - INFO - Macro and market data loaded
2025-04-17 22:18:52,631 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:52,632 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:52,633 - INFO - Loading existing macro data...
2025-04-17 22:18:52,649 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:52,650 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:52,655 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:52,656 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:52,656 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:52,658 - INFO - Loading existing market data...
2025-04-17 22:18:52,663 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:52,686 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:18:52,686 - INFO - Prepared training data with 1536 samples
2025-04-17 22:18:52,687 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:52,687 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:52,688 - INFO - Loading existing macro data...
2025-04-17 22:18:52,703 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:52,703 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:52,707 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:52,708 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:52,708 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:52,710 - INFO - Loading existing market data...
2025-04-17 22:18:52,715 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:52,727 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:18:52,728 - INFO - Prepared test data with 1276 samples
2025-04-17 22:18:52,728 - INFO - Test data prepared
2025-04-17 22:18:52,729 - INFO - Storing data...
2025-04-17 22:18:52,729 - INFO - Aligning data indices...
2025-04-17 22:18:52,730 - INFO - Data indices aligned
2025-04-17 22:18:52,731 - INFO - Data preparation completed
2025-04-17 22:18:52,731 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:18:52,731 - INFO - Training models...
2025-04-17 22:18:52,732 - INFO - Starting model training...
2025-04-17 22:18:52,732 - INFO - Training regime classifier...
2025-04-17 22:18:52,732 - INFO - Training XGBoost model...
2025-04-17 22:18:52,732 - INFO - Preparing features...
2025-04-17 22:18:52,733 - INFO - Input shape: (1536, 8)
2025-04-17 22:18:52,733 - INFO - Handling missing values...
2025-04-17 22:18:52,735 - INFO - Missing values: 0 -> 0
2025-04-17 22:18:52,735 - INFO - Scaling features...
2025-04-17 22:18:52,737 - INFO - Fitted new scaler
2025-04-17 22:18:52,739 - INFO - Output shape: (1536, 8)
2025-04-17 22:18:52,901 - INFO - XGBoost model training completed
2025-04-17 22:18:53,238 - INFO - Model training completed
2025-04-17 22:18:53,241 - INFO - Model training completed
2025-04-17 22:18:53,241 - INFO - Initializing portfolio weights...
2025-04-17 22:18:53,242 - INFO - Portfolio weights initialized
2025-04-17 22:18:53,243 - INFO - Generating regime predictions for test period...
2025-04-17 22:18:53,245 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:18:53,245 - ERROR - Error running xgboost with regime_aware and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:18:53,248 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 7 regimes
2025-04-17 22:18:53,248 - INFO - Initializing strategy...
2025-04-17 22:18:53,248 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 22:18:53,249 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:18:53,249 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:18:53,250 - INFO - Running strategy...
2025-04-17 22:18:53,250 - INFO - Starting strategy execution...
2025-04-17 22:18:53,250 - INFO - Preparing training and testing data...
2025-04-17 22:18:53,250 - INFO - Starting data preparation...
2025-04-17 22:18:53,251 - INFO - Loading Fama-French factors...
2025-04-17 22:18:53,266 - INFO - Fama-French factors loaded
2025-04-17 22:18:53,266 - INFO - Processing factor data...
2025-04-17 22:18:53,270 - INFO - Factor data processed
2025-04-17 22:18:53,270 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:18:53,271 - INFO - 
Training Period:
2025-04-17 22:18:53,277 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:18:53,288 - INFO - 
Testing Period:
2025-04-17 22:18:53,298 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:18:53,308 - INFO - Loading macro and market data...
2025-04-17 22:18:53,310 - INFO - Loading existing macro data...
2025-04-17 22:18:53,325 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:53,325 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:53,330 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:53,330 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:53,331 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:53,332 - INFO - Loading existing macro data...
2025-04-17 22:18:53,346 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:53,347 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:53,351 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:53,352 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:53,352 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:53,354 - INFO - Loading existing market data...
2025-04-17 22:18:53,361 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:53,362 - INFO - Loading existing market data...
2025-04-17 22:18:53,367 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:53,367 - INFO - Macro and market data loaded
2025-04-17 22:18:53,367 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:53,368 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:53,369 - INFO - Loading existing macro data...
2025-04-17 22:18:53,383 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:53,384 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:53,389 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:53,389 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:53,390 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:53,391 - INFO - Loading existing market data...
2025-04-17 22:18:53,396 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:53,419 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:18:53,419 - INFO - Prepared training data with 1536 samples
2025-04-17 22:18:53,420 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:53,420 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:53,422 - INFO - Loading existing macro data...
2025-04-17 22:18:53,440 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:53,440 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:53,445 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:53,445 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:53,446 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:53,447 - INFO - Loading existing market data...
2025-04-17 22:18:53,453 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:53,466 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:18:53,467 - INFO - Prepared test data with 1276 samples
2025-04-17 22:18:53,467 - INFO - Test data prepared
2025-04-17 22:18:53,467 - INFO - Storing data...
2025-04-17 22:18:53,468 - INFO - Aligning data indices...
2025-04-17 22:18:53,470 - INFO - Data indices aligned
2025-04-17 22:18:53,470 - INFO - Data preparation completed
2025-04-17 22:18:53,470 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:18:53,471 - INFO - Training models...
2025-04-17 22:18:53,471 - INFO - Starting model training...
2025-04-17 22:18:53,471 - INFO - Training regime classifier...
2025-04-17 22:18:53,472 - INFO - Training XGBoost model...
2025-04-17 22:18:53,472 - INFO - Preparing features...
2025-04-17 22:18:53,472 - INFO - Input shape: (1536, 8)
2025-04-17 22:18:53,473 - INFO - Handling missing values...
2025-04-17 22:18:53,474 - INFO - Missing values: 0 -> 0
2025-04-17 22:18:53,475 - INFO - Scaling features...
2025-04-17 22:18:53,476 - INFO - Fitted new scaler
2025-04-17 22:18:53,478 - INFO - Output shape: (1536, 8)
2025-04-17 22:18:53,631 - INFO - XGBoost model training completed
2025-04-17 22:18:54,024 - INFO - Model training completed
2025-04-17 22:18:54,027 - INFO - Model training completed
2025-04-17 22:18:54,027 - INFO - Initializing portfolio weights...
2025-04-17 22:18:54,028 - INFO - Portfolio weights initialized
2025-04-17 22:18:54,028 - INFO - Generating regime predictions for test period...
2025-04-17 22:18:54,030 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:18:54,031 - ERROR - Error running xgboost with regime_aware and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:18:54,033 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 3 regimes
2025-04-17 22:18:54,034 - INFO - Initializing strategy...
2025-04-17 22:18:54,034 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 22:18:54,034 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:18:54,034 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:18:54,035 - INFO - Running strategy...
2025-04-17 22:18:54,036 - INFO - Starting strategy execution...
2025-04-17 22:18:54,036 - INFO - Preparing training and testing data...
2025-04-17 22:18:54,036 - INFO - Starting data preparation...
2025-04-17 22:18:54,037 - INFO - Loading Fama-French factors...
2025-04-17 22:18:54,053 - INFO - Fama-French factors loaded
2025-04-17 22:18:54,053 - INFO - Processing factor data...
2025-04-17 22:18:54,057 - INFO - Factor data processed
2025-04-17 22:18:54,058 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:18:54,058 - INFO - 
Training Period:
2025-04-17 22:18:54,067 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:18:54,078 - INFO - 
Testing Period:
2025-04-17 22:18:54,085 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:18:54,098 - INFO - Loading macro and market data...
2025-04-17 22:18:54,099 - INFO - Loading existing macro data...
2025-04-17 22:18:54,115 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:54,116 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:54,119 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:54,120 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:54,120 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:54,121 - INFO - Loading existing macro data...
2025-04-17 22:18:54,135 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:54,136 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:54,140 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:54,140 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:54,141 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:54,142 - INFO - Loading existing market data...
2025-04-17 22:18:54,147 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:54,149 - INFO - Loading existing market data...
2025-04-17 22:18:54,153 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:54,153 - INFO - Macro and market data loaded
2025-04-17 22:18:54,154 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:54,154 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:54,155 - INFO - Loading existing macro data...
2025-04-17 22:18:54,172 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:54,172 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:54,177 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:54,177 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:54,178 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:54,179 - INFO - Loading existing market data...
2025-04-17 22:18:54,184 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:54,207 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:18:54,207 - INFO - Prepared training data with 1536 samples
2025-04-17 22:18:54,208 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:54,208 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:54,210 - INFO - Loading existing macro data...
2025-04-17 22:18:54,227 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:54,228 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:54,232 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:54,232 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:54,233 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:54,234 - INFO - Loading existing market data...
2025-04-17 22:18:54,240 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:54,251 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:18:54,251 - INFO - Prepared test data with 1276 samples
2025-04-17 22:18:54,251 - INFO - Test data prepared
2025-04-17 22:18:54,252 - INFO - Storing data...
2025-04-17 22:18:54,252 - INFO - Aligning data indices...
2025-04-17 22:18:54,254 - INFO - Data indices aligned
2025-04-17 22:18:54,254 - INFO - Data preparation completed
2025-04-17 22:18:54,255 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:18:54,255 - INFO - Training models...
2025-04-17 22:18:54,255 - INFO - Starting model training...
2025-04-17 22:18:54,255 - INFO - Training regime classifier...
2025-04-17 22:18:54,255 - INFO - Training XGBoost model...
2025-04-17 22:18:54,256 - INFO - Preparing features...
2025-04-17 22:18:54,256 - INFO - Input shape: (1536, 8)
2025-04-17 22:18:54,256 - INFO - Handling missing values...
2025-04-17 22:18:54,258 - INFO - Missing values: 0 -> 0
2025-04-17 22:18:54,258 - INFO - Scaling features...
2025-04-17 22:18:54,260 - INFO - Fitted new scaler
2025-04-17 22:18:54,261 - INFO - Output shape: (1536, 8)
2025-04-17 22:18:54,418 - INFO - XGBoost model training completed
2025-04-17 22:18:54,720 - INFO - Model training completed
2025-04-17 22:18:54,722 - INFO - Model training completed
2025-04-17 22:18:54,722 - INFO - Initializing portfolio weights...
2025-04-17 22:18:54,723 - INFO - Portfolio weights initialized
2025-04-17 22:18:54,724 - INFO - Generating regime predictions for test period...
2025-04-17 22:18:54,726 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:18:54,726 - ERROR - Error running xgboost with neural_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:18:54,729 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 5 regimes
2025-04-17 22:18:54,729 - INFO - Initializing strategy...
2025-04-17 22:18:54,729 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 22:18:54,730 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:18:54,730 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:18:54,730 - INFO - Running strategy...
2025-04-17 22:18:54,731 - INFO - Starting strategy execution...
2025-04-17 22:18:54,731 - INFO - Preparing training and testing data...
2025-04-17 22:18:54,731 - INFO - Starting data preparation...
2025-04-17 22:18:54,731 - INFO - Loading Fama-French factors...
2025-04-17 22:18:54,744 - INFO - Fama-French factors loaded
2025-04-17 22:18:54,744 - INFO - Processing factor data...
2025-04-17 22:18:54,749 - INFO - Factor data processed
2025-04-17 22:18:54,750 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:18:54,750 - INFO - 
Training Period:
2025-04-17 22:18:54,757 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:18:54,771 - INFO - 
Testing Period:
2025-04-17 22:18:54,781 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:18:54,796 - INFO - Loading macro and market data...
2025-04-17 22:18:54,798 - INFO - Loading existing macro data...
2025-04-17 22:18:54,813 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:54,814 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:54,819 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:54,819 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:54,820 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:54,822 - INFO - Loading existing macro data...
2025-04-17 22:18:54,835 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:54,836 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:54,840 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:54,841 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:54,841 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:54,843 - INFO - Loading existing market data...
2025-04-17 22:18:54,851 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:54,852 - INFO - Loading existing market data...
2025-04-17 22:18:54,857 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:54,857 - INFO - Macro and market data loaded
2025-04-17 22:18:54,857 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:54,858 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:54,859 - INFO - Loading existing macro data...
2025-04-17 22:18:54,873 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:54,874 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:54,878 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:54,879 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:54,879 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:54,881 - INFO - Loading existing market data...
2025-04-17 22:18:54,887 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:54,911 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:18:54,912 - INFO - Prepared training data with 1536 samples
2025-04-17 22:18:54,912 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:54,913 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:54,914 - INFO - Loading existing macro data...
2025-04-17 22:18:54,930 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:54,930 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:54,935 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:54,935 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:54,936 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:54,937 - INFO - Loading existing market data...
2025-04-17 22:18:54,942 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:54,957 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:18:54,957 - INFO - Prepared test data with 1276 samples
2025-04-17 22:18:54,958 - INFO - Test data prepared
2025-04-17 22:18:54,958 - INFO - Storing data...
2025-04-17 22:18:54,958 - INFO - Aligning data indices...
2025-04-17 22:18:54,960 - INFO - Data indices aligned
2025-04-17 22:18:54,960 - INFO - Data preparation completed
2025-04-17 22:18:54,961 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:18:54,961 - INFO - Training models...
2025-04-17 22:18:54,961 - INFO - Starting model training...
2025-04-17 22:18:54,961 - INFO - Training regime classifier...
2025-04-17 22:18:54,962 - INFO - Training XGBoost model...
2025-04-17 22:18:54,962 - INFO - Preparing features...
2025-04-17 22:18:54,962 - INFO - Input shape: (1536, 8)
2025-04-17 22:18:54,962 - INFO - Handling missing values...
2025-04-17 22:18:54,964 - INFO - Missing values: 0 -> 0
2025-04-17 22:18:54,964 - INFO - Scaling features...
2025-04-17 22:18:54,967 - INFO - Fitted new scaler
2025-04-17 22:18:54,968 - INFO - Output shape: (1536, 8)
2025-04-17 22:18:55,133 - INFO - XGBoost model training completed
2025-04-17 22:18:55,452 - INFO - Model training completed
2025-04-17 22:18:55,456 - INFO - Model training completed
2025-04-17 22:18:55,456 - INFO - Initializing portfolio weights...
2025-04-17 22:18:55,457 - INFO - Portfolio weights initialized
2025-04-17 22:18:55,458 - INFO - Generating regime predictions for test period...
2025-04-17 22:18:55,460 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:18:55,460 - ERROR - Error running xgboost with neural_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:18:55,463 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 7 regimes
2025-04-17 22:18:55,463 - INFO - Initializing strategy...
2025-04-17 22:18:55,464 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 22:18:55,464 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:18:55,465 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:18:55,466 - INFO - Running strategy...
2025-04-17 22:18:55,466 - INFO - Starting strategy execution...
2025-04-17 22:18:55,466 - INFO - Preparing training and testing data...
2025-04-17 22:18:55,466 - INFO - Starting data preparation...
2025-04-17 22:18:55,467 - INFO - Loading Fama-French factors...
2025-04-17 22:18:55,483 - INFO - Fama-French factors loaded
2025-04-17 22:18:55,483 - INFO - Processing factor data...
2025-04-17 22:18:55,487 - INFO - Factor data processed
2025-04-17 22:18:55,487 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:18:55,487 - INFO - 
Training Period:
2025-04-17 22:18:55,494 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:18:55,506 - INFO - 
Testing Period:
2025-04-17 22:18:55,514 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:18:55,524 - INFO - Loading macro and market data...
2025-04-17 22:18:55,526 - INFO - Loading existing macro data...
2025-04-17 22:18:55,540 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:55,541 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:55,545 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:55,545 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:55,546 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:55,549 - INFO - Loading existing macro data...
2025-04-17 22:18:55,564 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:55,565 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:55,568 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:55,569 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:55,569 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:55,571 - INFO - Loading existing market data...
2025-04-17 22:18:55,577 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:55,579 - INFO - Loading existing market data...
2025-04-17 22:18:55,583 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:55,584 - INFO - Macro and market data loaded
2025-04-17 22:18:55,584 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:55,585 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:55,586 - INFO - Loading existing macro data...
2025-04-17 22:18:55,600 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:55,601 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:55,605 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:55,606 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:55,606 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:55,608 - INFO - Loading existing market data...
2025-04-17 22:18:55,614 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:55,637 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:18:55,638 - INFO - Prepared training data with 1536 samples
2025-04-17 22:18:55,639 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:55,639 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:55,641 - INFO - Loading existing macro data...
2025-04-17 22:18:55,657 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:55,658 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:55,663 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:55,664 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:55,664 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:55,666 - INFO - Loading existing market data...
2025-04-17 22:18:55,671 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:55,684 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:18:55,684 - INFO - Prepared test data with 1276 samples
2025-04-17 22:18:55,685 - INFO - Test data prepared
2025-04-17 22:18:55,685 - INFO - Storing data...
2025-04-17 22:18:55,685 - INFO - Aligning data indices...
2025-04-17 22:18:55,687 - INFO - Data indices aligned
2025-04-17 22:18:55,687 - INFO - Data preparation completed
2025-04-17 22:18:55,688 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:18:55,688 - INFO - Training models...
2025-04-17 22:18:55,688 - INFO - Starting model training...
2025-04-17 22:18:55,688 - INFO - Training regime classifier...
2025-04-17 22:18:55,689 - INFO - Training XGBoost model...
2025-04-17 22:18:55,689 - INFO - Preparing features...
2025-04-17 22:18:55,689 - INFO - Input shape: (1536, 8)
2025-04-17 22:18:55,691 - INFO - Handling missing values...
2025-04-17 22:18:55,693 - INFO - Missing values: 0 -> 0
2025-04-17 22:18:55,693 - INFO - Scaling features...
2025-04-17 22:18:55,695 - INFO - Fitted new scaler
2025-04-17 22:18:55,696 - INFO - Output shape: (1536, 8)
2025-04-17 22:18:55,861 - INFO - XGBoost model training completed
2025-04-17 22:18:56,168 - INFO - Model training completed
2025-04-17 22:18:56,171 - INFO - Model training completed
2025-04-17 22:18:56,171 - INFO - Initializing portfolio weights...
2025-04-17 22:18:56,172 - INFO - Portfolio weights initialized
2025-04-17 22:18:56,173 - INFO - Generating regime predictions for test period...
2025-04-17 22:18:56,175 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:18:56,175 - ERROR - Error running xgboost with neural_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:18:56,177 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 22:18:56,177 - INFO - Initializing strategy...
2025-04-17 22:18:56,178 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 22:18:56,178 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:18:56,179 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:18:56,179 - INFO - Running strategy...
2025-04-17 22:18:56,180 - INFO - Starting strategy execution...
2025-04-17 22:18:56,180 - INFO - Preparing training and testing data...
2025-04-17 22:18:56,180 - INFO - Starting data preparation...
2025-04-17 22:18:56,181 - INFO - Loading Fama-French factors...
2025-04-17 22:18:56,194 - INFO - Fama-French factors loaded
2025-04-17 22:18:56,195 - INFO - Processing factor data...
2025-04-17 22:18:56,199 - INFO - Factor data processed
2025-04-17 22:18:56,199 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:18:56,199 - INFO - 
Training Period:
2025-04-17 22:18:56,206 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:18:56,219 - INFO - 
Testing Period:
2025-04-17 22:18:56,226 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:18:56,238 - INFO - Loading macro and market data...
2025-04-17 22:18:56,240 - INFO - Loading existing macro data...
2025-04-17 22:18:56,256 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:56,257 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:56,261 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:56,261 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:56,262 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:56,264 - INFO - Loading existing macro data...
2025-04-17 22:18:56,277 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:56,278 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:56,282 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:56,282 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:56,282 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:56,284 - INFO - Loading existing market data...
2025-04-17 22:18:56,289 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:56,291 - INFO - Loading existing market data...
2025-04-17 22:18:56,295 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:56,296 - INFO - Macro and market data loaded
2025-04-17 22:18:56,296 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:56,296 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:56,298 - INFO - Loading existing macro data...
2025-04-17 22:18:56,313 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:56,314 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:56,319 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:56,320 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:56,320 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:56,322 - INFO - Loading existing market data...
2025-04-17 22:18:56,327 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:56,351 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:18:56,352 - INFO - Prepared training data with 1536 samples
2025-04-17 22:18:56,353 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:56,353 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:56,355 - INFO - Loading existing macro data...
2025-04-17 22:18:56,371 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:56,371 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:56,375 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:56,376 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:56,376 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:56,377 - INFO - Loading existing market data...
2025-04-17 22:18:56,382 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:56,397 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:18:56,397 - INFO - Prepared test data with 1276 samples
2025-04-17 22:18:56,397 - INFO - Test data prepared
2025-04-17 22:18:56,398 - INFO - Storing data...
2025-04-17 22:18:56,398 - INFO - Aligning data indices...
2025-04-17 22:18:56,400 - INFO - Data indices aligned
2025-04-17 22:18:56,400 - INFO - Data preparation completed
2025-04-17 22:18:56,401 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:18:56,401 - INFO - Training models...
2025-04-17 22:18:56,401 - INFO - Starting model training...
2025-04-17 22:18:56,402 - INFO - Training regime classifier...
2025-04-17 22:18:56,402 - INFO - Training XGBoost model...
2025-04-17 22:18:56,402 - INFO - Preparing features...
2025-04-17 22:18:56,403 - INFO - Input shape: (1536, 8)
2025-04-17 22:18:56,403 - INFO - Handling missing values...
2025-04-17 22:18:56,405 - INFO - Missing values: 0 -> 0
2025-04-17 22:18:56,405 - INFO - Scaling features...
2025-04-17 22:18:56,407 - INFO - Fitted new scaler
2025-04-17 22:18:56,408 - INFO - Output shape: (1536, 8)
2025-04-17 22:18:56,581 - INFO - XGBoost model training completed
2025-04-17 22:18:56,947 - INFO - Model training completed
2025-04-17 22:18:56,950 - INFO - Model training completed
2025-04-17 22:18:56,950 - INFO - Initializing portfolio weights...
2025-04-17 22:18:56,951 - INFO - Portfolio weights initialized
2025-04-17 22:18:56,951 - INFO - Generating regime predictions for test period...
2025-04-17 22:18:56,954 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:18:56,954 - ERROR - Error running xgboost with autoencoder_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:18:56,957 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 22:18:56,957 - INFO - Initializing strategy...
2025-04-17 22:18:56,958 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 22:18:56,958 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:18:56,959 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:18:56,960 - INFO - Running strategy...
2025-04-17 22:18:56,960 - INFO - Starting strategy execution...
2025-04-17 22:18:56,960 - INFO - Preparing training and testing data...
2025-04-17 22:18:56,960 - INFO - Starting data preparation...
2025-04-17 22:18:56,961 - INFO - Loading Fama-French factors...
2025-04-17 22:18:56,976 - INFO - Fama-French factors loaded
2025-04-17 22:18:56,976 - INFO - Processing factor data...
2025-04-17 22:18:56,980 - INFO - Factor data processed
2025-04-17 22:18:56,981 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:18:56,981 - INFO - 
Training Period:
2025-04-17 22:18:56,988 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:18:56,999 - INFO - 
Testing Period:
2025-04-17 22:18:57,006 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:18:57,017 - INFO - Loading macro and market data...
2025-04-17 22:18:57,018 - INFO - Loading existing macro data...
2025-04-17 22:18:57,034 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:57,034 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:57,038 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:57,039 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:57,039 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:57,040 - INFO - Loading existing macro data...
2025-04-17 22:18:57,055 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:57,056 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:57,060 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:57,061 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:57,062 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:57,064 - INFO - Loading existing market data...
2025-04-17 22:18:57,069 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:57,071 - INFO - Loading existing market data...
2025-04-17 22:18:57,076 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:57,076 - INFO - Macro and market data loaded
2025-04-17 22:18:57,076 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:57,077 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:57,078 - INFO - Loading existing macro data...
2025-04-17 22:18:57,096 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:57,097 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:57,101 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:57,101 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:57,102 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:57,103 - INFO - Loading existing market data...
2025-04-17 22:18:57,108 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:57,130 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:18:57,131 - INFO - Prepared training data with 1536 samples
2025-04-17 22:18:57,131 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:57,132 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:57,134 - INFO - Loading existing macro data...
2025-04-17 22:18:57,150 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:57,150 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:57,155 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:57,155 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:57,155 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:57,158 - INFO - Loading existing market data...
2025-04-17 22:18:57,163 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:57,177 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:18:57,177 - INFO - Prepared test data with 1276 samples
2025-04-17 22:18:57,178 - INFO - Test data prepared
2025-04-17 22:18:57,178 - INFO - Storing data...
2025-04-17 22:18:57,179 - INFO - Aligning data indices...
2025-04-17 22:18:57,180 - INFO - Data indices aligned
2025-04-17 22:18:57,181 - INFO - Data preparation completed
2025-04-17 22:18:57,181 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:18:57,181 - INFO - Training models...
2025-04-17 22:18:57,181 - INFO - Starting model training...
2025-04-17 22:18:57,181 - INFO - Training regime classifier...
2025-04-17 22:18:57,182 - INFO - Training XGBoost model...
2025-04-17 22:18:57,182 - INFO - Preparing features...
2025-04-17 22:18:57,182 - INFO - Input shape: (1536, 8)
2025-04-17 22:18:57,182 - INFO - Handling missing values...
2025-04-17 22:18:57,183 - INFO - Missing values: 0 -> 0
2025-04-17 22:18:57,184 - INFO - Scaling features...
2025-04-17 22:18:57,185 - INFO - Fitted new scaler
2025-04-17 22:18:57,187 - INFO - Output shape: (1536, 8)
2025-04-17 22:18:57,341 - INFO - XGBoost model training completed
2025-04-17 22:18:57,665 - INFO - Model training completed
2025-04-17 22:18:57,668 - INFO - Model training completed
2025-04-17 22:18:57,669 - INFO - Initializing portfolio weights...
2025-04-17 22:18:57,670 - INFO - Portfolio weights initialized
2025-04-17 22:18:57,670 - INFO - Generating regime predictions for test period...
2025-04-17 22:18:57,673 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:18:57,674 - ERROR - Error running xgboost with autoencoder_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:18:57,676 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 22:18:57,676 - INFO - Initializing strategy...
2025-04-17 22:18:57,676 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 22:18:57,677 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:18:57,677 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:18:57,678 - INFO - Running strategy...
2025-04-17 22:18:57,678 - INFO - Starting strategy execution...
2025-04-17 22:18:57,679 - INFO - Preparing training and testing data...
2025-04-17 22:18:57,679 - INFO - Starting data preparation...
2025-04-17 22:18:57,679 - INFO - Loading Fama-French factors...
2025-04-17 22:18:57,694 - INFO - Fama-French factors loaded
2025-04-17 22:18:57,695 - INFO - Processing factor data...
2025-04-17 22:18:57,699 - INFO - Factor data processed
2025-04-17 22:18:57,700 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:18:57,700 - INFO - 
Training Period:
2025-04-17 22:18:57,708 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:18:57,719 - INFO - 
Testing Period:
2025-04-17 22:18:57,729 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:18:57,741 - INFO - Loading macro and market data...
2025-04-17 22:18:57,743 - INFO - Loading existing macro data...
2025-04-17 22:18:57,758 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:57,758 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:57,763 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:57,764 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:57,764 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:57,766 - INFO - Loading existing macro data...
2025-04-17 22:18:57,783 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:57,784 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:57,788 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:57,788 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:57,789 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:57,790 - INFO - Loading existing market data...
2025-04-17 22:18:57,798 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:57,800 - INFO - Loading existing market data...
2025-04-17 22:18:57,805 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:57,805 - INFO - Macro and market data loaded
2025-04-17 22:18:57,805 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:57,806 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:57,807 - INFO - Loading existing macro data...
2025-04-17 22:18:57,822 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:57,823 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:57,828 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:57,828 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:57,829 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:57,830 - INFO - Loading existing market data...
2025-04-17 22:18:57,835 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:57,857 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:18:57,858 - INFO - Prepared training data with 1536 samples
2025-04-17 22:18:57,858 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:57,859 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:57,861 - INFO - Loading existing macro data...
2025-04-17 22:18:57,879 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:57,880 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:57,884 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:57,884 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:57,885 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:57,887 - INFO - Loading existing market data...
2025-04-17 22:18:57,891 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:57,903 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:18:57,904 - INFO - Prepared test data with 1276 samples
2025-04-17 22:18:57,904 - INFO - Test data prepared
2025-04-17 22:18:57,904 - INFO - Storing data...
2025-04-17 22:18:57,905 - INFO - Aligning data indices...
2025-04-17 22:18:57,907 - INFO - Data indices aligned
2025-04-17 22:18:57,907 - INFO - Data preparation completed
2025-04-17 22:18:57,907 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:18:57,907 - INFO - Training models...
2025-04-17 22:18:57,908 - INFO - Starting model training...
2025-04-17 22:18:57,908 - INFO - Training regime classifier...
2025-04-17 22:18:57,908 - INFO - Training XGBoost model...
2025-04-17 22:18:57,908 - INFO - Preparing features...
2025-04-17 22:18:57,909 - INFO - Input shape: (1536, 8)
2025-04-17 22:18:57,909 - INFO - Handling missing values...
2025-04-17 22:18:57,910 - INFO - Missing values: 0 -> 0
2025-04-17 22:18:57,910 - INFO - Scaling features...
2025-04-17 22:18:57,912 - INFO - Fitted new scaler
2025-04-17 22:18:57,913 - INFO - Output shape: (1536, 8)
2025-04-17 22:18:58,069 - INFO - XGBoost model training completed
2025-04-17 22:18:58,401 - INFO - Model training completed
2025-04-17 22:18:58,404 - INFO - Model training completed
2025-04-17 22:18:58,405 - INFO - Initializing portfolio weights...
2025-04-17 22:18:58,405 - INFO - Portfolio weights initialized
2025-04-17 22:18:58,406 - INFO - Generating regime predictions for test period...
2025-04-17 22:18:58,409 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:18:58,410 - ERROR - Error running xgboost with autoencoder_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:18:58,412 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 3 regimes
2025-04-17 22:18:58,412 - INFO - Initializing strategy...
2025-04-17 22:18:58,412 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 22:18:58,412 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:18:58,413 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:18:59,787 - INFO - Running strategy...
2025-04-17 22:18:59,787 - INFO - Starting strategy execution...
2025-04-17 22:18:59,788 - INFO - Preparing training and testing data...
2025-04-17 22:18:59,788 - INFO - Starting data preparation...
2025-04-17 22:18:59,788 - INFO - Loading Fama-French factors...
2025-04-17 22:18:59,805 - INFO - Fama-French factors loaded
2025-04-17 22:18:59,806 - INFO - Processing factor data...
2025-04-17 22:18:59,810 - INFO - Factor data processed
2025-04-17 22:18:59,811 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:18:59,811 - INFO - 
Training Period:
2025-04-17 22:18:59,818 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:18:59,829 - INFO - 
Testing Period:
2025-04-17 22:18:59,836 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:18:59,849 - INFO - Loading macro and market data...
2025-04-17 22:18:59,850 - INFO - Loading existing macro data...
2025-04-17 22:18:59,868 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:59,868 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:59,873 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:59,873 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:59,873 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:59,875 - INFO - Loading existing macro data...
2025-04-17 22:18:59,891 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:59,892 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:59,897 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:59,898 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:59,898 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:59,900 - INFO - Loading existing market data...
2025-04-17 22:18:59,906 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:59,907 - INFO - Loading existing market data...
2025-04-17 22:18:59,911 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:18:59,911 - INFO - Macro and market data loaded
2025-04-17 22:18:59,912 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:59,912 - INFO - Preparing training data for regime classification...
2025-04-17 22:18:59,913 - INFO - Loading existing macro data...
2025-04-17 22:18:59,930 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:59,931 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:59,934 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:59,935 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:18:59,935 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:18:59,938 - INFO - Loading existing market data...
2025-04-17 22:18:59,944 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:18:59,966 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:18:59,967 - INFO - Prepared training data with 1536 samples
2025-04-17 22:18:59,967 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:59,967 - INFO - Preparing test data for regime classification...
2025-04-17 22:18:59,969 - INFO - Loading existing macro data...
2025-04-17 22:18:59,987 - WARNING - US corporate credit spread file not found
2025-04-17 22:18:59,988 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:18:59,992 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:18:59,993 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:18:59,993 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:18:59,994 - INFO - Loading existing market data...
2025-04-17 22:18:59,999 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:00,012 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:19:00,012 - INFO - Prepared test data with 1276 samples
2025-04-17 22:19:00,013 - INFO - Test data prepared
2025-04-17 22:19:00,013 - INFO - Storing data...
2025-04-17 22:19:00,013 - INFO - Aligning data indices...
2025-04-17 22:19:00,015 - INFO - Data indices aligned
2025-04-17 22:19:00,017 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:19:00,017 - INFO - Data preparation completed
2025-04-17 22:19:00,018 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:19:00,019 - INFO - Training models...
2025-04-17 22:19:00,019 - INFO - Starting model training...
2025-04-17 22:19:00,019 - INFO - Training regime classifier...
2025-04-17 22:19:00,019 - INFO - Training XGBoost model...
2025-04-17 22:19:00,020 - INFO - Preparing features...
2025-04-17 22:19:00,020 - INFO - Input shape: (1536, 8)
2025-04-17 22:19:00,020 - INFO - Handling missing values...
2025-04-17 22:19:00,022 - INFO - Missing values: 0 -> 0
2025-04-17 22:19:00,022 - INFO - Scaling features...
2025-04-17 22:19:00,024 - INFO - Fitted new scaler
2025-04-17 22:19:00,026 - INFO - Output shape: (1536, 8)
2025-04-17 22:19:00,182 - INFO - XGBoost model training completed
2025-04-17 22:19:00,550 - INFO - Training neural portfolio optimizer...
2025-04-17 22:19:00,551 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:19:00,551 - INFO - Model training completed
2025-04-17 22:19:00,554 - INFO - Model training completed
2025-04-17 22:19:00,555 - INFO - Initializing portfolio weights...
2025-04-17 22:19:00,555 - INFO - Portfolio weights initialized
2025-04-17 22:19:00,556 - INFO - Generating regime predictions for test period...
2025-04-17 22:19:00,558 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:19:00,558 - ERROR - Error running xgboost with neural and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:19:00,561 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 5 regimes
2025-04-17 22:19:00,561 - INFO - Initializing strategy...
2025-04-17 22:19:00,562 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 22:19:00,562 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:19:00,563 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:19:00,564 - INFO - Running strategy...
2025-04-17 22:19:00,564 - INFO - Starting strategy execution...
2025-04-17 22:19:00,564 - INFO - Preparing training and testing data...
2025-04-17 22:19:00,565 - INFO - Starting data preparation...
2025-04-17 22:19:00,565 - INFO - Loading Fama-French factors...
2025-04-17 22:19:00,583 - INFO - Fama-French factors loaded
2025-04-17 22:19:00,584 - INFO - Processing factor data...
2025-04-17 22:19:00,589 - INFO - Factor data processed
2025-04-17 22:19:00,589 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:19:00,590 - INFO - 
Training Period:
2025-04-17 22:19:00,597 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:19:00,608 - INFO - 
Testing Period:
2025-04-17 22:19:00,615 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:19:00,627 - INFO - Loading macro and market data...
2025-04-17 22:19:00,629 - INFO - Loading existing macro data...
2025-04-17 22:19:00,647 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:00,647 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:00,652 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:00,652 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:00,653 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:00,655 - INFO - Loading existing macro data...
2025-04-17 22:19:00,673 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:00,674 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:00,679 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:00,680 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:00,680 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:00,682 - INFO - Loading existing market data...
2025-04-17 22:19:00,688 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:00,689 - INFO - Loading existing market data...
2025-04-17 22:19:00,693 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:00,694 - INFO - Macro and market data loaded
2025-04-17 22:19:00,694 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:00,694 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:00,695 - INFO - Loading existing macro data...
2025-04-17 22:19:00,710 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:00,711 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:00,715 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:00,715 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:00,716 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:00,717 - INFO - Loading existing market data...
2025-04-17 22:19:00,723 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:00,744 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:19:00,744 - INFO - Prepared training data with 1536 samples
2025-04-17 22:19:00,745 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:00,745 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:00,747 - INFO - Loading existing macro data...
2025-04-17 22:19:00,765 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:00,766 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:00,770 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:00,770 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:00,771 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:00,772 - INFO - Loading existing market data...
2025-04-17 22:19:00,777 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:00,790 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:19:00,791 - INFO - Prepared test data with 1276 samples
2025-04-17 22:19:00,791 - INFO - Test data prepared
2025-04-17 22:19:00,792 - INFO - Storing data...
2025-04-17 22:19:00,792 - INFO - Aligning data indices...
2025-04-17 22:19:00,794 - INFO - Data indices aligned
2025-04-17 22:19:00,795 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:19:00,795 - INFO - Data preparation completed
2025-04-17 22:19:00,796 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:19:00,796 - INFO - Training models...
2025-04-17 22:19:00,796 - INFO - Starting model training...
2025-04-17 22:19:00,796 - INFO - Training regime classifier...
2025-04-17 22:19:00,797 - INFO - Training XGBoost model...
2025-04-17 22:19:00,797 - INFO - Preparing features...
2025-04-17 22:19:00,797 - INFO - Input shape: (1536, 8)
2025-04-17 22:19:00,797 - INFO - Handling missing values...
2025-04-17 22:19:00,799 - INFO - Missing values: 0 -> 0
2025-04-17 22:19:00,799 - INFO - Scaling features...
2025-04-17 22:19:00,801 - INFO - Fitted new scaler
2025-04-17 22:19:00,802 - INFO - Output shape: (1536, 8)
2025-04-17 22:19:00,954 - INFO - XGBoost model training completed
2025-04-17 22:19:01,269 - INFO - Training neural portfolio optimizer...
2025-04-17 22:19:01,270 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:19:01,270 - INFO - Model training completed
2025-04-17 22:19:01,273 - INFO - Model training completed
2025-04-17 22:19:01,273 - INFO - Initializing portfolio weights...
2025-04-17 22:19:01,274 - INFO - Portfolio weights initialized
2025-04-17 22:19:01,274 - INFO - Generating regime predictions for test period...
2025-04-17 22:19:01,276 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:19:01,277 - ERROR - Error running xgboost with neural and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:19:01,279 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 7 regimes
2025-04-17 22:19:01,279 - INFO - Initializing strategy...
2025-04-17 22:19:01,279 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 22:19:01,280 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:19:01,280 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:19:01,281 - INFO - Running strategy...
2025-04-17 22:19:01,282 - INFO - Starting strategy execution...
2025-04-17 22:19:01,282 - INFO - Preparing training and testing data...
2025-04-17 22:19:01,282 - INFO - Starting data preparation...
2025-04-17 22:19:01,283 - INFO - Loading Fama-French factors...
2025-04-17 22:19:01,298 - INFO - Fama-French factors loaded
2025-04-17 22:19:01,298 - INFO - Processing factor data...
2025-04-17 22:19:01,302 - INFO - Factor data processed
2025-04-17 22:19:01,302 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:19:01,302 - INFO - 
Training Period:
2025-04-17 22:19:01,312 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:19:01,323 - INFO - 
Testing Period:
2025-04-17 22:19:01,329 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:19:01,341 - INFO - Loading macro and market data...
2025-04-17 22:19:01,342 - INFO - Loading existing macro data...
2025-04-17 22:19:01,357 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:01,358 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:01,363 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:01,364 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:01,365 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:01,367 - INFO - Loading existing macro data...
2025-04-17 22:19:01,384 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:01,385 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:01,389 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:01,389 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:01,390 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:01,391 - INFO - Loading existing market data...
2025-04-17 22:19:01,397 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:01,398 - INFO - Loading existing market data...
2025-04-17 22:19:01,402 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:01,403 - INFO - Macro and market data loaded
2025-04-17 22:19:01,403 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:01,403 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:01,405 - INFO - Loading existing macro data...
2025-04-17 22:19:01,419 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:01,419 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:01,424 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:01,424 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:01,424 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:01,426 - INFO - Loading existing market data...
2025-04-17 22:19:01,431 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:01,454 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:19:01,454 - INFO - Prepared training data with 1536 samples
2025-04-17 22:19:01,455 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:01,455 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:01,457 - INFO - Loading existing macro data...
2025-04-17 22:19:01,474 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:01,475 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:01,481 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:01,481 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:01,482 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:01,484 - INFO - Loading existing market data...
2025-04-17 22:19:01,490 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:01,505 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:19:01,505 - INFO - Prepared test data with 1276 samples
2025-04-17 22:19:01,506 - INFO - Test data prepared
2025-04-17 22:19:01,506 - INFO - Storing data...
2025-04-17 22:19:01,506 - INFO - Aligning data indices...
2025-04-17 22:19:01,508 - INFO - Data indices aligned
2025-04-17 22:19:01,509 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:19:01,509 - INFO - Data preparation completed
2025-04-17 22:19:01,509 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:19:01,510 - INFO - Training models...
2025-04-17 22:19:01,510 - INFO - Starting model training...
2025-04-17 22:19:01,510 - INFO - Training regime classifier...
2025-04-17 22:19:01,510 - INFO - Training XGBoost model...
2025-04-17 22:19:01,510 - INFO - Preparing features...
2025-04-17 22:19:01,511 - INFO - Input shape: (1536, 8)
2025-04-17 22:19:01,511 - INFO - Handling missing values...
2025-04-17 22:19:01,513 - INFO - Missing values: 0 -> 0
2025-04-17 22:19:01,513 - INFO - Scaling features...
2025-04-17 22:19:01,516 - INFO - Fitted new scaler
2025-04-17 22:19:01,517 - INFO - Output shape: (1536, 8)
2025-04-17 22:19:01,664 - INFO - XGBoost model training completed
2025-04-17 22:19:01,980 - INFO - Training neural portfolio optimizer...
2025-04-17 22:19:01,981 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:19:01,981 - INFO - Model training completed
2025-04-17 22:19:01,983 - INFO - Model training completed
2025-04-17 22:19:01,983 - INFO - Initializing portfolio weights...
2025-04-17 22:19:01,984 - INFO - Portfolio weights initialized
2025-04-17 22:19:01,984 - INFO - Generating regime predictions for test period...
2025-04-17 22:19:01,987 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:19:01,987 - ERROR - Error running xgboost with neural and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 214, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:19:01,989 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 3 regimes
2025-04-17 22:19:01,989 - INFO - Initializing strategy...
2025-04-17 22:19:01,990 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 22:19:01,990 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:19:01,990 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:19:01,991 - INFO - Running strategy...
2025-04-17 22:19:01,992 - INFO - Starting strategy execution...
2025-04-17 22:19:01,992 - INFO - Preparing training and testing data...
2025-04-17 22:19:01,992 - INFO - Starting data preparation...
2025-04-17 22:19:01,993 - INFO - Loading Fama-French factors...
2025-04-17 22:19:02,007 - INFO - Fama-French factors loaded
2025-04-17 22:19:02,007 - INFO - Processing factor data...
2025-04-17 22:19:02,011 - INFO - Factor data processed
2025-04-17 22:19:02,011 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:19:02,011 - INFO - 
Training Period:
2025-04-17 22:19:02,017 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:19:02,030 - INFO - 
Testing Period:
2025-04-17 22:19:02,037 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:19:02,048 - INFO - Loading macro and market data...
2025-04-17 22:19:02,051 - INFO - Loading existing macro data...
2025-04-17 22:19:02,069 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:02,070 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:02,075 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:02,075 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:02,076 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:02,077 - INFO - Loading existing macro data...
2025-04-17 22:19:02,091 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:02,092 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:02,097 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:02,097 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:02,097 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:02,099 - INFO - Loading existing market data...
2025-04-17 22:19:02,104 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:02,105 - INFO - Loading existing market data...
2025-04-17 22:19:02,109 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:02,109 - INFO - Macro and market data loaded
2025-04-17 22:19:02,110 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:02,110 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:02,112 - INFO - Loading existing macro data...
2025-04-17 22:19:02,126 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:02,126 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:02,131 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:02,131 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:02,132 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:02,133 - INFO - Loading existing market data...
2025-04-17 22:19:02,138 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:02,162 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:19:02,162 - INFO - Prepared training data with 1536 samples
2025-04-17 22:19:02,163 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:02,163 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:02,165 - INFO - Loading existing macro data...
2025-04-17 22:19:02,181 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:02,182 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:02,186 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:02,186 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:02,187 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:02,188 - INFO - Loading existing market data...
2025-04-17 22:19:02,194 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:02,207 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:19:02,207 - INFO - Prepared test data with 1276 samples
2025-04-17 22:19:02,208 - INFO - Test data prepared
2025-04-17 22:19:02,208 - INFO - Storing data...
2025-04-17 22:19:02,208 - INFO - Aligning data indices...
2025-04-17 22:19:02,210 - INFO - Data indices aligned
2025-04-17 22:19:02,211 - INFO - Data preparation completed
2025-04-17 22:19:02,211 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:19:02,211 - INFO - Training models...
2025-04-17 22:19:02,211 - INFO - Starting model training...
2025-04-17 22:19:02,211 - INFO - Training regime classifier...
2025-04-17 22:19:02,212 - INFO - Training HMM model...
2025-04-17 22:19:02,531 - INFO - HMM model training completed
2025-04-17 22:19:03,024 - INFO - Model training completed
2025-04-17 22:19:03,026 - INFO - Model training completed
2025-04-17 22:19:03,027 - INFO - Initializing portfolio weights...
2025-04-17 22:19:03,027 - INFO - Portfolio weights initialized
2025-04-17 22:19:03,028 - INFO - Generating regime predictions for test period...
2025-04-17 22:19:03,030 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:19:03,030 - ERROR - Error running hmm with mean_variance and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:19:03,033 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 5 regimes
2025-04-17 22:19:03,033 - INFO - Initializing strategy...
2025-04-17 22:19:03,034 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 22:19:03,034 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:19:03,039 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:19:03,040 - INFO - Running strategy...
2025-04-17 22:19:03,040 - INFO - Starting strategy execution...
2025-04-17 22:19:03,040 - INFO - Preparing training and testing data...
2025-04-17 22:19:03,041 - INFO - Starting data preparation...
2025-04-17 22:19:03,041 - INFO - Loading Fama-French factors...
2025-04-17 22:19:03,056 - INFO - Fama-French factors loaded
2025-04-17 22:19:03,057 - INFO - Processing factor data...
2025-04-17 22:19:03,060 - INFO - Factor data processed
2025-04-17 22:19:03,061 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:19:03,061 - INFO - 
Training Period:
2025-04-17 22:19:03,068 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:19:03,080 - INFO - 
Testing Period:
2025-04-17 22:19:03,086 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:19:03,099 - INFO - Loading macro and market data...
2025-04-17 22:19:03,100 - INFO - Loading existing macro data...
2025-04-17 22:19:03,116 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:03,116 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:03,121 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:03,122 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:03,122 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:03,124 - INFO - Loading existing macro data...
2025-04-17 22:19:03,139 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:03,140 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:03,144 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:03,145 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:03,145 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:03,147 - INFO - Loading existing market data...
2025-04-17 22:19:03,152 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:03,154 - INFO - Loading existing market data...
2025-04-17 22:19:03,159 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:03,159 - INFO - Macro and market data loaded
2025-04-17 22:19:03,159 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:03,160 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:03,161 - INFO - Loading existing macro data...
2025-04-17 22:19:03,177 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:03,177 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:03,182 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:03,182 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:03,183 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:03,184 - INFO - Loading existing market data...
2025-04-17 22:19:03,190 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:03,211 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:19:03,212 - INFO - Prepared training data with 1536 samples
2025-04-17 22:19:03,212 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:03,213 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:03,215 - INFO - Loading existing macro data...
2025-04-17 22:19:03,232 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:03,232 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:03,238 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:03,238 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:03,239 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:03,240 - INFO - Loading existing market data...
2025-04-17 22:19:03,245 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:03,258 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:19:03,258 - INFO - Prepared test data with 1276 samples
2025-04-17 22:19:03,258 - INFO - Test data prepared
2025-04-17 22:19:03,259 - INFO - Storing data...
2025-04-17 22:19:03,259 - INFO - Aligning data indices...
2025-04-17 22:19:03,261 - INFO - Data indices aligned
2025-04-17 22:19:03,261 - INFO - Data preparation completed
2025-04-17 22:19:03,261 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:19:03,261 - INFO - Training models...
2025-04-17 22:19:03,262 - INFO - Starting model training...
2025-04-17 22:19:03,262 - INFO - Training regime classifier...
2025-04-17 22:19:03,262 - INFO - Training HMM model...
2025-04-17 22:19:03,596 - INFO - HMM model training completed
2025-04-17 22:19:03,925 - INFO - Model training completed
2025-04-17 22:19:03,929 - INFO - Model training completed
2025-04-17 22:19:03,929 - INFO - Initializing portfolio weights...
2025-04-17 22:19:03,930 - INFO - Portfolio weights initialized
2025-04-17 22:19:03,931 - INFO - Generating regime predictions for test period...
2025-04-17 22:19:03,933 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:19:03,934 - ERROR - Error running hmm with mean_variance and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:19:03,937 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 7 regimes
2025-04-17 22:19:03,937 - INFO - Initializing strategy...
2025-04-17 22:19:03,937 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 22:19:03,938 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:19:03,938 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:19:03,938 - INFO - Running strategy...
2025-04-17 22:19:03,939 - INFO - Starting strategy execution...
2025-04-17 22:19:03,939 - INFO - Preparing training and testing data...
2025-04-17 22:19:03,939 - INFO - Starting data preparation...
2025-04-17 22:19:03,939 - INFO - Loading Fama-French factors...
2025-04-17 22:19:03,956 - INFO - Fama-French factors loaded
2025-04-17 22:19:03,956 - INFO - Processing factor data...
2025-04-17 22:19:03,961 - INFO - Factor data processed
2025-04-17 22:19:03,962 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:19:03,962 - INFO - 
Training Period:
2025-04-17 22:19:03,972 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:19:03,993 - INFO - 
Testing Period:
2025-04-17 22:19:04,008 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:19:04,034 - INFO - Loading macro and market data...
2025-04-17 22:19:04,036 - INFO - Loading existing macro data...
2025-04-17 22:19:04,074 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:04,075 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:04,081 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:04,082 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:04,082 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:04,085 - INFO - Loading existing macro data...
2025-04-17 22:19:04,114 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:04,115 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:04,127 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:04,127 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:04,128 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:04,131 - INFO - Loading existing market data...
2025-04-17 22:19:04,144 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:04,148 - INFO - Loading existing market data...
2025-04-17 22:19:04,160 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:04,161 - INFO - Macro and market data loaded
2025-04-17 22:19:04,161 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:04,162 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:04,165 - INFO - Loading existing macro data...
2025-04-17 22:19:04,206 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:04,207 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:04,214 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:04,214 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:04,215 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:04,217 - INFO - Loading existing market data...
2025-04-17 22:19:04,224 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:04,251 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:19:04,251 - INFO - Prepared training data with 1536 samples
2025-04-17 22:19:04,252 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:04,252 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:04,254 - INFO - Loading existing macro data...
2025-04-17 22:19:04,272 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:04,272 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:04,278 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:04,279 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:04,279 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:04,281 - INFO - Loading existing market data...
2025-04-17 22:19:04,286 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:04,300 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:19:04,301 - INFO - Prepared test data with 1276 samples
2025-04-17 22:19:04,301 - INFO - Test data prepared
2025-04-17 22:19:04,301 - INFO - Storing data...
2025-04-17 22:19:04,301 - INFO - Aligning data indices...
2025-04-17 22:19:04,303 - INFO - Data indices aligned
2025-04-17 22:19:04,304 - INFO - Data preparation completed
2025-04-17 22:19:04,304 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:19:04,304 - INFO - Training models...
2025-04-17 22:19:04,304 - INFO - Starting model training...
2025-04-17 22:19:04,305 - INFO - Training regime classifier...
2025-04-17 22:19:04,305 - INFO - Training HMM model...
2025-04-17 22:19:04,665 - INFO - HMM model training completed
2025-04-17 22:19:05,001 - INFO - Model training completed
2025-04-17 22:19:05,004 - INFO - Model training completed
2025-04-17 22:19:05,005 - INFO - Initializing portfolio weights...
2025-04-17 22:19:05,006 - INFO - Portfolio weights initialized
2025-04-17 22:19:05,006 - INFO - Generating regime predictions for test period...
2025-04-17 22:19:05,008 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:19:05,009 - ERROR - Error running hmm with mean_variance and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:19:05,012 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 3 regimes
2025-04-17 22:19:05,012 - INFO - Initializing strategy...
2025-04-17 22:19:05,013 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 22:19:05,013 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:19:05,014 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:19:05,014 - INFO - Running strategy...
2025-04-17 22:19:05,014 - INFO - Starting strategy execution...
2025-04-17 22:19:05,015 - INFO - Preparing training and testing data...
2025-04-17 22:19:05,015 - INFO - Starting data preparation...
2025-04-17 22:19:05,015 - INFO - Loading Fama-French factors...
2025-04-17 22:19:05,032 - INFO - Fama-French factors loaded
2025-04-17 22:19:05,033 - INFO - Processing factor data...
2025-04-17 22:19:05,037 - INFO - Factor data processed
2025-04-17 22:19:05,037 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:19:05,038 - INFO - 
Training Period:
2025-04-17 22:19:05,044 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:19:05,057 - INFO - 
Testing Period:
2025-04-17 22:19:05,065 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:19:05,079 - INFO - Loading macro and market data...
2025-04-17 22:19:05,081 - INFO - Loading existing macro data...
2025-04-17 22:19:05,100 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:05,100 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:05,105 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:05,106 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:05,106 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:05,107 - INFO - Loading existing macro data...
2025-04-17 22:19:05,125 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:05,125 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:05,131 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:05,132 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:05,132 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:05,134 - INFO - Loading existing market data...
2025-04-17 22:19:05,139 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:05,141 - INFO - Loading existing market data...
2025-04-17 22:19:05,197 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:05,200 - INFO - Macro and market data loaded
2025-04-17 22:19:05,203 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:05,206 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:05,210 - INFO - Loading existing macro data...
2025-04-17 22:19:05,253 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:05,254 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:05,265 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:05,266 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:05,266 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:05,268 - INFO - Loading existing market data...
2025-04-17 22:19:05,278 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:05,325 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:19:05,325 - INFO - Prepared training data with 1536 samples
2025-04-17 22:19:05,326 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:05,326 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:05,329 - INFO - Loading existing macro data...
2025-04-17 22:19:05,350 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:05,350 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:05,356 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:05,356 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:05,356 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:05,358 - INFO - Loading existing market data...
2025-04-17 22:19:05,364 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:05,380 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:19:05,381 - INFO - Prepared test data with 1276 samples
2025-04-17 22:19:05,381 - INFO - Test data prepared
2025-04-17 22:19:05,382 - INFO - Storing data...
2025-04-17 22:19:05,382 - INFO - Aligning data indices...
2025-04-17 22:19:05,384 - INFO - Data indices aligned
2025-04-17 22:19:05,385 - INFO - Data preparation completed
2025-04-17 22:19:05,385 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:19:05,385 - INFO - Training models...
2025-04-17 22:19:05,385 - INFO - Starting model training...
2025-04-17 22:19:05,386 - INFO - Training regime classifier...
2025-04-17 22:19:05,386 - INFO - Training HMM model...
2025-04-17 22:19:05,726 - INFO - HMM model training completed
2025-04-17 22:19:06,131 - INFO - Model training completed
2025-04-17 22:19:06,133 - INFO - Model training completed
2025-04-17 22:19:06,134 - INFO - Initializing portfolio weights...
2025-04-17 22:19:06,135 - INFO - Portfolio weights initialized
2025-04-17 22:19:06,135 - INFO - Generating regime predictions for test period...
2025-04-17 22:19:06,138 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:19:06,139 - ERROR - Error running hmm with regime_aware and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:19:06,141 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 5 regimes
2025-04-17 22:19:06,141 - INFO - Initializing strategy...
2025-04-17 22:19:06,142 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 22:19:06,142 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:19:06,143 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:19:06,143 - INFO - Running strategy...
2025-04-17 22:19:06,144 - INFO - Starting strategy execution...
2025-04-17 22:19:06,144 - INFO - Preparing training and testing data...
2025-04-17 22:19:06,144 - INFO - Starting data preparation...
2025-04-17 22:19:06,145 - INFO - Loading Fama-French factors...
2025-04-17 22:19:06,162 - INFO - Fama-French factors loaded
2025-04-17 22:19:06,162 - INFO - Processing factor data...
2025-04-17 22:19:06,166 - INFO - Factor data processed
2025-04-17 22:19:06,167 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:19:06,167 - INFO - 
Training Period:
2025-04-17 22:19:06,177 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:19:06,196 - INFO - 
Testing Period:
2025-04-17 22:19:06,210 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:19:06,231 - INFO - Loading macro and market data...
2025-04-17 22:19:06,235 - INFO - Loading existing macro data...
2025-04-17 22:19:06,258 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:06,258 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:06,264 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:06,264 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:06,265 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:06,267 - INFO - Loading existing macro data...
2025-04-17 22:19:06,285 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:06,285 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:06,289 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:06,290 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:06,290 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:06,291 - INFO - Loading existing market data...
2025-04-17 22:19:06,297 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:06,298 - INFO - Loading existing market data...
2025-04-17 22:19:06,302 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:06,302 - INFO - Macro and market data loaded
2025-04-17 22:19:06,303 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:06,303 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:06,304 - INFO - Loading existing macro data...
2025-04-17 22:19:06,321 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:06,322 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:06,327 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:06,327 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:06,328 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:06,330 - INFO - Loading existing market data...
2025-04-17 22:19:06,335 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:06,357 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:19:06,358 - INFO - Prepared training data with 1536 samples
2025-04-17 22:19:06,358 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:06,359 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:06,361 - INFO - Loading existing macro data...
2025-04-17 22:19:06,380 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:06,381 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:06,385 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:06,386 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:06,386 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:06,388 - INFO - Loading existing market data...
2025-04-17 22:19:06,393 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:06,408 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:19:06,408 - INFO - Prepared test data with 1276 samples
2025-04-17 22:19:06,409 - INFO - Test data prepared
2025-04-17 22:19:06,409 - INFO - Storing data...
2025-04-17 22:19:06,409 - INFO - Aligning data indices...
2025-04-17 22:19:06,411 - INFO - Data indices aligned
2025-04-17 22:19:06,411 - INFO - Data preparation completed
2025-04-17 22:19:06,412 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:19:06,412 - INFO - Training models...
2025-04-17 22:19:06,412 - INFO - Starting model training...
2025-04-17 22:19:06,412 - INFO - Training regime classifier...
2025-04-17 22:19:06,412 - INFO - Training HMM model...
2025-04-17 22:19:06,748 - INFO - HMM model training completed
2025-04-17 22:19:07,093 - INFO - Model training completed
2025-04-17 22:19:07,096 - INFO - Model training completed
2025-04-17 22:19:07,097 - INFO - Initializing portfolio weights...
2025-04-17 22:19:07,098 - INFO - Portfolio weights initialized
2025-04-17 22:19:07,098 - INFO - Generating regime predictions for test period...
2025-04-17 22:19:07,101 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:19:07,102 - ERROR - Error running hmm with regime_aware and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:19:07,105 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 7 regimes
2025-04-17 22:19:07,105 - INFO - Initializing strategy...
2025-04-17 22:19:07,106 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 22:19:07,106 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:19:07,106 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:19:07,107 - INFO - Running strategy...
2025-04-17 22:19:07,107 - INFO - Starting strategy execution...
2025-04-17 22:19:07,107 - INFO - Preparing training and testing data...
2025-04-17 22:19:07,108 - INFO - Starting data preparation...
2025-04-17 22:19:07,108 - INFO - Loading Fama-French factors...
2025-04-17 22:19:07,123 - INFO - Fama-French factors loaded
2025-04-17 22:19:07,123 - INFO - Processing factor data...
2025-04-17 22:19:07,128 - INFO - Factor data processed
2025-04-17 22:19:07,129 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:19:07,129 - INFO - 
Training Period:
2025-04-17 22:19:07,136 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:19:07,147 - INFO - 
Testing Period:
2025-04-17 22:19:07,154 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:19:07,166 - INFO - Loading macro and market data...
2025-04-17 22:19:07,167 - INFO - Loading existing macro data...
2025-04-17 22:19:07,183 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:07,183 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:07,189 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:07,189 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:07,190 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:07,192 - INFO - Loading existing macro data...
2025-04-17 22:19:07,209 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:07,209 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:07,215 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:07,216 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:07,216 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:07,219 - INFO - Loading existing market data...
2025-04-17 22:19:07,228 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:07,230 - INFO - Loading existing market data...
2025-04-17 22:19:07,237 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:07,238 - INFO - Macro and market data loaded
2025-04-17 22:19:07,238 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:07,239 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:07,241 - INFO - Loading existing macro data...
2025-04-17 22:19:07,266 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:07,266 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:07,271 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:07,272 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:07,273 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:07,275 - INFO - Loading existing market data...
2025-04-17 22:19:07,280 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:07,302 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:19:07,303 - INFO - Prepared training data with 1536 samples
2025-04-17 22:19:07,303 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:07,304 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:07,305 - INFO - Loading existing macro data...
2025-04-17 22:19:07,322 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:07,323 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:07,328 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:07,328 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:07,329 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:07,330 - INFO - Loading existing market data...
2025-04-17 22:19:07,336 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:07,348 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:19:07,348 - INFO - Prepared test data with 1276 samples
2025-04-17 22:19:07,349 - INFO - Test data prepared
2025-04-17 22:19:07,349 - INFO - Storing data...
2025-04-17 22:19:07,349 - INFO - Aligning data indices...
2025-04-17 22:19:07,351 - INFO - Data indices aligned
2025-04-17 22:19:07,351 - INFO - Data preparation completed
2025-04-17 22:19:07,352 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:19:07,352 - INFO - Training models...
2025-04-17 22:19:07,352 - INFO - Starting model training...
2025-04-17 22:19:07,352 - INFO - Training regime classifier...
2025-04-17 22:19:07,352 - INFO - Training HMM model...
2025-04-17 22:19:07,649 - INFO - HMM model training completed
2025-04-17 22:19:07,965 - INFO - Model training completed
2025-04-17 22:19:07,967 - INFO - Model training completed
2025-04-17 22:19:07,968 - INFO - Initializing portfolio weights...
2025-04-17 22:19:07,968 - INFO - Portfolio weights initialized
2025-04-17 22:19:07,968 - INFO - Generating regime predictions for test period...
2025-04-17 22:19:07,971 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:19:07,971 - ERROR - Error running hmm with regime_aware and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:19:07,973 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 3 regimes
2025-04-17 22:19:07,973 - INFO - Initializing strategy...
2025-04-17 22:19:07,974 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 22:19:07,974 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:19:07,974 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:19:07,974 - INFO - Running strategy...
2025-04-17 22:19:07,974 - INFO - Starting strategy execution...
2025-04-17 22:19:07,975 - INFO - Preparing training and testing data...
2025-04-17 22:19:07,975 - INFO - Starting data preparation...
2025-04-17 22:19:07,975 - INFO - Loading Fama-French factors...
2025-04-17 22:19:07,993 - INFO - Fama-French factors loaded
2025-04-17 22:19:07,994 - INFO - Processing factor data...
2025-04-17 22:19:07,997 - INFO - Factor data processed
2025-04-17 22:19:07,997 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:19:07,997 - INFO - 
Training Period:
2025-04-17 22:19:08,006 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:19:08,016 - INFO - 
Testing Period:
2025-04-17 22:19:08,023 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:19:08,035 - INFO - Loading macro and market data...
2025-04-17 22:19:08,036 - INFO - Loading existing macro data...
2025-04-17 22:19:08,055 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:08,055 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:08,059 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:08,060 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:08,060 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:08,062 - INFO - Loading existing macro data...
2025-04-17 22:19:08,078 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:08,079 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:08,084 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:08,084 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:08,084 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:08,086 - INFO - Loading existing market data...
2025-04-17 22:19:08,092 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:08,094 - INFO - Loading existing market data...
2025-04-17 22:19:08,099 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:08,099 - INFO - Macro and market data loaded
2025-04-17 22:19:08,100 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:08,100 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:08,101 - INFO - Loading existing macro data...
2025-04-17 22:19:08,118 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:08,118 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:08,122 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:08,123 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:08,123 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:08,125 - INFO - Loading existing market data...
2025-04-17 22:19:08,131 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:08,152 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:19:08,153 - INFO - Prepared training data with 1536 samples
2025-04-17 22:19:08,153 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:08,153 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:08,155 - INFO - Loading existing macro data...
2025-04-17 22:19:08,171 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:08,171 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:08,176 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:08,177 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:08,177 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:08,179 - INFO - Loading existing market data...
2025-04-17 22:19:08,185 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:08,200 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:19:08,201 - INFO - Prepared test data with 1276 samples
2025-04-17 22:19:08,201 - INFO - Test data prepared
2025-04-17 22:19:08,201 - INFO - Storing data...
2025-04-17 22:19:08,202 - INFO - Aligning data indices...
2025-04-17 22:19:08,204 - INFO - Data indices aligned
2025-04-17 22:19:08,204 - INFO - Data preparation completed
2025-04-17 22:19:08,205 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:19:08,205 - INFO - Training models...
2025-04-17 22:19:08,205 - INFO - Starting model training...
2025-04-17 22:19:08,205 - INFO - Training regime classifier...
2025-04-17 22:19:08,206 - INFO - Training HMM model...
2025-04-17 22:19:08,538 - INFO - HMM model training completed
2025-04-17 22:19:08,841 - INFO - Model training completed
2025-04-17 22:19:08,843 - INFO - Model training completed
2025-04-17 22:19:08,844 - INFO - Initializing portfolio weights...
2025-04-17 22:19:08,845 - INFO - Portfolio weights initialized
2025-04-17 22:19:08,845 - INFO - Generating regime predictions for test period...
2025-04-17 22:19:08,847 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:19:08,848 - ERROR - Error running hmm with neural_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:19:08,850 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 5 regimes
2025-04-17 22:19:08,850 - INFO - Initializing strategy...
2025-04-17 22:19:08,850 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 22:19:08,851 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:19:08,851 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:19:08,851 - INFO - Running strategy...
2025-04-17 22:19:08,852 - INFO - Starting strategy execution...
2025-04-17 22:19:08,852 - INFO - Preparing training and testing data...
2025-04-17 22:19:08,852 - INFO - Starting data preparation...
2025-04-17 22:19:08,852 - INFO - Loading Fama-French factors...
2025-04-17 22:19:08,868 - INFO - Fama-French factors loaded
2025-04-17 22:19:08,868 - INFO - Processing factor data...
2025-04-17 22:19:08,871 - INFO - Factor data processed
2025-04-17 22:19:08,871 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:19:08,871 - INFO - 
Training Period:
2025-04-17 22:19:08,878 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:19:08,890 - INFO - 
Testing Period:
2025-04-17 22:19:08,896 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:19:08,908 - INFO - Loading macro and market data...
2025-04-17 22:19:08,910 - INFO - Loading existing macro data...
2025-04-17 22:19:08,926 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:08,927 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:08,932 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:08,932 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:08,933 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:08,934 - INFO - Loading existing macro data...
2025-04-17 22:19:08,950 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:08,951 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:08,955 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:08,956 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:08,956 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:08,958 - INFO - Loading existing market data...
2025-04-17 22:19:08,964 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:08,965 - INFO - Loading existing market data...
2025-04-17 22:19:08,969 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:08,970 - INFO - Macro and market data loaded
2025-04-17 22:19:08,970 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:08,970 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:08,972 - INFO - Loading existing macro data...
2025-04-17 22:19:08,988 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:08,989 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:08,993 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:08,994 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:08,994 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:08,996 - INFO - Loading existing market data...
2025-04-17 22:19:09,002 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:09,022 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:19:09,022 - INFO - Prepared training data with 1536 samples
2025-04-17 22:19:09,022 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:09,023 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:09,024 - INFO - Loading existing macro data...
2025-04-17 22:19:09,044 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:09,044 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:09,049 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:09,049 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:09,050 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:09,052 - INFO - Loading existing market data...
2025-04-17 22:19:09,056 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:09,069 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:19:09,069 - INFO - Prepared test data with 1276 samples
2025-04-17 22:19:09,070 - INFO - Test data prepared
2025-04-17 22:19:09,070 - INFO - Storing data...
2025-04-17 22:19:09,070 - INFO - Aligning data indices...
2025-04-17 22:19:09,072 - INFO - Data indices aligned
2025-04-17 22:19:09,072 - INFO - Data preparation completed
2025-04-17 22:19:09,072 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:19:09,073 - INFO - Training models...
2025-04-17 22:19:09,073 - INFO - Starting model training...
2025-04-17 22:19:09,073 - INFO - Training regime classifier...
2025-04-17 22:19:09,073 - INFO - Training HMM model...
2025-04-17 22:19:09,387 - INFO - HMM model training completed
2025-04-17 22:19:09,708 - INFO - Model training completed
2025-04-17 22:19:09,711 - INFO - Model training completed
2025-04-17 22:19:09,712 - INFO - Initializing portfolio weights...
2025-04-17 22:19:09,713 - INFO - Portfolio weights initialized
2025-04-17 22:19:09,714 - INFO - Generating regime predictions for test period...
2025-04-17 22:19:09,716 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:19:09,717 - ERROR - Error running hmm with neural_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:19:09,719 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 7 regimes
2025-04-17 22:19:09,719 - INFO - Initializing strategy...
2025-04-17 22:19:09,720 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 22:19:09,720 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:19:09,720 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:19:09,721 - INFO - Running strategy...
2025-04-17 22:19:09,721 - INFO - Starting strategy execution...
2025-04-17 22:19:09,722 - INFO - Preparing training and testing data...
2025-04-17 22:19:09,722 - INFO - Starting data preparation...
2025-04-17 22:19:09,722 - INFO - Loading Fama-French factors...
2025-04-17 22:19:09,736 - INFO - Fama-French factors loaded
2025-04-17 22:19:09,737 - INFO - Processing factor data...
2025-04-17 22:19:09,741 - INFO - Factor data processed
2025-04-17 22:19:09,742 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:19:09,742 - INFO - 
Training Period:
2025-04-17 22:19:09,749 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:19:09,760 - INFO - 
Testing Period:
2025-04-17 22:19:09,767 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:19:09,780 - INFO - Loading macro and market data...
2025-04-17 22:19:09,781 - INFO - Loading existing macro data...
2025-04-17 22:19:09,799 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:09,800 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:09,805 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:09,805 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:09,805 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:09,807 - INFO - Loading existing macro data...
2025-04-17 22:19:09,824 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:09,824 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:09,830 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:09,830 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:09,831 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:09,833 - INFO - Loading existing market data...
2025-04-17 22:19:09,839 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:09,840 - INFO - Loading existing market data...
2025-04-17 22:19:09,844 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:09,845 - INFO - Macro and market data loaded
2025-04-17 22:19:09,845 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:09,845 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:09,847 - INFO - Loading existing macro data...
2025-04-17 22:19:09,864 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:09,864 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:09,869 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:09,869 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:09,870 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:09,871 - INFO - Loading existing market data...
2025-04-17 22:19:09,876 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:09,899 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:19:09,899 - INFO - Prepared training data with 1536 samples
2025-04-17 22:19:09,899 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:09,900 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:09,901 - INFO - Loading existing macro data...
2025-04-17 22:19:09,919 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:09,919 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:09,924 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:09,924 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:09,925 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:09,927 - INFO - Loading existing market data...
2025-04-17 22:19:09,932 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:09,945 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:19:09,946 - INFO - Prepared test data with 1276 samples
2025-04-17 22:19:09,946 - INFO - Test data prepared
2025-04-17 22:19:09,947 - INFO - Storing data...
2025-04-17 22:19:09,947 - INFO - Aligning data indices...
2025-04-17 22:19:09,949 - INFO - Data indices aligned
2025-04-17 22:19:09,949 - INFO - Data preparation completed
2025-04-17 22:19:09,949 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:19:09,950 - INFO - Training models...
2025-04-17 22:19:09,950 - INFO - Starting model training...
2025-04-17 22:19:09,950 - INFO - Training regime classifier...
2025-04-17 22:19:09,951 - INFO - Training HMM model...
2025-04-17 22:19:10,305 - INFO - HMM model training completed
2025-04-17 22:19:10,674 - INFO - Model training completed
2025-04-17 22:19:10,676 - INFO - Model training completed
2025-04-17 22:19:10,677 - INFO - Initializing portfolio weights...
2025-04-17 22:19:10,678 - INFO - Portfolio weights initialized
2025-04-17 22:19:10,678 - INFO - Generating regime predictions for test period...
2025-04-17 22:19:10,681 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:19:10,682 - ERROR - Error running hmm with neural_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:19:10,684 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 22:19:10,685 - INFO - Initializing strategy...
2025-04-17 22:19:10,685 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 22:19:10,686 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:19:10,686 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:19:10,686 - INFO - Running strategy...
2025-04-17 22:19:10,687 - INFO - Starting strategy execution...
2025-04-17 22:19:10,687 - INFO - Preparing training and testing data...
2025-04-17 22:19:10,687 - INFO - Starting data preparation...
2025-04-17 22:19:10,687 - INFO - Loading Fama-French factors...
2025-04-17 22:19:10,701 - INFO - Fama-French factors loaded
2025-04-17 22:19:10,702 - INFO - Processing factor data...
2025-04-17 22:19:10,705 - INFO - Factor data processed
2025-04-17 22:19:10,705 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:19:10,705 - INFO - 
Training Period:
2025-04-17 22:19:10,712 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:19:10,725 - INFO - 
Testing Period:
2025-04-17 22:19:10,732 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:19:10,743 - INFO - Loading macro and market data...
2025-04-17 22:19:10,745 - INFO - Loading existing macro data...
2025-04-17 22:19:10,760 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:10,761 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:10,767 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:10,767 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:10,768 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:10,770 - INFO - Loading existing macro data...
2025-04-17 22:19:10,785 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:10,786 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:10,792 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:10,792 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:10,793 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:10,795 - INFO - Loading existing market data...
2025-04-17 22:19:10,800 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:10,802 - INFO - Loading existing market data...
2025-04-17 22:19:10,810 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:10,810 - INFO - Macro and market data loaded
2025-04-17 22:19:10,811 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:10,811 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:10,813 - INFO - Loading existing macro data...
2025-04-17 22:19:10,830 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:10,831 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:10,836 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:10,836 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:10,837 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:10,840 - INFO - Loading existing market data...
2025-04-17 22:19:10,848 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:10,869 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:19:10,869 - INFO - Prepared training data with 1536 samples
2025-04-17 22:19:10,870 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:10,870 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:10,871 - INFO - Loading existing macro data...
2025-04-17 22:19:10,887 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:10,888 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:10,892 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:10,893 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:10,893 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:10,895 - INFO - Loading existing market data...
2025-04-17 22:19:10,902 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:10,915 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:19:10,916 - INFO - Prepared test data with 1276 samples
2025-04-17 22:19:10,916 - INFO - Test data prepared
2025-04-17 22:19:10,917 - INFO - Storing data...
2025-04-17 22:19:10,917 - INFO - Aligning data indices...
2025-04-17 22:19:10,919 - INFO - Data indices aligned
2025-04-17 22:19:10,919 - INFO - Data preparation completed
2025-04-17 22:19:10,919 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:19:10,920 - INFO - Training models...
2025-04-17 22:19:10,920 - INFO - Starting model training...
2025-04-17 22:19:10,920 - INFO - Training regime classifier...
2025-04-17 22:19:10,920 - INFO - Training HMM model...
2025-04-17 22:19:11,257 - INFO - HMM model training completed
2025-04-17 22:19:11,558 - INFO - Model training completed
2025-04-17 22:19:11,561 - INFO - Model training completed
2025-04-17 22:19:11,562 - INFO - Initializing portfolio weights...
2025-04-17 22:19:11,562 - INFO - Portfolio weights initialized
2025-04-17 22:19:11,563 - INFO - Generating regime predictions for test period...
2025-04-17 22:19:11,565 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:19:11,566 - ERROR - Error running hmm with autoencoder_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:19:11,569 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 22:19:11,569 - INFO - Initializing strategy...
2025-04-17 22:19:11,569 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 22:19:11,570 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:19:11,570 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:19:11,570 - INFO - Running strategy...
2025-04-17 22:19:11,571 - INFO - Starting strategy execution...
2025-04-17 22:19:11,571 - INFO - Preparing training and testing data...
2025-04-17 22:19:11,571 - INFO - Starting data preparation...
2025-04-17 22:19:11,572 - INFO - Loading Fama-French factors...
2025-04-17 22:19:11,587 - INFO - Fama-French factors loaded
2025-04-17 22:19:11,587 - INFO - Processing factor data...
2025-04-17 22:19:11,590 - INFO - Factor data processed
2025-04-17 22:19:11,591 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:19:11,591 - INFO - 
Training Period:
2025-04-17 22:19:11,599 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:19:11,611 - INFO - 
Testing Period:
2025-04-17 22:19:11,618 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:19:11,629 - INFO - Loading macro and market data...
2025-04-17 22:19:11,631 - INFO - Loading existing macro data...
2025-04-17 22:19:11,646 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:11,646 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:11,651 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:11,651 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:11,651 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:11,654 - INFO - Loading existing macro data...
2025-04-17 22:19:11,668 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:11,668 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:11,673 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:11,674 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:11,674 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:11,676 - INFO - Loading existing market data...
2025-04-17 22:19:11,682 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:11,684 - INFO - Loading existing market data...
2025-04-17 22:19:11,690 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:11,690 - INFO - Macro and market data loaded
2025-04-17 22:19:11,691 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:11,691 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:11,693 - INFO - Loading existing macro data...
2025-04-17 22:19:11,707 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:11,708 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:11,712 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:11,712 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:11,712 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:11,714 - INFO - Loading existing market data...
2025-04-17 22:19:11,719 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:11,738 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:19:11,738 - INFO - Prepared training data with 1536 samples
2025-04-17 22:19:11,739 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:11,739 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:11,741 - INFO - Loading existing macro data...
2025-04-17 22:19:11,760 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:11,760 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:11,765 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:11,765 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:11,765 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:11,767 - INFO - Loading existing market data...
2025-04-17 22:19:11,773 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:11,786 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:19:11,786 - INFO - Prepared test data with 1276 samples
2025-04-17 22:19:11,787 - INFO - Test data prepared
2025-04-17 22:19:11,787 - INFO - Storing data...
2025-04-17 22:19:11,787 - INFO - Aligning data indices...
2025-04-17 22:19:11,789 - INFO - Data indices aligned
2025-04-17 22:19:11,789 - INFO - Data preparation completed
2025-04-17 22:19:11,789 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:19:11,790 - INFO - Training models...
2025-04-17 22:19:11,790 - INFO - Starting model training...
2025-04-17 22:19:11,790 - INFO - Training regime classifier...
2025-04-17 22:19:11,790 - INFO - Training HMM model...
2025-04-17 22:19:12,037 - WARNING - Model is not converging.  Current: 6604.335530223643 is not greater than 21252.70127342751. Delta is -14648.365743203865
2025-04-17 22:19:12,037 - INFO - HMM model training completed
2025-04-17 22:19:12,333 - INFO - Model training completed
2025-04-17 22:19:12,336 - INFO - Model training completed
2025-04-17 22:19:12,336 - INFO - Initializing portfolio weights...
2025-04-17 22:19:12,337 - INFO - Portfolio weights initialized
2025-04-17 22:19:12,337 - INFO - Generating regime predictions for test period...
2025-04-17 22:19:12,340 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:19:12,341 - ERROR - Error running hmm with autoencoder_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:19:12,343 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 22:19:12,343 - INFO - Initializing strategy...
2025-04-17 22:19:12,343 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 22:19:12,344 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:19:12,344 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:19:12,344 - INFO - Running strategy...
2025-04-17 22:19:12,345 - INFO - Starting strategy execution...
2025-04-17 22:19:12,345 - INFO - Preparing training and testing data...
2025-04-17 22:19:12,345 - INFO - Starting data preparation...
2025-04-17 22:19:12,345 - INFO - Loading Fama-French factors...
2025-04-17 22:19:12,360 - INFO - Fama-French factors loaded
2025-04-17 22:19:12,360 - INFO - Processing factor data...
2025-04-17 22:19:12,365 - INFO - Factor data processed
2025-04-17 22:19:12,365 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:19:12,365 - INFO - 
Training Period:
2025-04-17 22:19:12,373 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:19:12,384 - INFO - 
Testing Period:
2025-04-17 22:19:12,391 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:19:12,403 - INFO - Loading macro and market data...
2025-04-17 22:19:12,405 - INFO - Loading existing macro data...
2025-04-17 22:19:12,420 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:12,421 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:12,425 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:12,426 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:12,426 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:12,427 - INFO - Loading existing macro data...
2025-04-17 22:19:12,443 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:12,443 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:12,448 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:12,449 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:12,450 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:12,452 - INFO - Loading existing market data...
2025-04-17 22:19:12,459 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:12,462 - INFO - Loading existing market data...
2025-04-17 22:19:12,467 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:12,467 - INFO - Macro and market data loaded
2025-04-17 22:19:12,468 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:12,468 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:12,469 - INFO - Loading existing macro data...
2025-04-17 22:19:12,486 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:12,486 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:12,490 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:12,491 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:12,491 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:12,493 - INFO - Loading existing market data...
2025-04-17 22:19:12,498 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:12,520 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:19:12,521 - INFO - Prepared training data with 1536 samples
2025-04-17 22:19:12,521 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:12,521 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:12,523 - INFO - Loading existing macro data...
2025-04-17 22:19:12,542 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:12,542 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:12,547 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:12,548 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:12,548 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:12,550 - INFO - Loading existing market data...
2025-04-17 22:19:12,556 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:12,568 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:19:12,568 - INFO - Prepared test data with 1276 samples
2025-04-17 22:19:12,569 - INFO - Test data prepared
2025-04-17 22:19:12,569 - INFO - Storing data...
2025-04-17 22:19:12,569 - INFO - Aligning data indices...
2025-04-17 22:19:12,572 - INFO - Data indices aligned
2025-04-17 22:19:12,572 - INFO - Data preparation completed
2025-04-17 22:19:12,572 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:19:12,572 - INFO - Training models...
2025-04-17 22:19:12,573 - INFO - Starting model training...
2025-04-17 22:19:12,573 - INFO - Training regime classifier...
2025-04-17 22:19:12,573 - INFO - Training HMM model...
2025-04-17 22:19:12,896 - INFO - HMM model training completed
2025-04-17 22:19:13,281 - INFO - Model training completed
2025-04-17 22:19:13,285 - INFO - Model training completed
2025-04-17 22:19:13,285 - INFO - Initializing portfolio weights...
2025-04-17 22:19:13,286 - INFO - Portfolio weights initialized
2025-04-17 22:19:13,287 - INFO - Generating regime predictions for test period...
2025-04-17 22:19:13,289 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:19:13,290 - ERROR - Error running hmm with autoencoder_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:19:13,293 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 3 regimes
2025-04-17 22:19:13,293 - INFO - Initializing strategy...
2025-04-17 22:19:13,294 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 22:19:13,294 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:19:13,295 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:19:13,296 - INFO - Running strategy...
2025-04-17 22:19:13,296 - INFO - Starting strategy execution...
2025-04-17 22:19:13,297 - INFO - Preparing training and testing data...
2025-04-17 22:19:13,297 - INFO - Starting data preparation...
2025-04-17 22:19:13,297 - INFO - Loading Fama-French factors...
2025-04-17 22:19:13,331 - INFO - Fama-French factors loaded
2025-04-17 22:19:13,339 - INFO - Processing factor data...
2025-04-17 22:19:13,350 - INFO - Factor data processed
2025-04-17 22:19:13,352 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:19:13,353 - INFO - 
Training Period:
2025-04-17 22:19:13,367 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:19:13,403 - INFO - 
Testing Period:
2025-04-17 22:19:13,416 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:19:13,437 - INFO - Loading macro and market data...
2025-04-17 22:19:13,439 - INFO - Loading existing macro data...
2025-04-17 22:19:13,462 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:13,462 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:13,469 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:13,470 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:13,470 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:13,473 - INFO - Loading existing macro data...
2025-04-17 22:19:13,488 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:13,489 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:13,492 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:13,492 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:13,493 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:13,494 - INFO - Loading existing market data...
2025-04-17 22:19:13,499 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:13,500 - INFO - Loading existing market data...
2025-04-17 22:19:13,504 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:13,504 - INFO - Macro and market data loaded
2025-04-17 22:19:13,504 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:13,504 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:13,505 - INFO - Loading existing macro data...
2025-04-17 22:19:13,519 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:13,520 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:13,526 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:13,527 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:13,527 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:13,534 - INFO - Loading existing market data...
2025-04-17 22:19:13,544 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:13,574 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:19:13,575 - INFO - Prepared training data with 1536 samples
2025-04-17 22:19:13,576 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:13,576 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:13,580 - INFO - Loading existing macro data...
2025-04-17 22:19:13,606 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:13,607 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:13,611 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:13,611 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:13,611 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:13,613 - INFO - Loading existing market data...
2025-04-17 22:19:13,617 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:13,629 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:19:13,629 - INFO - Prepared test data with 1276 samples
2025-04-17 22:19:13,629 - INFO - Test data prepared
2025-04-17 22:19:13,630 - INFO - Storing data...
2025-04-17 22:19:13,630 - INFO - Aligning data indices...
2025-04-17 22:19:13,632 - INFO - Data indices aligned
2025-04-17 22:19:13,633 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:19:13,633 - INFO - Data preparation completed
2025-04-17 22:19:13,633 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:19:13,633 - INFO - Training models...
2025-04-17 22:19:13,634 - INFO - Starting model training...
2025-04-17 22:19:13,634 - INFO - Training regime classifier...
2025-04-17 22:19:13,634 - INFO - Training HMM model...
2025-04-17 22:19:13,893 - WARNING - Model is not converging.  Current: 6604.3355302216605 is not greater than 21252.701273798015. Delta is -14648.365743576354
2025-04-17 22:19:13,893 - INFO - HMM model training completed
2025-04-17 22:19:15,034 - INFO - Training neural portfolio optimizer...
2025-04-17 22:19:15,035 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:19:15,035 - INFO - Model training completed
2025-04-17 22:19:15,038 - INFO - Model training completed
2025-04-17 22:19:15,038 - INFO - Initializing portfolio weights...
2025-04-17 22:19:15,039 - INFO - Portfolio weights initialized
2025-04-17 22:19:15,039 - INFO - Generating regime predictions for test period...
2025-04-17 22:19:15,042 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:19:15,043 - ERROR - Error running hmm with neural and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:19:15,046 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 5 regimes
2025-04-17 22:19:15,046 - INFO - Initializing strategy...
2025-04-17 22:19:15,046 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 22:19:15,047 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:19:15,047 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:19:15,048 - INFO - Running strategy...
2025-04-17 22:19:15,048 - INFO - Starting strategy execution...
2025-04-17 22:19:15,049 - INFO - Preparing training and testing data...
2025-04-17 22:19:15,049 - INFO - Starting data preparation...
2025-04-17 22:19:15,049 - INFO - Loading Fama-French factors...
2025-04-17 22:19:15,066 - INFO - Fama-French factors loaded
2025-04-17 22:19:15,067 - INFO - Processing factor data...
2025-04-17 22:19:15,080 - INFO - Factor data processed
2025-04-17 22:19:15,080 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:19:15,081 - INFO - 
Training Period:
2025-04-17 22:19:15,099 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:19:15,113 - INFO - 
Testing Period:
2025-04-17 22:19:15,123 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:19:15,138 - INFO - Loading macro and market data...
2025-04-17 22:19:15,140 - INFO - Loading existing macro data...
2025-04-17 22:19:15,158 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:15,158 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:15,164 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:15,164 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:15,165 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:15,167 - INFO - Loading existing macro data...
2025-04-17 22:19:15,189 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:15,189 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:15,193 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:15,194 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:15,194 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:15,196 - INFO - Loading existing market data...
2025-04-17 22:19:15,202 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:15,204 - INFO - Loading existing market data...
2025-04-17 22:19:15,208 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:15,209 - INFO - Macro and market data loaded
2025-04-17 22:19:15,209 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:15,209 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:15,211 - INFO - Loading existing macro data...
2025-04-17 22:19:15,235 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:15,235 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:15,241 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:15,242 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:15,242 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:15,244 - INFO - Loading existing market data...
2025-04-17 22:19:15,251 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:15,282 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:19:15,282 - INFO - Prepared training data with 1536 samples
2025-04-17 22:19:15,283 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:15,283 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:15,285 - INFO - Loading existing macro data...
2025-04-17 22:19:15,308 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:15,309 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:15,314 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:15,315 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:15,315 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:15,318 - INFO - Loading existing market data...
2025-04-17 22:19:15,323 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:15,335 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:19:15,336 - INFO - Prepared test data with 1276 samples
2025-04-17 22:19:15,336 - INFO - Test data prepared
2025-04-17 22:19:15,336 - INFO - Storing data...
2025-04-17 22:19:15,336 - INFO - Aligning data indices...
2025-04-17 22:19:15,339 - INFO - Data indices aligned
2025-04-17 22:19:15,339 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:19:15,340 - INFO - Data preparation completed
2025-04-17 22:19:15,340 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:19:15,340 - INFO - Training models...
2025-04-17 22:19:15,340 - INFO - Starting model training...
2025-04-17 22:19:15,341 - INFO - Training regime classifier...
2025-04-17 22:19:15,341 - INFO - Training HMM model...
2025-04-17 22:19:15,758 - INFO - HMM model training completed
2025-04-17 22:19:16,133 - INFO - Training neural portfolio optimizer...
2025-04-17 22:19:16,133 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:19:16,134 - INFO - Model training completed
2025-04-17 22:19:16,137 - INFO - Model training completed
2025-04-17 22:19:16,137 - INFO - Initializing portfolio weights...
2025-04-17 22:19:16,138 - INFO - Portfolio weights initialized
2025-04-17 22:19:16,138 - INFO - Generating regime predictions for test period...
2025-04-17 22:19:16,140 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:19:16,141 - ERROR - Error running hmm with neural and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:19:16,144 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 7 regimes
2025-04-17 22:19:16,144 - INFO - Initializing strategy...
2025-04-17 22:19:16,144 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 22:19:16,144 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:19:16,144 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:19:16,145 - INFO - Running strategy...
2025-04-17 22:19:16,146 - INFO - Starting strategy execution...
2025-04-17 22:19:16,146 - INFO - Preparing training and testing data...
2025-04-17 22:19:16,146 - INFO - Starting data preparation...
2025-04-17 22:19:16,146 - INFO - Loading Fama-French factors...
2025-04-17 22:19:16,163 - INFO - Fama-French factors loaded
2025-04-17 22:19:16,163 - INFO - Processing factor data...
2025-04-17 22:19:16,166 - INFO - Factor data processed
2025-04-17 22:19:16,166 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:19:16,167 - INFO - 
Training Period:
2025-04-17 22:19:16,173 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:19:16,187 - INFO - 
Testing Period:
2025-04-17 22:19:16,197 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:19:16,209 - INFO - Loading macro and market data...
2025-04-17 22:19:16,210 - INFO - Loading existing macro data...
2025-04-17 22:19:16,225 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:16,225 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:16,230 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:16,230 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:16,230 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:16,232 - INFO - Loading existing macro data...
2025-04-17 22:19:16,247 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:16,247 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:16,252 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:16,252 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:16,253 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:16,255 - INFO - Loading existing market data...
2025-04-17 22:19:16,260 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:16,262 - INFO - Loading existing market data...
2025-04-17 22:19:16,266 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:16,267 - INFO - Macro and market data loaded
2025-04-17 22:19:16,267 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:16,268 - INFO - Preparing training data for regime classification...
2025-04-17 22:19:16,269 - INFO - Loading existing macro data...
2025-04-17 22:19:16,283 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:16,284 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:16,288 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:16,289 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:19:16,289 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:19:16,291 - INFO - Loading existing market data...
2025-04-17 22:19:16,296 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:19:16,326 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:19:16,326 - INFO - Prepared training data with 1536 samples
2025-04-17 22:19:16,326 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:16,327 - INFO - Preparing test data for regime classification...
2025-04-17 22:19:16,329 - INFO - Loading existing macro data...
2025-04-17 22:19:16,345 - WARNING - US corporate credit spread file not found
2025-04-17 22:19:16,345 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:19:16,350 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:19:16,351 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:19:16,351 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:19:16,353 - INFO - Loading existing market data...
2025-04-17 22:19:16,360 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:19:16,376 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:19:16,376 - INFO - Prepared test data with 1276 samples
2025-04-17 22:19:16,376 - INFO - Test data prepared
2025-04-17 22:19:16,377 - INFO - Storing data...
2025-04-17 22:19:16,377 - INFO - Aligning data indices...
2025-04-17 22:19:16,379 - INFO - Data indices aligned
2025-04-17 22:19:16,380 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:19:16,381 - INFO - Data preparation completed
2025-04-17 22:19:16,381 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:19:16,381 - INFO - Training models...
2025-04-17 22:19:16,381 - INFO - Starting model training...
2025-04-17 22:19:16,382 - INFO - Training regime classifier...
2025-04-17 22:19:16,382 - INFO - Training HMM model...
2025-04-17 22:19:16,700 - INFO - HMM model training completed
2025-04-17 22:19:17,046 - INFO - Training neural portfolio optimizer...
2025-04-17 22:19:17,047 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:19:17,047 - INFO - Model training completed
2025-04-17 22:19:17,050 - INFO - Model training completed
2025-04-17 22:19:17,051 - INFO - Initializing portfolio weights...
2025-04-17 22:19:17,051 - INFO - Portfolio weights initialized
2025-04-17 22:19:17,052 - INFO - Generating regime predictions for test period...
2025-04-17 22:19:17,056 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:19:17,057 - ERROR - Error running hmm with neural and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 262, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:19:17,060 - ERROR - No valid results obtained from parameter grid search
2025-04-17 22:19:17,061 - ERROR - No valid results obtained from parameter grid search
2025-04-17 22:19:17,061 - INFO - Factor timing strategy optimization completed
2025-04-17 22:22:01,664 - INFO - Starting factor timing strategy optimization...
2025-04-17 22:22:01,665 - INFO - Running parameter grid search...
2025-04-17 22:22:01,665 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 3 regimes
2025-04-17 22:22:01,665 - INFO - Initializing strategy...
2025-04-17 22:22:01,665 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 22:22:01,665 - ERROR - Error running lstm with mean_variance and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:22:01,667 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 5 regimes
2025-04-17 22:22:01,667 - INFO - Initializing strategy...
2025-04-17 22:22:01,667 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 22:22:01,667 - ERROR - Error running lstm with mean_variance and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:22:01,668 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 7 regimes
2025-04-17 22:22:01,668 - INFO - Initializing strategy...
2025-04-17 22:22:01,668 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 22:22:01,669 - ERROR - Error running lstm with mean_variance and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:22:01,669 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 3 regimes
2025-04-17 22:22:01,669 - INFO - Initializing strategy...
2025-04-17 22:22:01,669 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 22:22:01,669 - ERROR - Error running lstm with regime_aware and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:22:01,670 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 5 regimes
2025-04-17 22:22:01,670 - INFO - Initializing strategy...
2025-04-17 22:22:01,670 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 22:22:01,670 - ERROR - Error running lstm with regime_aware and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:22:01,671 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 7 regimes
2025-04-17 22:22:01,671 - INFO - Initializing strategy...
2025-04-17 22:22:01,671 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 22:22:01,672 - ERROR - Error running lstm with regime_aware and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:22:01,672 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 3 regimes
2025-04-17 22:22:01,672 - INFO - Initializing strategy...
2025-04-17 22:22:01,673 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 22:22:01,673 - ERROR - Error running lstm with neural_regime and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:22:01,673 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 5 regimes
2025-04-17 22:22:01,673 - INFO - Initializing strategy...
2025-04-17 22:22:01,674 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 22:22:01,674 - ERROR - Error running lstm with neural_regime and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:22:01,674 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 7 regimes
2025-04-17 22:22:01,674 - INFO - Initializing strategy...
2025-04-17 22:22:01,674 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 22:22:01,675 - ERROR - Error running lstm with neural_regime and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:22:01,675 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 22:22:01,675 - INFO - Initializing strategy...
2025-04-17 22:22:01,675 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 22:22:01,676 - ERROR - Error running lstm with autoencoder_regime and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:22:01,676 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 22:22:01,676 - INFO - Initializing strategy...
2025-04-17 22:22:01,676 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 22:22:01,677 - ERROR - Error running lstm with autoencoder_regime and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:22:01,677 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 22:22:01,677 - INFO - Initializing strategy...
2025-04-17 22:22:01,677 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 22:22:01,677 - ERROR - Error running lstm with autoencoder_regime and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:22:01,678 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 3 regimes
2025-04-17 22:22:01,678 - INFO - Initializing strategy...
2025-04-17 22:22:01,678 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 22:22:01,678 - ERROR - Error running lstm with neural and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:22:01,679 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 5 regimes
2025-04-17 22:22:01,679 - INFO - Initializing strategy...
2025-04-17 22:22:01,679 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 22:22:01,679 - ERROR - Error running lstm with neural and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:22:01,680 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 7 regimes
2025-04-17 22:22:01,680 - INFO - Initializing strategy...
2025-04-17 22:22:01,680 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 22:22:01,680 - ERROR - Error running lstm with neural and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:22:01,681 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 3 regimes
2025-04-17 22:22:01,681 - INFO - Initializing strategy...
2025-04-17 22:22:01,681 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 22:22:01,681 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:01,700 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:22:01,700 - INFO - Running strategy...
2025-04-17 22:22:01,700 - INFO - Starting strategy execution...
2025-04-17 22:22:01,701 - INFO - Preparing training and testing data...
2025-04-17 22:22:01,701 - INFO - Starting data preparation...
2025-04-17 22:22:01,701 - INFO - Loading Fama-French factors...
2025-04-17 22:22:01,714 - INFO - Fama-French factors loaded
2025-04-17 22:22:01,714 - INFO - Processing factor data...
2025-04-17 22:22:01,717 - INFO - Factor data processed
2025-04-17 22:22:01,717 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:01,717 - INFO - 
Training Period:
2025-04-17 22:22:01,721 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:01,729 - INFO - 
Testing Period:
2025-04-17 22:22:01,734 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:01,740 - INFO - Loading macro and market data...
2025-04-17 22:22:01,741 - INFO - Loading existing macro data...
2025-04-17 22:22:01,752 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:01,752 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:01,756 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:01,756 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:01,756 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:01,757 - INFO - Loading existing macro data...
2025-04-17 22:22:01,766 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:01,766 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:01,769 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:01,769 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:01,769 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:01,770 - INFO - Loading existing market data...
2025-04-17 22:22:01,774 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:01,775 - INFO - Loading existing market data...
2025-04-17 22:22:01,777 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:01,778 - INFO - Macro and market data loaded
2025-04-17 22:22:01,778 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:01,778 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:01,778 - INFO - Loading existing macro data...
2025-04-17 22:22:01,787 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:01,787 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:01,790 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:01,790 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:01,791 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:01,792 - INFO - Loading existing market data...
2025-04-17 22:22:01,795 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:01,929 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:01,929 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:01,929 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:01,930 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:01,931 - INFO - Loading existing macro data...
2025-04-17 22:22:01,943 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:01,943 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:01,946 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:01,946 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:01,947 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:01,948 - INFO - Loading existing market data...
2025-04-17 22:22:01,951 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:01,959 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:01,960 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:01,960 - INFO - Test data prepared
2025-04-17 22:22:01,960 - INFO - Storing data...
2025-04-17 22:22:01,961 - INFO - Aligning data indices...
2025-04-17 22:22:01,962 - INFO - Data indices aligned
2025-04-17 22:22:01,962 - INFO - Data preparation completed
2025-04-17 22:22:01,962 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:01,963 - INFO - Training models...
2025-04-17 22:22:01,963 - INFO - Starting model training...
2025-04-17 22:22:01,963 - INFO - Training regime classifier...
2025-04-17 22:22:01,963 - INFO - Training XGBoost model...
2025-04-17 22:22:01,963 - INFO - Preparing features...
2025-04-17 22:22:01,963 - INFO - Input shape: (1536, 8)
2025-04-17 22:22:01,964 - INFO - Handling missing values...
2025-04-17 22:22:01,965 - INFO - Missing values: 0 -> 0
2025-04-17 22:22:01,965 - INFO - Scaling features...
2025-04-17 22:22:01,966 - INFO - Fitted new scaler
2025-04-17 22:22:01,967 - INFO - Output shape: (1536, 8)
2025-04-17 22:22:02,716 - INFO - XGBoost model training completed
2025-04-17 22:22:02,994 - INFO - Model training completed
2025-04-17 22:22:02,995 - INFO - Model training completed
2025-04-17 22:22:02,996 - INFO - Initializing portfolio weights...
2025-04-17 22:22:02,996 - INFO - Portfolio weights initialized
2025-04-17 22:22:02,996 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:02,998 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:02,999 - ERROR - Error running xgboost with mean_variance and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:03,001 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 5 regimes
2025-04-17 22:22:03,002 - INFO - Initializing strategy...
2025-04-17 22:22:03,002 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 22:22:03,002 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:03,002 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:22:03,003 - INFO - Running strategy...
2025-04-17 22:22:03,003 - INFO - Starting strategy execution...
2025-04-17 22:22:03,003 - INFO - Preparing training and testing data...
2025-04-17 22:22:03,003 - INFO - Starting data preparation...
2025-04-17 22:22:03,003 - INFO - Loading Fama-French factors...
2025-04-17 22:22:03,014 - INFO - Fama-French factors loaded
2025-04-17 22:22:03,014 - INFO - Processing factor data...
2025-04-17 22:22:03,016 - INFO - Factor data processed
2025-04-17 22:22:03,016 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:03,016 - INFO - 
Training Period:
2025-04-17 22:22:03,020 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:03,027 - INFO - 
Testing Period:
2025-04-17 22:22:03,031 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:03,037 - INFO - Loading macro and market data...
2025-04-17 22:22:03,038 - INFO - Loading existing macro data...
2025-04-17 22:22:03,049 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:03,049 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:03,052 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:03,052 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:03,053 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:03,053 - INFO - Loading existing macro data...
2025-04-17 22:22:03,062 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:03,063 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:03,065 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:03,065 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:03,065 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:03,066 - INFO - Loading existing market data...
2025-04-17 22:22:03,070 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:03,070 - INFO - Loading existing market data...
2025-04-17 22:22:03,073 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:03,073 - INFO - Macro and market data loaded
2025-04-17 22:22:03,074 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:03,074 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:03,075 - INFO - Loading existing macro data...
2025-04-17 22:22:03,083 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:03,084 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:03,086 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:03,087 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:03,087 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:03,088 - INFO - Loading existing market data...
2025-04-17 22:22:03,091 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:03,105 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:03,105 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:03,106 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:03,106 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:03,107 - INFO - Loading existing macro data...
2025-04-17 22:22:03,117 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:03,117 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:03,120 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:03,121 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:03,121 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:03,122 - INFO - Loading existing market data...
2025-04-17 22:22:03,125 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:03,138 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:03,138 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:03,139 - INFO - Test data prepared
2025-04-17 22:22:03,139 - INFO - Storing data...
2025-04-17 22:22:03,139 - INFO - Aligning data indices...
2025-04-17 22:22:03,141 - INFO - Data indices aligned
2025-04-17 22:22:03,141 - INFO - Data preparation completed
2025-04-17 22:22:03,141 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:03,141 - INFO - Training models...
2025-04-17 22:22:03,141 - INFO - Starting model training...
2025-04-17 22:22:03,142 - INFO - Training regime classifier...
2025-04-17 22:22:03,142 - INFO - Training XGBoost model...
2025-04-17 22:22:03,142 - INFO - Preparing features...
2025-04-17 22:22:03,142 - INFO - Input shape: (1536, 8)
2025-04-17 22:22:03,142 - INFO - Handling missing values...
2025-04-17 22:22:03,144 - INFO - Missing values: 0 -> 0
2025-04-17 22:22:03,144 - INFO - Scaling features...
2025-04-17 22:22:03,146 - INFO - Fitted new scaler
2025-04-17 22:22:03,147 - INFO - Output shape: (1536, 8)
2025-04-17 22:22:03,374 - INFO - XGBoost model training completed
2025-04-17 22:22:03,710 - INFO - Model training completed
2025-04-17 22:22:03,712 - INFO - Model training completed
2025-04-17 22:22:03,713 - INFO - Initializing portfolio weights...
2025-04-17 22:22:03,713 - INFO - Portfolio weights initialized
2025-04-17 22:22:03,714 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:03,715 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:03,715 - ERROR - Error running xgboost with mean_variance and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:03,717 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 7 regimes
2025-04-17 22:22:03,717 - INFO - Initializing strategy...
2025-04-17 22:22:03,717 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 22:22:03,718 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:03,718 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:22:03,718 - INFO - Running strategy...
2025-04-17 22:22:03,718 - INFO - Starting strategy execution...
2025-04-17 22:22:03,719 - INFO - Preparing training and testing data...
2025-04-17 22:22:03,719 - INFO - Starting data preparation...
2025-04-17 22:22:03,719 - INFO - Loading Fama-French factors...
2025-04-17 22:22:03,727 - INFO - Fama-French factors loaded
2025-04-17 22:22:03,728 - INFO - Processing factor data...
2025-04-17 22:22:03,730 - INFO - Factor data processed
2025-04-17 22:22:03,730 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:03,730 - INFO - 
Training Period:
2025-04-17 22:22:03,734 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:03,741 - INFO - 
Testing Period:
2025-04-17 22:22:03,745 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:03,753 - INFO - Loading macro and market data...
2025-04-17 22:22:03,754 - INFO - Loading existing macro data...
2025-04-17 22:22:03,764 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:03,765 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:03,768 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:03,768 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:03,768 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:03,769 - INFO - Loading existing macro data...
2025-04-17 22:22:03,779 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:03,779 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:03,782 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:03,782 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:03,782 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:03,783 - INFO - Loading existing market data...
2025-04-17 22:22:03,787 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:03,788 - INFO - Loading existing market data...
2025-04-17 22:22:03,790 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:03,791 - INFO - Macro and market data loaded
2025-04-17 22:22:03,791 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:03,791 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:03,792 - INFO - Loading existing macro data...
2025-04-17 22:22:03,802 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:03,802 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:03,805 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:03,806 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:03,806 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:03,807 - INFO - Loading existing market data...
2025-04-17 22:22:03,810 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:03,825 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:03,825 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:03,825 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:03,826 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:03,827 - INFO - Loading existing macro data...
2025-04-17 22:22:03,839 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:03,839 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:03,842 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:03,843 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:03,843 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:03,844 - INFO - Loading existing market data...
2025-04-17 22:22:03,847 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:03,858 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:03,858 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:03,858 - INFO - Test data prepared
2025-04-17 22:22:03,858 - INFO - Storing data...
2025-04-17 22:22:03,859 - INFO - Aligning data indices...
2025-04-17 22:22:03,860 - INFO - Data indices aligned
2025-04-17 22:22:03,860 - INFO - Data preparation completed
2025-04-17 22:22:03,861 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:03,861 - INFO - Training models...
2025-04-17 22:22:03,861 - INFO - Starting model training...
2025-04-17 22:22:03,861 - INFO - Training regime classifier...
2025-04-17 22:22:03,861 - INFO - Training XGBoost model...
2025-04-17 22:22:03,862 - INFO - Preparing features...
2025-04-17 22:22:03,862 - INFO - Input shape: (1536, 8)
2025-04-17 22:22:03,862 - INFO - Handling missing values...
2025-04-17 22:22:03,863 - INFO - Missing values: 0 -> 0
2025-04-17 22:22:03,863 - INFO - Scaling features...
2025-04-17 22:22:03,864 - INFO - Fitted new scaler
2025-04-17 22:22:03,865 - INFO - Output shape: (1536, 8)
2025-04-17 22:22:03,971 - INFO - XGBoost model training completed
2025-04-17 22:22:04,179 - INFO - Model training completed
2025-04-17 22:22:04,180 - INFO - Model training completed
2025-04-17 22:22:04,181 - INFO - Initializing portfolio weights...
2025-04-17 22:22:04,181 - INFO - Portfolio weights initialized
2025-04-17 22:22:04,181 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:04,183 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:04,183 - ERROR - Error running xgboost with mean_variance and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:04,184 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 3 regimes
2025-04-17 22:22:04,185 - INFO - Initializing strategy...
2025-04-17 22:22:04,185 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 22:22:04,185 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:04,185 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:22:04,186 - INFO - Running strategy...
2025-04-17 22:22:04,186 - INFO - Starting strategy execution...
2025-04-17 22:22:04,186 - INFO - Preparing training and testing data...
2025-04-17 22:22:04,186 - INFO - Starting data preparation...
2025-04-17 22:22:04,186 - INFO - Loading Fama-French factors...
2025-04-17 22:22:04,196 - INFO - Fama-French factors loaded
2025-04-17 22:22:04,196 - INFO - Processing factor data...
2025-04-17 22:22:04,198 - INFO - Factor data processed
2025-04-17 22:22:04,198 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:04,198 - INFO - 
Training Period:
2025-04-17 22:22:04,202 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:04,210 - INFO - 
Testing Period:
2025-04-17 22:22:04,214 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:04,221 - INFO - Loading macro and market data...
2025-04-17 22:22:04,222 - INFO - Loading existing macro data...
2025-04-17 22:22:04,231 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:04,231 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:04,234 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:04,235 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:04,235 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:04,236 - INFO - Loading existing macro data...
2025-04-17 22:22:04,245 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:04,246 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:04,248 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:04,248 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:04,249 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:04,250 - INFO - Loading existing market data...
2025-04-17 22:22:04,253 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:04,254 - INFO - Loading existing market data...
2025-04-17 22:22:04,257 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:04,257 - INFO - Macro and market data loaded
2025-04-17 22:22:04,257 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:04,257 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:04,258 - INFO - Loading existing macro data...
2025-04-17 22:22:04,267 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:04,267 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:04,269 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:04,270 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:04,270 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:04,271 - INFO - Loading existing market data...
2025-04-17 22:22:04,274 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:04,287 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:04,288 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:04,288 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:04,288 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:04,289 - INFO - Loading existing macro data...
2025-04-17 22:22:04,300 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:04,301 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:04,303 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:04,304 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:04,304 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:04,305 - INFO - Loading existing market data...
2025-04-17 22:22:04,308 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:04,317 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:04,318 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:04,318 - INFO - Test data prepared
2025-04-17 22:22:04,318 - INFO - Storing data...
2025-04-17 22:22:04,318 - INFO - Aligning data indices...
2025-04-17 22:22:04,320 - INFO - Data indices aligned
2025-04-17 22:22:04,320 - INFO - Data preparation completed
2025-04-17 22:22:04,320 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:04,320 - INFO - Training models...
2025-04-17 22:22:04,321 - INFO - Starting model training...
2025-04-17 22:22:04,321 - INFO - Training regime classifier...
2025-04-17 22:22:04,321 - INFO - Training XGBoost model...
2025-04-17 22:22:04,321 - INFO - Preparing features...
2025-04-17 22:22:04,321 - INFO - Input shape: (1536, 8)
2025-04-17 22:22:04,321 - INFO - Handling missing values...
2025-04-17 22:22:04,322 - INFO - Missing values: 0 -> 0
2025-04-17 22:22:04,322 - INFO - Scaling features...
2025-04-17 22:22:04,323 - INFO - Fitted new scaler
2025-04-17 22:22:04,324 - INFO - Output shape: (1536, 8)
2025-04-17 22:22:04,428 - INFO - XGBoost model training completed
2025-04-17 22:22:04,640 - INFO - Model training completed
2025-04-17 22:22:04,642 - INFO - Model training completed
2025-04-17 22:22:04,642 - INFO - Initializing portfolio weights...
2025-04-17 22:22:04,643 - INFO - Portfolio weights initialized
2025-04-17 22:22:04,643 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:04,644 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:04,645 - ERROR - Error running xgboost with regime_aware and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:04,646 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 5 regimes
2025-04-17 22:22:04,646 - INFO - Initializing strategy...
2025-04-17 22:22:04,646 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 22:22:04,646 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:04,647 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:22:04,647 - INFO - Running strategy...
2025-04-17 22:22:04,647 - INFO - Starting strategy execution...
2025-04-17 22:22:04,647 - INFO - Preparing training and testing data...
2025-04-17 22:22:04,647 - INFO - Starting data preparation...
2025-04-17 22:22:04,647 - INFO - Loading Fama-French factors...
2025-04-17 22:22:04,656 - INFO - Fama-French factors loaded
2025-04-17 22:22:04,657 - INFO - Processing factor data...
2025-04-17 22:22:04,659 - INFO - Factor data processed
2025-04-17 22:22:04,659 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:04,659 - INFO - 
Training Period:
2025-04-17 22:22:04,663 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:04,670 - INFO - 
Testing Period:
2025-04-17 22:22:04,674 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:04,681 - INFO - Loading macro and market data...
2025-04-17 22:22:04,682 - INFO - Loading existing macro data...
2025-04-17 22:22:04,692 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:04,692 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:04,695 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:04,695 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:04,696 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:04,697 - INFO - Loading existing macro data...
2025-04-17 22:22:04,706 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:04,707 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:04,709 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:04,709 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:04,709 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:04,710 - INFO - Loading existing market data...
2025-04-17 22:22:04,714 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:04,715 - INFO - Loading existing market data...
2025-04-17 22:22:04,718 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:04,718 - INFO - Macro and market data loaded
2025-04-17 22:22:04,718 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:04,719 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:04,719 - INFO - Loading existing macro data...
2025-04-17 22:22:04,728 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:04,728 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:04,731 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:04,731 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:04,731 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:04,732 - INFO - Loading existing market data...
2025-04-17 22:22:04,735 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:04,749 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:04,749 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:04,750 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:04,750 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:04,751 - INFO - Loading existing macro data...
2025-04-17 22:22:04,761 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:04,762 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:04,764 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:04,764 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:04,765 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:04,766 - INFO - Loading existing market data...
2025-04-17 22:22:04,768 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:04,780 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:04,780 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:04,781 - INFO - Test data prepared
2025-04-17 22:22:04,781 - INFO - Storing data...
2025-04-17 22:22:04,781 - INFO - Aligning data indices...
2025-04-17 22:22:04,782 - INFO - Data indices aligned
2025-04-17 22:22:04,783 - INFO - Data preparation completed
2025-04-17 22:22:04,783 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:04,783 - INFO - Training models...
2025-04-17 22:22:04,783 - INFO - Starting model training...
2025-04-17 22:22:04,783 - INFO - Training regime classifier...
2025-04-17 22:22:04,783 - INFO - Training XGBoost model...
2025-04-17 22:22:04,783 - INFO - Preparing features...
2025-04-17 22:22:04,784 - INFO - Input shape: (1536, 8)
2025-04-17 22:22:04,784 - INFO - Handling missing values...
2025-04-17 22:22:04,785 - INFO - Missing values: 0 -> 0
2025-04-17 22:22:04,785 - INFO - Scaling features...
2025-04-17 22:22:04,786 - INFO - Fitted new scaler
2025-04-17 22:22:04,786 - INFO - Output shape: (1536, 8)
2025-04-17 22:22:04,891 - INFO - XGBoost model training completed
2025-04-17 22:22:05,105 - INFO - Model training completed
2025-04-17 22:22:05,107 - INFO - Model training completed
2025-04-17 22:22:05,107 - INFO - Initializing portfolio weights...
2025-04-17 22:22:05,108 - INFO - Portfolio weights initialized
2025-04-17 22:22:05,108 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:05,110 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:05,110 - ERROR - Error running xgboost with regime_aware and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:05,111 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 7 regimes
2025-04-17 22:22:05,112 - INFO - Initializing strategy...
2025-04-17 22:22:05,112 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 22:22:05,112 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:05,112 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:22:05,113 - INFO - Running strategy...
2025-04-17 22:22:05,113 - INFO - Starting strategy execution...
2025-04-17 22:22:05,113 - INFO - Preparing training and testing data...
2025-04-17 22:22:05,113 - INFO - Starting data preparation...
2025-04-17 22:22:05,113 - INFO - Loading Fama-French factors...
2025-04-17 22:22:05,122 - INFO - Fama-French factors loaded
2025-04-17 22:22:05,122 - INFO - Processing factor data...
2025-04-17 22:22:05,125 - INFO - Factor data processed
2025-04-17 22:22:05,125 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:05,125 - INFO - 
Training Period:
2025-04-17 22:22:05,129 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:05,136 - INFO - 
Testing Period:
2025-04-17 22:22:05,140 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:05,147 - INFO - Loading macro and market data...
2025-04-17 22:22:05,148 - INFO - Loading existing macro data...
2025-04-17 22:22:05,158 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:05,158 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:05,161 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:05,161 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:05,161 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:05,162 - INFO - Loading existing macro data...
2025-04-17 22:22:05,171 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:05,172 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:05,175 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:05,175 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:05,175 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:05,176 - INFO - Loading existing market data...
2025-04-17 22:22:05,180 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:05,181 - INFO - Loading existing market data...
2025-04-17 22:22:05,183 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:05,183 - INFO - Macro and market data loaded
2025-04-17 22:22:05,183 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:05,184 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:05,184 - INFO - Loading existing macro data...
2025-04-17 22:22:05,193 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:05,194 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:05,196 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:05,197 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:05,197 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:05,198 - INFO - Loading existing market data...
2025-04-17 22:22:05,201 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:05,216 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:05,216 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:05,217 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:05,217 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:05,218 - INFO - Loading existing macro data...
2025-04-17 22:22:05,230 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:05,231 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:05,233 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:05,234 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:05,234 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:05,236 - INFO - Loading existing market data...
2025-04-17 22:22:05,240 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:05,249 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:05,249 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:05,250 - INFO - Test data prepared
2025-04-17 22:22:05,250 - INFO - Storing data...
2025-04-17 22:22:05,251 - INFO - Aligning data indices...
2025-04-17 22:22:05,252 - INFO - Data indices aligned
2025-04-17 22:22:05,252 - INFO - Data preparation completed
2025-04-17 22:22:05,252 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:05,252 - INFO - Training models...
2025-04-17 22:22:05,252 - INFO - Starting model training...
2025-04-17 22:22:05,252 - INFO - Training regime classifier...
2025-04-17 22:22:05,253 - INFO - Training XGBoost model...
2025-04-17 22:22:05,253 - INFO - Preparing features...
2025-04-17 22:22:05,253 - INFO - Input shape: (1536, 8)
2025-04-17 22:22:05,253 - INFO - Handling missing values...
2025-04-17 22:22:05,254 - INFO - Missing values: 0 -> 0
2025-04-17 22:22:05,254 - INFO - Scaling features...
2025-04-17 22:22:05,256 - INFO - Fitted new scaler
2025-04-17 22:22:05,257 - INFO - Output shape: (1536, 8)
2025-04-17 22:22:05,360 - INFO - XGBoost model training completed
2025-04-17 22:22:05,572 - INFO - Model training completed
2025-04-17 22:22:05,574 - INFO - Model training completed
2025-04-17 22:22:05,574 - INFO - Initializing portfolio weights...
2025-04-17 22:22:05,575 - INFO - Portfolio weights initialized
2025-04-17 22:22:05,575 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:05,576 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:05,577 - ERROR - Error running xgboost with regime_aware and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:05,578 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 3 regimes
2025-04-17 22:22:05,578 - INFO - Initializing strategy...
2025-04-17 22:22:05,578 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 22:22:05,578 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:05,579 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:22:05,579 - INFO - Running strategy...
2025-04-17 22:22:05,579 - INFO - Starting strategy execution...
2025-04-17 22:22:05,579 - INFO - Preparing training and testing data...
2025-04-17 22:22:05,579 - INFO - Starting data preparation...
2025-04-17 22:22:05,579 - INFO - Loading Fama-French factors...
2025-04-17 22:22:05,588 - INFO - Fama-French factors loaded
2025-04-17 22:22:05,589 - INFO - Processing factor data...
2025-04-17 22:22:05,591 - INFO - Factor data processed
2025-04-17 22:22:05,591 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:05,591 - INFO - 
Training Period:
2025-04-17 22:22:05,595 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:05,602 - INFO - 
Testing Period:
2025-04-17 22:22:05,606 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:05,614 - INFO - Loading macro and market data...
2025-04-17 22:22:05,615 - INFO - Loading existing macro data...
2025-04-17 22:22:05,624 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:05,625 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:05,628 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:05,628 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:05,628 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:05,629 - INFO - Loading existing macro data...
2025-04-17 22:22:05,638 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:05,638 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:05,641 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:05,641 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:05,641 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:05,642 - INFO - Loading existing market data...
2025-04-17 22:22:05,645 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:05,646 - INFO - Loading existing market data...
2025-04-17 22:22:05,649 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:05,649 - INFO - Macro and market data loaded
2025-04-17 22:22:05,649 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:05,650 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:05,650 - INFO - Loading existing macro data...
2025-04-17 22:22:05,660 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:05,661 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:05,663 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:05,664 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:05,664 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:05,665 - INFO - Loading existing market data...
2025-04-17 22:22:05,668 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:05,681 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:05,682 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:05,682 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:05,682 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:05,683 - INFO - Loading existing macro data...
2025-04-17 22:22:05,694 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:05,694 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:05,697 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:05,697 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:05,697 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:05,699 - INFO - Loading existing market data...
2025-04-17 22:22:05,702 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:05,713 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:05,713 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:05,714 - INFO - Test data prepared
2025-04-17 22:22:05,714 - INFO - Storing data...
2025-04-17 22:22:05,714 - INFO - Aligning data indices...
2025-04-17 22:22:05,715 - INFO - Data indices aligned
2025-04-17 22:22:05,715 - INFO - Data preparation completed
2025-04-17 22:22:05,715 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:05,716 - INFO - Training models...
2025-04-17 22:22:05,716 - INFO - Starting model training...
2025-04-17 22:22:05,716 - INFO - Training regime classifier...
2025-04-17 22:22:05,716 - INFO - Training XGBoost model...
2025-04-17 22:22:05,716 - INFO - Preparing features...
2025-04-17 22:22:05,716 - INFO - Input shape: (1536, 8)
2025-04-17 22:22:05,716 - INFO - Handling missing values...
2025-04-17 22:22:05,717 - INFO - Missing values: 0 -> 0
2025-04-17 22:22:05,717 - INFO - Scaling features...
2025-04-17 22:22:05,718 - INFO - Fitted new scaler
2025-04-17 22:22:05,719 - INFO - Output shape: (1536, 8)
2025-04-17 22:22:05,827 - INFO - XGBoost model training completed
2025-04-17 22:22:06,036 - INFO - Model training completed
2025-04-17 22:22:06,038 - INFO - Model training completed
2025-04-17 22:22:06,038 - INFO - Initializing portfolio weights...
2025-04-17 22:22:06,039 - INFO - Portfolio weights initialized
2025-04-17 22:22:06,039 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:06,040 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:06,041 - ERROR - Error running xgboost with neural_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:06,042 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 5 regimes
2025-04-17 22:22:06,042 - INFO - Initializing strategy...
2025-04-17 22:22:06,042 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 22:22:06,043 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:06,043 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:22:06,043 - INFO - Running strategy...
2025-04-17 22:22:06,043 - INFO - Starting strategy execution...
2025-04-17 22:22:06,043 - INFO - Preparing training and testing data...
2025-04-17 22:22:06,043 - INFO - Starting data preparation...
2025-04-17 22:22:06,044 - INFO - Loading Fama-French factors...
2025-04-17 22:22:06,053 - INFO - Fama-French factors loaded
2025-04-17 22:22:06,053 - INFO - Processing factor data...
2025-04-17 22:22:06,055 - INFO - Factor data processed
2025-04-17 22:22:06,055 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:06,055 - INFO - 
Training Period:
2025-04-17 22:22:06,059 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:06,066 - INFO - 
Testing Period:
2025-04-17 22:22:06,070 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:06,077 - INFO - Loading macro and market data...
2025-04-17 22:22:06,078 - INFO - Loading existing macro data...
2025-04-17 22:22:06,088 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:06,088 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:06,091 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:06,091 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:06,091 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:06,092 - INFO - Loading existing macro data...
2025-04-17 22:22:06,102 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:06,102 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:06,105 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:06,105 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:06,105 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:06,106 - INFO - Loading existing market data...
2025-04-17 22:22:06,109 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:06,110 - INFO - Loading existing market data...
2025-04-17 22:22:06,113 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:06,113 - INFO - Macro and market data loaded
2025-04-17 22:22:06,113 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:06,113 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:06,114 - INFO - Loading existing macro data...
2025-04-17 22:22:06,123 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:06,123 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:06,126 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:06,126 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:06,126 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:06,127 - INFO - Loading existing market data...
2025-04-17 22:22:06,130 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:06,145 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:06,145 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:06,146 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:06,146 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:06,147 - INFO - Loading existing macro data...
2025-04-17 22:22:06,157 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:06,157 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:06,161 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:06,161 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:06,161 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:06,162 - INFO - Loading existing market data...
2025-04-17 22:22:06,165 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:06,174 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:06,175 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:06,175 - INFO - Test data prepared
2025-04-17 22:22:06,176 - INFO - Storing data...
2025-04-17 22:22:06,176 - INFO - Aligning data indices...
2025-04-17 22:22:06,177 - INFO - Data indices aligned
2025-04-17 22:22:06,177 - INFO - Data preparation completed
2025-04-17 22:22:06,177 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:06,177 - INFO - Training models...
2025-04-17 22:22:06,178 - INFO - Starting model training...
2025-04-17 22:22:06,178 - INFO - Training regime classifier...
2025-04-17 22:22:06,178 - INFO - Training XGBoost model...
2025-04-17 22:22:06,178 - INFO - Preparing features...
2025-04-17 22:22:06,178 - INFO - Input shape: (1536, 8)
2025-04-17 22:22:06,179 - INFO - Handling missing values...
2025-04-17 22:22:06,180 - INFO - Missing values: 0 -> 0
2025-04-17 22:22:06,180 - INFO - Scaling features...
2025-04-17 22:22:06,181 - INFO - Fitted new scaler
2025-04-17 22:22:06,182 - INFO - Output shape: (1536, 8)
2025-04-17 22:22:06,308 - INFO - XGBoost model training completed
2025-04-17 22:22:06,521 - INFO - Model training completed
2025-04-17 22:22:06,523 - INFO - Model training completed
2025-04-17 22:22:06,523 - INFO - Initializing portfolio weights...
2025-04-17 22:22:06,524 - INFO - Portfolio weights initialized
2025-04-17 22:22:06,524 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:06,526 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:06,526 - ERROR - Error running xgboost with neural_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:06,528 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 7 regimes
2025-04-17 22:22:06,528 - INFO - Initializing strategy...
2025-04-17 22:22:06,528 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 22:22:06,528 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:06,529 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:22:06,529 - INFO - Running strategy...
2025-04-17 22:22:06,529 - INFO - Starting strategy execution...
2025-04-17 22:22:06,529 - INFO - Preparing training and testing data...
2025-04-17 22:22:06,529 - INFO - Starting data preparation...
2025-04-17 22:22:06,530 - INFO - Loading Fama-French factors...
2025-04-17 22:22:06,539 - INFO - Fama-French factors loaded
2025-04-17 22:22:06,539 - INFO - Processing factor data...
2025-04-17 22:22:06,541 - INFO - Factor data processed
2025-04-17 22:22:06,541 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:06,542 - INFO - 
Training Period:
2025-04-17 22:22:06,546 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:06,553 - INFO - 
Testing Period:
2025-04-17 22:22:06,557 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:06,565 - INFO - Loading macro and market data...
2025-04-17 22:22:06,566 - INFO - Loading existing macro data...
2025-04-17 22:22:06,577 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:06,577 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:06,580 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:06,580 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:06,580 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:06,582 - INFO - Loading existing macro data...
2025-04-17 22:22:06,591 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:06,591 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:06,594 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:06,595 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:06,595 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:06,596 - INFO - Loading existing market data...
2025-04-17 22:22:06,599 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:06,601 - INFO - Loading existing market data...
2025-04-17 22:22:06,604 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:06,604 - INFO - Macro and market data loaded
2025-04-17 22:22:06,604 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:06,605 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:06,605 - INFO - Loading existing macro data...
2025-04-17 22:22:06,615 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:06,616 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:06,618 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:06,619 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:06,619 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:06,620 - INFO - Loading existing market data...
2025-04-17 22:22:06,623 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:06,637 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:06,638 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:06,638 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:06,638 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:06,639 - INFO - Loading existing macro data...
2025-04-17 22:22:06,651 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:06,651 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:06,654 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:06,654 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:06,655 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:06,656 - INFO - Loading existing market data...
2025-04-17 22:22:06,659 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:06,669 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:06,670 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:06,670 - INFO - Test data prepared
2025-04-17 22:22:06,671 - INFO - Storing data...
2025-04-17 22:22:06,671 - INFO - Aligning data indices...
2025-04-17 22:22:06,672 - INFO - Data indices aligned
2025-04-17 22:22:06,672 - INFO - Data preparation completed
2025-04-17 22:22:06,673 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:06,673 - INFO - Training models...
2025-04-17 22:22:06,673 - INFO - Starting model training...
2025-04-17 22:22:06,673 - INFO - Training regime classifier...
2025-04-17 22:22:06,673 - INFO - Training XGBoost model...
2025-04-17 22:22:06,674 - INFO - Preparing features...
2025-04-17 22:22:06,674 - INFO - Input shape: (1536, 8)
2025-04-17 22:22:06,674 - INFO - Handling missing values...
2025-04-17 22:22:06,675 - INFO - Missing values: 0 -> 0
2025-04-17 22:22:06,675 - INFO - Scaling features...
2025-04-17 22:22:06,677 - INFO - Fitted new scaler
2025-04-17 22:22:06,678 - INFO - Output shape: (1536, 8)
2025-04-17 22:22:06,787 - INFO - XGBoost model training completed
2025-04-17 22:22:06,998 - INFO - Model training completed
2025-04-17 22:22:07,000 - INFO - Model training completed
2025-04-17 22:22:07,000 - INFO - Initializing portfolio weights...
2025-04-17 22:22:07,001 - INFO - Portfolio weights initialized
2025-04-17 22:22:07,001 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:07,002 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:07,003 - ERROR - Error running xgboost with neural_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:07,004 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 22:22:07,004 - INFO - Initializing strategy...
2025-04-17 22:22:07,005 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 22:22:07,005 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:07,005 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:22:07,005 - INFO - Running strategy...
2025-04-17 22:22:07,006 - INFO - Starting strategy execution...
2025-04-17 22:22:07,006 - INFO - Preparing training and testing data...
2025-04-17 22:22:07,006 - INFO - Starting data preparation...
2025-04-17 22:22:07,006 - INFO - Loading Fama-French factors...
2025-04-17 22:22:07,015 - INFO - Fama-French factors loaded
2025-04-17 22:22:07,015 - INFO - Processing factor data...
2025-04-17 22:22:07,017 - INFO - Factor data processed
2025-04-17 22:22:07,018 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:07,018 - INFO - 
Training Period:
2025-04-17 22:22:07,022 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:07,029 - INFO - 
Testing Period:
2025-04-17 22:22:07,034 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:07,041 - INFO - Loading macro and market data...
2025-04-17 22:22:07,042 - INFO - Loading existing macro data...
2025-04-17 22:22:07,052 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:07,052 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:07,056 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:07,056 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:07,056 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:07,057 - INFO - Loading existing macro data...
2025-04-17 22:22:07,067 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:07,067 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:07,070 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:07,070 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:07,071 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:07,072 - INFO - Loading existing market data...
2025-04-17 22:22:07,076 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:07,077 - INFO - Loading existing market data...
2025-04-17 22:22:07,080 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:07,080 - INFO - Macro and market data loaded
2025-04-17 22:22:07,080 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:07,080 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:07,081 - INFO - Loading existing macro data...
2025-04-17 22:22:07,090 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:07,090 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:07,094 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:07,094 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:07,094 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:07,096 - INFO - Loading existing market data...
2025-04-17 22:22:07,099 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:07,114 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:07,114 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:07,115 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:07,115 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:07,116 - INFO - Loading existing macro data...
2025-04-17 22:22:07,126 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:07,127 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:07,130 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:07,130 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:07,130 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:07,131 - INFO - Loading existing market data...
2025-04-17 22:22:07,135 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:07,145 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:07,145 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:07,146 - INFO - Test data prepared
2025-04-17 22:22:07,146 - INFO - Storing data...
2025-04-17 22:22:07,146 - INFO - Aligning data indices...
2025-04-17 22:22:07,147 - INFO - Data indices aligned
2025-04-17 22:22:07,148 - INFO - Data preparation completed
2025-04-17 22:22:07,148 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:07,148 - INFO - Training models...
2025-04-17 22:22:07,149 - INFO - Starting model training...
2025-04-17 22:22:07,149 - INFO - Training regime classifier...
2025-04-17 22:22:07,149 - INFO - Training XGBoost model...
2025-04-17 22:22:07,149 - INFO - Preparing features...
2025-04-17 22:22:07,149 - INFO - Input shape: (1536, 8)
2025-04-17 22:22:07,149 - INFO - Handling missing values...
2025-04-17 22:22:07,150 - INFO - Missing values: 0 -> 0
2025-04-17 22:22:07,151 - INFO - Scaling features...
2025-04-17 22:22:07,152 - INFO - Fitted new scaler
2025-04-17 22:22:07,152 - INFO - Output shape: (1536, 8)
2025-04-17 22:22:07,255 - INFO - XGBoost model training completed
2025-04-17 22:22:07,467 - INFO - Model training completed
2025-04-17 22:22:07,469 - INFO - Model training completed
2025-04-17 22:22:07,469 - INFO - Initializing portfolio weights...
2025-04-17 22:22:07,470 - INFO - Portfolio weights initialized
2025-04-17 22:22:07,470 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:07,472 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:07,472 - ERROR - Error running xgboost with autoencoder_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:07,473 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 22:22:07,473 - INFO - Initializing strategy...
2025-04-17 22:22:07,474 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 22:22:07,474 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:07,474 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:22:07,474 - INFO - Running strategy...
2025-04-17 22:22:07,474 - INFO - Starting strategy execution...
2025-04-17 22:22:07,475 - INFO - Preparing training and testing data...
2025-04-17 22:22:07,475 - INFO - Starting data preparation...
2025-04-17 22:22:07,475 - INFO - Loading Fama-French factors...
2025-04-17 22:22:07,484 - INFO - Fama-French factors loaded
2025-04-17 22:22:07,484 - INFO - Processing factor data...
2025-04-17 22:22:07,486 - INFO - Factor data processed
2025-04-17 22:22:07,486 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:07,486 - INFO - 
Training Period:
2025-04-17 22:22:07,490 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:07,497 - INFO - 
Testing Period:
2025-04-17 22:22:07,501 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:07,508 - INFO - Loading macro and market data...
2025-04-17 22:22:07,509 - INFO - Loading existing macro data...
2025-04-17 22:22:07,518 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:07,519 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:07,521 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:07,522 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:07,522 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:07,523 - INFO - Loading existing macro data...
2025-04-17 22:22:07,531 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:07,532 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:07,535 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:07,535 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:07,535 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:07,536 - INFO - Loading existing market data...
2025-04-17 22:22:07,540 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:07,540 - INFO - Loading existing market data...
2025-04-17 22:22:07,543 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:07,543 - INFO - Macro and market data loaded
2025-04-17 22:22:07,543 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:07,543 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:07,544 - INFO - Loading existing macro data...
2025-04-17 22:22:07,553 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:07,554 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:07,556 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:07,557 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:07,557 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:07,558 - INFO - Loading existing market data...
2025-04-17 22:22:07,561 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:07,575 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:07,576 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:07,576 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:07,576 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:07,577 - INFO - Loading existing macro data...
2025-04-17 22:22:07,589 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:07,589 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:07,592 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:07,593 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:07,593 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:07,594 - INFO - Loading existing market data...
2025-04-17 22:22:07,597 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:07,606 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:07,607 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:07,607 - INFO - Test data prepared
2025-04-17 22:22:07,607 - INFO - Storing data...
2025-04-17 22:22:07,608 - INFO - Aligning data indices...
2025-04-17 22:22:07,609 - INFO - Data indices aligned
2025-04-17 22:22:07,610 - INFO - Data preparation completed
2025-04-17 22:22:07,610 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:07,610 - INFO - Training models...
2025-04-17 22:22:07,610 - INFO - Starting model training...
2025-04-17 22:22:07,610 - INFO - Training regime classifier...
2025-04-17 22:22:07,611 - INFO - Training XGBoost model...
2025-04-17 22:22:07,611 - INFO - Preparing features...
2025-04-17 22:22:07,611 - INFO - Input shape: (1536, 8)
2025-04-17 22:22:07,611 - INFO - Handling missing values...
2025-04-17 22:22:07,612 - INFO - Missing values: 0 -> 0
2025-04-17 22:22:07,612 - INFO - Scaling features...
2025-04-17 22:22:07,613 - INFO - Fitted new scaler
2025-04-17 22:22:07,614 - INFO - Output shape: (1536, 8)
2025-04-17 22:22:07,721 - INFO - XGBoost model training completed
2025-04-17 22:22:07,942 - INFO - Model training completed
2025-04-17 22:22:07,944 - INFO - Model training completed
2025-04-17 22:22:07,944 - INFO - Initializing portfolio weights...
2025-04-17 22:22:07,944 - INFO - Portfolio weights initialized
2025-04-17 22:22:07,945 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:07,946 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:07,946 - ERROR - Error running xgboost with autoencoder_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:07,948 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 22:22:07,948 - INFO - Initializing strategy...
2025-04-17 22:22:07,948 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 22:22:07,948 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:07,948 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:22:07,949 - INFO - Running strategy...
2025-04-17 22:22:07,949 - INFO - Starting strategy execution...
2025-04-17 22:22:07,949 - INFO - Preparing training and testing data...
2025-04-17 22:22:07,949 - INFO - Starting data preparation...
2025-04-17 22:22:07,949 - INFO - Loading Fama-French factors...
2025-04-17 22:22:07,959 - INFO - Fama-French factors loaded
2025-04-17 22:22:07,959 - INFO - Processing factor data...
2025-04-17 22:22:07,961 - INFO - Factor data processed
2025-04-17 22:22:07,961 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:07,961 - INFO - 
Training Period:
2025-04-17 22:22:07,966 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:07,973 - INFO - 
Testing Period:
2025-04-17 22:22:07,977 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:07,985 - INFO - Loading macro and market data...
2025-04-17 22:22:07,986 - INFO - Loading existing macro data...
2025-04-17 22:22:07,995 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:07,995 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:07,998 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:07,999 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:07,999 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:08,000 - INFO - Loading existing macro data...
2025-04-17 22:22:08,009 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:08,009 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:08,012 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:08,012 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:08,012 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:08,013 - INFO - Loading existing market data...
2025-04-17 22:22:08,017 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:08,018 - INFO - Loading existing market data...
2025-04-17 22:22:08,021 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:08,021 - INFO - Macro and market data loaded
2025-04-17 22:22:08,021 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:08,021 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:08,022 - INFO - Loading existing macro data...
2025-04-17 22:22:08,031 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:08,032 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:08,034 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:08,035 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:08,035 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:08,036 - INFO - Loading existing market data...
2025-04-17 22:22:08,039 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:08,053 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:08,054 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:08,054 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:08,054 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:08,055 - INFO - Loading existing macro data...
2025-04-17 22:22:08,065 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:08,065 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:08,069 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:08,069 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:08,069 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:08,071 - INFO - Loading existing market data...
2025-04-17 22:22:08,074 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:08,086 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:08,086 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:08,086 - INFO - Test data prepared
2025-04-17 22:22:08,086 - INFO - Storing data...
2025-04-17 22:22:08,087 - INFO - Aligning data indices...
2025-04-17 22:22:08,088 - INFO - Data indices aligned
2025-04-17 22:22:08,088 - INFO - Data preparation completed
2025-04-17 22:22:08,088 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:08,088 - INFO - Training models...
2025-04-17 22:22:08,088 - INFO - Starting model training...
2025-04-17 22:22:08,088 - INFO - Training regime classifier...
2025-04-17 22:22:08,088 - INFO - Training XGBoost model...
2025-04-17 22:22:08,089 - INFO - Preparing features...
2025-04-17 22:22:08,089 - INFO - Input shape: (1536, 8)
2025-04-17 22:22:08,089 - INFO - Handling missing values...
2025-04-17 22:22:08,090 - INFO - Missing values: 0 -> 0
2025-04-17 22:22:08,090 - INFO - Scaling features...
2025-04-17 22:22:08,091 - INFO - Fitted new scaler
2025-04-17 22:22:08,092 - INFO - Output shape: (1536, 8)
2025-04-17 22:22:08,195 - INFO - XGBoost model training completed
2025-04-17 22:22:08,410 - INFO - Model training completed
2025-04-17 22:22:08,411 - INFO - Model training completed
2025-04-17 22:22:08,411 - INFO - Initializing portfolio weights...
2025-04-17 22:22:08,412 - INFO - Portfolio weights initialized
2025-04-17 22:22:08,412 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:08,414 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:08,414 - ERROR - Error running xgboost with autoencoder_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:08,416 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 3 regimes
2025-04-17 22:22:08,416 - INFO - Initializing strategy...
2025-04-17 22:22:08,416 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 22:22:08,416 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:08,416 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:22:09,344 - INFO - Running strategy...
2025-04-17 22:22:09,344 - INFO - Starting strategy execution...
2025-04-17 22:22:09,344 - INFO - Preparing training and testing data...
2025-04-17 22:22:09,344 - INFO - Starting data preparation...
2025-04-17 22:22:09,344 - INFO - Loading Fama-French factors...
2025-04-17 22:22:09,355 - INFO - Fama-French factors loaded
2025-04-17 22:22:09,355 - INFO - Processing factor data...
2025-04-17 22:22:09,358 - INFO - Factor data processed
2025-04-17 22:22:09,358 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:09,358 - INFO - 
Training Period:
2025-04-17 22:22:09,362 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:09,369 - INFO - 
Testing Period:
2025-04-17 22:22:09,374 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:09,381 - INFO - Loading macro and market data...
2025-04-17 22:22:09,381 - INFO - Loading existing macro data...
2025-04-17 22:22:09,391 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:09,391 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:09,394 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:09,394 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:09,395 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:09,396 - INFO - Loading existing macro data...
2025-04-17 22:22:09,405 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:09,406 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:09,408 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:09,409 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:09,409 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:09,410 - INFO - Loading existing market data...
2025-04-17 22:22:09,414 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:09,415 - INFO - Loading existing market data...
2025-04-17 22:22:09,417 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:09,418 - INFO - Macro and market data loaded
2025-04-17 22:22:09,418 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:09,418 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:09,419 - INFO - Loading existing macro data...
2025-04-17 22:22:09,430 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:09,430 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:09,433 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:09,433 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:09,433 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:09,434 - INFO - Loading existing market data...
2025-04-17 22:22:09,438 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:09,453 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:09,454 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:09,454 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:09,454 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:09,455 - INFO - Loading existing macro data...
2025-04-17 22:22:09,465 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:09,466 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:09,469 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:09,469 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:09,470 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:09,471 - INFO - Loading existing market data...
2025-04-17 22:22:09,474 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:09,484 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:09,485 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:09,485 - INFO - Test data prepared
2025-04-17 22:22:09,485 - INFO - Storing data...
2025-04-17 22:22:09,485 - INFO - Aligning data indices...
2025-04-17 22:22:09,486 - INFO - Data indices aligned
2025-04-17 22:22:09,487 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:22:09,487 - INFO - Data preparation completed
2025-04-17 22:22:09,487 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:09,488 - INFO - Training models...
2025-04-17 22:22:09,488 - INFO - Starting model training...
2025-04-17 22:22:09,488 - INFO - Training regime classifier...
2025-04-17 22:22:09,488 - INFO - Training XGBoost model...
2025-04-17 22:22:09,488 - INFO - Preparing features...
2025-04-17 22:22:09,488 - INFO - Input shape: (1536, 8)
2025-04-17 22:22:09,488 - INFO - Handling missing values...
2025-04-17 22:22:09,489 - INFO - Missing values: 0 -> 0
2025-04-17 22:22:09,489 - INFO - Scaling features...
2025-04-17 22:22:09,490 - INFO - Fitted new scaler
2025-04-17 22:22:09,491 - INFO - Output shape: (1536, 8)
2025-04-17 22:22:09,600 - INFO - XGBoost model training completed
2025-04-17 22:22:09,816 - INFO - Training neural portfolio optimizer...
2025-04-17 22:22:09,816 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:22:09,816 - INFO - Model training completed
2025-04-17 22:22:09,818 - INFO - Model training completed
2025-04-17 22:22:09,818 - INFO - Initializing portfolio weights...
2025-04-17 22:22:09,819 - INFO - Portfolio weights initialized
2025-04-17 22:22:09,819 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:09,820 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:09,821 - ERROR - Error running xgboost with neural and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:09,822 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 5 regimes
2025-04-17 22:22:09,822 - INFO - Initializing strategy...
2025-04-17 22:22:09,822 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 22:22:09,823 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:09,823 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:22:09,824 - INFO - Running strategy...
2025-04-17 22:22:09,824 - INFO - Starting strategy execution...
2025-04-17 22:22:09,824 - INFO - Preparing training and testing data...
2025-04-17 22:22:09,824 - INFO - Starting data preparation...
2025-04-17 22:22:09,824 - INFO - Loading Fama-French factors...
2025-04-17 22:22:09,833 - INFO - Fama-French factors loaded
2025-04-17 22:22:09,834 - INFO - Processing factor data...
2025-04-17 22:22:09,836 - INFO - Factor data processed
2025-04-17 22:22:09,836 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:09,836 - INFO - 
Training Period:
2025-04-17 22:22:09,840 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:09,847 - INFO - 
Testing Period:
2025-04-17 22:22:09,851 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:09,858 - INFO - Loading macro and market data...
2025-04-17 22:22:09,859 - INFO - Loading existing macro data...
2025-04-17 22:22:09,869 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:09,870 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:09,872 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:09,872 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:09,873 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:09,873 - INFO - Loading existing macro data...
2025-04-17 22:22:09,883 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:09,883 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:09,886 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:09,886 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:09,886 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:09,887 - INFO - Loading existing market data...
2025-04-17 22:22:09,891 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:09,892 - INFO - Loading existing market data...
2025-04-17 22:22:09,895 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:09,895 - INFO - Macro and market data loaded
2025-04-17 22:22:09,895 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:09,895 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:09,896 - INFO - Loading existing macro data...
2025-04-17 22:22:09,904 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:09,905 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:09,907 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:09,908 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:09,908 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:09,909 - INFO - Loading existing market data...
2025-04-17 22:22:09,913 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:09,926 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:09,927 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:09,927 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:09,927 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:09,928 - INFO - Loading existing macro data...
2025-04-17 22:22:09,938 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:09,938 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:09,942 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:09,942 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:09,942 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:09,943 - INFO - Loading existing market data...
2025-04-17 22:22:09,946 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:09,956 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:09,956 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:09,957 - INFO - Test data prepared
2025-04-17 22:22:09,957 - INFO - Storing data...
2025-04-17 22:22:09,957 - INFO - Aligning data indices...
2025-04-17 22:22:09,958 - INFO - Data indices aligned
2025-04-17 22:22:09,959 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:22:09,959 - INFO - Data preparation completed
2025-04-17 22:22:09,959 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:09,959 - INFO - Training models...
2025-04-17 22:22:09,959 - INFO - Starting model training...
2025-04-17 22:22:09,959 - INFO - Training regime classifier...
2025-04-17 22:22:09,959 - INFO - Training XGBoost model...
2025-04-17 22:22:09,959 - INFO - Preparing features...
2025-04-17 22:22:09,959 - INFO - Input shape: (1536, 8)
2025-04-17 22:22:09,960 - INFO - Handling missing values...
2025-04-17 22:22:09,960 - INFO - Missing values: 0 -> 0
2025-04-17 22:22:09,961 - INFO - Scaling features...
2025-04-17 22:22:09,962 - INFO - Fitted new scaler
2025-04-17 22:22:09,962 - INFO - Output shape: (1536, 8)
2025-04-17 22:22:10,070 - INFO - XGBoost model training completed
2025-04-17 22:22:10,284 - INFO - Training neural portfolio optimizer...
2025-04-17 22:22:10,284 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:22:10,284 - INFO - Model training completed
2025-04-17 22:22:10,286 - INFO - Model training completed
2025-04-17 22:22:10,286 - INFO - Initializing portfolio weights...
2025-04-17 22:22:10,286 - INFO - Portfolio weights initialized
2025-04-17 22:22:10,286 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:10,288 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:10,288 - ERROR - Error running xgboost with neural and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:10,290 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 7 regimes
2025-04-17 22:22:10,290 - INFO - Initializing strategy...
2025-04-17 22:22:10,290 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 22:22:10,290 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:10,290 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:22:10,291 - INFO - Running strategy...
2025-04-17 22:22:10,291 - INFO - Starting strategy execution...
2025-04-17 22:22:10,292 - INFO - Preparing training and testing data...
2025-04-17 22:22:10,292 - INFO - Starting data preparation...
2025-04-17 22:22:10,292 - INFO - Loading Fama-French factors...
2025-04-17 22:22:10,302 - INFO - Fama-French factors loaded
2025-04-17 22:22:10,302 - INFO - Processing factor data...
2025-04-17 22:22:10,305 - INFO - Factor data processed
2025-04-17 22:22:10,305 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:10,305 - INFO - 
Training Period:
2025-04-17 22:22:10,309 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:10,317 - INFO - 
Testing Period:
2025-04-17 22:22:10,321 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:10,328 - INFO - Loading macro and market data...
2025-04-17 22:22:10,329 - INFO - Loading existing macro data...
2025-04-17 22:22:10,339 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:10,340 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:10,342 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:10,343 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:10,343 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:10,344 - INFO - Loading existing macro data...
2025-04-17 22:22:10,353 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:10,354 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:10,356 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:10,356 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:10,356 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:10,357 - INFO - Loading existing market data...
2025-04-17 22:22:10,361 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:10,362 - INFO - Loading existing market data...
2025-04-17 22:22:10,364 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:10,365 - INFO - Macro and market data loaded
2025-04-17 22:22:10,365 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:10,365 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:10,366 - INFO - Loading existing macro data...
2025-04-17 22:22:10,375 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:10,375 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:10,377 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:10,378 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:10,378 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:10,379 - INFO - Loading existing market data...
2025-04-17 22:22:10,382 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:10,397 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:10,397 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:10,397 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:10,397 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:10,398 - INFO - Loading existing macro data...
2025-04-17 22:22:10,411 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:10,412 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:10,415 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:10,415 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:10,416 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:10,417 - INFO - Loading existing market data...
2025-04-17 22:22:10,420 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:10,431 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:10,432 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:10,432 - INFO - Test data prepared
2025-04-17 22:22:10,432 - INFO - Storing data...
2025-04-17 22:22:10,432 - INFO - Aligning data indices...
2025-04-17 22:22:10,433 - INFO - Data indices aligned
2025-04-17 22:22:10,434 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:22:10,434 - INFO - Data preparation completed
2025-04-17 22:22:10,434 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:10,434 - INFO - Training models...
2025-04-17 22:22:10,435 - INFO - Starting model training...
2025-04-17 22:22:10,435 - INFO - Training regime classifier...
2025-04-17 22:22:10,435 - INFO - Training XGBoost model...
2025-04-17 22:22:10,435 - INFO - Preparing features...
2025-04-17 22:22:10,436 - INFO - Input shape: (1536, 8)
2025-04-17 22:22:10,436 - INFO - Handling missing values...
2025-04-17 22:22:10,437 - INFO - Missing values: 0 -> 0
2025-04-17 22:22:10,437 - INFO - Scaling features...
2025-04-17 22:22:10,438 - INFO - Fitted new scaler
2025-04-17 22:22:10,439 - INFO - Output shape: (1536, 8)
2025-04-17 22:22:10,553 - INFO - XGBoost model training completed
2025-04-17 22:22:10,778 - INFO - Training neural portfolio optimizer...
2025-04-17 22:22:10,779 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:22:10,779 - INFO - Model training completed
2025-04-17 22:22:10,780 - INFO - Model training completed
2025-04-17 22:22:10,780 - INFO - Initializing portfolio weights...
2025-04-17 22:22:10,781 - INFO - Portfolio weights initialized
2025-04-17 22:22:10,781 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:10,782 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:10,783 - ERROR - Error running xgboost with neural and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:10,784 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 3 regimes
2025-04-17 22:22:10,785 - INFO - Initializing strategy...
2025-04-17 22:22:10,785 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 22:22:10,785 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:10,785 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:22:10,786 - INFO - Running strategy...
2025-04-17 22:22:10,786 - INFO - Starting strategy execution...
2025-04-17 22:22:10,786 - INFO - Preparing training and testing data...
2025-04-17 22:22:10,786 - INFO - Starting data preparation...
2025-04-17 22:22:10,786 - INFO - Loading Fama-French factors...
2025-04-17 22:22:10,796 - INFO - Fama-French factors loaded
2025-04-17 22:22:10,796 - INFO - Processing factor data...
2025-04-17 22:22:10,798 - INFO - Factor data processed
2025-04-17 22:22:10,798 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:10,799 - INFO - 
Training Period:
2025-04-17 22:22:10,803 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:10,811 - INFO - 
Testing Period:
2025-04-17 22:22:10,815 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:10,822 - INFO - Loading macro and market data...
2025-04-17 22:22:10,823 - INFO - Loading existing macro data...
2025-04-17 22:22:10,833 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:10,833 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:10,836 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:10,836 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:10,836 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:10,837 - INFO - Loading existing macro data...
2025-04-17 22:22:10,847 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:10,848 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:10,850 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:10,850 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:10,850 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:10,851 - INFO - Loading existing market data...
2025-04-17 22:22:10,855 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:10,856 - INFO - Loading existing market data...
2025-04-17 22:22:10,858 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:10,859 - INFO - Macro and market data loaded
2025-04-17 22:22:10,859 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:10,859 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:10,860 - INFO - Loading existing macro data...
2025-04-17 22:22:10,869 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:10,869 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:10,872 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:10,872 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:10,872 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:10,873 - INFO - Loading existing market data...
2025-04-17 22:22:10,877 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:10,891 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:10,891 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:10,891 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:10,892 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:10,893 - INFO - Loading existing macro data...
2025-04-17 22:22:10,904 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:10,905 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:10,908 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:10,909 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:10,909 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:10,910 - INFO - Loading existing market data...
2025-04-17 22:22:10,913 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:10,922 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:10,922 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:10,922 - INFO - Test data prepared
2025-04-17 22:22:10,922 - INFO - Storing data...
2025-04-17 22:22:10,923 - INFO - Aligning data indices...
2025-04-17 22:22:10,924 - INFO - Data indices aligned
2025-04-17 22:22:10,924 - INFO - Data preparation completed
2025-04-17 22:22:10,924 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:10,925 - INFO - Training models...
2025-04-17 22:22:10,925 - INFO - Starting model training...
2025-04-17 22:22:10,925 - INFO - Training regime classifier...
2025-04-17 22:22:10,925 - INFO - Training HMM model...
2025-04-17 22:22:11,140 - INFO - HMM model training completed
2025-04-17 22:22:11,473 - INFO - Model training completed
2025-04-17 22:22:11,475 - INFO - Model training completed
2025-04-17 22:22:11,475 - INFO - Initializing portfolio weights...
2025-04-17 22:22:11,476 - INFO - Portfolio weights initialized
2025-04-17 22:22:11,476 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:11,477 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:11,478 - ERROR - Error running hmm with mean_variance and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:11,479 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 5 regimes
2025-04-17 22:22:11,479 - INFO - Initializing strategy...
2025-04-17 22:22:11,479 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 22:22:11,480 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:11,480 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:22:11,480 - INFO - Running strategy...
2025-04-17 22:22:11,480 - INFO - Starting strategy execution...
2025-04-17 22:22:11,480 - INFO - Preparing training and testing data...
2025-04-17 22:22:11,480 - INFO - Starting data preparation...
2025-04-17 22:22:11,481 - INFO - Loading Fama-French factors...
2025-04-17 22:22:11,489 - INFO - Fama-French factors loaded
2025-04-17 22:22:11,490 - INFO - Processing factor data...
2025-04-17 22:22:11,492 - INFO - Factor data processed
2025-04-17 22:22:11,492 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:11,492 - INFO - 
Training Period:
2025-04-17 22:22:11,496 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:11,503 - INFO - 
Testing Period:
2025-04-17 22:22:11,506 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:11,513 - INFO - Loading macro and market data...
2025-04-17 22:22:11,514 - INFO - Loading existing macro data...
2025-04-17 22:22:11,524 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:11,524 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:11,527 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:11,527 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:11,528 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:11,529 - INFO - Loading existing macro data...
2025-04-17 22:22:11,537 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:11,538 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:11,540 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:11,540 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:11,541 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:11,541 - INFO - Loading existing market data...
2025-04-17 22:22:11,545 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:11,545 - INFO - Loading existing market data...
2025-04-17 22:22:11,548 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:11,548 - INFO - Macro and market data loaded
2025-04-17 22:22:11,548 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:11,548 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:11,549 - INFO - Loading existing macro data...
2025-04-17 22:22:11,558 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:11,558 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:11,561 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:11,561 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:11,561 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:11,562 - INFO - Loading existing market data...
2025-04-17 22:22:11,565 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:11,578 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:11,579 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:11,579 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:11,579 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:11,580 - INFO - Loading existing macro data...
2025-04-17 22:22:11,591 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:11,591 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:11,595 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:11,595 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:11,595 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:11,597 - INFO - Loading existing market data...
2025-04-17 22:22:11,600 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:11,609 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:11,609 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:11,609 - INFO - Test data prepared
2025-04-17 22:22:11,609 - INFO - Storing data...
2025-04-17 22:22:11,609 - INFO - Aligning data indices...
2025-04-17 22:22:11,611 - INFO - Data indices aligned
2025-04-17 22:22:11,611 - INFO - Data preparation completed
2025-04-17 22:22:11,611 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:11,611 - INFO - Training models...
2025-04-17 22:22:11,611 - INFO - Starting model training...
2025-04-17 22:22:11,611 - INFO - Training regime classifier...
2025-04-17 22:22:11,611 - INFO - Training HMM model...
2025-04-17 22:22:11,787 - WARNING - Model is not converging.  Current: 6604.339029600825 is not greater than 21507.424263737772. Delta is -14903.085234136946
2025-04-17 22:22:11,787 - INFO - HMM model training completed
2025-04-17 22:22:11,972 - INFO - Model training completed
2025-04-17 22:22:11,974 - INFO - Model training completed
2025-04-17 22:22:11,974 - INFO - Initializing portfolio weights...
2025-04-17 22:22:11,974 - INFO - Portfolio weights initialized
2025-04-17 22:22:11,975 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:11,976 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:11,976 - ERROR - Error running hmm with mean_variance and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:11,978 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 7 regimes
2025-04-17 22:22:11,978 - INFO - Initializing strategy...
2025-04-17 22:22:11,978 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 22:22:11,978 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:11,979 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:22:11,979 - INFO - Running strategy...
2025-04-17 22:22:11,979 - INFO - Starting strategy execution...
2025-04-17 22:22:11,979 - INFO - Preparing training and testing data...
2025-04-17 22:22:11,979 - INFO - Starting data preparation...
2025-04-17 22:22:11,979 - INFO - Loading Fama-French factors...
2025-04-17 22:22:11,988 - INFO - Fama-French factors loaded
2025-04-17 22:22:11,989 - INFO - Processing factor data...
2025-04-17 22:22:11,991 - INFO - Factor data processed
2025-04-17 22:22:11,991 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:11,991 - INFO - 
Training Period:
2025-04-17 22:22:11,995 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:12,002 - INFO - 
Testing Period:
2025-04-17 22:22:12,006 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:12,014 - INFO - Loading macro and market data...
2025-04-17 22:22:12,015 - INFO - Loading existing macro data...
2025-04-17 22:22:12,024 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:12,025 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:12,027 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:12,028 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:12,028 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:12,029 - INFO - Loading existing macro data...
2025-04-17 22:22:12,038 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:12,038 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:12,041 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:12,041 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:12,041 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:12,042 - INFO - Loading existing market data...
2025-04-17 22:22:12,046 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:12,047 - INFO - Loading existing market data...
2025-04-17 22:22:12,050 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:12,050 - INFO - Macro and market data loaded
2025-04-17 22:22:12,050 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:12,050 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:12,051 - INFO - Loading existing macro data...
2025-04-17 22:22:12,060 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:12,060 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:12,063 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:12,063 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:12,063 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:12,064 - INFO - Loading existing market data...
2025-04-17 22:22:12,067 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:12,080 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:12,080 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:12,080 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:12,081 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:12,082 - INFO - Loading existing macro data...
2025-04-17 22:22:12,091 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:12,092 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:12,095 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:12,095 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:12,095 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:12,096 - INFO - Loading existing market data...
2025-04-17 22:22:12,100 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:12,109 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:12,110 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:12,110 - INFO - Test data prepared
2025-04-17 22:22:12,110 - INFO - Storing data...
2025-04-17 22:22:12,110 - INFO - Aligning data indices...
2025-04-17 22:22:12,111 - INFO - Data indices aligned
2025-04-17 22:22:12,111 - INFO - Data preparation completed
2025-04-17 22:22:12,112 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:12,112 - INFO - Training models...
2025-04-17 22:22:12,112 - INFO - Starting model training...
2025-04-17 22:22:12,112 - INFO - Training regime classifier...
2025-04-17 22:22:12,112 - INFO - Training HMM model...
2025-04-17 22:22:12,323 - INFO - HMM model training completed
2025-04-17 22:22:12,510 - INFO - Model training completed
2025-04-17 22:22:12,511 - INFO - Model training completed
2025-04-17 22:22:12,511 - INFO - Initializing portfolio weights...
2025-04-17 22:22:12,512 - INFO - Portfolio weights initialized
2025-04-17 22:22:12,512 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:12,513 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:12,514 - ERROR - Error running hmm with mean_variance and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:12,515 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 3 regimes
2025-04-17 22:22:12,515 - INFO - Initializing strategy...
2025-04-17 22:22:12,515 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 22:22:12,516 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:12,516 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:22:12,516 - INFO - Running strategy...
2025-04-17 22:22:12,516 - INFO - Starting strategy execution...
2025-04-17 22:22:12,516 - INFO - Preparing training and testing data...
2025-04-17 22:22:12,516 - INFO - Starting data preparation...
2025-04-17 22:22:12,516 - INFO - Loading Fama-French factors...
2025-04-17 22:22:12,526 - INFO - Fama-French factors loaded
2025-04-17 22:22:12,526 - INFO - Processing factor data...
2025-04-17 22:22:12,528 - INFO - Factor data processed
2025-04-17 22:22:12,528 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:12,528 - INFO - 
Training Period:
2025-04-17 22:22:12,532 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:12,540 - INFO - 
Testing Period:
2025-04-17 22:22:12,544 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:12,550 - INFO - Loading macro and market data...
2025-04-17 22:22:12,551 - INFO - Loading existing macro data...
2025-04-17 22:22:12,562 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:12,562 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:12,565 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:12,565 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:12,565 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:12,566 - INFO - Loading existing macro data...
2025-04-17 22:22:12,576 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:12,577 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:12,579 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:12,579 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:12,579 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:12,581 - INFO - Loading existing market data...
2025-04-17 22:22:12,584 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:12,585 - INFO - Loading existing market data...
2025-04-17 22:22:12,588 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:12,588 - INFO - Macro and market data loaded
2025-04-17 22:22:12,589 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:12,589 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:12,590 - INFO - Loading existing macro data...
2025-04-17 22:22:12,599 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:12,599 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:12,602 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:12,602 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:12,602 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:12,603 - INFO - Loading existing market data...
2025-04-17 22:22:12,606 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:12,620 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:12,620 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:12,620 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:12,621 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:12,622 - INFO - Loading existing macro data...
2025-04-17 22:22:12,632 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:12,632 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:12,635 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:12,635 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:12,635 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:12,636 - INFO - Loading existing market data...
2025-04-17 22:22:12,639 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:12,649 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:12,649 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:12,649 - INFO - Test data prepared
2025-04-17 22:22:12,650 - INFO - Storing data...
2025-04-17 22:22:12,650 - INFO - Aligning data indices...
2025-04-17 22:22:12,652 - INFO - Data indices aligned
2025-04-17 22:22:12,652 - INFO - Data preparation completed
2025-04-17 22:22:12,652 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:12,652 - INFO - Training models...
2025-04-17 22:22:12,652 - INFO - Starting model training...
2025-04-17 22:22:12,652 - INFO - Training regime classifier...
2025-04-17 22:22:12,653 - INFO - Training HMM model...
2025-04-17 22:22:12,863 - INFO - HMM model training completed
2025-04-17 22:22:13,048 - INFO - Model training completed
2025-04-17 22:22:13,050 - INFO - Model training completed
2025-04-17 22:22:13,050 - INFO - Initializing portfolio weights...
2025-04-17 22:22:13,051 - INFO - Portfolio weights initialized
2025-04-17 22:22:13,051 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:13,052 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:13,053 - ERROR - Error running hmm with regime_aware and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:13,054 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 5 regimes
2025-04-17 22:22:13,054 - INFO - Initializing strategy...
2025-04-17 22:22:13,055 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 22:22:13,055 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:13,055 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:22:13,055 - INFO - Running strategy...
2025-04-17 22:22:13,055 - INFO - Starting strategy execution...
2025-04-17 22:22:13,055 - INFO - Preparing training and testing data...
2025-04-17 22:22:13,055 - INFO - Starting data preparation...
2025-04-17 22:22:13,055 - INFO - Loading Fama-French factors...
2025-04-17 22:22:13,065 - INFO - Fama-French factors loaded
2025-04-17 22:22:13,065 - INFO - Processing factor data...
2025-04-17 22:22:13,067 - INFO - Factor data processed
2025-04-17 22:22:13,067 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:13,067 - INFO - 
Training Period:
2025-04-17 22:22:13,072 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:13,079 - INFO - 
Testing Period:
2025-04-17 22:22:13,083 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:13,090 - INFO - Loading macro and market data...
2025-04-17 22:22:13,091 - INFO - Loading existing macro data...
2025-04-17 22:22:13,101 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:13,101 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:13,104 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:13,104 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:13,104 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:13,105 - INFO - Loading existing macro data...
2025-04-17 22:22:13,115 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:13,115 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:13,118 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:13,118 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:13,118 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:13,119 - INFO - Loading existing market data...
2025-04-17 22:22:13,122 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:13,123 - INFO - Loading existing market data...
2025-04-17 22:22:13,126 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:13,126 - INFO - Macro and market data loaded
2025-04-17 22:22:13,126 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:13,127 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:13,128 - INFO - Loading existing macro data...
2025-04-17 22:22:13,137 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:13,137 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:13,140 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:13,140 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:13,140 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:13,141 - INFO - Loading existing market data...
2025-04-17 22:22:13,144 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:13,157 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:13,157 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:13,157 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:13,157 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:13,158 - INFO - Loading existing macro data...
2025-04-17 22:22:13,170 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:13,170 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:13,173 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:13,173 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:13,174 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:13,175 - INFO - Loading existing market data...
2025-04-17 22:22:13,178 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:13,189 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:13,189 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:13,189 - INFO - Test data prepared
2025-04-17 22:22:13,190 - INFO - Storing data...
2025-04-17 22:22:13,190 - INFO - Aligning data indices...
2025-04-17 22:22:13,191 - INFO - Data indices aligned
2025-04-17 22:22:13,191 - INFO - Data preparation completed
2025-04-17 22:22:13,191 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:13,191 - INFO - Training models...
2025-04-17 22:22:13,191 - INFO - Starting model training...
2025-04-17 22:22:13,192 - INFO - Training regime classifier...
2025-04-17 22:22:13,192 - INFO - Training HMM model...
2025-04-17 22:22:13,378 - WARNING - Model is not converging.  Current: 6604.339029594567 is not greater than 21507.424264371282. Delta is -14903.085234776714
2025-04-17 22:22:13,378 - INFO - HMM model training completed
2025-04-17 22:22:13,559 - INFO - Model training completed
2025-04-17 22:22:13,561 - INFO - Model training completed
2025-04-17 22:22:13,561 - INFO - Initializing portfolio weights...
2025-04-17 22:22:13,562 - INFO - Portfolio weights initialized
2025-04-17 22:22:13,562 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:13,563 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:13,564 - ERROR - Error running hmm with regime_aware and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:13,565 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 7 regimes
2025-04-17 22:22:13,565 - INFO - Initializing strategy...
2025-04-17 22:22:13,565 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 22:22:13,566 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:13,566 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:22:13,566 - INFO - Running strategy...
2025-04-17 22:22:13,566 - INFO - Starting strategy execution...
2025-04-17 22:22:13,566 - INFO - Preparing training and testing data...
2025-04-17 22:22:13,566 - INFO - Starting data preparation...
2025-04-17 22:22:13,566 - INFO - Loading Fama-French factors...
2025-04-17 22:22:13,575 - INFO - Fama-French factors loaded
2025-04-17 22:22:13,575 - INFO - Processing factor data...
2025-04-17 22:22:13,577 - INFO - Factor data processed
2025-04-17 22:22:13,577 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:13,578 - INFO - 
Training Period:
2025-04-17 22:22:13,582 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:13,589 - INFO - 
Testing Period:
2025-04-17 22:22:13,593 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:13,599 - INFO - Loading macro and market data...
2025-04-17 22:22:13,601 - INFO - Loading existing macro data...
2025-04-17 22:22:13,610 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:13,610 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:13,613 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:13,614 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:13,614 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:13,615 - INFO - Loading existing macro data...
2025-04-17 22:22:13,625 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:13,626 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:13,628 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:13,629 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:13,629 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:13,630 - INFO - Loading existing market data...
2025-04-17 22:22:13,634 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:13,634 - INFO - Loading existing market data...
2025-04-17 22:22:13,637 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:13,638 - INFO - Macro and market data loaded
2025-04-17 22:22:13,638 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:13,638 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:13,639 - INFO - Loading existing macro data...
2025-04-17 22:22:13,648 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:13,648 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:13,651 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:13,651 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:13,652 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:13,652 - INFO - Loading existing market data...
2025-04-17 22:22:13,655 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:13,669 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:13,670 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:13,670 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:13,670 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:13,671 - INFO - Loading existing macro data...
2025-04-17 22:22:13,682 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:13,683 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:13,686 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:13,686 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:13,686 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:13,687 - INFO - Loading existing market data...
2025-04-17 22:22:13,691 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:13,701 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:13,701 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:13,702 - INFO - Test data prepared
2025-04-17 22:22:13,702 - INFO - Storing data...
2025-04-17 22:22:13,702 - INFO - Aligning data indices...
2025-04-17 22:22:13,703 - INFO - Data indices aligned
2025-04-17 22:22:13,704 - INFO - Data preparation completed
2025-04-17 22:22:13,704 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:13,704 - INFO - Training models...
2025-04-17 22:22:13,704 - INFO - Starting model training...
2025-04-17 22:22:13,704 - INFO - Training regime classifier...
2025-04-17 22:22:13,704 - INFO - Training HMM model...
2025-04-17 22:22:13,912 - INFO - HMM model training completed
2025-04-17 22:22:14,089 - INFO - Model training completed
2025-04-17 22:22:14,091 - INFO - Model training completed
2025-04-17 22:22:14,091 - INFO - Initializing portfolio weights...
2025-04-17 22:22:14,092 - INFO - Portfolio weights initialized
2025-04-17 22:22:14,092 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:14,093 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:14,094 - ERROR - Error running hmm with regime_aware and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:14,095 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 3 regimes
2025-04-17 22:22:14,095 - INFO - Initializing strategy...
2025-04-17 22:22:14,095 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 22:22:14,095 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:14,096 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:22:14,096 - INFO - Running strategy...
2025-04-17 22:22:14,096 - INFO - Starting strategy execution...
2025-04-17 22:22:14,096 - INFO - Preparing training and testing data...
2025-04-17 22:22:14,096 - INFO - Starting data preparation...
2025-04-17 22:22:14,096 - INFO - Loading Fama-French factors...
2025-04-17 22:22:14,105 - INFO - Fama-French factors loaded
2025-04-17 22:22:14,105 - INFO - Processing factor data...
2025-04-17 22:22:14,107 - INFO - Factor data processed
2025-04-17 22:22:14,107 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:14,108 - INFO - 
Training Period:
2025-04-17 22:22:14,111 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:14,118 - INFO - 
Testing Period:
2025-04-17 22:22:14,122 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:14,128 - INFO - Loading macro and market data...
2025-04-17 22:22:14,129 - INFO - Loading existing macro data...
2025-04-17 22:22:14,139 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:14,139 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:14,142 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:14,142 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:14,142 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:14,143 - INFO - Loading existing macro data...
2025-04-17 22:22:14,152 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:14,152 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:14,155 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:14,155 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:14,155 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:14,156 - INFO - Loading existing market data...
2025-04-17 22:22:14,159 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:14,160 - INFO - Loading existing market data...
2025-04-17 22:22:14,163 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:14,163 - INFO - Macro and market data loaded
2025-04-17 22:22:14,163 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:14,163 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:14,164 - INFO - Loading existing macro data...
2025-04-17 22:22:14,172 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:14,173 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:14,175 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:14,175 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:14,175 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:14,176 - INFO - Loading existing market data...
2025-04-17 22:22:14,179 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:14,191 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:14,192 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:14,192 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:14,192 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:14,193 - INFO - Loading existing macro data...
2025-04-17 22:22:14,203 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:14,203 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:14,207 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:14,207 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:14,207 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:14,208 - INFO - Loading existing market data...
2025-04-17 22:22:14,211 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:14,221 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:14,221 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:14,222 - INFO - Test data prepared
2025-04-17 22:22:14,222 - INFO - Storing data...
2025-04-17 22:22:14,222 - INFO - Aligning data indices...
2025-04-17 22:22:14,223 - INFO - Data indices aligned
2025-04-17 22:22:14,223 - INFO - Data preparation completed
2025-04-17 22:22:14,223 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:14,223 - INFO - Training models...
2025-04-17 22:22:14,224 - INFO - Starting model training...
2025-04-17 22:22:14,224 - INFO - Training regime classifier...
2025-04-17 22:22:14,224 - INFO - Training HMM model...
2025-04-17 22:22:14,427 - INFO - HMM model training completed
2025-04-17 22:22:14,605 - INFO - Model training completed
2025-04-17 22:22:14,607 - INFO - Model training completed
2025-04-17 22:22:14,607 - INFO - Initializing portfolio weights...
2025-04-17 22:22:14,607 - INFO - Portfolio weights initialized
2025-04-17 22:22:14,607 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:14,609 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:14,609 - ERROR - Error running hmm with neural_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:14,611 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 5 regimes
2025-04-17 22:22:14,611 - INFO - Initializing strategy...
2025-04-17 22:22:14,611 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 22:22:14,611 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:14,611 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:22:14,611 - INFO - Running strategy...
2025-04-17 22:22:14,612 - INFO - Starting strategy execution...
2025-04-17 22:22:14,612 - INFO - Preparing training and testing data...
2025-04-17 22:22:14,612 - INFO - Starting data preparation...
2025-04-17 22:22:14,612 - INFO - Loading Fama-French factors...
2025-04-17 22:22:14,620 - INFO - Fama-French factors loaded
2025-04-17 22:22:14,621 - INFO - Processing factor data...
2025-04-17 22:22:14,623 - INFO - Factor data processed
2025-04-17 22:22:14,623 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:14,623 - INFO - 
Training Period:
2025-04-17 22:22:14,627 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:14,634 - INFO - 
Testing Period:
2025-04-17 22:22:14,638 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:14,645 - INFO - Loading macro and market data...
2025-04-17 22:22:14,646 - INFO - Loading existing macro data...
2025-04-17 22:22:14,656 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:14,656 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:14,659 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:14,659 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:14,659 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:14,660 - INFO - Loading existing macro data...
2025-04-17 22:22:14,669 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:14,670 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:14,673 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:14,673 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:14,673 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:14,674 - INFO - Loading existing market data...
2025-04-17 22:22:14,677 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:14,678 - INFO - Loading existing market data...
2025-04-17 22:22:14,680 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:14,680 - INFO - Macro and market data loaded
2025-04-17 22:22:14,681 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:14,681 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:14,681 - INFO - Loading existing macro data...
2025-04-17 22:22:14,690 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:14,691 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:14,693 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:14,693 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:14,694 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:14,694 - INFO - Loading existing market data...
2025-04-17 22:22:14,698 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:14,711 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:14,711 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:14,711 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:14,712 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:14,713 - INFO - Loading existing macro data...
2025-04-17 22:22:14,723 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:14,723 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:14,726 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:14,726 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:14,727 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:14,728 - INFO - Loading existing market data...
2025-04-17 22:22:14,731 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:14,740 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:14,740 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:14,740 - INFO - Test data prepared
2025-04-17 22:22:14,740 - INFO - Storing data...
2025-04-17 22:22:14,741 - INFO - Aligning data indices...
2025-04-17 22:22:14,742 - INFO - Data indices aligned
2025-04-17 22:22:14,742 - INFO - Data preparation completed
2025-04-17 22:22:14,742 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:14,742 - INFO - Training models...
2025-04-17 22:22:14,742 - INFO - Starting model training...
2025-04-17 22:22:14,742 - INFO - Training regime classifier...
2025-04-17 22:22:14,743 - INFO - Training HMM model...
2025-04-17 22:22:14,954 - INFO - HMM model training completed
2025-04-17 22:22:15,132 - INFO - Model training completed
2025-04-17 22:22:15,134 - INFO - Model training completed
2025-04-17 22:22:15,134 - INFO - Initializing portfolio weights...
2025-04-17 22:22:15,134 - INFO - Portfolio weights initialized
2025-04-17 22:22:15,135 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:15,136 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:15,136 - ERROR - Error running hmm with neural_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:15,138 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 7 regimes
2025-04-17 22:22:15,138 - INFO - Initializing strategy...
2025-04-17 22:22:15,138 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 22:22:15,138 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:15,138 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:22:15,139 - INFO - Running strategy...
2025-04-17 22:22:15,139 - INFO - Starting strategy execution...
2025-04-17 22:22:15,139 - INFO - Preparing training and testing data...
2025-04-17 22:22:15,139 - INFO - Starting data preparation...
2025-04-17 22:22:15,139 - INFO - Loading Fama-French factors...
2025-04-17 22:22:15,148 - INFO - Fama-French factors loaded
2025-04-17 22:22:15,148 - INFO - Processing factor data...
2025-04-17 22:22:15,150 - INFO - Factor data processed
2025-04-17 22:22:15,150 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:15,151 - INFO - 
Training Period:
2025-04-17 22:22:15,155 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:15,161 - INFO - 
Testing Period:
2025-04-17 22:22:15,165 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:15,172 - INFO - Loading macro and market data...
2025-04-17 22:22:15,173 - INFO - Loading existing macro data...
2025-04-17 22:22:15,182 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:15,182 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:15,185 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:15,185 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:15,186 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:15,186 - INFO - Loading existing macro data...
2025-04-17 22:22:15,196 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:15,197 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:15,199 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:15,199 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:15,200 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:15,200 - INFO - Loading existing market data...
2025-04-17 22:22:15,204 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:15,205 - INFO - Loading existing market data...
2025-04-17 22:22:15,207 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:15,208 - INFO - Macro and market data loaded
2025-04-17 22:22:15,208 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:15,208 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:15,209 - INFO - Loading existing macro data...
2025-04-17 22:22:15,217 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:15,217 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:15,220 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:15,220 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:15,220 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:15,221 - INFO - Loading existing market data...
2025-04-17 22:22:15,224 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:15,238 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:15,238 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:15,238 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:15,238 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:15,239 - INFO - Loading existing macro data...
2025-04-17 22:22:15,249 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:15,250 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:15,252 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:15,253 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:15,253 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:15,254 - INFO - Loading existing market data...
2025-04-17 22:22:15,257 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:15,267 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:15,267 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:15,268 - INFO - Test data prepared
2025-04-17 22:22:15,268 - INFO - Storing data...
2025-04-17 22:22:15,268 - INFO - Aligning data indices...
2025-04-17 22:22:15,269 - INFO - Data indices aligned
2025-04-17 22:22:15,269 - INFO - Data preparation completed
2025-04-17 22:22:15,269 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:15,269 - INFO - Training models...
2025-04-17 22:22:15,270 - INFO - Starting model training...
2025-04-17 22:22:15,270 - INFO - Training regime classifier...
2025-04-17 22:22:15,270 - INFO - Training HMM model...
2025-04-17 22:22:15,442 - WARNING - Model is not converging.  Current: 6604.335530239133 is not greater than 21252.701274313542. Delta is -14648.36574407441
2025-04-17 22:22:15,443 - INFO - HMM model training completed
2025-04-17 22:22:15,625 - INFO - Model training completed
2025-04-17 22:22:15,627 - INFO - Model training completed
2025-04-17 22:22:15,627 - INFO - Initializing portfolio weights...
2025-04-17 22:22:15,627 - INFO - Portfolio weights initialized
2025-04-17 22:22:15,627 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:15,629 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:15,629 - ERROR - Error running hmm with neural_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:15,631 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 22:22:15,631 - INFO - Initializing strategy...
2025-04-17 22:22:15,631 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 22:22:15,631 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:15,631 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:22:15,631 - INFO - Running strategy...
2025-04-17 22:22:15,632 - INFO - Starting strategy execution...
2025-04-17 22:22:15,632 - INFO - Preparing training and testing data...
2025-04-17 22:22:15,632 - INFO - Starting data preparation...
2025-04-17 22:22:15,632 - INFO - Loading Fama-French factors...
2025-04-17 22:22:15,641 - INFO - Fama-French factors loaded
2025-04-17 22:22:15,641 - INFO - Processing factor data...
2025-04-17 22:22:15,643 - INFO - Factor data processed
2025-04-17 22:22:15,644 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:15,644 - INFO - 
Training Period:
2025-04-17 22:22:15,648 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:15,654 - INFO - 
Testing Period:
2025-04-17 22:22:15,658 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:15,665 - INFO - Loading macro and market data...
2025-04-17 22:22:15,666 - INFO - Loading existing macro data...
2025-04-17 22:22:15,675 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:15,676 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:15,679 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:15,679 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:15,679 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:15,680 - INFO - Loading existing macro data...
2025-04-17 22:22:15,688 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:15,689 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:15,691 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:15,691 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:15,691 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:15,692 - INFO - Loading existing market data...
2025-04-17 22:22:15,695 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:15,696 - INFO - Loading existing market data...
2025-04-17 22:22:15,698 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:15,698 - INFO - Macro and market data loaded
2025-04-17 22:22:15,699 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:15,699 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:15,699 - INFO - Loading existing macro data...
2025-04-17 22:22:15,708 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:15,708 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:15,710 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:15,710 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:15,711 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:15,712 - INFO - Loading existing market data...
2025-04-17 22:22:15,715 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:15,728 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:15,729 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:15,729 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:15,729 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:15,730 - INFO - Loading existing macro data...
2025-04-17 22:22:15,744 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:15,745 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:15,749 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:15,749 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:15,750 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:15,751 - INFO - Loading existing market data...
2025-04-17 22:22:15,755 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:15,765 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:15,765 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:15,765 - INFO - Test data prepared
2025-04-17 22:22:15,765 - INFO - Storing data...
2025-04-17 22:22:15,766 - INFO - Aligning data indices...
2025-04-17 22:22:15,767 - INFO - Data indices aligned
2025-04-17 22:22:15,767 - INFO - Data preparation completed
2025-04-17 22:22:15,767 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:15,767 - INFO - Training models...
2025-04-17 22:22:15,767 - INFO - Starting model training...
2025-04-17 22:22:15,767 - INFO - Training regime classifier...
2025-04-17 22:22:15,768 - INFO - Training HMM model...
2025-04-17 22:22:15,987 - INFO - HMM model training completed
2025-04-17 22:22:16,167 - INFO - Model training completed
2025-04-17 22:22:16,169 - INFO - Model training completed
2025-04-17 22:22:16,169 - INFO - Initializing portfolio weights...
2025-04-17 22:22:16,170 - INFO - Portfolio weights initialized
2025-04-17 22:22:16,170 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:16,171 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:16,172 - ERROR - Error running hmm with autoencoder_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:16,173 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 22:22:16,173 - INFO - Initializing strategy...
2025-04-17 22:22:16,173 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 22:22:16,174 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:16,174 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:22:16,174 - INFO - Running strategy...
2025-04-17 22:22:16,174 - INFO - Starting strategy execution...
2025-04-17 22:22:16,174 - INFO - Preparing training and testing data...
2025-04-17 22:22:16,174 - INFO - Starting data preparation...
2025-04-17 22:22:16,174 - INFO - Loading Fama-French factors...
2025-04-17 22:22:16,184 - INFO - Fama-French factors loaded
2025-04-17 22:22:16,184 - INFO - Processing factor data...
2025-04-17 22:22:16,186 - INFO - Factor data processed
2025-04-17 22:22:16,186 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:16,186 - INFO - 
Training Period:
2025-04-17 22:22:16,190 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:16,197 - INFO - 
Testing Period:
2025-04-17 22:22:16,202 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:16,209 - INFO - Loading macro and market data...
2025-04-17 22:22:16,210 - INFO - Loading existing macro data...
2025-04-17 22:22:16,220 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:16,221 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:16,223 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:16,224 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:16,224 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:16,225 - INFO - Loading existing macro data...
2025-04-17 22:22:16,234 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:16,234 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:16,237 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:16,237 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:16,237 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:16,238 - INFO - Loading existing market data...
2025-04-17 22:22:16,241 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:16,242 - INFO - Loading existing market data...
2025-04-17 22:22:16,245 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:16,245 - INFO - Macro and market data loaded
2025-04-17 22:22:16,246 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:16,246 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:16,246 - INFO - Loading existing macro data...
2025-04-17 22:22:16,256 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:16,256 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:16,259 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:16,259 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:16,259 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:16,260 - INFO - Loading existing market data...
2025-04-17 22:22:16,264 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:16,277 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:16,278 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:16,278 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:16,278 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:16,279 - INFO - Loading existing macro data...
2025-04-17 22:22:16,290 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:16,290 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:16,293 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:16,293 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:16,293 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:16,295 - INFO - Loading existing market data...
2025-04-17 22:22:16,298 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:16,308 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:16,309 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:16,309 - INFO - Test data prepared
2025-04-17 22:22:16,309 - INFO - Storing data...
2025-04-17 22:22:16,310 - INFO - Aligning data indices...
2025-04-17 22:22:16,311 - INFO - Data indices aligned
2025-04-17 22:22:16,311 - INFO - Data preparation completed
2025-04-17 22:22:16,312 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:16,312 - INFO - Training models...
2025-04-17 22:22:16,312 - INFO - Starting model training...
2025-04-17 22:22:16,312 - INFO - Training regime classifier...
2025-04-17 22:22:16,312 - INFO - Training HMM model...
2025-04-17 22:22:16,530 - INFO - HMM model training completed
2025-04-17 22:22:16,717 - INFO - Model training completed
2025-04-17 22:22:16,718 - INFO - Model training completed
2025-04-17 22:22:16,719 - INFO - Initializing portfolio weights...
2025-04-17 22:22:16,719 - INFO - Portfolio weights initialized
2025-04-17 22:22:16,719 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:16,721 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:16,722 - ERROR - Error running hmm with autoencoder_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:16,723 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 22:22:16,723 - INFO - Initializing strategy...
2025-04-17 22:22:16,723 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 22:22:16,724 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:16,724 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:22:16,724 - INFO - Running strategy...
2025-04-17 22:22:16,724 - INFO - Starting strategy execution...
2025-04-17 22:22:16,724 - INFO - Preparing training and testing data...
2025-04-17 22:22:16,724 - INFO - Starting data preparation...
2025-04-17 22:22:16,724 - INFO - Loading Fama-French factors...
2025-04-17 22:22:16,734 - INFO - Fama-French factors loaded
2025-04-17 22:22:16,734 - INFO - Processing factor data...
2025-04-17 22:22:16,736 - INFO - Factor data processed
2025-04-17 22:22:16,737 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:16,737 - INFO - 
Training Period:
2025-04-17 22:22:16,741 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:16,748 - INFO - 
Testing Period:
2025-04-17 22:22:16,752 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:16,759 - INFO - Loading macro and market data...
2025-04-17 22:22:16,760 - INFO - Loading existing macro data...
2025-04-17 22:22:16,769 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:16,769 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:16,772 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:16,772 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:16,773 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:16,773 - INFO - Loading existing macro data...
2025-04-17 22:22:16,784 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:16,784 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:16,787 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:16,787 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:16,787 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:16,788 - INFO - Loading existing market data...
2025-04-17 22:22:16,792 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:16,793 - INFO - Loading existing market data...
2025-04-17 22:22:16,796 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:16,796 - INFO - Macro and market data loaded
2025-04-17 22:22:16,796 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:16,796 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:16,797 - INFO - Loading existing macro data...
2025-04-17 22:22:16,806 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:16,806 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:16,809 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:16,809 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:16,809 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:16,810 - INFO - Loading existing market data...
2025-04-17 22:22:16,814 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:16,827 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:16,827 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:16,827 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:16,827 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:16,829 - INFO - Loading existing macro data...
2025-04-17 22:22:16,841 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:16,841 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:16,845 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:16,845 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:16,845 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:16,847 - INFO - Loading existing market data...
2025-04-17 22:22:16,851 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:16,861 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:16,862 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:16,862 - INFO - Test data prepared
2025-04-17 22:22:16,862 - INFO - Storing data...
2025-04-17 22:22:16,863 - INFO - Aligning data indices...
2025-04-17 22:22:16,864 - INFO - Data indices aligned
2025-04-17 22:22:16,864 - INFO - Data preparation completed
2025-04-17 22:22:16,864 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:16,864 - INFO - Training models...
2025-04-17 22:22:16,864 - INFO - Starting model training...
2025-04-17 22:22:16,864 - INFO - Training regime classifier...
2025-04-17 22:22:16,864 - INFO - Training HMM model...
2025-04-17 22:22:17,076 - INFO - HMM model training completed
2025-04-17 22:22:17,257 - INFO - Model training completed
2025-04-17 22:22:17,259 - INFO - Model training completed
2025-04-17 22:22:17,259 - INFO - Initializing portfolio weights...
2025-04-17 22:22:17,260 - INFO - Portfolio weights initialized
2025-04-17 22:22:17,260 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:17,262 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:17,262 - ERROR - Error running hmm with autoencoder_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:17,264 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 3 regimes
2025-04-17 22:22:17,264 - INFO - Initializing strategy...
2025-04-17 22:22:17,264 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 22:22:17,264 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:17,264 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:22:17,265 - INFO - Running strategy...
2025-04-17 22:22:17,265 - INFO - Starting strategy execution...
2025-04-17 22:22:17,265 - INFO - Preparing training and testing data...
2025-04-17 22:22:17,265 - INFO - Starting data preparation...
2025-04-17 22:22:17,265 - INFO - Loading Fama-French factors...
2025-04-17 22:22:17,274 - INFO - Fama-French factors loaded
2025-04-17 22:22:17,275 - INFO - Processing factor data...
2025-04-17 22:22:17,277 - INFO - Factor data processed
2025-04-17 22:22:17,277 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:17,277 - INFO - 
Training Period:
2025-04-17 22:22:17,281 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:17,288 - INFO - 
Testing Period:
2025-04-17 22:22:17,292 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:17,299 - INFO - Loading macro and market data...
2025-04-17 22:22:17,300 - INFO - Loading existing macro data...
2025-04-17 22:22:17,310 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:17,311 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:17,313 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:17,314 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:17,314 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:17,315 - INFO - Loading existing macro data...
2025-04-17 22:22:17,324 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:17,325 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:17,328 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:17,328 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:17,328 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:17,329 - INFO - Loading existing market data...
2025-04-17 22:22:17,332 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:17,333 - INFO - Loading existing market data...
2025-04-17 22:22:17,336 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:17,336 - INFO - Macro and market data loaded
2025-04-17 22:22:17,336 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:17,336 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:17,337 - INFO - Loading existing macro data...
2025-04-17 22:22:17,347 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:17,347 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:17,350 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:17,350 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:17,350 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:17,351 - INFO - Loading existing market data...
2025-04-17 22:22:17,355 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:17,368 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:17,368 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:17,368 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:17,368 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:17,369 - INFO - Loading existing macro data...
2025-04-17 22:22:17,379 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:17,379 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:17,382 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:17,382 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:17,383 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:17,384 - INFO - Loading existing market data...
2025-04-17 22:22:17,388 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:17,398 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:17,398 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:17,398 - INFO - Test data prepared
2025-04-17 22:22:17,399 - INFO - Storing data...
2025-04-17 22:22:17,399 - INFO - Aligning data indices...
2025-04-17 22:22:17,400 - INFO - Data indices aligned
2025-04-17 22:22:17,400 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:22:17,400 - INFO - Data preparation completed
2025-04-17 22:22:17,401 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:17,401 - INFO - Training models...
2025-04-17 22:22:17,401 - INFO - Starting model training...
2025-04-17 22:22:17,401 - INFO - Training regime classifier...
2025-04-17 22:22:17,401 - INFO - Training HMM model...
2025-04-17 22:22:17,615 - INFO - HMM model training completed
2025-04-17 22:22:17,797 - INFO - Training neural portfolio optimizer...
2025-04-17 22:22:17,797 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:22:17,797 - INFO - Model training completed
2025-04-17 22:22:17,799 - INFO - Model training completed
2025-04-17 22:22:17,799 - INFO - Initializing portfolio weights...
2025-04-17 22:22:17,799 - INFO - Portfolio weights initialized
2025-04-17 22:22:17,799 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:17,801 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:17,801 - ERROR - Error running hmm with neural and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:17,803 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 5 regimes
2025-04-17 22:22:17,803 - INFO - Initializing strategy...
2025-04-17 22:22:17,803 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 22:22:17,803 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:17,803 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:22:17,804 - INFO - Running strategy...
2025-04-17 22:22:17,804 - INFO - Starting strategy execution...
2025-04-17 22:22:17,804 - INFO - Preparing training and testing data...
2025-04-17 22:22:17,804 - INFO - Starting data preparation...
2025-04-17 22:22:17,804 - INFO - Loading Fama-French factors...
2025-04-17 22:22:17,814 - INFO - Fama-French factors loaded
2025-04-17 22:22:17,814 - INFO - Processing factor data...
2025-04-17 22:22:17,816 - INFO - Factor data processed
2025-04-17 22:22:17,816 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:17,817 - INFO - 
Training Period:
2025-04-17 22:22:17,821 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:17,828 - INFO - 
Testing Period:
2025-04-17 22:22:17,833 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:17,840 - INFO - Loading macro and market data...
2025-04-17 22:22:17,841 - INFO - Loading existing macro data...
2025-04-17 22:22:17,850 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:17,851 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:17,853 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:17,854 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:17,854 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:17,855 - INFO - Loading existing macro data...
2025-04-17 22:22:17,865 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:17,866 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:17,868 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:17,869 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:17,869 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:17,870 - INFO - Loading existing market data...
2025-04-17 22:22:17,874 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:17,875 - INFO - Loading existing market data...
2025-04-17 22:22:17,877 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:17,878 - INFO - Macro and market data loaded
2025-04-17 22:22:17,878 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:17,878 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:17,879 - INFO - Loading existing macro data...
2025-04-17 22:22:17,888 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:17,888 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:17,891 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:17,891 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:17,891 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:17,892 - INFO - Loading existing market data...
2025-04-17 22:22:17,896 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:17,909 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:17,909 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:17,910 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:17,910 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:17,911 - INFO - Loading existing macro data...
2025-04-17 22:22:17,921 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:17,921 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:17,924 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:17,924 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:17,924 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:17,926 - INFO - Loading existing market data...
2025-04-17 22:22:17,930 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:17,941 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:17,942 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:17,942 - INFO - Test data prepared
2025-04-17 22:22:17,942 - INFO - Storing data...
2025-04-17 22:22:17,942 - INFO - Aligning data indices...
2025-04-17 22:22:17,944 - INFO - Data indices aligned
2025-04-17 22:22:17,944 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:22:17,944 - INFO - Data preparation completed
2025-04-17 22:22:17,945 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:17,945 - INFO - Training models...
2025-04-17 22:22:17,945 - INFO - Starting model training...
2025-04-17 22:22:17,945 - INFO - Training regime classifier...
2025-04-17 22:22:17,945 - INFO - Training HMM model...
2025-04-17 22:22:18,123 - WARNING - Model is not converging.  Current: 6604.339029588364 is not greater than 21507.42426465207. Delta is -14903.085235063705
2025-04-17 22:22:18,124 - INFO - HMM model training completed
2025-04-17 22:22:18,306 - INFO - Training neural portfolio optimizer...
2025-04-17 22:22:18,307 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:22:18,307 - INFO - Model training completed
2025-04-17 22:22:18,308 - INFO - Model training completed
2025-04-17 22:22:18,308 - INFO - Initializing portfolio weights...
2025-04-17 22:22:18,309 - INFO - Portfolio weights initialized
2025-04-17 22:22:18,309 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:18,311 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:18,311 - ERROR - Error running hmm with neural and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:18,312 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 7 regimes
2025-04-17 22:22:18,313 - INFO - Initializing strategy...
2025-04-17 22:22:18,313 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 22:22:18,313 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:22:18,313 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:22:18,314 - INFO - Running strategy...
2025-04-17 22:22:18,314 - INFO - Starting strategy execution...
2025-04-17 22:22:18,314 - INFO - Preparing training and testing data...
2025-04-17 22:22:18,314 - INFO - Starting data preparation...
2025-04-17 22:22:18,314 - INFO - Loading Fama-French factors...
2025-04-17 22:22:18,323 - INFO - Fama-French factors loaded
2025-04-17 22:22:18,323 - INFO - Processing factor data...
2025-04-17 22:22:18,326 - INFO - Factor data processed
2025-04-17 22:22:18,326 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:22:18,326 - INFO - 
Training Period:
2025-04-17 22:22:18,330 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:22:18,337 - INFO - 
Testing Period:
2025-04-17 22:22:18,342 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:22:18,348 - INFO - Loading macro and market data...
2025-04-17 22:22:18,350 - INFO - Loading existing macro data...
2025-04-17 22:22:18,359 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:18,360 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:18,362 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:18,363 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:18,363 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:18,364 - INFO - Loading existing macro data...
2025-04-17 22:22:18,374 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:18,374 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:18,377 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:18,377 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:18,377 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:18,378 - INFO - Loading existing market data...
2025-04-17 22:22:18,381 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:18,382 - INFO - Loading existing market data...
2025-04-17 22:22:18,385 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:18,385 - INFO - Macro and market data loaded
2025-04-17 22:22:18,385 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:18,385 - INFO - Preparing training data for regime classification...
2025-04-17 22:22:18,386 - INFO - Loading existing macro data...
2025-04-17 22:22:18,395 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:18,395 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:18,398 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:18,398 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:22:18,398 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:22:18,399 - INFO - Loading existing market data...
2025-04-17 22:22:18,403 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:22:18,415 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:22:18,416 - INFO - Prepared training data with 1536 samples
2025-04-17 22:22:18,416 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:18,416 - INFO - Preparing test data for regime classification...
2025-04-17 22:22:18,417 - INFO - Loading existing macro data...
2025-04-17 22:22:18,429 - WARNING - US corporate credit spread file not found
2025-04-17 22:22:18,429 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:22:18,433 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:22:18,433 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:22:18,433 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:22:18,434 - INFO - Loading existing market data...
2025-04-17 22:22:18,437 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:22:18,446 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:22:18,446 - INFO - Prepared test data with 1276 samples
2025-04-17 22:22:18,447 - INFO - Test data prepared
2025-04-17 22:22:18,447 - INFO - Storing data...
2025-04-17 22:22:18,447 - INFO - Aligning data indices...
2025-04-17 22:22:18,448 - INFO - Data indices aligned
2025-04-17 22:22:18,449 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:22:18,449 - INFO - Data preparation completed
2025-04-17 22:22:18,449 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:22:18,450 - INFO - Training models...
2025-04-17 22:22:18,450 - INFO - Starting model training...
2025-04-17 22:22:18,450 - INFO - Training regime classifier...
2025-04-17 22:22:18,450 - INFO - Training HMM model...
2025-04-17 22:22:18,663 - INFO - HMM model training completed
2025-04-17 22:22:18,853 - INFO - Training neural portfolio optimizer...
2025-04-17 22:22:18,854 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:22:18,854 - INFO - Model training completed
2025-04-17 22:22:18,855 - INFO - Model training completed
2025-04-17 22:22:18,855 - INFO - Initializing portfolio weights...
2025-04-17 22:22:18,856 - INFO - Portfolio weights initialized
2025-04-17 22:22:18,856 - INFO - Generating regime predictions for test period...
2025-04-17 22:22:18,857 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:22:18,858 - ERROR - Error running hmm with neural and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:22:18,860 - ERROR - No valid results obtained from parameter grid search
2025-04-17 22:22:18,860 - ERROR - No valid results obtained from parameter grid search
2025-04-17 22:22:18,860 - INFO - Factor timing strategy optimization completed
2025-04-17 22:23:15,370 - INFO - Starting factor timing strategy optimization...
2025-04-17 22:23:15,371 - INFO - Running parameter grid search...
2025-04-17 22:23:15,371 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 3 regimes
2025-04-17 22:23:15,371 - INFO - Initializing strategy...
2025-04-17 22:23:15,372 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 22:23:15,372 - ERROR - Error running lstm with mean_variance and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:23:15,373 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 5 regimes
2025-04-17 22:23:15,373 - INFO - Initializing strategy...
2025-04-17 22:23:15,374 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 22:23:15,374 - ERROR - Error running lstm with mean_variance and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:23:15,375 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 7 regimes
2025-04-17 22:23:15,375 - INFO - Initializing strategy...
2025-04-17 22:23:15,375 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 22:23:15,375 - ERROR - Error running lstm with mean_variance and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:23:15,376 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 3 regimes
2025-04-17 22:23:15,376 - INFO - Initializing strategy...
2025-04-17 22:23:15,376 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 22:23:15,377 - ERROR - Error running lstm with regime_aware and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:23:15,377 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 5 regimes
2025-04-17 22:23:15,378 - INFO - Initializing strategy...
2025-04-17 22:23:15,378 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 22:23:15,378 - ERROR - Error running lstm with regime_aware and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:23:15,378 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 7 regimes
2025-04-17 22:23:15,379 - INFO - Initializing strategy...
2025-04-17 22:23:15,379 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 22:23:15,379 - ERROR - Error running lstm with regime_aware and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:23:15,379 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 3 regimes
2025-04-17 22:23:15,380 - INFO - Initializing strategy...
2025-04-17 22:23:15,380 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 22:23:15,381 - ERROR - Error running lstm with neural_regime and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:23:15,381 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 5 regimes
2025-04-17 22:23:15,381 - INFO - Initializing strategy...
2025-04-17 22:23:15,382 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 22:23:15,382 - ERROR - Error running lstm with neural_regime and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:23:15,382 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 7 regimes
2025-04-17 22:23:15,382 - INFO - Initializing strategy...
2025-04-17 22:23:15,383 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 22:23:15,383 - ERROR - Error running lstm with neural_regime and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:23:15,383 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 22:23:15,383 - INFO - Initializing strategy...
2025-04-17 22:23:15,384 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 22:23:15,384 - ERROR - Error running lstm with autoencoder_regime and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:23:15,384 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 22:23:15,384 - INFO - Initializing strategy...
2025-04-17 22:23:15,385 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 22:23:15,385 - ERROR - Error running lstm with autoencoder_regime and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:23:15,385 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 22:23:15,386 - INFO - Initializing strategy...
2025-04-17 22:23:15,386 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 22:23:15,386 - ERROR - Error running lstm with autoencoder_regime and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:23:15,386 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 3 regimes
2025-04-17 22:23:15,387 - INFO - Initializing strategy...
2025-04-17 22:23:15,387 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 22:23:15,387 - ERROR - Error running lstm with neural and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:23:15,388 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 5 regimes
2025-04-17 22:23:15,388 - INFO - Initializing strategy...
2025-04-17 22:23:15,388 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 22:23:15,388 - ERROR - Error running lstm with neural and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:23:15,389 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 7 regimes
2025-04-17 22:23:15,389 - INFO - Initializing strategy...
2025-04-17 22:23:15,389 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 22:23:15,389 - ERROR - Error running lstm with neural and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:23:15,390 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 3 regimes
2025-04-17 22:23:15,390 - INFO - Initializing strategy...
2025-04-17 22:23:15,390 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 22:23:15,390 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:15,410 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:23:15,410 - INFO - Running strategy...
2025-04-17 22:23:15,410 - INFO - Starting strategy execution...
2025-04-17 22:23:15,410 - INFO - Preparing training and testing data...
2025-04-17 22:23:15,410 - INFO - Starting data preparation...
2025-04-17 22:23:15,410 - INFO - Loading Fama-French factors...
2025-04-17 22:23:15,423 - INFO - Fama-French factors loaded
2025-04-17 22:23:15,423 - INFO - Processing factor data...
2025-04-17 22:23:15,426 - INFO - Factor data processed
2025-04-17 22:23:15,426 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:15,426 - INFO - 
Training Period:
2025-04-17 22:23:15,432 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:15,439 - INFO - 
Testing Period:
2025-04-17 22:23:15,444 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:15,451 - INFO - Loading macro and market data...
2025-04-17 22:23:15,452 - INFO - Loading existing macro data...
2025-04-17 22:23:15,463 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:15,464 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:15,467 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:15,468 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:15,468 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:15,469 - INFO - Loading existing macro data...
2025-04-17 22:23:15,479 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:15,479 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:15,482 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:15,482 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:15,482 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:15,483 - INFO - Loading existing market data...
2025-04-17 22:23:15,487 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:15,488 - INFO - Loading existing market data...
2025-04-17 22:23:15,491 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:15,491 - INFO - Macro and market data loaded
2025-04-17 22:23:15,492 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:15,492 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:15,493 - INFO - Loading existing macro data...
2025-04-17 22:23:15,502 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:15,502 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:15,504 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:15,505 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:15,505 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:15,506 - INFO - Loading existing market data...
2025-04-17 22:23:15,509 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:15,644 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:15,645 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:15,645 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:15,645 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:15,647 - INFO - Loading existing macro data...
2025-04-17 22:23:15,662 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:15,662 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:15,665 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:15,666 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:15,666 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:15,667 - INFO - Loading existing market data...
2025-04-17 22:23:15,671 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:15,680 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:15,681 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:15,681 - INFO - Test data prepared
2025-04-17 22:23:15,681 - INFO - Storing data...
2025-04-17 22:23:15,681 - INFO - Aligning data indices...
2025-04-17 22:23:15,683 - INFO - Data indices aligned
2025-04-17 22:23:15,683 - INFO - Data preparation completed
2025-04-17 22:23:15,683 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:15,683 - INFO - Training models...
2025-04-17 22:23:15,683 - INFO - Starting model training...
2025-04-17 22:23:15,683 - INFO - Training regime classifier...
2025-04-17 22:23:15,684 - INFO - Training XGBoost model...
2025-04-17 22:23:15,684 - INFO - Preparing features...
2025-04-17 22:23:15,684 - INFO - Input shape: (1536, 8)
2025-04-17 22:23:15,684 - INFO - Handling missing values...
2025-04-17 22:23:15,686 - INFO - Missing values: 0 -> 0
2025-04-17 22:23:15,686 - INFO - Scaling features...
2025-04-17 22:23:15,687 - INFO - Fitted new scaler
2025-04-17 22:23:15,688 - INFO - Output shape: (1536, 8)
2025-04-17 22:23:16,995 - INFO - XGBoost model training completed
2025-04-17 22:23:17,277 - INFO - Model training completed
2025-04-17 22:23:17,279 - INFO - Model training completed
2025-04-17 22:23:17,279 - INFO - Initializing portfolio weights...
2025-04-17 22:23:17,280 - INFO - Portfolio weights initialized
2025-04-17 22:23:17,280 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:17,281 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:17,282 - ERROR - Error running xgboost with mean_variance and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:17,285 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 5 regimes
2025-04-17 22:23:17,285 - INFO - Initializing strategy...
2025-04-17 22:23:17,285 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 22:23:17,285 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:17,285 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:23:17,286 - INFO - Running strategy...
2025-04-17 22:23:17,286 - INFO - Starting strategy execution...
2025-04-17 22:23:17,286 - INFO - Preparing training and testing data...
2025-04-17 22:23:17,286 - INFO - Starting data preparation...
2025-04-17 22:23:17,286 - INFO - Loading Fama-French factors...
2025-04-17 22:23:17,297 - INFO - Fama-French factors loaded
2025-04-17 22:23:17,298 - INFO - Processing factor data...
2025-04-17 22:23:17,300 - INFO - Factor data processed
2025-04-17 22:23:17,300 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:17,300 - INFO - 
Training Period:
2025-04-17 22:23:17,304 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:17,312 - INFO - 
Testing Period:
2025-04-17 22:23:17,316 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:17,323 - INFO - Loading macro and market data...
2025-04-17 22:23:17,324 - INFO - Loading existing macro data...
2025-04-17 22:23:17,335 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:17,336 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:17,339 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:17,339 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:17,340 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:17,341 - INFO - Loading existing macro data...
2025-04-17 22:23:17,350 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:17,350 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:17,353 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:17,353 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:17,354 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:17,355 - INFO - Loading existing market data...
2025-04-17 22:23:17,362 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:17,364 - INFO - Loading existing market data...
2025-04-17 22:23:17,370 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:17,371 - INFO - Macro and market data loaded
2025-04-17 22:23:17,371 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:17,371 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:17,374 - INFO - Loading existing macro data...
2025-04-17 22:23:17,395 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:17,396 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:17,401 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:17,401 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:17,401 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:17,403 - INFO - Loading existing market data...
2025-04-17 22:23:17,408 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:17,428 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:17,429 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:17,429 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:17,429 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:17,431 - INFO - Loading existing macro data...
2025-04-17 22:23:17,450 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:17,451 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:17,456 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:17,456 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:17,456 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:17,458 - INFO - Loading existing market data...
2025-04-17 22:23:17,464 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:17,475 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:17,475 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:17,476 - INFO - Test data prepared
2025-04-17 22:23:17,476 - INFO - Storing data...
2025-04-17 22:23:17,476 - INFO - Aligning data indices...
2025-04-17 22:23:17,478 - INFO - Data indices aligned
2025-04-17 22:23:17,478 - INFO - Data preparation completed
2025-04-17 22:23:17,478 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:17,478 - INFO - Training models...
2025-04-17 22:23:17,478 - INFO - Starting model training...
2025-04-17 22:23:17,478 - INFO - Training regime classifier...
2025-04-17 22:23:17,478 - INFO - Training XGBoost model...
2025-04-17 22:23:17,479 - INFO - Preparing features...
2025-04-17 22:23:17,479 - INFO - Input shape: (1536, 8)
2025-04-17 22:23:17,479 - INFO - Handling missing values...
2025-04-17 22:23:17,480 - INFO - Missing values: 0 -> 0
2025-04-17 22:23:17,480 - INFO - Scaling features...
2025-04-17 22:23:17,481 - INFO - Fitted new scaler
2025-04-17 22:23:17,482 - INFO - Output shape: (1536, 8)
2025-04-17 22:23:17,675 - INFO - XGBoost model training completed
2025-04-17 22:23:18,003 - INFO - Model training completed
2025-04-17 22:23:18,005 - INFO - Model training completed
2025-04-17 22:23:18,005 - INFO - Initializing portfolio weights...
2025-04-17 22:23:18,006 - INFO - Portfolio weights initialized
2025-04-17 22:23:18,006 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:18,007 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:18,007 - ERROR - Error running xgboost with mean_variance and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:18,009 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 7 regimes
2025-04-17 22:23:18,009 - INFO - Initializing strategy...
2025-04-17 22:23:18,009 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 22:23:18,009 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:18,010 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:23:18,010 - INFO - Running strategy...
2025-04-17 22:23:18,010 - INFO - Starting strategy execution...
2025-04-17 22:23:18,010 - INFO - Preparing training and testing data...
2025-04-17 22:23:18,010 - INFO - Starting data preparation...
2025-04-17 22:23:18,011 - INFO - Loading Fama-French factors...
2025-04-17 22:23:18,020 - INFO - Fama-French factors loaded
2025-04-17 22:23:18,020 - INFO - Processing factor data...
2025-04-17 22:23:18,022 - INFO - Factor data processed
2025-04-17 22:23:18,023 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:18,023 - INFO - 
Training Period:
2025-04-17 22:23:18,027 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:18,034 - INFO - 
Testing Period:
2025-04-17 22:23:18,038 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:18,045 - INFO - Loading macro and market data...
2025-04-17 22:23:18,046 - INFO - Loading existing macro data...
2025-04-17 22:23:18,056 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:18,056 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:18,059 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:18,060 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:18,060 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:18,061 - INFO - Loading existing macro data...
2025-04-17 22:23:18,071 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:18,071 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:18,074 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:18,074 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:18,074 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:18,075 - INFO - Loading existing market data...
2025-04-17 22:23:18,079 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:18,080 - INFO - Loading existing market data...
2025-04-17 22:23:18,083 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:18,084 - INFO - Macro and market data loaded
2025-04-17 22:23:18,084 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:18,084 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:18,085 - INFO - Loading existing macro data...
2025-04-17 22:23:18,095 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:18,095 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:18,098 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:18,098 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:18,098 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:18,099 - INFO - Loading existing market data...
2025-04-17 22:23:18,102 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:18,116 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:18,116 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:18,117 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:18,117 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:18,118 - INFO - Loading existing macro data...
2025-04-17 22:23:18,130 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:18,130 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:18,134 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:18,134 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:18,134 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:18,135 - INFO - Loading existing market data...
2025-04-17 22:23:18,139 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:18,149 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:18,150 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:18,150 - INFO - Test data prepared
2025-04-17 22:23:18,150 - INFO - Storing data...
2025-04-17 22:23:18,151 - INFO - Aligning data indices...
2025-04-17 22:23:18,152 - INFO - Data indices aligned
2025-04-17 22:23:18,152 - INFO - Data preparation completed
2025-04-17 22:23:18,152 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:18,152 - INFO - Training models...
2025-04-17 22:23:18,153 - INFO - Starting model training...
2025-04-17 22:23:18,153 - INFO - Training regime classifier...
2025-04-17 22:23:18,153 - INFO - Training XGBoost model...
2025-04-17 22:23:18,153 - INFO - Preparing features...
2025-04-17 22:23:18,154 - INFO - Input shape: (1536, 8)
2025-04-17 22:23:18,154 - INFO - Handling missing values...
2025-04-17 22:23:18,155 - INFO - Missing values: 0 -> 0
2025-04-17 22:23:18,155 - INFO - Scaling features...
2025-04-17 22:23:18,156 - INFO - Fitted new scaler
2025-04-17 22:23:18,157 - INFO - Output shape: (1536, 8)
2025-04-17 22:23:18,270 - INFO - XGBoost model training completed
2025-04-17 22:23:18,483 - INFO - Model training completed
2025-04-17 22:23:18,485 - INFO - Model training completed
2025-04-17 22:23:18,485 - INFO - Initializing portfolio weights...
2025-04-17 22:23:18,485 - INFO - Portfolio weights initialized
2025-04-17 22:23:18,486 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:18,487 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:18,487 - ERROR - Error running xgboost with mean_variance and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:18,489 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 3 regimes
2025-04-17 22:23:18,489 - INFO - Initializing strategy...
2025-04-17 22:23:18,489 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 22:23:18,489 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:18,489 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:23:18,490 - INFO - Running strategy...
2025-04-17 22:23:18,490 - INFO - Starting strategy execution...
2025-04-17 22:23:18,490 - INFO - Preparing training and testing data...
2025-04-17 22:23:18,490 - INFO - Starting data preparation...
2025-04-17 22:23:18,491 - INFO - Loading Fama-French factors...
2025-04-17 22:23:18,500 - INFO - Fama-French factors loaded
2025-04-17 22:23:18,500 - INFO - Processing factor data...
2025-04-17 22:23:18,502 - INFO - Factor data processed
2025-04-17 22:23:18,503 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:18,503 - INFO - 
Training Period:
2025-04-17 22:23:18,507 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:18,514 - INFO - 
Testing Period:
2025-04-17 22:23:18,518 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:18,526 - INFO - Loading macro and market data...
2025-04-17 22:23:18,527 - INFO - Loading existing macro data...
2025-04-17 22:23:18,537 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:18,537 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:18,540 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:18,541 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:18,541 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:18,542 - INFO - Loading existing macro data...
2025-04-17 22:23:18,551 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:18,552 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:18,555 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:18,555 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:18,555 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:18,557 - INFO - Loading existing market data...
2025-04-17 22:23:18,561 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:18,562 - INFO - Loading existing market data...
2025-04-17 22:23:18,564 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:18,565 - INFO - Macro and market data loaded
2025-04-17 22:23:18,565 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:18,565 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:18,566 - INFO - Loading existing macro data...
2025-04-17 22:23:18,575 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:18,575 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:18,578 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:18,578 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:18,578 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:18,579 - INFO - Loading existing market data...
2025-04-17 22:23:18,583 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:18,597 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:18,598 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:18,598 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:18,598 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:18,599 - INFO - Loading existing macro data...
2025-04-17 22:23:18,610 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:18,610 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:18,613 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:18,614 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:18,614 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:18,615 - INFO - Loading existing market data...
2025-04-17 22:23:18,618 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:18,627 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:18,628 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:18,628 - INFO - Test data prepared
2025-04-17 22:23:18,628 - INFO - Storing data...
2025-04-17 22:23:18,629 - INFO - Aligning data indices...
2025-04-17 22:23:18,630 - INFO - Data indices aligned
2025-04-17 22:23:18,630 - INFO - Data preparation completed
2025-04-17 22:23:18,631 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:18,631 - INFO - Training models...
2025-04-17 22:23:18,631 - INFO - Starting model training...
2025-04-17 22:23:18,631 - INFO - Training regime classifier...
2025-04-17 22:23:18,631 - INFO - Training XGBoost model...
2025-04-17 22:23:18,632 - INFO - Preparing features...
2025-04-17 22:23:18,632 - INFO - Input shape: (1536, 8)
2025-04-17 22:23:18,632 - INFO - Handling missing values...
2025-04-17 22:23:18,633 - INFO - Missing values: 0 -> 0
2025-04-17 22:23:18,634 - INFO - Scaling features...
2025-04-17 22:23:18,635 - INFO - Fitted new scaler
2025-04-17 22:23:18,636 - INFO - Output shape: (1536, 8)
2025-04-17 22:23:18,742 - INFO - XGBoost model training completed
2025-04-17 22:23:18,953 - INFO - Model training completed
2025-04-17 22:23:18,955 - INFO - Model training completed
2025-04-17 22:23:18,955 - INFO - Initializing portfolio weights...
2025-04-17 22:23:18,956 - INFO - Portfolio weights initialized
2025-04-17 22:23:18,956 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:18,958 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:18,958 - ERROR - Error running xgboost with regime_aware and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:18,959 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 5 regimes
2025-04-17 22:23:18,959 - INFO - Initializing strategy...
2025-04-17 22:23:18,960 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 22:23:18,960 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:18,960 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:23:18,961 - INFO - Running strategy...
2025-04-17 22:23:18,961 - INFO - Starting strategy execution...
2025-04-17 22:23:18,961 - INFO - Preparing training and testing data...
2025-04-17 22:23:18,961 - INFO - Starting data preparation...
2025-04-17 22:23:18,961 - INFO - Loading Fama-French factors...
2025-04-17 22:23:18,970 - INFO - Fama-French factors loaded
2025-04-17 22:23:18,970 - INFO - Processing factor data...
2025-04-17 22:23:18,972 - INFO - Factor data processed
2025-04-17 22:23:18,973 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:18,973 - INFO - 
Training Period:
2025-04-17 22:23:18,977 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:18,984 - INFO - 
Testing Period:
2025-04-17 22:23:18,988 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:18,995 - INFO - Loading macro and market data...
2025-04-17 22:23:18,996 - INFO - Loading existing macro data...
2025-04-17 22:23:19,006 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:19,007 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:19,009 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:19,010 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:19,010 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:19,011 - INFO - Loading existing macro data...
2025-04-17 22:23:19,021 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:19,021 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:19,024 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:19,024 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:19,024 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:19,025 - INFO - Loading existing market data...
2025-04-17 22:23:19,029 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:19,029 - INFO - Loading existing market data...
2025-04-17 22:23:19,032 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:19,032 - INFO - Macro and market data loaded
2025-04-17 22:23:19,032 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:19,032 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:19,033 - INFO - Loading existing macro data...
2025-04-17 22:23:19,043 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:19,043 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:19,045 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:19,046 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:19,046 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:19,047 - INFO - Loading existing market data...
2025-04-17 22:23:19,051 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:19,065 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:19,065 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:19,065 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:19,065 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:19,067 - INFO - Loading existing macro data...
2025-04-17 22:23:19,077 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:19,077 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:19,080 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:19,081 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:19,081 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:19,083 - INFO - Loading existing market data...
2025-04-17 22:23:19,086 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:19,096 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:19,096 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:19,097 - INFO - Test data prepared
2025-04-17 22:23:19,097 - INFO - Storing data...
2025-04-17 22:23:19,097 - INFO - Aligning data indices...
2025-04-17 22:23:19,098 - INFO - Data indices aligned
2025-04-17 22:23:19,099 - INFO - Data preparation completed
2025-04-17 22:23:19,099 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:19,099 - INFO - Training models...
2025-04-17 22:23:19,099 - INFO - Starting model training...
2025-04-17 22:23:19,099 - INFO - Training regime classifier...
2025-04-17 22:23:19,099 - INFO - Training XGBoost model...
2025-04-17 22:23:19,099 - INFO - Preparing features...
2025-04-17 22:23:19,100 - INFO - Input shape: (1536, 8)
2025-04-17 22:23:19,100 - INFO - Handling missing values...
2025-04-17 22:23:19,101 - INFO - Missing values: 0 -> 0
2025-04-17 22:23:19,101 - INFO - Scaling features...
2025-04-17 22:23:19,102 - INFO - Fitted new scaler
2025-04-17 22:23:19,103 - INFO - Output shape: (1536, 8)
2025-04-17 22:23:19,210 - INFO - XGBoost model training completed
2025-04-17 22:23:19,433 - INFO - Model training completed
2025-04-17 22:23:19,435 - INFO - Model training completed
2025-04-17 22:23:19,435 - INFO - Initializing portfolio weights...
2025-04-17 22:23:19,435 - INFO - Portfolio weights initialized
2025-04-17 22:23:19,436 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:19,437 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:19,438 - ERROR - Error running xgboost with regime_aware and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:19,439 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 7 regimes
2025-04-17 22:23:19,439 - INFO - Initializing strategy...
2025-04-17 22:23:19,439 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 22:23:19,440 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:19,440 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:23:19,440 - INFO - Running strategy...
2025-04-17 22:23:19,440 - INFO - Starting strategy execution...
2025-04-17 22:23:19,441 - INFO - Preparing training and testing data...
2025-04-17 22:23:19,441 - INFO - Starting data preparation...
2025-04-17 22:23:19,441 - INFO - Loading Fama-French factors...
2025-04-17 22:23:19,451 - INFO - Fama-French factors loaded
2025-04-17 22:23:19,451 - INFO - Processing factor data...
2025-04-17 22:23:19,453 - INFO - Factor data processed
2025-04-17 22:23:19,454 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:19,454 - INFO - 
Training Period:
2025-04-17 22:23:19,458 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:19,465 - INFO - 
Testing Period:
2025-04-17 22:23:19,470 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:19,477 - INFO - Loading macro and market data...
2025-04-17 22:23:19,478 - INFO - Loading existing macro data...
2025-04-17 22:23:19,488 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:19,489 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:19,491 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:19,492 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:19,492 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:19,493 - INFO - Loading existing macro data...
2025-04-17 22:23:19,502 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:19,503 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:19,506 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:19,506 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:19,506 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:19,507 - INFO - Loading existing market data...
2025-04-17 22:23:19,510 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:19,511 - INFO - Loading existing market data...
2025-04-17 22:23:19,514 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:19,514 - INFO - Macro and market data loaded
2025-04-17 22:23:19,514 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:19,514 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:19,515 - INFO - Loading existing macro data...
2025-04-17 22:23:19,524 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:19,525 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:19,528 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:19,528 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:19,528 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:19,529 - INFO - Loading existing market data...
2025-04-17 22:23:19,533 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:19,548 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:19,548 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:19,548 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:19,548 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:19,549 - INFO - Loading existing macro data...
2025-04-17 22:23:19,561 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:19,561 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:19,564 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:19,564 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:19,564 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:19,565 - INFO - Loading existing market data...
2025-04-17 22:23:19,569 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:19,579 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:19,579 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:19,579 - INFO - Test data prepared
2025-04-17 22:23:19,580 - INFO - Storing data...
2025-04-17 22:23:19,580 - INFO - Aligning data indices...
2025-04-17 22:23:19,581 - INFO - Data indices aligned
2025-04-17 22:23:19,581 - INFO - Data preparation completed
2025-04-17 22:23:19,582 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:19,582 - INFO - Training models...
2025-04-17 22:23:19,582 - INFO - Starting model training...
2025-04-17 22:23:19,582 - INFO - Training regime classifier...
2025-04-17 22:23:19,582 - INFO - Training XGBoost model...
2025-04-17 22:23:19,582 - INFO - Preparing features...
2025-04-17 22:23:19,582 - INFO - Input shape: (1536, 8)
2025-04-17 22:23:19,582 - INFO - Handling missing values...
2025-04-17 22:23:19,584 - INFO - Missing values: 0 -> 0
2025-04-17 22:23:19,584 - INFO - Scaling features...
2025-04-17 22:23:19,585 - INFO - Fitted new scaler
2025-04-17 22:23:19,585 - INFO - Output shape: (1536, 8)
2025-04-17 22:23:19,698 - INFO - XGBoost model training completed
2025-04-17 22:23:19,912 - INFO - Model training completed
2025-04-17 22:23:19,913 - INFO - Model training completed
2025-04-17 22:23:19,914 - INFO - Initializing portfolio weights...
2025-04-17 22:23:19,914 - INFO - Portfolio weights initialized
2025-04-17 22:23:19,914 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:19,916 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:19,916 - ERROR - Error running xgboost with regime_aware and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:19,918 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 3 regimes
2025-04-17 22:23:19,918 - INFO - Initializing strategy...
2025-04-17 22:23:19,918 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 22:23:19,918 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:19,918 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:23:19,919 - INFO - Running strategy...
2025-04-17 22:23:19,919 - INFO - Starting strategy execution...
2025-04-17 22:23:19,919 - INFO - Preparing training and testing data...
2025-04-17 22:23:19,919 - INFO - Starting data preparation...
2025-04-17 22:23:19,919 - INFO - Loading Fama-French factors...
2025-04-17 22:23:19,929 - INFO - Fama-French factors loaded
2025-04-17 22:23:19,929 - INFO - Processing factor data...
2025-04-17 22:23:19,931 - INFO - Factor data processed
2025-04-17 22:23:19,931 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:19,931 - INFO - 
Training Period:
2025-04-17 22:23:19,935 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:19,942 - INFO - 
Testing Period:
2025-04-17 22:23:19,946 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:19,953 - INFO - Loading macro and market data...
2025-04-17 22:23:19,954 - INFO - Loading existing macro data...
2025-04-17 22:23:19,966 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:19,966 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:19,969 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:19,969 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:19,969 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:19,971 - INFO - Loading existing macro data...
2025-04-17 22:23:19,980 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:19,980 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:19,983 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:19,983 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:19,983 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:19,984 - INFO - Loading existing market data...
2025-04-17 22:23:19,988 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:19,989 - INFO - Loading existing market data...
2025-04-17 22:23:19,992 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:19,992 - INFO - Macro and market data loaded
2025-04-17 22:23:19,992 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:19,993 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:19,993 - INFO - Loading existing macro data...
2025-04-17 22:23:20,003 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:20,003 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:20,006 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:20,006 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:20,006 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:20,007 - INFO - Loading existing market data...
2025-04-17 22:23:20,010 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:20,025 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:20,025 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:20,026 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:20,026 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:20,027 - INFO - Loading existing macro data...
2025-04-17 22:23:20,037 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:20,038 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:20,041 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:20,041 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:20,041 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:20,042 - INFO - Loading existing market data...
2025-04-17 22:23:20,045 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:20,054 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:20,055 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:20,055 - INFO - Test data prepared
2025-04-17 22:23:20,055 - INFO - Storing data...
2025-04-17 22:23:20,056 - INFO - Aligning data indices...
2025-04-17 22:23:20,057 - INFO - Data indices aligned
2025-04-17 22:23:20,057 - INFO - Data preparation completed
2025-04-17 22:23:20,057 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:20,057 - INFO - Training models...
2025-04-17 22:23:20,057 - INFO - Starting model training...
2025-04-17 22:23:20,057 - INFO - Training regime classifier...
2025-04-17 22:23:20,057 - INFO - Training XGBoost model...
2025-04-17 22:23:20,058 - INFO - Preparing features...
2025-04-17 22:23:20,058 - INFO - Input shape: (1536, 8)
2025-04-17 22:23:20,058 - INFO - Handling missing values...
2025-04-17 22:23:20,059 - INFO - Missing values: 0 -> 0
2025-04-17 22:23:20,060 - INFO - Scaling features...
2025-04-17 22:23:20,061 - INFO - Fitted new scaler
2025-04-17 22:23:20,062 - INFO - Output shape: (1536, 8)
2025-04-17 22:23:20,175 - INFO - XGBoost model training completed
2025-04-17 22:23:20,390 - INFO - Model training completed
2025-04-17 22:23:20,391 - INFO - Model training completed
2025-04-17 22:23:20,392 - INFO - Initializing portfolio weights...
2025-04-17 22:23:20,392 - INFO - Portfolio weights initialized
2025-04-17 22:23:20,392 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:20,394 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:20,394 - ERROR - Error running xgboost with neural_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:20,395 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 5 regimes
2025-04-17 22:23:20,395 - INFO - Initializing strategy...
2025-04-17 22:23:20,396 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 22:23:20,396 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:20,396 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:23:20,396 - INFO - Running strategy...
2025-04-17 22:23:20,397 - INFO - Starting strategy execution...
2025-04-17 22:23:20,397 - INFO - Preparing training and testing data...
2025-04-17 22:23:20,397 - INFO - Starting data preparation...
2025-04-17 22:23:20,397 - INFO - Loading Fama-French factors...
2025-04-17 22:23:20,406 - INFO - Fama-French factors loaded
2025-04-17 22:23:20,406 - INFO - Processing factor data...
2025-04-17 22:23:20,408 - INFO - Factor data processed
2025-04-17 22:23:20,408 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:20,409 - INFO - 
Training Period:
2025-04-17 22:23:20,413 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:20,420 - INFO - 
Testing Period:
2025-04-17 22:23:20,425 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:20,432 - INFO - Loading macro and market data...
2025-04-17 22:23:20,433 - INFO - Loading existing macro data...
2025-04-17 22:23:20,443 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:20,444 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:20,446 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:20,447 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:20,447 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:20,448 - INFO - Loading existing macro data...
2025-04-17 22:23:20,458 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:20,458 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:20,461 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:20,461 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:20,461 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:20,462 - INFO - Loading existing market data...
2025-04-17 22:23:20,466 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:20,467 - INFO - Loading existing market data...
2025-04-17 22:23:20,470 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:20,470 - INFO - Macro and market data loaded
2025-04-17 22:23:20,470 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:20,470 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:20,471 - INFO - Loading existing macro data...
2025-04-17 22:23:20,481 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:20,481 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:20,484 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:20,484 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:20,484 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:20,485 - INFO - Loading existing market data...
2025-04-17 22:23:20,489 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:20,505 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:20,505 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:20,505 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:20,505 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:20,506 - INFO - Loading existing macro data...
2025-04-17 22:23:20,516 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:20,517 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:20,520 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:20,520 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:20,520 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:20,522 - INFO - Loading existing market data...
2025-04-17 22:23:20,526 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:20,536 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:20,537 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:20,537 - INFO - Test data prepared
2025-04-17 22:23:20,537 - INFO - Storing data...
2025-04-17 22:23:20,537 - INFO - Aligning data indices...
2025-04-17 22:23:20,538 - INFO - Data indices aligned
2025-04-17 22:23:20,538 - INFO - Data preparation completed
2025-04-17 22:23:20,538 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:20,539 - INFO - Training models...
2025-04-17 22:23:20,539 - INFO - Starting model training...
2025-04-17 22:23:20,539 - INFO - Training regime classifier...
2025-04-17 22:23:20,539 - INFO - Training XGBoost model...
2025-04-17 22:23:20,539 - INFO - Preparing features...
2025-04-17 22:23:20,539 - INFO - Input shape: (1536, 8)
2025-04-17 22:23:20,539 - INFO - Handling missing values...
2025-04-17 22:23:20,540 - INFO - Missing values: 0 -> 0
2025-04-17 22:23:20,541 - INFO - Scaling features...
2025-04-17 22:23:20,542 - INFO - Fitted new scaler
2025-04-17 22:23:20,543 - INFO - Output shape: (1536, 8)
2025-04-17 22:23:20,655 - INFO - XGBoost model training completed
2025-04-17 22:23:20,883 - INFO - Model training completed
2025-04-17 22:23:20,885 - INFO - Model training completed
2025-04-17 22:23:20,885 - INFO - Initializing portfolio weights...
2025-04-17 22:23:20,886 - INFO - Portfolio weights initialized
2025-04-17 22:23:20,886 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:20,887 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:20,888 - ERROR - Error running xgboost with neural_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:20,889 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 7 regimes
2025-04-17 22:23:20,889 - INFO - Initializing strategy...
2025-04-17 22:23:20,889 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 22:23:20,890 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:20,890 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:23:20,890 - INFO - Running strategy...
2025-04-17 22:23:20,891 - INFO - Starting strategy execution...
2025-04-17 22:23:20,891 - INFO - Preparing training and testing data...
2025-04-17 22:23:20,891 - INFO - Starting data preparation...
2025-04-17 22:23:20,891 - INFO - Loading Fama-French factors...
2025-04-17 22:23:20,900 - INFO - Fama-French factors loaded
2025-04-17 22:23:20,901 - INFO - Processing factor data...
2025-04-17 22:23:20,903 - INFO - Factor data processed
2025-04-17 22:23:20,903 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:20,903 - INFO - 
Training Period:
2025-04-17 22:23:20,907 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:20,915 - INFO - 
Testing Period:
2025-04-17 22:23:20,919 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:20,927 - INFO - Loading macro and market data...
2025-04-17 22:23:20,928 - INFO - Loading existing macro data...
2025-04-17 22:23:20,939 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:20,939 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:20,943 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:20,943 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:20,943 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:20,944 - INFO - Loading existing macro data...
2025-04-17 22:23:20,954 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:20,955 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:20,958 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:20,958 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:20,958 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:20,959 - INFO - Loading existing market data...
2025-04-17 22:23:20,963 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:20,964 - INFO - Loading existing market data...
2025-04-17 22:23:20,967 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:20,968 - INFO - Macro and market data loaded
2025-04-17 22:23:20,968 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:20,968 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:20,969 - INFO - Loading existing macro data...
2025-04-17 22:23:20,980 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:20,980 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:20,983 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:20,984 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:20,984 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:20,985 - INFO - Loading existing market data...
2025-04-17 22:23:20,988 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:21,002 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:21,002 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:21,003 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:21,003 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:21,004 - INFO - Loading existing macro data...
2025-04-17 22:23:21,015 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:21,016 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:21,019 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:21,019 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:21,019 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:21,020 - INFO - Loading existing market data...
2025-04-17 22:23:21,024 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:21,033 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:21,034 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:21,034 - INFO - Test data prepared
2025-04-17 22:23:21,035 - INFO - Storing data...
2025-04-17 22:23:21,035 - INFO - Aligning data indices...
2025-04-17 22:23:21,036 - INFO - Data indices aligned
2025-04-17 22:23:21,037 - INFO - Data preparation completed
2025-04-17 22:23:21,037 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:21,037 - INFO - Training models...
2025-04-17 22:23:21,037 - INFO - Starting model training...
2025-04-17 22:23:21,037 - INFO - Training regime classifier...
2025-04-17 22:23:21,037 - INFO - Training XGBoost model...
2025-04-17 22:23:21,038 - INFO - Preparing features...
2025-04-17 22:23:21,038 - INFO - Input shape: (1536, 8)
2025-04-17 22:23:21,038 - INFO - Handling missing values...
2025-04-17 22:23:21,039 - INFO - Missing values: 0 -> 0
2025-04-17 22:23:21,039 - INFO - Scaling features...
2025-04-17 22:23:21,041 - INFO - Fitted new scaler
2025-04-17 22:23:21,042 - INFO - Output shape: (1536, 8)
2025-04-17 22:23:21,151 - INFO - XGBoost model training completed
2025-04-17 22:23:21,362 - INFO - Model training completed
2025-04-17 22:23:21,364 - INFO - Model training completed
2025-04-17 22:23:21,364 - INFO - Initializing portfolio weights...
2025-04-17 22:23:21,365 - INFO - Portfolio weights initialized
2025-04-17 22:23:21,365 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:21,366 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:21,367 - ERROR - Error running xgboost with neural_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:21,368 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 22:23:21,368 - INFO - Initializing strategy...
2025-04-17 22:23:21,368 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 22:23:21,369 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:21,369 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:23:21,369 - INFO - Running strategy...
2025-04-17 22:23:21,369 - INFO - Starting strategy execution...
2025-04-17 22:23:21,369 - INFO - Preparing training and testing data...
2025-04-17 22:23:21,370 - INFO - Starting data preparation...
2025-04-17 22:23:21,370 - INFO - Loading Fama-French factors...
2025-04-17 22:23:21,379 - INFO - Fama-French factors loaded
2025-04-17 22:23:21,379 - INFO - Processing factor data...
2025-04-17 22:23:21,381 - INFO - Factor data processed
2025-04-17 22:23:21,382 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:21,383 - INFO - 
Training Period:
2025-04-17 22:23:21,387 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:21,394 - INFO - 
Testing Period:
2025-04-17 22:23:21,399 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:21,406 - INFO - Loading macro and market data...
2025-04-17 22:23:21,408 - INFO - Loading existing macro data...
2025-04-17 22:23:21,418 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:21,419 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:21,422 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:21,423 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:21,423 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:21,424 - INFO - Loading existing macro data...
2025-04-17 22:23:21,434 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:21,434 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:21,437 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:21,437 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:21,437 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:21,438 - INFO - Loading existing market data...
2025-04-17 22:23:21,442 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:21,443 - INFO - Loading existing market data...
2025-04-17 22:23:21,446 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:21,446 - INFO - Macro and market data loaded
2025-04-17 22:23:21,447 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:21,447 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:21,448 - INFO - Loading existing macro data...
2025-04-17 22:23:21,457 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:21,457 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:21,461 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:21,461 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:21,461 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:21,462 - INFO - Loading existing market data...
2025-04-17 22:23:21,466 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:21,480 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:21,481 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:21,481 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:21,481 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:21,482 - INFO - Loading existing macro data...
2025-04-17 22:23:21,493 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:21,493 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:21,496 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:21,496 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:21,496 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:21,497 - INFO - Loading existing market data...
2025-04-17 22:23:21,500 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:21,510 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:21,510 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:21,511 - INFO - Test data prepared
2025-04-17 22:23:21,511 - INFO - Storing data...
2025-04-17 22:23:21,511 - INFO - Aligning data indices...
2025-04-17 22:23:21,513 - INFO - Data indices aligned
2025-04-17 22:23:21,513 - INFO - Data preparation completed
2025-04-17 22:23:21,513 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:21,513 - INFO - Training models...
2025-04-17 22:23:21,513 - INFO - Starting model training...
2025-04-17 22:23:21,513 - INFO - Training regime classifier...
2025-04-17 22:23:21,513 - INFO - Training XGBoost model...
2025-04-17 22:23:21,514 - INFO - Preparing features...
2025-04-17 22:23:21,514 - INFO - Input shape: (1536, 8)
2025-04-17 22:23:21,514 - INFO - Handling missing values...
2025-04-17 22:23:21,515 - INFO - Missing values: 0 -> 0
2025-04-17 22:23:21,516 - INFO - Scaling features...
2025-04-17 22:23:21,517 - INFO - Fitted new scaler
2025-04-17 22:23:21,518 - INFO - Output shape: (1536, 8)
2025-04-17 22:23:21,626 - INFO - XGBoost model training completed
2025-04-17 22:23:21,844 - INFO - Model training completed
2025-04-17 22:23:21,846 - INFO - Model training completed
2025-04-17 22:23:21,846 - INFO - Initializing portfolio weights...
2025-04-17 22:23:21,847 - INFO - Portfolio weights initialized
2025-04-17 22:23:21,847 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:21,849 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:21,849 - ERROR - Error running xgboost with autoencoder_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:21,851 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 22:23:21,851 - INFO - Initializing strategy...
2025-04-17 22:23:21,851 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 22:23:21,851 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:21,852 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:23:21,852 - INFO - Running strategy...
2025-04-17 22:23:21,852 - INFO - Starting strategy execution...
2025-04-17 22:23:21,853 - INFO - Preparing training and testing data...
2025-04-17 22:23:21,853 - INFO - Starting data preparation...
2025-04-17 22:23:21,853 - INFO - Loading Fama-French factors...
2025-04-17 22:23:21,863 - INFO - Fama-French factors loaded
2025-04-17 22:23:21,863 - INFO - Processing factor data...
2025-04-17 22:23:21,866 - INFO - Factor data processed
2025-04-17 22:23:21,866 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:21,866 - INFO - 
Training Period:
2025-04-17 22:23:21,871 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:21,878 - INFO - 
Testing Period:
2025-04-17 22:23:21,882 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:21,890 - INFO - Loading macro and market data...
2025-04-17 22:23:21,891 - INFO - Loading existing macro data...
2025-04-17 22:23:21,901 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:21,901 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:21,904 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:21,904 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:21,905 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:21,906 - INFO - Loading existing macro data...
2025-04-17 22:23:21,916 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:21,916 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:21,919 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:21,919 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:21,919 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:21,920 - INFO - Loading existing market data...
2025-04-17 22:23:21,924 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:21,925 - INFO - Loading existing market data...
2025-04-17 22:23:21,929 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:21,929 - INFO - Macro and market data loaded
2025-04-17 22:23:21,929 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:21,929 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:21,930 - INFO - Loading existing macro data...
2025-04-17 22:23:21,941 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:21,941 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:21,944 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:21,944 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:21,944 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:21,945 - INFO - Loading existing market data...
2025-04-17 22:23:21,949 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:21,963 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:21,964 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:21,964 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:21,964 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:21,965 - INFO - Loading existing macro data...
2025-04-17 22:23:21,977 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:21,978 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:21,981 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:21,981 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:21,981 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:21,982 - INFO - Loading existing market data...
2025-04-17 22:23:21,986 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:21,996 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:21,996 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:21,997 - INFO - Test data prepared
2025-04-17 22:23:21,997 - INFO - Storing data...
2025-04-17 22:23:21,997 - INFO - Aligning data indices...
2025-04-17 22:23:21,999 - INFO - Data indices aligned
2025-04-17 22:23:21,999 - INFO - Data preparation completed
2025-04-17 22:23:21,999 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:21,999 - INFO - Training models...
2025-04-17 22:23:21,999 - INFO - Starting model training...
2025-04-17 22:23:21,999 - INFO - Training regime classifier...
2025-04-17 22:23:21,999 - INFO - Training XGBoost model...
2025-04-17 22:23:21,999 - INFO - Preparing features...
2025-04-17 22:23:22,000 - INFO - Input shape: (1536, 8)
2025-04-17 22:23:22,000 - INFO - Handling missing values...
2025-04-17 22:23:22,001 - INFO - Missing values: 0 -> 0
2025-04-17 22:23:22,001 - INFO - Scaling features...
2025-04-17 22:23:22,002 - INFO - Fitted new scaler
2025-04-17 22:23:22,002 - INFO - Output shape: (1536, 8)
2025-04-17 22:23:22,116 - INFO - XGBoost model training completed
2025-04-17 22:23:22,332 - INFO - Model training completed
2025-04-17 22:23:22,334 - INFO - Model training completed
2025-04-17 22:23:22,334 - INFO - Initializing portfolio weights...
2025-04-17 22:23:22,334 - INFO - Portfolio weights initialized
2025-04-17 22:23:22,335 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:22,336 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:22,336 - ERROR - Error running xgboost with autoencoder_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:22,338 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 22:23:22,338 - INFO - Initializing strategy...
2025-04-17 22:23:22,338 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 22:23:22,338 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:22,338 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:23:22,339 - INFO - Running strategy...
2025-04-17 22:23:22,339 - INFO - Starting strategy execution...
2025-04-17 22:23:22,339 - INFO - Preparing training and testing data...
2025-04-17 22:23:22,339 - INFO - Starting data preparation...
2025-04-17 22:23:22,339 - INFO - Loading Fama-French factors...
2025-04-17 22:23:22,349 - INFO - Fama-French factors loaded
2025-04-17 22:23:22,349 - INFO - Processing factor data...
2025-04-17 22:23:22,352 - INFO - Factor data processed
2025-04-17 22:23:22,352 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:22,352 - INFO - 
Training Period:
2025-04-17 22:23:22,356 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:22,364 - INFO - 
Testing Period:
2025-04-17 22:23:22,368 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:22,375 - INFO - Loading macro and market data...
2025-04-17 22:23:22,376 - INFO - Loading existing macro data...
2025-04-17 22:23:22,385 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:22,386 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:22,389 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:22,389 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:22,390 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:22,391 - INFO - Loading existing macro data...
2025-04-17 22:23:22,400 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:22,401 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:22,404 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:22,404 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:22,405 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:22,406 - INFO - Loading existing market data...
2025-04-17 22:23:22,410 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:22,411 - INFO - Loading existing market data...
2025-04-17 22:23:22,414 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:22,415 - INFO - Macro and market data loaded
2025-04-17 22:23:22,415 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:22,415 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:22,416 - INFO - Loading existing macro data...
2025-04-17 22:23:22,425 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:22,425 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:22,428 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:22,428 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:22,429 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:22,430 - INFO - Loading existing market data...
2025-04-17 22:23:22,433 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:22,448 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:22,448 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:22,449 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:22,449 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:22,450 - INFO - Loading existing macro data...
2025-04-17 22:23:22,461 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:22,461 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:22,464 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:22,464 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:22,464 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:22,465 - INFO - Loading existing market data...
2025-04-17 22:23:22,468 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:22,478 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:22,479 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:22,479 - INFO - Test data prepared
2025-04-17 22:23:22,480 - INFO - Storing data...
2025-04-17 22:23:22,480 - INFO - Aligning data indices...
2025-04-17 22:23:22,481 - INFO - Data indices aligned
2025-04-17 22:23:22,481 - INFO - Data preparation completed
2025-04-17 22:23:22,481 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:22,481 - INFO - Training models...
2025-04-17 22:23:22,481 - INFO - Starting model training...
2025-04-17 22:23:22,482 - INFO - Training regime classifier...
2025-04-17 22:23:22,482 - INFO - Training XGBoost model...
2025-04-17 22:23:22,482 - INFO - Preparing features...
2025-04-17 22:23:22,482 - INFO - Input shape: (1536, 8)
2025-04-17 22:23:22,482 - INFO - Handling missing values...
2025-04-17 22:23:22,484 - INFO - Missing values: 0 -> 0
2025-04-17 22:23:22,484 - INFO - Scaling features...
2025-04-17 22:23:22,485 - INFO - Fitted new scaler
2025-04-17 22:23:22,486 - INFO - Output shape: (1536, 8)
2025-04-17 22:23:22,595 - INFO - XGBoost model training completed
2025-04-17 22:23:22,812 - INFO - Model training completed
2025-04-17 22:23:22,814 - INFO - Model training completed
2025-04-17 22:23:22,814 - INFO - Initializing portfolio weights...
2025-04-17 22:23:22,815 - INFO - Portfolio weights initialized
2025-04-17 22:23:22,815 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:22,816 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:22,817 - ERROR - Error running xgboost with autoencoder_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:22,818 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 3 regimes
2025-04-17 22:23:22,818 - INFO - Initializing strategy...
2025-04-17 22:23:22,818 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 22:23:22,819 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:22,819 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:23:23,718 - INFO - Running strategy...
2025-04-17 22:23:23,719 - INFO - Starting strategy execution...
2025-04-17 22:23:23,719 - INFO - Preparing training and testing data...
2025-04-17 22:23:23,719 - INFO - Starting data preparation...
2025-04-17 22:23:23,719 - INFO - Loading Fama-French factors...
2025-04-17 22:23:23,730 - INFO - Fama-French factors loaded
2025-04-17 22:23:23,730 - INFO - Processing factor data...
2025-04-17 22:23:23,732 - INFO - Factor data processed
2025-04-17 22:23:23,732 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:23,732 - INFO - 
Training Period:
2025-04-17 22:23:23,737 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:23,744 - INFO - 
Testing Period:
2025-04-17 22:23:23,748 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:23,756 - INFO - Loading macro and market data...
2025-04-17 22:23:23,757 - INFO - Loading existing macro data...
2025-04-17 22:23:23,769 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:23,770 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:23,773 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:23,773 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:23,773 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:23,774 - INFO - Loading existing macro data...
2025-04-17 22:23:23,784 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:23,784 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:23,787 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:23,787 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:23,787 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:23,788 - INFO - Loading existing market data...
2025-04-17 22:23:23,792 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:23,793 - INFO - Loading existing market data...
2025-04-17 22:23:23,795 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:23,795 - INFO - Macro and market data loaded
2025-04-17 22:23:23,796 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:23,796 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:23,797 - INFO - Loading existing macro data...
2025-04-17 22:23:23,808 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:23,808 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:23,811 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:23,811 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:23,811 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:23,812 - INFO - Loading existing market data...
2025-04-17 22:23:23,817 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:23,831 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:23,832 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:23,832 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:23,832 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:23,833 - INFO - Loading existing macro data...
2025-04-17 22:23:23,845 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:23,845 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:23,848 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:23,849 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:23,849 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:23,851 - INFO - Loading existing market data...
2025-04-17 22:23:23,854 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:23,865 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:23,865 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:23,866 - INFO - Test data prepared
2025-04-17 22:23:23,866 - INFO - Storing data...
2025-04-17 22:23:23,866 - INFO - Aligning data indices...
2025-04-17 22:23:23,868 - INFO - Data indices aligned
2025-04-17 22:23:23,868 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:23:23,868 - INFO - Data preparation completed
2025-04-17 22:23:23,869 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:23,869 - INFO - Training models...
2025-04-17 22:23:23,869 - INFO - Starting model training...
2025-04-17 22:23:23,869 - INFO - Training regime classifier...
2025-04-17 22:23:23,869 - INFO - Training XGBoost model...
2025-04-17 22:23:23,869 - INFO - Preparing features...
2025-04-17 22:23:23,869 - INFO - Input shape: (1536, 8)
2025-04-17 22:23:23,869 - INFO - Handling missing values...
2025-04-17 22:23:23,871 - INFO - Missing values: 0 -> 0
2025-04-17 22:23:23,871 - INFO - Scaling features...
2025-04-17 22:23:23,872 - INFO - Fitted new scaler
2025-04-17 22:23:23,873 - INFO - Output shape: (1536, 8)
2025-04-17 22:23:23,984 - INFO - XGBoost model training completed
2025-04-17 22:23:24,201 - INFO - Training neural portfolio optimizer...
2025-04-17 22:23:24,202 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:23:24,202 - INFO - Model training completed
2025-04-17 22:23:24,203 - INFO - Model training completed
2025-04-17 22:23:24,203 - INFO - Initializing portfolio weights...
2025-04-17 22:23:24,204 - INFO - Portfolio weights initialized
2025-04-17 22:23:24,204 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:24,205 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:24,205 - ERROR - Error running xgboost with neural and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:24,207 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 5 regimes
2025-04-17 22:23:24,207 - INFO - Initializing strategy...
2025-04-17 22:23:24,208 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 22:23:24,208 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:24,208 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:23:24,209 - INFO - Running strategy...
2025-04-17 22:23:24,209 - INFO - Starting strategy execution...
2025-04-17 22:23:24,209 - INFO - Preparing training and testing data...
2025-04-17 22:23:24,210 - INFO - Starting data preparation...
2025-04-17 22:23:24,210 - INFO - Loading Fama-French factors...
2025-04-17 22:23:24,219 - INFO - Fama-French factors loaded
2025-04-17 22:23:24,219 - INFO - Processing factor data...
2025-04-17 22:23:24,221 - INFO - Factor data processed
2025-04-17 22:23:24,222 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:24,222 - INFO - 
Training Period:
2025-04-17 22:23:24,226 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:24,233 - INFO - 
Testing Period:
2025-04-17 22:23:24,237 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:24,244 - INFO - Loading macro and market data...
2025-04-17 22:23:24,245 - INFO - Loading existing macro data...
2025-04-17 22:23:24,254 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:24,255 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:24,258 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:24,258 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:24,258 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:24,259 - INFO - Loading existing macro data...
2025-04-17 22:23:24,270 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:24,270 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:24,273 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:24,273 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:24,273 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:24,274 - INFO - Loading existing market data...
2025-04-17 22:23:24,278 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:24,279 - INFO - Loading existing market data...
2025-04-17 22:23:24,282 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:24,282 - INFO - Macro and market data loaded
2025-04-17 22:23:24,282 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:24,283 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:24,283 - INFO - Loading existing macro data...
2025-04-17 22:23:24,293 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:24,293 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:24,296 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:24,296 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:24,296 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:24,297 - INFO - Loading existing market data...
2025-04-17 22:23:24,300 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:24,314 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:24,314 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:24,315 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:24,315 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:24,316 - INFO - Loading existing macro data...
2025-04-17 22:23:24,327 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:24,327 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:24,330 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:24,331 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:24,331 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:24,332 - INFO - Loading existing market data...
2025-04-17 22:23:24,335 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:24,345 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:24,345 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:24,346 - INFO - Test data prepared
2025-04-17 22:23:24,346 - INFO - Storing data...
2025-04-17 22:23:24,347 - INFO - Aligning data indices...
2025-04-17 22:23:24,348 - INFO - Data indices aligned
2025-04-17 22:23:24,349 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:23:24,349 - INFO - Data preparation completed
2025-04-17 22:23:24,349 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:24,349 - INFO - Training models...
2025-04-17 22:23:24,349 - INFO - Starting model training...
2025-04-17 22:23:24,350 - INFO - Training regime classifier...
2025-04-17 22:23:24,350 - INFO - Training XGBoost model...
2025-04-17 22:23:24,350 - INFO - Preparing features...
2025-04-17 22:23:24,350 - INFO - Input shape: (1536, 8)
2025-04-17 22:23:24,350 - INFO - Handling missing values...
2025-04-17 22:23:24,351 - INFO - Missing values: 0 -> 0
2025-04-17 22:23:24,351 - INFO - Scaling features...
2025-04-17 22:23:24,353 - INFO - Fitted new scaler
2025-04-17 22:23:24,354 - INFO - Output shape: (1536, 8)
2025-04-17 22:23:24,461 - INFO - XGBoost model training completed
2025-04-17 22:23:24,682 - INFO - Training neural portfolio optimizer...
2025-04-17 22:23:24,682 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:23:24,682 - INFO - Model training completed
2025-04-17 22:23:24,683 - INFO - Model training completed
2025-04-17 22:23:24,684 - INFO - Initializing portfolio weights...
2025-04-17 22:23:24,684 - INFO - Portfolio weights initialized
2025-04-17 22:23:24,684 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:24,686 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:24,686 - ERROR - Error running xgboost with neural and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:24,688 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 7 regimes
2025-04-17 22:23:24,688 - INFO - Initializing strategy...
2025-04-17 22:23:24,688 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 22:23:24,688 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:24,688 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:23:24,689 - INFO - Running strategy...
2025-04-17 22:23:24,689 - INFO - Starting strategy execution...
2025-04-17 22:23:24,690 - INFO - Preparing training and testing data...
2025-04-17 22:23:24,690 - INFO - Starting data preparation...
2025-04-17 22:23:24,690 - INFO - Loading Fama-French factors...
2025-04-17 22:23:24,699 - INFO - Fama-French factors loaded
2025-04-17 22:23:24,699 - INFO - Processing factor data...
2025-04-17 22:23:24,701 - INFO - Factor data processed
2025-04-17 22:23:24,701 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:24,702 - INFO - 
Training Period:
2025-04-17 22:23:24,706 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:24,713 - INFO - 
Testing Period:
2025-04-17 22:23:24,717 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:24,723 - INFO - Loading macro and market data...
2025-04-17 22:23:24,724 - INFO - Loading existing macro data...
2025-04-17 22:23:24,734 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:24,734 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:24,737 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:24,737 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:24,737 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:24,738 - INFO - Loading existing macro data...
2025-04-17 22:23:24,748 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:24,748 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:24,751 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:24,751 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:24,751 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:24,752 - INFO - Loading existing market data...
2025-04-17 22:23:24,756 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:24,757 - INFO - Loading existing market data...
2025-04-17 22:23:24,759 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:24,759 - INFO - Macro and market data loaded
2025-04-17 22:23:24,760 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:24,760 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:24,760 - INFO - Loading existing macro data...
2025-04-17 22:23:24,770 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:24,770 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:24,773 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:24,773 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:24,774 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:24,775 - INFO - Loading existing market data...
2025-04-17 22:23:24,779 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:24,793 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:24,793 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:24,793 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:24,794 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:24,795 - INFO - Loading existing macro data...
2025-04-17 22:23:24,807 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:24,807 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:24,811 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:24,811 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:24,811 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:24,812 - INFO - Loading existing market data...
2025-04-17 22:23:24,815 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:24,826 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:24,827 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:24,827 - INFO - Test data prepared
2025-04-17 22:23:24,827 - INFO - Storing data...
2025-04-17 22:23:24,827 - INFO - Aligning data indices...
2025-04-17 22:23:24,829 - INFO - Data indices aligned
2025-04-17 22:23:24,829 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:23:24,829 - INFO - Data preparation completed
2025-04-17 22:23:24,830 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:24,830 - INFO - Training models...
2025-04-17 22:23:24,830 - INFO - Starting model training...
2025-04-17 22:23:24,830 - INFO - Training regime classifier...
2025-04-17 22:23:24,830 - INFO - Training XGBoost model...
2025-04-17 22:23:24,830 - INFO - Preparing features...
2025-04-17 22:23:24,830 - INFO - Input shape: (1536, 8)
2025-04-17 22:23:24,831 - INFO - Handling missing values...
2025-04-17 22:23:24,832 - INFO - Missing values: 0 -> 0
2025-04-17 22:23:24,832 - INFO - Scaling features...
2025-04-17 22:23:24,834 - INFO - Fitted new scaler
2025-04-17 22:23:24,834 - INFO - Output shape: (1536, 8)
2025-04-17 22:23:24,951 - INFO - XGBoost model training completed
2025-04-17 22:23:25,171 - INFO - Training neural portfolio optimizer...
2025-04-17 22:23:25,171 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:23:25,171 - INFO - Model training completed
2025-04-17 22:23:25,173 - INFO - Model training completed
2025-04-17 22:23:25,173 - INFO - Initializing portfolio weights...
2025-04-17 22:23:25,174 - INFO - Portfolio weights initialized
2025-04-17 22:23:25,174 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:25,175 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:25,175 - ERROR - Error running xgboost with neural and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:25,177 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 3 regimes
2025-04-17 22:23:25,177 - INFO - Initializing strategy...
2025-04-17 22:23:25,177 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 22:23:25,178 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:25,178 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:23:25,179 - INFO - Running strategy...
2025-04-17 22:23:25,179 - INFO - Starting strategy execution...
2025-04-17 22:23:25,179 - INFO - Preparing training and testing data...
2025-04-17 22:23:25,179 - INFO - Starting data preparation...
2025-04-17 22:23:25,179 - INFO - Loading Fama-French factors...
2025-04-17 22:23:25,190 - INFO - Fama-French factors loaded
2025-04-17 22:23:25,190 - INFO - Processing factor data...
2025-04-17 22:23:25,193 - INFO - Factor data processed
2025-04-17 22:23:25,193 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:25,193 - INFO - 
Training Period:
2025-04-17 22:23:25,198 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:25,205 - INFO - 
Testing Period:
2025-04-17 22:23:25,210 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:25,217 - INFO - Loading macro and market data...
2025-04-17 22:23:25,218 - INFO - Loading existing macro data...
2025-04-17 22:23:25,229 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:25,229 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:25,232 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:25,232 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:25,233 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:25,234 - INFO - Loading existing macro data...
2025-04-17 22:23:25,244 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:25,244 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:25,247 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:25,247 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:25,248 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:25,249 - INFO - Loading existing market data...
2025-04-17 22:23:25,254 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:25,256 - INFO - Loading existing market data...
2025-04-17 22:23:25,259 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:25,259 - INFO - Macro and market data loaded
2025-04-17 22:23:25,259 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:25,259 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:25,260 - INFO - Loading existing macro data...
2025-04-17 22:23:25,273 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:25,273 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:25,277 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:25,278 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:25,278 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:25,279 - INFO - Loading existing market data...
2025-04-17 22:23:25,283 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:25,298 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:25,299 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:25,299 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:25,299 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:25,300 - INFO - Loading existing macro data...
2025-04-17 22:23:25,312 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:25,312 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:25,315 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:25,316 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:25,316 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:25,317 - INFO - Loading existing market data...
2025-04-17 22:23:25,321 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:25,332 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:25,332 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:25,333 - INFO - Test data prepared
2025-04-17 22:23:25,333 - INFO - Storing data...
2025-04-17 22:23:25,333 - INFO - Aligning data indices...
2025-04-17 22:23:25,334 - INFO - Data indices aligned
2025-04-17 22:23:25,335 - INFO - Data preparation completed
2025-04-17 22:23:25,335 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:25,335 - INFO - Training models...
2025-04-17 22:23:25,335 - INFO - Starting model training...
2025-04-17 22:23:25,335 - INFO - Training regime classifier...
2025-04-17 22:23:25,335 - INFO - Training HMM model...
2025-04-17 22:23:25,555 - INFO - HMM model training completed
2025-04-17 22:23:25,913 - INFO - Model training completed
2025-04-17 22:23:25,916 - INFO - Model training completed
2025-04-17 22:23:25,916 - INFO - Initializing portfolio weights...
2025-04-17 22:23:25,916 - INFO - Portfolio weights initialized
2025-04-17 22:23:25,917 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:25,918 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:25,919 - ERROR - Error running hmm with mean_variance and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:25,920 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 5 regimes
2025-04-17 22:23:25,920 - INFO - Initializing strategy...
2025-04-17 22:23:25,920 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 22:23:25,920 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:25,921 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:23:25,921 - INFO - Running strategy...
2025-04-17 22:23:25,921 - INFO - Starting strategy execution...
2025-04-17 22:23:25,921 - INFO - Preparing training and testing data...
2025-04-17 22:23:25,921 - INFO - Starting data preparation...
2025-04-17 22:23:25,921 - INFO - Loading Fama-French factors...
2025-04-17 22:23:25,931 - INFO - Fama-French factors loaded
2025-04-17 22:23:25,932 - INFO - Processing factor data...
2025-04-17 22:23:25,934 - INFO - Factor data processed
2025-04-17 22:23:25,934 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:25,934 - INFO - 
Training Period:
2025-04-17 22:23:25,939 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:25,946 - INFO - 
Testing Period:
2025-04-17 22:23:25,951 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:25,958 - INFO - Loading macro and market data...
2025-04-17 22:23:25,959 - INFO - Loading existing macro data...
2025-04-17 22:23:25,970 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:25,970 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:25,973 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:25,973 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:25,974 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:25,975 - INFO - Loading existing macro data...
2025-04-17 22:23:25,986 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:25,986 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:25,989 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:25,989 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:25,989 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:25,990 - INFO - Loading existing market data...
2025-04-17 22:23:25,994 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:25,995 - INFO - Loading existing market data...
2025-04-17 22:23:25,998 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:25,998 - INFO - Macro and market data loaded
2025-04-17 22:23:25,998 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:25,998 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:25,999 - INFO - Loading existing macro data...
2025-04-17 22:23:26,008 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:26,009 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:26,011 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:26,012 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:26,012 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:26,013 - INFO - Loading existing market data...
2025-04-17 22:23:26,016 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:26,031 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:26,031 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:26,032 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:26,032 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:26,033 - INFO - Loading existing macro data...
2025-04-17 22:23:26,046 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:26,047 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:26,050 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:26,051 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:26,051 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:26,053 - INFO - Loading existing market data...
2025-04-17 22:23:26,058 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:26,071 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:26,071 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:26,072 - INFO - Test data prepared
2025-04-17 22:23:26,072 - INFO - Storing data...
2025-04-17 22:23:26,072 - INFO - Aligning data indices...
2025-04-17 22:23:26,074 - INFO - Data indices aligned
2025-04-17 22:23:26,074 - INFO - Data preparation completed
2025-04-17 22:23:26,074 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:26,075 - INFO - Training models...
2025-04-17 22:23:26,075 - INFO - Starting model training...
2025-04-17 22:23:26,075 - INFO - Training regime classifier...
2025-04-17 22:23:26,075 - INFO - Training HMM model...
2025-04-17 22:23:26,267 - WARNING - Model is not converging.  Current: 6604.339029593529 is not greater than 21507.42426482565. Delta is -14903.085235232124
2025-04-17 22:23:26,267 - INFO - HMM model training completed
2025-04-17 22:23:26,456 - INFO - Model training completed
2025-04-17 22:23:26,458 - INFO - Model training completed
2025-04-17 22:23:26,458 - INFO - Initializing portfolio weights...
2025-04-17 22:23:26,458 - INFO - Portfolio weights initialized
2025-04-17 22:23:26,458 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:26,460 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:26,460 - ERROR - Error running hmm with mean_variance and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:26,462 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 7 regimes
2025-04-17 22:23:26,462 - INFO - Initializing strategy...
2025-04-17 22:23:26,462 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 22:23:26,462 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:26,462 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:23:26,462 - INFO - Running strategy...
2025-04-17 22:23:26,462 - INFO - Starting strategy execution...
2025-04-17 22:23:26,463 - INFO - Preparing training and testing data...
2025-04-17 22:23:26,463 - INFO - Starting data preparation...
2025-04-17 22:23:26,463 - INFO - Loading Fama-French factors...
2025-04-17 22:23:26,472 - INFO - Fama-French factors loaded
2025-04-17 22:23:26,472 - INFO - Processing factor data...
2025-04-17 22:23:26,475 - INFO - Factor data processed
2025-04-17 22:23:26,475 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:26,475 - INFO - 
Training Period:
2025-04-17 22:23:26,479 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:26,486 - INFO - 
Testing Period:
2025-04-17 22:23:26,490 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:26,497 - INFO - Loading macro and market data...
2025-04-17 22:23:26,498 - INFO - Loading existing macro data...
2025-04-17 22:23:26,508 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:26,508 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:26,511 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:26,511 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:26,512 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:26,513 - INFO - Loading existing macro data...
2025-04-17 22:23:26,523 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:26,523 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:26,526 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:26,526 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:26,526 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:26,527 - INFO - Loading existing market data...
2025-04-17 22:23:26,531 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:26,532 - INFO - Loading existing market data...
2025-04-17 22:23:26,536 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:26,536 - INFO - Macro and market data loaded
2025-04-17 22:23:26,536 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:26,537 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:26,537 - INFO - Loading existing macro data...
2025-04-17 22:23:26,547 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:26,547 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:26,550 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:26,551 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:26,551 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:26,552 - INFO - Loading existing market data...
2025-04-17 22:23:26,556 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:26,570 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:26,570 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:26,570 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:26,570 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:26,572 - INFO - Loading existing macro data...
2025-04-17 22:23:26,583 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:26,583 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:26,586 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:26,586 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:26,586 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:26,587 - INFO - Loading existing market data...
2025-04-17 22:23:26,591 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:26,602 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:26,602 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:26,602 - INFO - Test data prepared
2025-04-17 22:23:26,602 - INFO - Storing data...
2025-04-17 22:23:26,602 - INFO - Aligning data indices...
2025-04-17 22:23:26,604 - INFO - Data indices aligned
2025-04-17 22:23:26,604 - INFO - Data preparation completed
2025-04-17 22:23:26,604 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:26,604 - INFO - Training models...
2025-04-17 22:23:26,604 - INFO - Starting model training...
2025-04-17 22:23:26,605 - INFO - Training regime classifier...
2025-04-17 22:23:26,605 - INFO - Training HMM model...
2025-04-17 22:23:26,789 - WARNING - Model is not converging.  Current: 6604.332742752068 is not greater than 21103.699436312778. Delta is -14499.36669356071
2025-04-17 22:23:26,789 - INFO - HMM model training completed
2025-04-17 22:23:26,977 - INFO - Model training completed
2025-04-17 22:23:26,978 - INFO - Model training completed
2025-04-17 22:23:26,979 - INFO - Initializing portfolio weights...
2025-04-17 22:23:26,979 - INFO - Portfolio weights initialized
2025-04-17 22:23:26,979 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:26,981 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:26,981 - ERROR - Error running hmm with mean_variance and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:26,983 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 3 regimes
2025-04-17 22:23:26,983 - INFO - Initializing strategy...
2025-04-17 22:23:26,983 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 22:23:26,983 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:26,983 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:23:26,984 - INFO - Running strategy...
2025-04-17 22:23:26,984 - INFO - Starting strategy execution...
2025-04-17 22:23:26,984 - INFO - Preparing training and testing data...
2025-04-17 22:23:26,984 - INFO - Starting data preparation...
2025-04-17 22:23:26,984 - INFO - Loading Fama-French factors...
2025-04-17 22:23:26,994 - INFO - Fama-French factors loaded
2025-04-17 22:23:26,994 - INFO - Processing factor data...
2025-04-17 22:23:26,996 - INFO - Factor data processed
2025-04-17 22:23:26,996 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:26,997 - INFO - 
Training Period:
2025-04-17 22:23:27,001 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:27,008 - INFO - 
Testing Period:
2025-04-17 22:23:27,013 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:27,021 - INFO - Loading macro and market data...
2025-04-17 22:23:27,022 - INFO - Loading existing macro data...
2025-04-17 22:23:27,034 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:27,034 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:27,037 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:27,037 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:27,038 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:27,039 - INFO - Loading existing macro data...
2025-04-17 22:23:27,049 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:27,049 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:27,052 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:27,052 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:27,053 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:27,054 - INFO - Loading existing market data...
2025-04-17 22:23:27,058 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:27,059 - INFO - Loading existing market data...
2025-04-17 22:23:27,062 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:27,062 - INFO - Macro and market data loaded
2025-04-17 22:23:27,062 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:27,063 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:27,063 - INFO - Loading existing macro data...
2025-04-17 22:23:27,074 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:27,074 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:27,077 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:27,077 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:27,077 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:27,078 - INFO - Loading existing market data...
2025-04-17 22:23:27,082 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:27,096 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:27,096 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:27,096 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:27,096 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:27,098 - INFO - Loading existing macro data...
2025-04-17 22:23:27,108 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:27,109 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:27,112 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:27,112 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:27,113 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:27,114 - INFO - Loading existing market data...
2025-04-17 22:23:27,119 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:27,130 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:27,130 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:27,130 - INFO - Test data prepared
2025-04-17 22:23:27,131 - INFO - Storing data...
2025-04-17 22:23:27,131 - INFO - Aligning data indices...
2025-04-17 22:23:27,132 - INFO - Data indices aligned
2025-04-17 22:23:27,133 - INFO - Data preparation completed
2025-04-17 22:23:27,133 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:27,133 - INFO - Training models...
2025-04-17 22:23:27,133 - INFO - Starting model training...
2025-04-17 22:23:27,133 - INFO - Training regime classifier...
2025-04-17 22:23:27,133 - INFO - Training HMM model...
2025-04-17 22:23:27,319 - WARNING - Model is not converging.  Current: 6604.335530230886 is not greater than 21252.70127379546. Delta is -14648.365743564575
2025-04-17 22:23:27,319 - INFO - HMM model training completed
2025-04-17 22:23:27,507 - INFO - Model training completed
2025-04-17 22:23:27,509 - INFO - Model training completed
2025-04-17 22:23:27,509 - INFO - Initializing portfolio weights...
2025-04-17 22:23:27,509 - INFO - Portfolio weights initialized
2025-04-17 22:23:27,509 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:27,511 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:27,511 - ERROR - Error running hmm with regime_aware and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:27,513 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 5 regimes
2025-04-17 22:23:27,513 - INFO - Initializing strategy...
2025-04-17 22:23:27,513 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 22:23:27,514 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:27,514 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:23:27,514 - INFO - Running strategy...
2025-04-17 22:23:27,514 - INFO - Starting strategy execution...
2025-04-17 22:23:27,514 - INFO - Preparing training and testing data...
2025-04-17 22:23:27,514 - INFO - Starting data preparation...
2025-04-17 22:23:27,514 - INFO - Loading Fama-French factors...
2025-04-17 22:23:27,524 - INFO - Fama-French factors loaded
2025-04-17 22:23:27,524 - INFO - Processing factor data...
2025-04-17 22:23:27,527 - INFO - Factor data processed
2025-04-17 22:23:27,527 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:27,527 - INFO - 
Training Period:
2025-04-17 22:23:27,531 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:27,538 - INFO - 
Testing Period:
2025-04-17 22:23:27,543 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:27,550 - INFO - Loading macro and market data...
2025-04-17 22:23:27,551 - INFO - Loading existing macro data...
2025-04-17 22:23:27,562 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:27,562 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:27,565 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:27,565 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:27,566 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:27,567 - INFO - Loading existing macro data...
2025-04-17 22:23:27,577 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:27,577 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:27,580 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:27,580 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:27,580 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:27,582 - INFO - Loading existing market data...
2025-04-17 22:23:27,586 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:27,587 - INFO - Loading existing market data...
2025-04-17 22:23:27,590 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:27,590 - INFO - Macro and market data loaded
2025-04-17 22:23:27,591 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:27,591 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:27,592 - INFO - Loading existing macro data...
2025-04-17 22:23:27,602 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:27,603 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:27,606 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:27,606 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:27,606 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:27,607 - INFO - Loading existing market data...
2025-04-17 22:23:27,611 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:27,625 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:27,625 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:27,625 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:27,625 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:27,627 - INFO - Loading existing macro data...
2025-04-17 22:23:27,637 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:27,638 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:27,641 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:27,642 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:27,642 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:27,643 - INFO - Loading existing market data...
2025-04-17 22:23:27,647 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:27,656 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:27,657 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:27,657 - INFO - Test data prepared
2025-04-17 22:23:27,657 - INFO - Storing data...
2025-04-17 22:23:27,658 - INFO - Aligning data indices...
2025-04-17 22:23:27,659 - INFO - Data indices aligned
2025-04-17 22:23:27,660 - INFO - Data preparation completed
2025-04-17 22:23:27,660 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:27,660 - INFO - Training models...
2025-04-17 22:23:27,660 - INFO - Starting model training...
2025-04-17 22:23:27,660 - INFO - Training regime classifier...
2025-04-17 22:23:27,660 - INFO - Training HMM model...
2025-04-17 22:23:27,842 - WARNING - Model is not converging.  Current: 6604.3390296009575 is not greater than 21507.424265036807. Delta is -14903.08523543585
2025-04-17 22:23:27,842 - INFO - HMM model training completed
2025-04-17 22:23:28,035 - INFO - Model training completed
2025-04-17 22:23:28,036 - INFO - Model training completed
2025-04-17 22:23:28,036 - INFO - Initializing portfolio weights...
2025-04-17 22:23:28,037 - INFO - Portfolio weights initialized
2025-04-17 22:23:28,037 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:28,039 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:28,039 - ERROR - Error running hmm with regime_aware and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:28,041 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 7 regimes
2025-04-17 22:23:28,041 - INFO - Initializing strategy...
2025-04-17 22:23:28,041 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 22:23:28,041 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:28,041 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:23:28,042 - INFO - Running strategy...
2025-04-17 22:23:28,042 - INFO - Starting strategy execution...
2025-04-17 22:23:28,042 - INFO - Preparing training and testing data...
2025-04-17 22:23:28,042 - INFO - Starting data preparation...
2025-04-17 22:23:28,042 - INFO - Loading Fama-French factors...
2025-04-17 22:23:28,052 - INFO - Fama-French factors loaded
2025-04-17 22:23:28,052 - INFO - Processing factor data...
2025-04-17 22:23:28,055 - INFO - Factor data processed
2025-04-17 22:23:28,055 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:28,055 - INFO - 
Training Period:
2025-04-17 22:23:28,060 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:28,068 - INFO - 
Testing Period:
2025-04-17 22:23:28,072 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:28,080 - INFO - Loading macro and market data...
2025-04-17 22:23:28,081 - INFO - Loading existing macro data...
2025-04-17 22:23:28,093 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:28,093 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:28,096 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:28,097 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:28,097 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:28,098 - INFO - Loading existing macro data...
2025-04-17 22:23:28,110 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:28,110 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:28,113 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:28,113 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:28,113 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:28,114 - INFO - Loading existing market data...
2025-04-17 22:23:28,119 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:28,120 - INFO - Loading existing market data...
2025-04-17 22:23:28,123 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:28,123 - INFO - Macro and market data loaded
2025-04-17 22:23:28,124 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:28,124 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:28,125 - INFO - Loading existing macro data...
2025-04-17 22:23:28,135 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:28,136 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:28,139 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:28,139 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:28,139 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:28,140 - INFO - Loading existing market data...
2025-04-17 22:23:28,144 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:28,157 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:28,158 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:28,158 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:28,158 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:28,159 - INFO - Loading existing macro data...
2025-04-17 22:23:28,170 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:28,171 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:28,174 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:28,174 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:28,175 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:28,176 - INFO - Loading existing market data...
2025-04-17 22:23:28,179 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:28,190 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:28,190 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:28,191 - INFO - Test data prepared
2025-04-17 22:23:28,191 - INFO - Storing data...
2025-04-17 22:23:28,191 - INFO - Aligning data indices...
2025-04-17 22:23:28,192 - INFO - Data indices aligned
2025-04-17 22:23:28,193 - INFO - Data preparation completed
2025-04-17 22:23:28,193 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:28,193 - INFO - Training models...
2025-04-17 22:23:28,193 - INFO - Starting model training...
2025-04-17 22:23:28,193 - INFO - Training regime classifier...
2025-04-17 22:23:28,194 - INFO - Training HMM model...
2025-04-17 22:23:28,370 - WARNING - Model is not converging.  Current: 6604.3355302216605 is not greater than 21252.701273798015. Delta is -14648.365743576354
2025-04-17 22:23:28,370 - INFO - HMM model training completed
2025-04-17 22:23:28,555 - INFO - Model training completed
2025-04-17 22:23:28,557 - INFO - Model training completed
2025-04-17 22:23:28,557 - INFO - Initializing portfolio weights...
2025-04-17 22:23:28,558 - INFO - Portfolio weights initialized
2025-04-17 22:23:28,558 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:28,559 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:28,560 - ERROR - Error running hmm with regime_aware and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:28,561 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 3 regimes
2025-04-17 22:23:28,561 - INFO - Initializing strategy...
2025-04-17 22:23:28,561 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 22:23:28,561 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:28,561 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:23:28,562 - INFO - Running strategy...
2025-04-17 22:23:28,562 - INFO - Starting strategy execution...
2025-04-17 22:23:28,562 - INFO - Preparing training and testing data...
2025-04-17 22:23:28,562 - INFO - Starting data preparation...
2025-04-17 22:23:28,562 - INFO - Loading Fama-French factors...
2025-04-17 22:23:28,573 - INFO - Fama-French factors loaded
2025-04-17 22:23:28,573 - INFO - Processing factor data...
2025-04-17 22:23:28,575 - INFO - Factor data processed
2025-04-17 22:23:28,575 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:28,575 - INFO - 
Training Period:
2025-04-17 22:23:28,579 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:28,586 - INFO - 
Testing Period:
2025-04-17 22:23:28,590 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:28,597 - INFO - Loading macro and market data...
2025-04-17 22:23:28,598 - INFO - Loading existing macro data...
2025-04-17 22:23:28,607 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:28,608 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:28,611 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:28,611 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:28,611 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:28,612 - INFO - Loading existing macro data...
2025-04-17 22:23:28,622 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:28,622 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:28,625 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:28,625 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:28,626 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:28,627 - INFO - Loading existing market data...
2025-04-17 22:23:28,630 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:28,631 - INFO - Loading existing market data...
2025-04-17 22:23:28,634 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:28,634 - INFO - Macro and market data loaded
2025-04-17 22:23:28,634 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:28,634 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:28,635 - INFO - Loading existing macro data...
2025-04-17 22:23:28,644 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:28,645 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:28,647 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:28,647 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:28,648 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:28,648 - INFO - Loading existing market data...
2025-04-17 22:23:28,652 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:28,664 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:28,665 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:28,665 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:28,665 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:28,666 - INFO - Loading existing macro data...
2025-04-17 22:23:28,677 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:28,677 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:28,681 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:28,682 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:28,682 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:28,683 - INFO - Loading existing market data...
2025-04-17 22:23:28,687 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:28,698 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:28,698 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:28,699 - INFO - Test data prepared
2025-04-17 22:23:28,699 - INFO - Storing data...
2025-04-17 22:23:28,699 - INFO - Aligning data indices...
2025-04-17 22:23:28,701 - INFO - Data indices aligned
2025-04-17 22:23:28,701 - INFO - Data preparation completed
2025-04-17 22:23:28,701 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:28,701 - INFO - Training models...
2025-04-17 22:23:28,701 - INFO - Starting model training...
2025-04-17 22:23:28,702 - INFO - Training regime classifier...
2025-04-17 22:23:28,702 - INFO - Training HMM model...
2025-04-17 22:23:28,915 - INFO - HMM model training completed
2025-04-17 22:23:29,111 - INFO - Model training completed
2025-04-17 22:23:29,112 - INFO - Model training completed
2025-04-17 22:23:29,113 - INFO - Initializing portfolio weights...
2025-04-17 22:23:29,113 - INFO - Portfolio weights initialized
2025-04-17 22:23:29,113 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:29,115 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:29,115 - ERROR - Error running hmm with neural_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:29,117 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 5 regimes
2025-04-17 22:23:29,117 - INFO - Initializing strategy...
2025-04-17 22:23:29,117 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 22:23:29,117 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:29,118 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:23:29,118 - INFO - Running strategy...
2025-04-17 22:23:29,118 - INFO - Starting strategy execution...
2025-04-17 22:23:29,118 - INFO - Preparing training and testing data...
2025-04-17 22:23:29,118 - INFO - Starting data preparation...
2025-04-17 22:23:29,118 - INFO - Loading Fama-French factors...
2025-04-17 22:23:29,128 - INFO - Fama-French factors loaded
2025-04-17 22:23:29,128 - INFO - Processing factor data...
2025-04-17 22:23:29,130 - INFO - Factor data processed
2025-04-17 22:23:29,131 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:29,131 - INFO - 
Training Period:
2025-04-17 22:23:29,135 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:29,142 - INFO - 
Testing Period:
2025-04-17 22:23:29,147 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:29,155 - INFO - Loading macro and market data...
2025-04-17 22:23:29,156 - INFO - Loading existing macro data...
2025-04-17 22:23:29,167 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:29,168 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:29,170 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:29,171 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:29,171 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:29,172 - INFO - Loading existing macro data...
2025-04-17 22:23:29,182 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:29,183 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:29,186 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:29,186 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:29,187 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:29,188 - INFO - Loading existing market data...
2025-04-17 22:23:29,192 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:29,193 - INFO - Loading existing market data...
2025-04-17 22:23:29,196 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:29,196 - INFO - Macro and market data loaded
2025-04-17 22:23:29,196 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:29,196 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:29,197 - INFO - Loading existing macro data...
2025-04-17 22:23:29,208 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:29,209 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:29,211 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:29,212 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:29,212 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:29,213 - INFO - Loading existing market data...
2025-04-17 22:23:29,216 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:29,230 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:29,230 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:29,230 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:29,230 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:29,232 - INFO - Loading existing macro data...
2025-04-17 22:23:29,245 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:29,245 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:29,249 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:29,249 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:29,250 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:29,251 - INFO - Loading existing market data...
2025-04-17 22:23:29,255 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:29,265 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:29,266 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:29,266 - INFO - Test data prepared
2025-04-17 22:23:29,266 - INFO - Storing data...
2025-04-17 22:23:29,267 - INFO - Aligning data indices...
2025-04-17 22:23:29,268 - INFO - Data indices aligned
2025-04-17 22:23:29,269 - INFO - Data preparation completed
2025-04-17 22:23:29,269 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:29,269 - INFO - Training models...
2025-04-17 22:23:29,269 - INFO - Starting model training...
2025-04-17 22:23:29,270 - INFO - Training regime classifier...
2025-04-17 22:23:29,270 - INFO - Training HMM model...
2025-04-17 22:23:29,448 - WARNING - Model is not converging.  Current: 6604.33902959622 is not greater than 21507.424262527482. Delta is -14903.085232931262
2025-04-17 22:23:29,448 - INFO - HMM model training completed
2025-04-17 22:23:29,630 - INFO - Model training completed
2025-04-17 22:23:29,631 - INFO - Model training completed
2025-04-17 22:23:29,631 - INFO - Initializing portfolio weights...
2025-04-17 22:23:29,632 - INFO - Portfolio weights initialized
2025-04-17 22:23:29,632 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:29,634 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:29,634 - ERROR - Error running hmm with neural_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:29,636 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 7 regimes
2025-04-17 22:23:29,636 - INFO - Initializing strategy...
2025-04-17 22:23:29,636 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 22:23:29,636 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:29,636 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:23:29,637 - INFO - Running strategy...
2025-04-17 22:23:29,637 - INFO - Starting strategy execution...
2025-04-17 22:23:29,637 - INFO - Preparing training and testing data...
2025-04-17 22:23:29,637 - INFO - Starting data preparation...
2025-04-17 22:23:29,637 - INFO - Loading Fama-French factors...
2025-04-17 22:23:29,647 - INFO - Fama-French factors loaded
2025-04-17 22:23:29,647 - INFO - Processing factor data...
2025-04-17 22:23:29,649 - INFO - Factor data processed
2025-04-17 22:23:29,649 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:29,649 - INFO - 
Training Period:
2025-04-17 22:23:29,654 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:29,661 - INFO - 
Testing Period:
2025-04-17 22:23:29,665 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:29,671 - INFO - Loading macro and market data...
2025-04-17 22:23:29,672 - INFO - Loading existing macro data...
2025-04-17 22:23:29,683 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:29,683 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:29,686 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:29,686 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:29,686 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:29,687 - INFO - Loading existing macro data...
2025-04-17 22:23:29,697 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:29,697 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:29,700 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:29,700 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:29,700 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:29,701 - INFO - Loading existing market data...
2025-04-17 22:23:29,705 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:29,705 - INFO - Loading existing market data...
2025-04-17 22:23:29,708 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:29,709 - INFO - Macro and market data loaded
2025-04-17 22:23:29,709 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:29,709 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:29,709 - INFO - Loading existing macro data...
2025-04-17 22:23:29,718 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:29,719 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:29,722 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:29,722 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:29,722 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:29,723 - INFO - Loading existing market data...
2025-04-17 22:23:29,726 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:29,740 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:29,740 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:29,740 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:29,741 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:29,742 - INFO - Loading existing macro data...
2025-04-17 22:23:29,752 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:29,752 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:29,756 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:29,756 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:29,756 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:29,758 - INFO - Loading existing market data...
2025-04-17 22:23:29,762 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:29,772 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:29,773 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:29,773 - INFO - Test data prepared
2025-04-17 22:23:29,773 - INFO - Storing data...
2025-04-17 22:23:29,774 - INFO - Aligning data indices...
2025-04-17 22:23:29,775 - INFO - Data indices aligned
2025-04-17 22:23:29,776 - INFO - Data preparation completed
2025-04-17 22:23:29,776 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:29,776 - INFO - Training models...
2025-04-17 22:23:29,776 - INFO - Starting model training...
2025-04-17 22:23:29,776 - INFO - Training regime classifier...
2025-04-17 22:23:29,776 - INFO - Training HMM model...
2025-04-17 22:23:29,995 - INFO - HMM model training completed
2025-04-17 22:23:30,181 - INFO - Model training completed
2025-04-17 22:23:30,183 - INFO - Model training completed
2025-04-17 22:23:30,183 - INFO - Initializing portfolio weights...
2025-04-17 22:23:30,184 - INFO - Portfolio weights initialized
2025-04-17 22:23:30,184 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:30,185 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:30,186 - ERROR - Error running hmm with neural_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:30,187 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 22:23:30,187 - INFO - Initializing strategy...
2025-04-17 22:23:30,188 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 22:23:30,188 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:30,188 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:23:30,188 - INFO - Running strategy...
2025-04-17 22:23:30,188 - INFO - Starting strategy execution...
2025-04-17 22:23:30,188 - INFO - Preparing training and testing data...
2025-04-17 22:23:30,189 - INFO - Starting data preparation...
2025-04-17 22:23:30,189 - INFO - Loading Fama-French factors...
2025-04-17 22:23:30,198 - INFO - Fama-French factors loaded
2025-04-17 22:23:30,198 - INFO - Processing factor data...
2025-04-17 22:23:30,201 - INFO - Factor data processed
2025-04-17 22:23:30,201 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:30,201 - INFO - 
Training Period:
2025-04-17 22:23:30,205 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:30,212 - INFO - 
Testing Period:
2025-04-17 22:23:30,216 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:30,222 - INFO - Loading macro and market data...
2025-04-17 22:23:30,223 - INFO - Loading existing macro data...
2025-04-17 22:23:30,233 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:30,234 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:30,236 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:30,237 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:30,237 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:30,238 - INFO - Loading existing macro data...
2025-04-17 22:23:30,248 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:30,248 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:30,251 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:30,251 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:30,251 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:30,252 - INFO - Loading existing market data...
2025-04-17 22:23:30,255 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:30,256 - INFO - Loading existing market data...
2025-04-17 22:23:30,259 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:30,259 - INFO - Macro and market data loaded
2025-04-17 22:23:30,259 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:30,259 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:30,260 - INFO - Loading existing macro data...
2025-04-17 22:23:30,270 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:30,270 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:30,273 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:30,273 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:30,273 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:30,274 - INFO - Loading existing market data...
2025-04-17 22:23:30,278 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:30,293 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:30,293 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:30,293 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:30,294 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:30,295 - INFO - Loading existing macro data...
2025-04-17 22:23:30,306 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:30,307 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:30,310 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:30,310 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:30,310 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:30,311 - INFO - Loading existing market data...
2025-04-17 22:23:30,315 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:30,324 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:30,324 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:30,324 - INFO - Test data prepared
2025-04-17 22:23:30,325 - INFO - Storing data...
2025-04-17 22:23:30,325 - INFO - Aligning data indices...
2025-04-17 22:23:30,326 - INFO - Data indices aligned
2025-04-17 22:23:30,326 - INFO - Data preparation completed
2025-04-17 22:23:30,326 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:30,327 - INFO - Training models...
2025-04-17 22:23:30,327 - INFO - Starting model training...
2025-04-17 22:23:30,327 - INFO - Training regime classifier...
2025-04-17 22:23:30,327 - INFO - Training HMM model...
2025-04-17 22:23:30,548 - INFO - HMM model training completed
2025-04-17 22:23:30,736 - INFO - Model training completed
2025-04-17 22:23:30,738 - INFO - Model training completed
2025-04-17 22:23:30,738 - INFO - Initializing portfolio weights...
2025-04-17 22:23:30,739 - INFO - Portfolio weights initialized
2025-04-17 22:23:30,739 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:30,740 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:30,741 - ERROR - Error running hmm with autoencoder_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:30,743 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 22:23:30,743 - INFO - Initializing strategy...
2025-04-17 22:23:30,743 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 22:23:30,743 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:30,743 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:23:30,743 - INFO - Running strategy...
2025-04-17 22:23:30,744 - INFO - Starting strategy execution...
2025-04-17 22:23:30,744 - INFO - Preparing training and testing data...
2025-04-17 22:23:30,744 - INFO - Starting data preparation...
2025-04-17 22:23:30,744 - INFO - Loading Fama-French factors...
2025-04-17 22:23:30,754 - INFO - Fama-French factors loaded
2025-04-17 22:23:30,755 - INFO - Processing factor data...
2025-04-17 22:23:30,757 - INFO - Factor data processed
2025-04-17 22:23:30,757 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:30,757 - INFO - 
Training Period:
2025-04-17 22:23:30,762 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:30,769 - INFO - 
Testing Period:
2025-04-17 22:23:30,773 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:30,780 - INFO - Loading macro and market data...
2025-04-17 22:23:30,781 - INFO - Loading existing macro data...
2025-04-17 22:23:30,793 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:30,794 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:30,797 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:30,797 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:30,797 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:30,798 - INFO - Loading existing macro data...
2025-04-17 22:23:30,809 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:30,809 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:30,812 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:30,812 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:30,812 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:30,814 - INFO - Loading existing market data...
2025-04-17 22:23:30,818 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:30,819 - INFO - Loading existing market data...
2025-04-17 22:23:30,822 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:30,822 - INFO - Macro and market data loaded
2025-04-17 22:23:30,823 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:30,823 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:30,824 - INFO - Loading existing macro data...
2025-04-17 22:23:30,836 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:30,836 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:30,839 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:30,840 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:30,840 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:30,841 - INFO - Loading existing market data...
2025-04-17 22:23:30,845 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:30,859 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:30,860 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:30,860 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:30,860 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:30,862 - INFO - Loading existing macro data...
2025-04-17 22:23:30,875 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:30,875 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:30,879 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:30,880 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:30,880 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:30,881 - INFO - Loading existing market data...
2025-04-17 22:23:30,886 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:30,896 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:30,897 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:30,897 - INFO - Test data prepared
2025-04-17 22:23:30,898 - INFO - Storing data...
2025-04-17 22:23:30,898 - INFO - Aligning data indices...
2025-04-17 22:23:30,899 - INFO - Data indices aligned
2025-04-17 22:23:30,899 - INFO - Data preparation completed
2025-04-17 22:23:30,900 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:30,900 - INFO - Training models...
2025-04-17 22:23:30,900 - INFO - Starting model training...
2025-04-17 22:23:30,900 - INFO - Training regime classifier...
2025-04-17 22:23:30,900 - INFO - Training HMM model...
2025-04-17 22:23:31,125 - INFO - HMM model training completed
2025-04-17 22:23:31,310 - INFO - Model training completed
2025-04-17 22:23:31,312 - INFO - Model training completed
2025-04-17 22:23:31,312 - INFO - Initializing portfolio weights...
2025-04-17 22:23:31,312 - INFO - Portfolio weights initialized
2025-04-17 22:23:31,313 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:31,314 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:31,314 - ERROR - Error running hmm with autoencoder_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:31,316 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 22:23:31,316 - INFO - Initializing strategy...
2025-04-17 22:23:31,316 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 22:23:31,317 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:31,317 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:23:31,317 - INFO - Running strategy...
2025-04-17 22:23:31,317 - INFO - Starting strategy execution...
2025-04-17 22:23:31,317 - INFO - Preparing training and testing data...
2025-04-17 22:23:31,317 - INFO - Starting data preparation...
2025-04-17 22:23:31,317 - INFO - Loading Fama-French factors...
2025-04-17 22:23:31,327 - INFO - Fama-French factors loaded
2025-04-17 22:23:31,327 - INFO - Processing factor data...
2025-04-17 22:23:31,329 - INFO - Factor data processed
2025-04-17 22:23:31,330 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:31,330 - INFO - 
Training Period:
2025-04-17 22:23:31,334 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:31,341 - INFO - 
Testing Period:
2025-04-17 22:23:31,345 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:31,353 - INFO - Loading macro and market data...
2025-04-17 22:23:31,354 - INFO - Loading existing macro data...
2025-04-17 22:23:31,364 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:31,364 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:31,367 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:31,367 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:31,368 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:31,369 - INFO - Loading existing macro data...
2025-04-17 22:23:31,378 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:31,379 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:31,381 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:31,382 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:31,382 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:31,383 - INFO - Loading existing market data...
2025-04-17 22:23:31,386 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:31,387 - INFO - Loading existing market data...
2025-04-17 22:23:31,390 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:31,390 - INFO - Macro and market data loaded
2025-04-17 22:23:31,390 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:31,390 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:31,391 - INFO - Loading existing macro data...
2025-04-17 22:23:31,401 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:31,402 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:31,404 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:31,404 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:31,405 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:31,406 - INFO - Loading existing market data...
2025-04-17 22:23:31,409 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:31,423 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:31,423 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:31,423 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:31,423 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:31,425 - INFO - Loading existing macro data...
2025-04-17 22:23:31,434 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:31,435 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:31,438 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:31,438 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:31,439 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:31,440 - INFO - Loading existing market data...
2025-04-17 22:23:31,443 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:31,453 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:31,453 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:31,454 - INFO - Test data prepared
2025-04-17 22:23:31,454 - INFO - Storing data...
2025-04-17 22:23:31,454 - INFO - Aligning data indices...
2025-04-17 22:23:31,456 - INFO - Data indices aligned
2025-04-17 22:23:31,457 - INFO - Data preparation completed
2025-04-17 22:23:31,457 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:31,457 - INFO - Training models...
2025-04-17 22:23:31,457 - INFO - Starting model training...
2025-04-17 22:23:31,457 - INFO - Training regime classifier...
2025-04-17 22:23:31,458 - INFO - Training HMM model...
2025-04-17 22:23:31,637 - WARNING - Model is not converging.  Current: 6604.3355302321625 is not greater than 21252.70127462488. Delta is -14648.365744392719
2025-04-17 22:23:31,638 - INFO - HMM model training completed
2025-04-17 22:23:31,822 - INFO - Model training completed
2025-04-17 22:23:31,824 - INFO - Model training completed
2025-04-17 22:23:31,824 - INFO - Initializing portfolio weights...
2025-04-17 22:23:31,825 - INFO - Portfolio weights initialized
2025-04-17 22:23:31,825 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:31,827 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:31,827 - ERROR - Error running hmm with autoencoder_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:31,829 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 3 regimes
2025-04-17 22:23:31,829 - INFO - Initializing strategy...
2025-04-17 22:23:31,829 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 22:23:31,829 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:31,829 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:23:31,830 - INFO - Running strategy...
2025-04-17 22:23:31,830 - INFO - Starting strategy execution...
2025-04-17 22:23:31,830 - INFO - Preparing training and testing data...
2025-04-17 22:23:31,830 - INFO - Starting data preparation...
2025-04-17 22:23:31,830 - INFO - Loading Fama-French factors...
2025-04-17 22:23:31,840 - INFO - Fama-French factors loaded
2025-04-17 22:23:31,840 - INFO - Processing factor data...
2025-04-17 22:23:31,842 - INFO - Factor data processed
2025-04-17 22:23:31,842 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:31,842 - INFO - 
Training Period:
2025-04-17 22:23:31,846 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:31,854 - INFO - 
Testing Period:
2025-04-17 22:23:31,858 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:31,865 - INFO - Loading macro and market data...
2025-04-17 22:23:31,866 - INFO - Loading existing macro data...
2025-04-17 22:23:31,876 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:31,877 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:31,880 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:31,880 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:31,880 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:31,881 - INFO - Loading existing macro data...
2025-04-17 22:23:31,891 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:31,891 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:31,894 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:31,894 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:31,895 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:31,896 - INFO - Loading existing market data...
2025-04-17 22:23:31,899 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:31,900 - INFO - Loading existing market data...
2025-04-17 22:23:31,903 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:31,904 - INFO - Macro and market data loaded
2025-04-17 22:23:31,904 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:31,904 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:31,905 - INFO - Loading existing macro data...
2025-04-17 22:23:31,915 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:31,915 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:31,918 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:31,918 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:31,918 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:31,920 - INFO - Loading existing market data...
2025-04-17 22:23:31,923 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:31,937 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:31,937 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:31,937 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:31,938 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:31,939 - INFO - Loading existing macro data...
2025-04-17 22:23:31,951 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:31,951 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:31,954 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:31,954 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:31,954 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:31,956 - INFO - Loading existing market data...
2025-04-17 22:23:31,960 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:31,970 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:31,970 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:31,970 - INFO - Test data prepared
2025-04-17 22:23:31,971 - INFO - Storing data...
2025-04-17 22:23:31,971 - INFO - Aligning data indices...
2025-04-17 22:23:31,972 - INFO - Data indices aligned
2025-04-17 22:23:31,973 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:23:31,973 - INFO - Data preparation completed
2025-04-17 22:23:31,973 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:31,973 - INFO - Training models...
2025-04-17 22:23:31,973 - INFO - Starting model training...
2025-04-17 22:23:31,974 - INFO - Training regime classifier...
2025-04-17 22:23:31,974 - INFO - Training HMM model...
2025-04-17 22:23:32,185 - INFO - HMM model training completed
2025-04-17 22:23:32,371 - INFO - Training neural portfolio optimizer...
2025-04-17 22:23:32,371 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:23:32,371 - INFO - Model training completed
2025-04-17 22:23:32,373 - INFO - Model training completed
2025-04-17 22:23:32,373 - INFO - Initializing portfolio weights...
2025-04-17 22:23:32,374 - INFO - Portfolio weights initialized
2025-04-17 22:23:32,374 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:32,375 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:32,376 - ERROR - Error running hmm with neural and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:32,378 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 5 regimes
2025-04-17 22:23:32,378 - INFO - Initializing strategy...
2025-04-17 22:23:32,378 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 22:23:32,378 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:32,378 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:23:32,379 - INFO - Running strategy...
2025-04-17 22:23:32,379 - INFO - Starting strategy execution...
2025-04-17 22:23:32,379 - INFO - Preparing training and testing data...
2025-04-17 22:23:32,379 - INFO - Starting data preparation...
2025-04-17 22:23:32,379 - INFO - Loading Fama-French factors...
2025-04-17 22:23:32,390 - INFO - Fama-French factors loaded
2025-04-17 22:23:32,390 - INFO - Processing factor data...
2025-04-17 22:23:32,392 - INFO - Factor data processed
2025-04-17 22:23:32,392 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:32,393 - INFO - 
Training Period:
2025-04-17 22:23:32,397 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:32,405 - INFO - 
Testing Period:
2025-04-17 22:23:32,409 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:32,417 - INFO - Loading macro and market data...
2025-04-17 22:23:32,418 - INFO - Loading existing macro data...
2025-04-17 22:23:32,428 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:32,428 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:32,431 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:32,431 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:32,431 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:32,432 - INFO - Loading existing macro data...
2025-04-17 22:23:32,442 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:32,442 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:32,445 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:32,445 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:32,446 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:32,446 - INFO - Loading existing market data...
2025-04-17 22:23:32,450 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:32,451 - INFO - Loading existing market data...
2025-04-17 22:23:32,453 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:32,454 - INFO - Macro and market data loaded
2025-04-17 22:23:32,454 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:32,454 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:32,455 - INFO - Loading existing macro data...
2025-04-17 22:23:32,464 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:32,465 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:32,467 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:32,467 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:32,467 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:32,468 - INFO - Loading existing market data...
2025-04-17 22:23:32,471 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:32,484 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:32,485 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:32,485 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:32,485 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:32,487 - INFO - Loading existing macro data...
2025-04-17 22:23:32,497 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:32,497 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:32,501 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:32,501 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:32,501 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:32,502 - INFO - Loading existing market data...
2025-04-17 22:23:32,506 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:32,516 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:32,516 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:32,517 - INFO - Test data prepared
2025-04-17 22:23:32,517 - INFO - Storing data...
2025-04-17 22:23:32,517 - INFO - Aligning data indices...
2025-04-17 22:23:32,519 - INFO - Data indices aligned
2025-04-17 22:23:32,520 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:23:32,520 - INFO - Data preparation completed
2025-04-17 22:23:32,520 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:32,520 - INFO - Training models...
2025-04-17 22:23:32,520 - INFO - Starting model training...
2025-04-17 22:23:32,520 - INFO - Training regime classifier...
2025-04-17 22:23:32,520 - INFO - Training HMM model...
2025-04-17 22:23:32,701 - WARNING - Model is not converging.  Current: 6604.332742761141 is not greater than 21103.699436208757. Delta is -14499.366693447617
2025-04-17 22:23:32,701 - INFO - HMM model training completed
2025-04-17 22:23:32,891 - INFO - Training neural portfolio optimizer...
2025-04-17 22:23:32,891 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:23:32,891 - INFO - Model training completed
2025-04-17 22:23:32,892 - INFO - Model training completed
2025-04-17 22:23:32,893 - INFO - Initializing portfolio weights...
2025-04-17 22:23:32,893 - INFO - Portfolio weights initialized
2025-04-17 22:23:32,893 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:32,895 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:32,895 - ERROR - Error running hmm with neural and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:32,897 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 7 regimes
2025-04-17 22:23:32,897 - INFO - Initializing strategy...
2025-04-17 22:23:32,897 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 22:23:32,897 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:23:32,897 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:23:32,898 - INFO - Running strategy...
2025-04-17 22:23:32,898 - INFO - Starting strategy execution...
2025-04-17 22:23:32,898 - INFO - Preparing training and testing data...
2025-04-17 22:23:32,898 - INFO - Starting data preparation...
2025-04-17 22:23:32,898 - INFO - Loading Fama-French factors...
2025-04-17 22:23:32,908 - INFO - Fama-French factors loaded
2025-04-17 22:23:32,908 - INFO - Processing factor data...
2025-04-17 22:23:32,911 - INFO - Factor data processed
2025-04-17 22:23:32,911 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:23:32,911 - INFO - 
Training Period:
2025-04-17 22:23:32,915 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:23:32,922 - INFO - 
Testing Period:
2025-04-17 22:23:32,927 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:23:32,934 - INFO - Loading macro and market data...
2025-04-17 22:23:32,935 - INFO - Loading existing macro data...
2025-04-17 22:23:32,945 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:32,945 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:32,948 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:32,948 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:32,948 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:32,950 - INFO - Loading existing macro data...
2025-04-17 22:23:32,959 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:32,959 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:32,962 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:32,962 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:32,962 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:32,964 - INFO - Loading existing market data...
2025-04-17 22:23:32,967 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:32,968 - INFO - Loading existing market data...
2025-04-17 22:23:32,971 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:32,971 - INFO - Macro and market data loaded
2025-04-17 22:23:32,972 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:32,972 - INFO - Preparing training data for regime classification...
2025-04-17 22:23:32,973 - INFO - Loading existing macro data...
2025-04-17 22:23:32,981 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:32,982 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:32,985 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:32,985 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:23:32,985 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:23:32,986 - INFO - Loading existing market data...
2025-04-17 22:23:32,989 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:23:33,002 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:23:33,003 - INFO - Prepared training data with 1536 samples
2025-04-17 22:23:33,003 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:33,003 - INFO - Preparing test data for regime classification...
2025-04-17 22:23:33,004 - INFO - Loading existing macro data...
2025-04-17 22:23:33,016 - WARNING - US corporate credit spread file not found
2025-04-17 22:23:33,016 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:23:33,020 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:23:33,020 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:23:33,020 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:23:33,021 - INFO - Loading existing market data...
2025-04-17 22:23:33,024 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:23:33,035 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:23:33,035 - INFO - Prepared test data with 1276 samples
2025-04-17 22:23:33,036 - INFO - Test data prepared
2025-04-17 22:23:33,036 - INFO - Storing data...
2025-04-17 22:23:33,036 - INFO - Aligning data indices...
2025-04-17 22:23:33,037 - INFO - Data indices aligned
2025-04-17 22:23:33,038 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:23:33,039 - INFO - Data preparation completed
2025-04-17 22:23:33,039 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:23:33,039 - INFO - Training models...
2025-04-17 22:23:33,039 - INFO - Starting model training...
2025-04-17 22:23:33,039 - INFO - Training regime classifier...
2025-04-17 22:23:33,039 - INFO - Training HMM model...
2025-04-17 22:23:33,261 - INFO - HMM model training completed
2025-04-17 22:23:33,455 - INFO - Training neural portfolio optimizer...
2025-04-17 22:23:33,456 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:23:33,456 - INFO - Model training completed
2025-04-17 22:23:33,457 - INFO - Model training completed
2025-04-17 22:23:33,457 - INFO - Initializing portfolio weights...
2025-04-17 22:23:33,458 - INFO - Portfolio weights initialized
2025-04-17 22:23:33,458 - INFO - Generating regime predictions for test period...
2025-04-17 22:23:33,459 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:23:33,460 - ERROR - Error running hmm with neural and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:23:33,461 - ERROR - No valid results obtained from parameter grid search
2025-04-17 22:23:33,462 - ERROR - No valid results obtained from parameter grid search
2025-04-17 22:23:33,462 - INFO - Factor timing strategy optimization completed
2025-04-17 22:24:47,120 - INFO - Starting factor timing strategy optimization...
2025-04-17 22:24:47,121 - INFO - Running parameter grid search...
2025-04-17 22:24:47,121 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 3 regimes
2025-04-17 22:24:47,121 - INFO - Initializing strategy...
2025-04-17 22:24:47,121 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 22:24:47,121 - ERROR - Error running lstm with mean_variance and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:24:47,122 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 5 regimes
2025-04-17 22:24:47,123 - INFO - Initializing strategy...
2025-04-17 22:24:47,123 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 22:24:47,123 - ERROR - Error running lstm with mean_variance and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:24:47,124 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 7 regimes
2025-04-17 22:24:47,124 - INFO - Initializing strategy...
2025-04-17 22:24:47,124 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 22:24:47,124 - ERROR - Error running lstm with mean_variance and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:24:47,125 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 3 regimes
2025-04-17 22:24:47,125 - INFO - Initializing strategy...
2025-04-17 22:24:47,125 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 22:24:47,125 - ERROR - Error running lstm with regime_aware and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:24:47,126 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 5 regimes
2025-04-17 22:24:47,126 - INFO - Initializing strategy...
2025-04-17 22:24:47,126 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 22:24:47,126 - ERROR - Error running lstm with regime_aware and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:24:47,127 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 7 regimes
2025-04-17 22:24:47,127 - INFO - Initializing strategy...
2025-04-17 22:24:47,127 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 22:24:47,127 - ERROR - Error running lstm with regime_aware and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:24:47,128 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 3 regimes
2025-04-17 22:24:47,128 - INFO - Initializing strategy...
2025-04-17 22:24:47,128 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 22:24:47,128 - ERROR - Error running lstm with neural_regime and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:24:47,129 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 5 regimes
2025-04-17 22:24:47,129 - INFO - Initializing strategy...
2025-04-17 22:24:47,129 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 22:24:47,129 - ERROR - Error running lstm with neural_regime and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:24:47,130 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 7 regimes
2025-04-17 22:24:47,130 - INFO - Initializing strategy...
2025-04-17 22:24:47,130 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 22:24:47,130 - ERROR - Error running lstm with neural_regime and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:24:47,131 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 22:24:47,131 - INFO - Initializing strategy...
2025-04-17 22:24:47,131 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 22:24:47,131 - ERROR - Error running lstm with autoencoder_regime and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:24:47,132 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 22:24:47,132 - INFO - Initializing strategy...
2025-04-17 22:24:47,132 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 22:24:47,132 - ERROR - Error running lstm with autoencoder_regime and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:24:47,133 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 22:24:47,133 - INFO - Initializing strategy...
2025-04-17 22:24:47,133 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 22:24:47,133 - ERROR - Error running lstm with autoencoder_regime and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:24:47,134 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 3 regimes
2025-04-17 22:24:47,134 - INFO - Initializing strategy...
2025-04-17 22:24:47,134 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 22:24:47,134 - ERROR - Error running lstm with neural and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:24:47,135 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 5 regimes
2025-04-17 22:24:47,135 - INFO - Initializing strategy...
2025-04-17 22:24:47,135 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 22:24:47,135 - ERROR - Error running lstm with neural and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:24:47,136 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 7 regimes
2025-04-17 22:24:47,136 - INFO - Initializing strategy...
2025-04-17 22:24:47,136 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 22:24:47,136 - ERROR - Error running lstm with neural and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:24:47,137 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 3 regimes
2025-04-17 22:24:47,137 - INFO - Initializing strategy...
2025-04-17 22:24:47,137 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 22:24:47,137 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:24:47,156 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:24:47,157 - INFO - Running strategy...
2025-04-17 22:24:47,157 - INFO - Starting strategy execution...
2025-04-17 22:24:47,157 - INFO - Preparing training and testing data...
2025-04-17 22:24:47,157 - INFO - Starting data preparation...
2025-04-17 22:24:47,157 - INFO - Loading Fama-French factors...
2025-04-17 22:24:47,171 - INFO - Fama-French factors loaded
2025-04-17 22:24:47,171 - INFO - Processing factor data...
2025-04-17 22:24:47,174 - INFO - Factor data processed
2025-04-17 22:24:47,174 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:24:47,174 - INFO - 
Training Period:
2025-04-17 22:24:47,179 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:24:47,188 - INFO - 
Testing Period:
2025-04-17 22:24:47,192 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:24:47,198 - INFO - Loading macro and market data...
2025-04-17 22:24:47,199 - INFO - Loading existing macro data...
2025-04-17 22:24:47,210 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:47,211 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:47,215 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:47,215 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:47,215 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:47,216 - INFO - Loading existing macro data...
2025-04-17 22:24:47,225 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:47,226 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:47,229 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:47,229 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:47,229 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:47,230 - INFO - Loading existing market data...
2025-04-17 22:24:47,234 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:47,235 - INFO - Loading existing market data...
2025-04-17 22:24:47,237 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:47,238 - INFO - Macro and market data loaded
2025-04-17 22:24:47,238 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:47,238 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:47,239 - INFO - Loading existing macro data...
2025-04-17 22:24:47,247 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:47,248 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:47,251 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:47,251 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:47,251 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:47,252 - INFO - Loading existing market data...
2025-04-17 22:24:47,255 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:47,399 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:24:47,400 - INFO - Prepared training data with 1536 samples
2025-04-17 22:24:47,400 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:47,400 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:47,401 - INFO - Loading existing macro data...
2025-04-17 22:24:47,413 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:47,413 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:47,417 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:47,417 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:47,418 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:47,419 - INFO - Loading existing market data...
2025-04-17 22:24:47,422 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:47,430 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:24:47,430 - INFO - Prepared test data with 1276 samples
2025-04-17 22:24:47,431 - INFO - Test data prepared
2025-04-17 22:24:47,431 - INFO - Storing data...
2025-04-17 22:24:47,431 - INFO - Aligning data indices...
2025-04-17 22:24:47,432 - INFO - Data indices aligned
2025-04-17 22:24:47,432 - INFO - Data preparation completed
2025-04-17 22:24:47,432 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:24:47,432 - INFO - Training models...
2025-04-17 22:24:47,432 - INFO - Starting model training...
2025-04-17 22:24:47,433 - INFO - Training regime classifier...
2025-04-17 22:24:47,433 - INFO - Training XGBoost model...
2025-04-17 22:24:47,433 - INFO - Preparing features...
2025-04-17 22:24:47,433 - INFO - Input shape: (1536, 8)
2025-04-17 22:24:47,433 - INFO - Handling missing values...
2025-04-17 22:24:47,434 - INFO - Missing values: 0 -> 0
2025-04-17 22:24:47,434 - INFO - Scaling features...
2025-04-17 22:24:47,436 - INFO - Fitted new scaler
2025-04-17 22:24:47,437 - INFO - Output shape: (1536, 8)
2025-04-17 22:24:48,740 - INFO - XGBoost model training completed
2025-04-17 22:24:49,025 - INFO - Model training completed
2025-04-17 22:24:49,027 - INFO - Model training completed
2025-04-17 22:24:49,027 - INFO - Initializing portfolio weights...
2025-04-17 22:24:49,028 - INFO - Portfolio weights initialized
2025-04-17 22:24:49,028 - INFO - Generating regime predictions for test period...
2025-04-17 22:24:49,030 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:24:49,030 - ERROR - Error running xgboost with mean_variance and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:24:49,034 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 5 regimes
2025-04-17 22:24:49,034 - INFO - Initializing strategy...
2025-04-17 22:24:49,034 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 22:24:49,035 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:24:49,035 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:24:49,035 - INFO - Running strategy...
2025-04-17 22:24:49,035 - INFO - Starting strategy execution...
2025-04-17 22:24:49,036 - INFO - Preparing training and testing data...
2025-04-17 22:24:49,036 - INFO - Starting data preparation...
2025-04-17 22:24:49,036 - INFO - Loading Fama-French factors...
2025-04-17 22:24:49,045 - INFO - Fama-French factors loaded
2025-04-17 22:24:49,045 - INFO - Processing factor data...
2025-04-17 22:24:49,047 - INFO - Factor data processed
2025-04-17 22:24:49,047 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:24:49,048 - INFO - 
Training Period:
2025-04-17 22:24:49,052 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:24:49,059 - INFO - 
Testing Period:
2025-04-17 22:24:49,062 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:24:49,069 - INFO - Loading macro and market data...
2025-04-17 22:24:49,070 - INFO - Loading existing macro data...
2025-04-17 22:24:49,080 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:49,080 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:49,083 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:49,083 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:49,083 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:49,084 - INFO - Loading existing macro data...
2025-04-17 22:24:49,093 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:49,094 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:49,096 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:49,097 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:49,097 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:49,098 - INFO - Loading existing market data...
2025-04-17 22:24:49,101 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:49,102 - INFO - Loading existing market data...
2025-04-17 22:24:49,105 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:49,105 - INFO - Macro and market data loaded
2025-04-17 22:24:49,105 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:49,106 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:49,106 - INFO - Loading existing macro data...
2025-04-17 22:24:49,115 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:49,116 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:49,118 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:49,118 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:49,119 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:49,119 - INFO - Loading existing market data...
2025-04-17 22:24:49,123 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:49,136 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:24:49,136 - INFO - Prepared training data with 1536 samples
2025-04-17 22:24:49,137 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:49,137 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:49,138 - INFO - Loading existing macro data...
2025-04-17 22:24:49,148 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:49,148 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:49,151 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:49,151 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:49,152 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:49,153 - INFO - Loading existing market data...
2025-04-17 22:24:49,156 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:49,165 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:24:49,166 - INFO - Prepared test data with 1276 samples
2025-04-17 22:24:49,166 - INFO - Test data prepared
2025-04-17 22:24:49,166 - INFO - Storing data...
2025-04-17 22:24:49,166 - INFO - Aligning data indices...
2025-04-17 22:24:49,168 - INFO - Data indices aligned
2025-04-17 22:24:49,168 - INFO - Data preparation completed
2025-04-17 22:24:49,168 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:24:49,168 - INFO - Training models...
2025-04-17 22:24:49,168 - INFO - Starting model training...
2025-04-17 22:24:49,169 - INFO - Training regime classifier...
2025-04-17 22:24:49,169 - INFO - Training XGBoost model...
2025-04-17 22:24:49,169 - INFO - Preparing features...
2025-04-17 22:24:49,169 - INFO - Input shape: (1536, 8)
2025-04-17 22:24:49,169 - INFO - Handling missing values...
2025-04-17 22:24:49,171 - INFO - Missing values: 0 -> 0
2025-04-17 22:24:49,171 - INFO - Scaling features...
2025-04-17 22:24:49,172 - INFO - Fitted new scaler
2025-04-17 22:24:49,173 - INFO - Output shape: (1536, 8)
2025-04-17 22:24:49,429 - INFO - XGBoost model training completed
2025-04-17 22:24:49,759 - INFO - Model training completed
2025-04-17 22:24:49,761 - INFO - Model training completed
2025-04-17 22:24:49,761 - INFO - Initializing portfolio weights...
2025-04-17 22:24:49,762 - INFO - Portfolio weights initialized
2025-04-17 22:24:49,762 - INFO - Generating regime predictions for test period...
2025-04-17 22:24:49,764 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:24:49,764 - ERROR - Error running xgboost with mean_variance and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:24:49,765 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 7 regimes
2025-04-17 22:24:49,765 - INFO - Initializing strategy...
2025-04-17 22:24:49,766 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 22:24:49,766 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:24:49,766 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:24:49,766 - INFO - Running strategy...
2025-04-17 22:24:49,767 - INFO - Starting strategy execution...
2025-04-17 22:24:49,767 - INFO - Preparing training and testing data...
2025-04-17 22:24:49,767 - INFO - Starting data preparation...
2025-04-17 22:24:49,767 - INFO - Loading Fama-French factors...
2025-04-17 22:24:49,777 - INFO - Fama-French factors loaded
2025-04-17 22:24:49,777 - INFO - Processing factor data...
2025-04-17 22:24:49,779 - INFO - Factor data processed
2025-04-17 22:24:49,780 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:24:49,780 - INFO - 
Training Period:
2025-04-17 22:24:49,784 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:24:49,792 - INFO - 
Testing Period:
2025-04-17 22:24:49,797 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:24:49,804 - INFO - Loading macro and market data...
2025-04-17 22:24:49,805 - INFO - Loading existing macro data...
2025-04-17 22:24:49,815 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:49,816 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:49,818 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:49,819 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:49,819 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:49,820 - INFO - Loading existing macro data...
2025-04-17 22:24:49,829 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:49,830 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:49,833 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:49,833 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:49,833 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:49,835 - INFO - Loading existing market data...
2025-04-17 22:24:49,838 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:49,839 - INFO - Loading existing market data...
2025-04-17 22:24:49,842 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:49,842 - INFO - Macro and market data loaded
2025-04-17 22:24:49,842 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:49,842 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:49,843 - INFO - Loading existing macro data...
2025-04-17 22:24:49,852 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:49,853 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:49,855 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:49,856 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:49,856 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:49,857 - INFO - Loading existing market data...
2025-04-17 22:24:49,860 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:49,874 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:24:49,874 - INFO - Prepared training data with 1536 samples
2025-04-17 22:24:49,875 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:49,875 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:49,876 - INFO - Loading existing macro data...
2025-04-17 22:24:49,887 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:49,888 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:49,891 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:49,891 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:49,892 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:49,893 - INFO - Loading existing market data...
2025-04-17 22:24:49,897 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:49,906 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:24:49,907 - INFO - Prepared test data with 1276 samples
2025-04-17 22:24:49,907 - INFO - Test data prepared
2025-04-17 22:24:49,908 - INFO - Storing data...
2025-04-17 22:24:49,908 - INFO - Aligning data indices...
2025-04-17 22:24:49,909 - INFO - Data indices aligned
2025-04-17 22:24:49,909 - INFO - Data preparation completed
2025-04-17 22:24:49,910 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:24:49,910 - INFO - Training models...
2025-04-17 22:24:49,910 - INFO - Starting model training...
2025-04-17 22:24:49,910 - INFO - Training regime classifier...
2025-04-17 22:24:49,910 - INFO - Training XGBoost model...
2025-04-17 22:24:49,910 - INFO - Preparing features...
2025-04-17 22:24:49,911 - INFO - Input shape: (1536, 8)
2025-04-17 22:24:49,911 - INFO - Handling missing values...
2025-04-17 22:24:49,912 - INFO - Missing values: 0 -> 0
2025-04-17 22:24:49,912 - INFO - Scaling features...
2025-04-17 22:24:49,913 - INFO - Fitted new scaler
2025-04-17 22:24:49,914 - INFO - Output shape: (1536, 8)
2025-04-17 22:24:50,019 - INFO - XGBoost model training completed
2025-04-17 22:24:50,227 - INFO - Model training completed
2025-04-17 22:24:50,229 - INFO - Model training completed
2025-04-17 22:24:50,229 - INFO - Initializing portfolio weights...
2025-04-17 22:24:50,229 - INFO - Portfolio weights initialized
2025-04-17 22:24:50,229 - INFO - Generating regime predictions for test period...
2025-04-17 22:24:50,231 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:24:50,231 - ERROR - Error running xgboost with mean_variance and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:24:50,232 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 3 regimes
2025-04-17 22:24:50,232 - INFO - Initializing strategy...
2025-04-17 22:24:50,233 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 22:24:50,233 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:24:50,233 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:24:50,233 - INFO - Running strategy...
2025-04-17 22:24:50,234 - INFO - Starting strategy execution...
2025-04-17 22:24:50,234 - INFO - Preparing training and testing data...
2025-04-17 22:24:50,234 - INFO - Starting data preparation...
2025-04-17 22:24:50,234 - INFO - Loading Fama-French factors...
2025-04-17 22:24:50,243 - INFO - Fama-French factors loaded
2025-04-17 22:24:50,243 - INFO - Processing factor data...
2025-04-17 22:24:50,245 - INFO - Factor data processed
2025-04-17 22:24:50,245 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:24:50,245 - INFO - 
Training Period:
2025-04-17 22:24:50,250 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:24:50,258 - INFO - 
Testing Period:
2025-04-17 22:24:50,262 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:24:50,269 - INFO - Loading macro and market data...
2025-04-17 22:24:50,270 - INFO - Loading existing macro data...
2025-04-17 22:24:50,280 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:50,281 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:50,284 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:50,284 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:50,284 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:50,285 - INFO - Loading existing macro data...
2025-04-17 22:24:50,295 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:50,296 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:50,299 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:50,299 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:50,299 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:50,300 - INFO - Loading existing market data...
2025-04-17 22:24:50,303 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:50,304 - INFO - Loading existing market data...
2025-04-17 22:24:50,307 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:50,307 - INFO - Macro and market data loaded
2025-04-17 22:24:50,307 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:50,307 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:50,308 - INFO - Loading existing macro data...
2025-04-17 22:24:50,317 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:50,317 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:50,320 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:50,320 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:50,321 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:50,321 - INFO - Loading existing market data...
2025-04-17 22:24:50,325 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:50,339 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:24:50,340 - INFO - Prepared training data with 1536 samples
2025-04-17 22:24:50,340 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:50,340 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:50,341 - INFO - Loading existing macro data...
2025-04-17 22:24:50,353 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:50,354 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:50,357 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:50,357 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:50,357 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:50,358 - INFO - Loading existing market data...
2025-04-17 22:24:50,362 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:50,370 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:24:50,371 - INFO - Prepared test data with 1276 samples
2025-04-17 22:24:50,371 - INFO - Test data prepared
2025-04-17 22:24:50,371 - INFO - Storing data...
2025-04-17 22:24:50,371 - INFO - Aligning data indices...
2025-04-17 22:24:50,373 - INFO - Data indices aligned
2025-04-17 22:24:50,373 - INFO - Data preparation completed
2025-04-17 22:24:50,373 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:24:50,374 - INFO - Training models...
2025-04-17 22:24:50,374 - INFO - Starting model training...
2025-04-17 22:24:50,374 - INFO - Training regime classifier...
2025-04-17 22:24:50,374 - INFO - Training XGBoost model...
2025-04-17 22:24:50,374 - INFO - Preparing features...
2025-04-17 22:24:50,374 - INFO - Input shape: (1536, 8)
2025-04-17 22:24:50,375 - INFO - Handling missing values...
2025-04-17 22:24:50,376 - INFO - Missing values: 0 -> 0
2025-04-17 22:24:50,376 - INFO - Scaling features...
2025-04-17 22:24:50,377 - INFO - Fitted new scaler
2025-04-17 22:24:50,378 - INFO - Output shape: (1536, 8)
2025-04-17 22:24:50,481 - INFO - XGBoost model training completed
2025-04-17 22:24:50,689 - INFO - Model training completed
2025-04-17 22:24:50,691 - INFO - Model training completed
2025-04-17 22:24:50,691 - INFO - Initializing portfolio weights...
2025-04-17 22:24:50,691 - INFO - Portfolio weights initialized
2025-04-17 22:24:50,692 - INFO - Generating regime predictions for test period...
2025-04-17 22:24:50,693 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:24:50,694 - ERROR - Error running xgboost with regime_aware and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:24:50,695 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 5 regimes
2025-04-17 22:24:50,695 - INFO - Initializing strategy...
2025-04-17 22:24:50,695 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 22:24:50,696 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:24:50,696 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:24:50,696 - INFO - Running strategy...
2025-04-17 22:24:50,696 - INFO - Starting strategy execution...
2025-04-17 22:24:50,696 - INFO - Preparing training and testing data...
2025-04-17 22:24:50,697 - INFO - Starting data preparation...
2025-04-17 22:24:50,697 - INFO - Loading Fama-French factors...
2025-04-17 22:24:50,706 - INFO - Fama-French factors loaded
2025-04-17 22:24:50,706 - INFO - Processing factor data...
2025-04-17 22:24:50,708 - INFO - Factor data processed
2025-04-17 22:24:50,708 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:24:50,708 - INFO - 
Training Period:
2025-04-17 22:24:50,712 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:24:50,719 - INFO - 
Testing Period:
2025-04-17 22:24:50,725 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:24:50,732 - INFO - Loading macro and market data...
2025-04-17 22:24:50,733 - INFO - Loading existing macro data...
2025-04-17 22:24:50,743 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:50,743 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:50,746 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:50,746 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:50,746 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:50,747 - INFO - Loading existing macro data...
2025-04-17 22:24:50,756 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:50,757 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:50,759 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:50,759 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:50,760 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:50,760 - INFO - Loading existing market data...
2025-04-17 22:24:50,764 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:50,764 - INFO - Loading existing market data...
2025-04-17 22:24:50,767 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:50,767 - INFO - Macro and market data loaded
2025-04-17 22:24:50,767 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:50,767 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:50,768 - INFO - Loading existing macro data...
2025-04-17 22:24:50,777 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:50,778 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:50,780 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:50,781 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:50,781 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:50,782 - INFO - Loading existing market data...
2025-04-17 22:24:50,785 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:50,799 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:24:50,799 - INFO - Prepared training data with 1536 samples
2025-04-17 22:24:50,800 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:50,800 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:50,801 - INFO - Loading existing macro data...
2025-04-17 22:24:50,810 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:50,810 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:50,813 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:50,813 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:50,813 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:50,814 - INFO - Loading existing market data...
2025-04-17 22:24:50,817 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:50,826 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:24:50,826 - INFO - Prepared test data with 1276 samples
2025-04-17 22:24:50,827 - INFO - Test data prepared
2025-04-17 22:24:50,827 - INFO - Storing data...
2025-04-17 22:24:50,827 - INFO - Aligning data indices...
2025-04-17 22:24:50,828 - INFO - Data indices aligned
2025-04-17 22:24:50,828 - INFO - Data preparation completed
2025-04-17 22:24:50,828 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:24:50,828 - INFO - Training models...
2025-04-17 22:24:50,829 - INFO - Starting model training...
2025-04-17 22:24:50,829 - INFO - Training regime classifier...
2025-04-17 22:24:50,829 - INFO - Training XGBoost model...
2025-04-17 22:24:50,829 - INFO - Preparing features...
2025-04-17 22:24:50,829 - INFO - Input shape: (1536, 8)
2025-04-17 22:24:50,829 - INFO - Handling missing values...
2025-04-17 22:24:50,830 - INFO - Missing values: 0 -> 0
2025-04-17 22:24:50,830 - INFO - Scaling features...
2025-04-17 22:24:50,831 - INFO - Fitted new scaler
2025-04-17 22:24:50,832 - INFO - Output shape: (1536, 8)
2025-04-17 22:24:50,939 - INFO - XGBoost model training completed
2025-04-17 22:24:51,158 - INFO - Model training completed
2025-04-17 22:24:51,160 - INFO - Model training completed
2025-04-17 22:24:51,160 - INFO - Initializing portfolio weights...
2025-04-17 22:24:51,160 - INFO - Portfolio weights initialized
2025-04-17 22:24:51,161 - INFO - Generating regime predictions for test period...
2025-04-17 22:24:51,162 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:24:51,162 - ERROR - Error running xgboost with regime_aware and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:24:51,163 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 7 regimes
2025-04-17 22:24:51,164 - INFO - Initializing strategy...
2025-04-17 22:24:51,164 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 22:24:51,164 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:24:51,164 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:24:51,165 - INFO - Running strategy...
2025-04-17 22:24:51,165 - INFO - Starting strategy execution...
2025-04-17 22:24:51,165 - INFO - Preparing training and testing data...
2025-04-17 22:24:51,165 - INFO - Starting data preparation...
2025-04-17 22:24:51,165 - INFO - Loading Fama-French factors...
2025-04-17 22:24:51,175 - INFO - Fama-French factors loaded
2025-04-17 22:24:51,176 - INFO - Processing factor data...
2025-04-17 22:24:51,178 - INFO - Factor data processed
2025-04-17 22:24:51,178 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:24:51,178 - INFO - 
Training Period:
2025-04-17 22:24:51,183 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:24:51,191 - INFO - 
Testing Period:
2025-04-17 22:24:51,195 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:24:51,202 - INFO - Loading macro and market data...
2025-04-17 22:24:51,203 - INFO - Loading existing macro data...
2025-04-17 22:24:51,214 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:51,214 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:51,217 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:51,217 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:51,218 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:51,219 - INFO - Loading existing macro data...
2025-04-17 22:24:51,228 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:51,229 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:51,231 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:51,231 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:51,231 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:51,232 - INFO - Loading existing market data...
2025-04-17 22:24:51,236 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:51,237 - INFO - Loading existing market data...
2025-04-17 22:24:51,240 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:51,240 - INFO - Macro and market data loaded
2025-04-17 22:24:51,240 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:51,240 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:51,241 - INFO - Loading existing macro data...
2025-04-17 22:24:51,250 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:51,250 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:51,253 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:51,253 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:51,253 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:51,254 - INFO - Loading existing market data...
2025-04-17 22:24:51,258 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:51,272 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:24:51,272 - INFO - Prepared training data with 1536 samples
2025-04-17 22:24:51,272 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:51,273 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:51,274 - INFO - Loading existing macro data...
2025-04-17 22:24:51,284 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:51,284 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:51,286 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:51,287 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:51,287 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:51,288 - INFO - Loading existing market data...
2025-04-17 22:24:51,291 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:51,301 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:24:51,301 - INFO - Prepared test data with 1276 samples
2025-04-17 22:24:51,301 - INFO - Test data prepared
2025-04-17 22:24:51,301 - INFO - Storing data...
2025-04-17 22:24:51,302 - INFO - Aligning data indices...
2025-04-17 22:24:51,303 - INFO - Data indices aligned
2025-04-17 22:24:51,303 - INFO - Data preparation completed
2025-04-17 22:24:51,303 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:24:51,303 - INFO - Training models...
2025-04-17 22:24:51,304 - INFO - Starting model training...
2025-04-17 22:24:51,304 - INFO - Training regime classifier...
2025-04-17 22:24:51,304 - INFO - Training XGBoost model...
2025-04-17 22:24:51,304 - INFO - Preparing features...
2025-04-17 22:24:51,304 - INFO - Input shape: (1536, 8)
2025-04-17 22:24:51,304 - INFO - Handling missing values...
2025-04-17 22:24:51,305 - INFO - Missing values: 0 -> 0
2025-04-17 22:24:51,305 - INFO - Scaling features...
2025-04-17 22:24:51,306 - INFO - Fitted new scaler
2025-04-17 22:24:51,307 - INFO - Output shape: (1536, 8)
2025-04-17 22:24:51,413 - INFO - XGBoost model training completed
2025-04-17 22:24:51,627 - INFO - Model training completed
2025-04-17 22:24:51,629 - INFO - Model training completed
2025-04-17 22:24:51,630 - INFO - Initializing portfolio weights...
2025-04-17 22:24:51,630 - INFO - Portfolio weights initialized
2025-04-17 22:24:51,630 - INFO - Generating regime predictions for test period...
2025-04-17 22:24:51,632 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:24:51,633 - ERROR - Error running xgboost with regime_aware and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:24:51,634 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 3 regimes
2025-04-17 22:24:51,634 - INFO - Initializing strategy...
2025-04-17 22:24:51,634 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 22:24:51,635 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:24:51,635 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:24:51,635 - INFO - Running strategy...
2025-04-17 22:24:51,635 - INFO - Starting strategy execution...
2025-04-17 22:24:51,635 - INFO - Preparing training and testing data...
2025-04-17 22:24:51,636 - INFO - Starting data preparation...
2025-04-17 22:24:51,636 - INFO - Loading Fama-French factors...
2025-04-17 22:24:51,645 - INFO - Fama-French factors loaded
2025-04-17 22:24:51,645 - INFO - Processing factor data...
2025-04-17 22:24:51,647 - INFO - Factor data processed
2025-04-17 22:24:51,647 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:24:51,647 - INFO - 
Training Period:
2025-04-17 22:24:51,651 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:24:51,658 - INFO - 
Testing Period:
2025-04-17 22:24:51,662 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:24:51,669 - INFO - Loading macro and market data...
2025-04-17 22:24:51,670 - INFO - Loading existing macro data...
2025-04-17 22:24:51,681 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:51,681 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:51,684 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:51,684 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:51,684 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:51,685 - INFO - Loading existing macro data...
2025-04-17 22:24:51,695 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:51,695 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:51,697 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:51,698 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:51,698 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:51,699 - INFO - Loading existing market data...
2025-04-17 22:24:51,702 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:51,703 - INFO - Loading existing market data...
2025-04-17 22:24:51,706 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:51,706 - INFO - Macro and market data loaded
2025-04-17 22:24:51,706 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:51,706 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:51,707 - INFO - Loading existing macro data...
2025-04-17 22:24:51,716 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:51,717 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:51,719 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:51,719 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:51,720 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:51,721 - INFO - Loading existing market data...
2025-04-17 22:24:51,724 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:51,738 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:24:51,738 - INFO - Prepared training data with 1536 samples
2025-04-17 22:24:51,738 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:51,739 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:51,740 - INFO - Loading existing macro data...
2025-04-17 22:24:51,749 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:51,750 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:51,752 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:51,753 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:51,753 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:51,754 - INFO - Loading existing market data...
2025-04-17 22:24:51,758 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:51,769 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:24:51,769 - INFO - Prepared test data with 1276 samples
2025-04-17 22:24:51,769 - INFO - Test data prepared
2025-04-17 22:24:51,770 - INFO - Storing data...
2025-04-17 22:24:51,770 - INFO - Aligning data indices...
2025-04-17 22:24:51,771 - INFO - Data indices aligned
2025-04-17 22:24:51,772 - INFO - Data preparation completed
2025-04-17 22:24:51,772 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:24:51,772 - INFO - Training models...
2025-04-17 22:24:51,772 - INFO - Starting model training...
2025-04-17 22:24:51,772 - INFO - Training regime classifier...
2025-04-17 22:24:51,772 - INFO - Training XGBoost model...
2025-04-17 22:24:51,772 - INFO - Preparing features...
2025-04-17 22:24:51,772 - INFO - Input shape: (1536, 8)
2025-04-17 22:24:51,773 - INFO - Handling missing values...
2025-04-17 22:24:51,774 - INFO - Missing values: 0 -> 0
2025-04-17 22:24:51,774 - INFO - Scaling features...
2025-04-17 22:24:51,775 - INFO - Fitted new scaler
2025-04-17 22:24:51,776 - INFO - Output shape: (1536, 8)
2025-04-17 22:24:51,880 - INFO - XGBoost model training completed
2025-04-17 22:24:52,094 - INFO - Model training completed
2025-04-17 22:24:52,096 - INFO - Model training completed
2025-04-17 22:24:52,096 - INFO - Initializing portfolio weights...
2025-04-17 22:24:52,096 - INFO - Portfolio weights initialized
2025-04-17 22:24:52,097 - INFO - Generating regime predictions for test period...
2025-04-17 22:24:52,098 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:24:52,098 - ERROR - Error running xgboost with neural_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:24:52,100 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 5 regimes
2025-04-17 22:24:52,100 - INFO - Initializing strategy...
2025-04-17 22:24:52,100 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 22:24:52,100 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:24:52,100 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:24:52,101 - INFO - Running strategy...
2025-04-17 22:24:52,101 - INFO - Starting strategy execution...
2025-04-17 22:24:52,101 - INFO - Preparing training and testing data...
2025-04-17 22:24:52,101 - INFO - Starting data preparation...
2025-04-17 22:24:52,101 - INFO - Loading Fama-French factors...
2025-04-17 22:24:52,110 - INFO - Fama-French factors loaded
2025-04-17 22:24:52,110 - INFO - Processing factor data...
2025-04-17 22:24:52,112 - INFO - Factor data processed
2025-04-17 22:24:52,113 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:24:52,113 - INFO - 
Training Period:
2025-04-17 22:24:52,117 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:24:52,124 - INFO - 
Testing Period:
2025-04-17 22:24:52,128 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:24:52,136 - INFO - Loading macro and market data...
2025-04-17 22:24:52,137 - INFO - Loading existing macro data...
2025-04-17 22:24:52,146 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:52,147 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:52,149 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:52,150 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:52,150 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:52,151 - INFO - Loading existing macro data...
2025-04-17 22:24:52,160 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:52,160 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:52,163 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:52,163 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:52,163 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:52,164 - INFO - Loading existing market data...
2025-04-17 22:24:52,168 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:52,168 - INFO - Loading existing market data...
2025-04-17 22:24:52,171 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:52,172 - INFO - Macro and market data loaded
2025-04-17 22:24:52,172 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:52,172 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:52,173 - INFO - Loading existing macro data...
2025-04-17 22:24:52,181 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:52,182 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:52,184 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:52,184 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:52,185 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:52,186 - INFO - Loading existing market data...
2025-04-17 22:24:52,189 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:52,203 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:24:52,204 - INFO - Prepared training data with 1536 samples
2025-04-17 22:24:52,204 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:52,204 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:52,205 - INFO - Loading existing macro data...
2025-04-17 22:24:52,218 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:52,218 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:52,221 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:52,221 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:52,222 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:52,222 - INFO - Loading existing market data...
2025-04-17 22:24:52,225 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:52,234 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:24:52,235 - INFO - Prepared test data with 1276 samples
2025-04-17 22:24:52,235 - INFO - Test data prepared
2025-04-17 22:24:52,235 - INFO - Storing data...
2025-04-17 22:24:52,235 - INFO - Aligning data indices...
2025-04-17 22:24:52,236 - INFO - Data indices aligned
2025-04-17 22:24:52,237 - INFO - Data preparation completed
2025-04-17 22:24:52,237 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:24:52,237 - INFO - Training models...
2025-04-17 22:24:52,237 - INFO - Starting model training...
2025-04-17 22:24:52,237 - INFO - Training regime classifier...
2025-04-17 22:24:52,237 - INFO - Training XGBoost model...
2025-04-17 22:24:52,237 - INFO - Preparing features...
2025-04-17 22:24:52,237 - INFO - Input shape: (1536, 8)
2025-04-17 22:24:52,238 - INFO - Handling missing values...
2025-04-17 22:24:52,239 - INFO - Missing values: 0 -> 0
2025-04-17 22:24:52,239 - INFO - Scaling features...
2025-04-17 22:24:52,240 - INFO - Fitted new scaler
2025-04-17 22:24:52,241 - INFO - Output shape: (1536, 8)
2025-04-17 22:24:52,346 - INFO - XGBoost model training completed
2025-04-17 22:24:52,558 - INFO - Model training completed
2025-04-17 22:24:52,560 - INFO - Model training completed
2025-04-17 22:24:52,560 - INFO - Initializing portfolio weights...
2025-04-17 22:24:52,561 - INFO - Portfolio weights initialized
2025-04-17 22:24:52,561 - INFO - Generating regime predictions for test period...
2025-04-17 22:24:52,562 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:24:52,562 - ERROR - Error running xgboost with neural_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:24:52,564 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 7 regimes
2025-04-17 22:24:52,564 - INFO - Initializing strategy...
2025-04-17 22:24:52,564 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 22:24:52,564 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:24:52,564 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:24:52,565 - INFO - Running strategy...
2025-04-17 22:24:52,565 - INFO - Starting strategy execution...
2025-04-17 22:24:52,565 - INFO - Preparing training and testing data...
2025-04-17 22:24:52,565 - INFO - Starting data preparation...
2025-04-17 22:24:52,565 - INFO - Loading Fama-French factors...
2025-04-17 22:24:52,577 - INFO - Fama-French factors loaded
2025-04-17 22:24:52,577 - INFO - Processing factor data...
2025-04-17 22:24:52,580 - INFO - Factor data processed
2025-04-17 22:24:52,580 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:24:52,580 - INFO - 
Training Period:
2025-04-17 22:24:52,584 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:24:52,592 - INFO - 
Testing Period:
2025-04-17 22:24:52,596 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:24:52,603 - INFO - Loading macro and market data...
2025-04-17 22:24:52,604 - INFO - Loading existing macro data...
2025-04-17 22:24:52,614 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:52,615 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:52,618 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:52,618 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:52,618 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:52,619 - INFO - Loading existing macro data...
2025-04-17 22:24:52,628 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:52,628 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:52,632 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:52,632 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:52,632 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:52,633 - INFO - Loading existing market data...
2025-04-17 22:24:52,637 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:52,638 - INFO - Loading existing market data...
2025-04-17 22:24:52,641 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:52,641 - INFO - Macro and market data loaded
2025-04-17 22:24:52,641 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:52,641 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:52,642 - INFO - Loading existing macro data...
2025-04-17 22:24:52,651 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:52,651 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:52,654 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:52,654 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:52,654 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:52,655 - INFO - Loading existing market data...
2025-04-17 22:24:52,658 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:52,672 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:24:52,673 - INFO - Prepared training data with 1536 samples
2025-04-17 22:24:52,673 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:52,673 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:52,674 - INFO - Loading existing macro data...
2025-04-17 22:24:52,685 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:52,685 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:52,689 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:52,689 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:52,689 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:52,690 - INFO - Loading existing market data...
2025-04-17 22:24:52,694 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:52,703 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:24:52,704 - INFO - Prepared test data with 1276 samples
2025-04-17 22:24:52,704 - INFO - Test data prepared
2025-04-17 22:24:52,704 - INFO - Storing data...
2025-04-17 22:24:52,705 - INFO - Aligning data indices...
2025-04-17 22:24:52,706 - INFO - Data indices aligned
2025-04-17 22:24:52,706 - INFO - Data preparation completed
2025-04-17 22:24:52,707 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:24:52,707 - INFO - Training models...
2025-04-17 22:24:52,707 - INFO - Starting model training...
2025-04-17 22:24:52,707 - INFO - Training regime classifier...
2025-04-17 22:24:52,707 - INFO - Training XGBoost model...
2025-04-17 22:24:52,707 - INFO - Preparing features...
2025-04-17 22:24:52,708 - INFO - Input shape: (1536, 8)
2025-04-17 22:24:52,708 - INFO - Handling missing values...
2025-04-17 22:24:52,709 - INFO - Missing values: 0 -> 0
2025-04-17 22:24:52,709 - INFO - Scaling features...
2025-04-17 22:24:52,710 - INFO - Fitted new scaler
2025-04-17 22:24:52,711 - INFO - Output shape: (1536, 8)
2025-04-17 22:24:52,817 - INFO - XGBoost model training completed
2025-04-17 22:24:53,031 - INFO - Model training completed
2025-04-17 22:24:53,033 - INFO - Model training completed
2025-04-17 22:24:53,033 - INFO - Initializing portfolio weights...
2025-04-17 22:24:53,034 - INFO - Portfolio weights initialized
2025-04-17 22:24:53,034 - INFO - Generating regime predictions for test period...
2025-04-17 22:24:53,035 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:24:53,036 - ERROR - Error running xgboost with neural_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:24:53,037 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 22:24:53,037 - INFO - Initializing strategy...
2025-04-17 22:24:53,037 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 22:24:53,037 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:24:53,038 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:24:53,038 - INFO - Running strategy...
2025-04-17 22:24:53,038 - INFO - Starting strategy execution...
2025-04-17 22:24:53,038 - INFO - Preparing training and testing data...
2025-04-17 22:24:53,038 - INFO - Starting data preparation...
2025-04-17 22:24:53,038 - INFO - Loading Fama-French factors...
2025-04-17 22:24:53,047 - INFO - Fama-French factors loaded
2025-04-17 22:24:53,048 - INFO - Processing factor data...
2025-04-17 22:24:53,050 - INFO - Factor data processed
2025-04-17 22:24:53,050 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:24:53,050 - INFO - 
Training Period:
2025-04-17 22:24:53,054 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:24:53,061 - INFO - 
Testing Period:
2025-04-17 22:24:53,064 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:24:53,071 - INFO - Loading macro and market data...
2025-04-17 22:24:53,073 - INFO - Loading existing macro data...
2025-04-17 22:24:53,082 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:53,082 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:53,085 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:53,085 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:53,085 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:53,086 - INFO - Loading existing macro data...
2025-04-17 22:24:53,096 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:53,096 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:53,099 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:53,099 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:53,099 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:53,100 - INFO - Loading existing market data...
2025-04-17 22:24:53,103 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:53,104 - INFO - Loading existing market data...
2025-04-17 22:24:53,107 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:53,107 - INFO - Macro and market data loaded
2025-04-17 22:24:53,107 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:53,107 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:53,108 - INFO - Loading existing macro data...
2025-04-17 22:24:53,117 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:53,118 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:53,121 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:53,121 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:53,121 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:53,122 - INFO - Loading existing market data...
2025-04-17 22:24:53,126 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:53,141 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:24:53,141 - INFO - Prepared training data with 1536 samples
2025-04-17 22:24:53,141 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:53,141 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:53,142 - INFO - Loading existing macro data...
2025-04-17 22:24:53,154 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:53,154 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:53,157 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:53,157 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:53,158 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:53,158 - INFO - Loading existing market data...
2025-04-17 22:24:53,161 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:53,171 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:24:53,171 - INFO - Prepared test data with 1276 samples
2025-04-17 22:24:53,171 - INFO - Test data prepared
2025-04-17 22:24:53,172 - INFO - Storing data...
2025-04-17 22:24:53,172 - INFO - Aligning data indices...
2025-04-17 22:24:53,173 - INFO - Data indices aligned
2025-04-17 22:24:53,173 - INFO - Data preparation completed
2025-04-17 22:24:53,174 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:24:53,174 - INFO - Training models...
2025-04-17 22:24:53,174 - INFO - Starting model training...
2025-04-17 22:24:53,174 - INFO - Training regime classifier...
2025-04-17 22:24:53,175 - INFO - Training XGBoost model...
2025-04-17 22:24:53,175 - INFO - Preparing features...
2025-04-17 22:24:53,175 - INFO - Input shape: (1536, 8)
2025-04-17 22:24:53,175 - INFO - Handling missing values...
2025-04-17 22:24:53,176 - INFO - Missing values: 0 -> 0
2025-04-17 22:24:53,177 - INFO - Scaling features...
2025-04-17 22:24:53,178 - INFO - Fitted new scaler
2025-04-17 22:24:53,179 - INFO - Output shape: (1536, 8)
2025-04-17 22:24:53,282 - INFO - XGBoost model training completed
2025-04-17 22:24:53,497 - INFO - Model training completed
2025-04-17 22:24:53,499 - INFO - Model training completed
2025-04-17 22:24:53,499 - INFO - Initializing portfolio weights...
2025-04-17 22:24:53,499 - INFO - Portfolio weights initialized
2025-04-17 22:24:53,500 - INFO - Generating regime predictions for test period...
2025-04-17 22:24:53,501 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:24:53,501 - ERROR - Error running xgboost with autoencoder_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:24:53,503 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 22:24:53,503 - INFO - Initializing strategy...
2025-04-17 22:24:53,503 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 22:24:53,503 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:24:53,504 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:24:53,504 - INFO - Running strategy...
2025-04-17 22:24:53,504 - INFO - Starting strategy execution...
2025-04-17 22:24:53,505 - INFO - Preparing training and testing data...
2025-04-17 22:24:53,505 - INFO - Starting data preparation...
2025-04-17 22:24:53,505 - INFO - Loading Fama-French factors...
2025-04-17 22:24:53,514 - INFO - Fama-French factors loaded
2025-04-17 22:24:53,514 - INFO - Processing factor data...
2025-04-17 22:24:53,516 - INFO - Factor data processed
2025-04-17 22:24:53,516 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:24:53,516 - INFO - 
Training Period:
2025-04-17 22:24:53,520 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:24:53,529 - INFO - 
Testing Period:
2025-04-17 22:24:53,533 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:24:53,540 - INFO - Loading macro and market data...
2025-04-17 22:24:53,541 - INFO - Loading existing macro data...
2025-04-17 22:24:53,552 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:53,552 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:53,556 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:53,556 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:53,556 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:53,557 - INFO - Loading existing macro data...
2025-04-17 22:24:53,566 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:53,566 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:53,569 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:53,569 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:53,570 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:53,571 - INFO - Loading existing market data...
2025-04-17 22:24:53,575 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:53,576 - INFO - Loading existing market data...
2025-04-17 22:24:53,579 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:53,579 - INFO - Macro and market data loaded
2025-04-17 22:24:53,580 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:53,580 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:53,581 - INFO - Loading existing macro data...
2025-04-17 22:24:53,590 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:53,591 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:53,593 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:53,594 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:53,594 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:53,595 - INFO - Loading existing market data...
2025-04-17 22:24:53,599 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:53,615 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:24:53,615 - INFO - Prepared training data with 1536 samples
2025-04-17 22:24:53,615 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:53,615 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:53,617 - INFO - Loading existing macro data...
2025-04-17 22:24:53,627 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:53,628 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:53,631 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:53,632 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:53,632 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:53,633 - INFO - Loading existing market data...
2025-04-17 22:24:53,637 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:53,647 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:24:53,647 - INFO - Prepared test data with 1276 samples
2025-04-17 22:24:53,648 - INFO - Test data prepared
2025-04-17 22:24:53,648 - INFO - Storing data...
2025-04-17 22:24:53,648 - INFO - Aligning data indices...
2025-04-17 22:24:53,649 - INFO - Data indices aligned
2025-04-17 22:24:53,649 - INFO - Data preparation completed
2025-04-17 22:24:53,650 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:24:53,650 - INFO - Training models...
2025-04-17 22:24:53,650 - INFO - Starting model training...
2025-04-17 22:24:53,650 - INFO - Training regime classifier...
2025-04-17 22:24:53,650 - INFO - Training XGBoost model...
2025-04-17 22:24:53,650 - INFO - Preparing features...
2025-04-17 22:24:53,651 - INFO - Input shape: (1536, 8)
2025-04-17 22:24:53,651 - INFO - Handling missing values...
2025-04-17 22:24:53,652 - INFO - Missing values: 0 -> 0
2025-04-17 22:24:53,653 - INFO - Scaling features...
2025-04-17 22:24:53,654 - INFO - Fitted new scaler
2025-04-17 22:24:53,655 - INFO - Output shape: (1536, 8)
2025-04-17 22:24:53,760 - INFO - XGBoost model training completed
2025-04-17 22:24:53,970 - INFO - Model training completed
2025-04-17 22:24:53,972 - INFO - Model training completed
2025-04-17 22:24:53,972 - INFO - Initializing portfolio weights...
2025-04-17 22:24:53,973 - INFO - Portfolio weights initialized
2025-04-17 22:24:53,973 - INFO - Generating regime predictions for test period...
2025-04-17 22:24:53,974 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:24:53,974 - ERROR - Error running xgboost with autoencoder_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:24:53,976 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 22:24:53,976 - INFO - Initializing strategy...
2025-04-17 22:24:53,976 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 22:24:53,976 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:24:53,976 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:24:53,977 - INFO - Running strategy...
2025-04-17 22:24:53,977 - INFO - Starting strategy execution...
2025-04-17 22:24:53,977 - INFO - Preparing training and testing data...
2025-04-17 22:24:53,977 - INFO - Starting data preparation...
2025-04-17 22:24:53,977 - INFO - Loading Fama-French factors...
2025-04-17 22:24:53,987 - INFO - Fama-French factors loaded
2025-04-17 22:24:53,987 - INFO - Processing factor data...
2025-04-17 22:24:53,989 - INFO - Factor data processed
2025-04-17 22:24:53,989 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:24:53,990 - INFO - 
Training Period:
2025-04-17 22:24:53,994 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:24:54,001 - INFO - 
Testing Period:
2025-04-17 22:24:54,006 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:24:54,013 - INFO - Loading macro and market data...
2025-04-17 22:24:54,014 - INFO - Loading existing macro data...
2025-04-17 22:24:54,023 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:54,024 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:54,027 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:54,027 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:54,028 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:54,029 - INFO - Loading existing macro data...
2025-04-17 22:24:54,038 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:54,038 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:54,041 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:54,041 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:54,041 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:54,042 - INFO - Loading existing market data...
2025-04-17 22:24:54,046 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:54,047 - INFO - Loading existing market data...
2025-04-17 22:24:54,049 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:54,050 - INFO - Macro and market data loaded
2025-04-17 22:24:54,050 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:54,050 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:54,051 - INFO - Loading existing macro data...
2025-04-17 22:24:54,060 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:54,061 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:54,064 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:54,064 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:54,064 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:54,065 - INFO - Loading existing market data...
2025-04-17 22:24:54,068 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:54,082 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:24:54,082 - INFO - Prepared training data with 1536 samples
2025-04-17 22:24:54,083 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:54,083 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:54,084 - INFO - Loading existing macro data...
2025-04-17 22:24:54,096 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:54,096 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:54,099 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:54,099 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:54,099 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:54,100 - INFO - Loading existing market data...
2025-04-17 22:24:54,103 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:54,113 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:24:54,113 - INFO - Prepared test data with 1276 samples
2025-04-17 22:24:54,114 - INFO - Test data prepared
2025-04-17 22:24:54,114 - INFO - Storing data...
2025-04-17 22:24:54,114 - INFO - Aligning data indices...
2025-04-17 22:24:54,115 - INFO - Data indices aligned
2025-04-17 22:24:54,115 - INFO - Data preparation completed
2025-04-17 22:24:54,115 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:24:54,116 - INFO - Training models...
2025-04-17 22:24:54,116 - INFO - Starting model training...
2025-04-17 22:24:54,116 - INFO - Training regime classifier...
2025-04-17 22:24:54,116 - INFO - Training XGBoost model...
2025-04-17 22:24:54,116 - INFO - Preparing features...
2025-04-17 22:24:54,116 - INFO - Input shape: (1536, 8)
2025-04-17 22:24:54,116 - INFO - Handling missing values...
2025-04-17 22:24:54,117 - INFO - Missing values: 0 -> 0
2025-04-17 22:24:54,117 - INFO - Scaling features...
2025-04-17 22:24:54,118 - INFO - Fitted new scaler
2025-04-17 22:24:54,119 - INFO - Output shape: (1536, 8)
2025-04-17 22:24:54,226 - INFO - XGBoost model training completed
2025-04-17 22:24:54,440 - INFO - Model training completed
2025-04-17 22:24:54,442 - INFO - Model training completed
2025-04-17 22:24:54,442 - INFO - Initializing portfolio weights...
2025-04-17 22:24:54,442 - INFO - Portfolio weights initialized
2025-04-17 22:24:54,443 - INFO - Generating regime predictions for test period...
2025-04-17 22:24:54,444 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:24:54,444 - ERROR - Error running xgboost with autoencoder_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:24:54,446 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 3 regimes
2025-04-17 22:24:54,447 - INFO - Initializing strategy...
2025-04-17 22:24:54,447 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 22:24:54,447 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:24:54,447 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:24:55,336 - INFO - Running strategy...
2025-04-17 22:24:55,337 - INFO - Starting strategy execution...
2025-04-17 22:24:55,337 - INFO - Preparing training and testing data...
2025-04-17 22:24:55,337 - INFO - Starting data preparation...
2025-04-17 22:24:55,338 - INFO - Loading Fama-French factors...
2025-04-17 22:24:55,348 - INFO - Fama-French factors loaded
2025-04-17 22:24:55,349 - INFO - Processing factor data...
2025-04-17 22:24:55,351 - INFO - Factor data processed
2025-04-17 22:24:55,351 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:24:55,351 - INFO - 
Training Period:
2025-04-17 22:24:55,355 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:24:55,362 - INFO - 
Testing Period:
2025-04-17 22:24:55,366 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:24:55,373 - INFO - Loading macro and market data...
2025-04-17 22:24:55,374 - INFO - Loading existing macro data...
2025-04-17 22:24:55,384 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:55,384 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:55,387 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:55,388 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:55,388 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:55,389 - INFO - Loading existing macro data...
2025-04-17 22:24:55,400 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:55,401 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:55,404 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:55,404 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:55,404 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:55,405 - INFO - Loading existing market data...
2025-04-17 22:24:55,409 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:55,410 - INFO - Loading existing market data...
2025-04-17 22:24:55,413 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:55,414 - INFO - Macro and market data loaded
2025-04-17 22:24:55,414 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:55,414 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:55,415 - INFO - Loading existing macro data...
2025-04-17 22:24:55,427 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:55,427 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:55,430 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:55,431 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:55,431 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:55,432 - INFO - Loading existing market data...
2025-04-17 22:24:55,435 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:55,450 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:24:55,450 - INFO - Prepared training data with 1536 samples
2025-04-17 22:24:55,450 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:55,450 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:55,452 - INFO - Loading existing macro data...
2025-04-17 22:24:55,461 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:55,462 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:55,465 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:55,465 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:55,466 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:55,467 - INFO - Loading existing market data...
2025-04-17 22:24:55,470 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:55,480 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:24:55,480 - INFO - Prepared test data with 1276 samples
2025-04-17 22:24:55,481 - INFO - Test data prepared
2025-04-17 22:24:55,481 - INFO - Storing data...
2025-04-17 22:24:55,482 - INFO - Aligning data indices...
2025-04-17 22:24:55,483 - INFO - Data indices aligned
2025-04-17 22:24:55,484 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:24:55,484 - INFO - Data preparation completed
2025-04-17 22:24:55,484 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:24:55,484 - INFO - Training models...
2025-04-17 22:24:55,484 - INFO - Starting model training...
2025-04-17 22:24:55,485 - INFO - Training regime classifier...
2025-04-17 22:24:55,485 - INFO - Training XGBoost model...
2025-04-17 22:24:55,485 - INFO - Preparing features...
2025-04-17 22:24:55,485 - INFO - Input shape: (1536, 8)
2025-04-17 22:24:55,485 - INFO - Handling missing values...
2025-04-17 22:24:55,486 - INFO - Missing values: 0 -> 0
2025-04-17 22:24:55,486 - INFO - Scaling features...
2025-04-17 22:24:55,487 - INFO - Fitted new scaler
2025-04-17 22:24:55,488 - INFO - Output shape: (1536, 8)
2025-04-17 22:24:55,598 - INFO - XGBoost model training completed
2025-04-17 22:24:55,814 - INFO - Training neural portfolio optimizer...
2025-04-17 22:24:55,814 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:24:55,815 - INFO - Model training completed
2025-04-17 22:24:55,816 - INFO - Model training completed
2025-04-17 22:24:55,816 - INFO - Initializing portfolio weights...
2025-04-17 22:24:55,817 - INFO - Portfolio weights initialized
2025-04-17 22:24:55,817 - INFO - Generating regime predictions for test period...
2025-04-17 22:24:55,818 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:24:55,819 - ERROR - Error running xgboost with neural and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:24:55,820 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 5 regimes
2025-04-17 22:24:55,820 - INFO - Initializing strategy...
2025-04-17 22:24:55,820 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 22:24:55,821 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:24:55,821 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:24:55,822 - INFO - Running strategy...
2025-04-17 22:24:55,822 - INFO - Starting strategy execution...
2025-04-17 22:24:55,822 - INFO - Preparing training and testing data...
2025-04-17 22:24:55,822 - INFO - Starting data preparation...
2025-04-17 22:24:55,822 - INFO - Loading Fama-French factors...
2025-04-17 22:24:55,831 - INFO - Fama-French factors loaded
2025-04-17 22:24:55,831 - INFO - Processing factor data...
2025-04-17 22:24:55,833 - INFO - Factor data processed
2025-04-17 22:24:55,834 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:24:55,834 - INFO - 
Training Period:
2025-04-17 22:24:55,838 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:24:55,845 - INFO - 
Testing Period:
2025-04-17 22:24:55,849 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:24:55,856 - INFO - Loading macro and market data...
2025-04-17 22:24:55,857 - INFO - Loading existing macro data...
2025-04-17 22:24:55,867 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:55,868 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:55,871 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:55,871 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:55,871 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:55,872 - INFO - Loading existing macro data...
2025-04-17 22:24:55,882 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:55,882 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:55,885 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:55,885 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:55,886 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:55,887 - INFO - Loading existing market data...
2025-04-17 22:24:55,890 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:55,891 - INFO - Loading existing market data...
2025-04-17 22:24:55,894 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:55,894 - INFO - Macro and market data loaded
2025-04-17 22:24:55,895 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:55,895 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:55,896 - INFO - Loading existing macro data...
2025-04-17 22:24:55,905 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:55,906 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:55,909 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:55,909 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:55,909 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:55,910 - INFO - Loading existing market data...
2025-04-17 22:24:55,913 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:55,928 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:24:55,928 - INFO - Prepared training data with 1536 samples
2025-04-17 22:24:55,928 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:55,929 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:55,930 - INFO - Loading existing macro data...
2025-04-17 22:24:55,941 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:55,941 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:55,945 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:55,945 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:55,945 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:55,946 - INFO - Loading existing market data...
2025-04-17 22:24:55,950 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:55,960 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:24:55,960 - INFO - Prepared test data with 1276 samples
2025-04-17 22:24:55,961 - INFO - Test data prepared
2025-04-17 22:24:55,961 - INFO - Storing data...
2025-04-17 22:24:55,961 - INFO - Aligning data indices...
2025-04-17 22:24:55,962 - INFO - Data indices aligned
2025-04-17 22:24:55,963 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:24:55,963 - INFO - Data preparation completed
2025-04-17 22:24:55,963 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:24:55,964 - INFO - Training models...
2025-04-17 22:24:55,964 - INFO - Starting model training...
2025-04-17 22:24:55,964 - INFO - Training regime classifier...
2025-04-17 22:24:55,964 - INFO - Training XGBoost model...
2025-04-17 22:24:55,964 - INFO - Preparing features...
2025-04-17 22:24:55,965 - INFO - Input shape: (1536, 8)
2025-04-17 22:24:55,965 - INFO - Handling missing values...
2025-04-17 22:24:55,966 - INFO - Missing values: 0 -> 0
2025-04-17 22:24:55,966 - INFO - Scaling features...
2025-04-17 22:24:55,967 - INFO - Fitted new scaler
2025-04-17 22:24:55,968 - INFO - Output shape: (1536, 8)
2025-04-17 22:24:56,072 - INFO - XGBoost model training completed
2025-04-17 22:24:56,284 - INFO - Training neural portfolio optimizer...
2025-04-17 22:24:56,285 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:24:56,285 - INFO - Model training completed
2025-04-17 22:24:56,286 - INFO - Model training completed
2025-04-17 22:24:56,286 - INFO - Initializing portfolio weights...
2025-04-17 22:24:56,287 - INFO - Portfolio weights initialized
2025-04-17 22:24:56,287 - INFO - Generating regime predictions for test period...
2025-04-17 22:24:56,289 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:24:56,289 - ERROR - Error running xgboost with neural and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:24:56,291 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 7 regimes
2025-04-17 22:24:56,291 - INFO - Initializing strategy...
2025-04-17 22:24:56,291 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 22:24:56,291 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:24:56,291 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:24:56,292 - INFO - Running strategy...
2025-04-17 22:24:56,292 - INFO - Starting strategy execution...
2025-04-17 22:24:56,293 - INFO - Preparing training and testing data...
2025-04-17 22:24:56,293 - INFO - Starting data preparation...
2025-04-17 22:24:56,293 - INFO - Loading Fama-French factors...
2025-04-17 22:24:56,302 - INFO - Fama-French factors loaded
2025-04-17 22:24:56,302 - INFO - Processing factor data...
2025-04-17 22:24:56,304 - INFO - Factor data processed
2025-04-17 22:24:56,304 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:24:56,304 - INFO - 
Training Period:
2025-04-17 22:24:56,309 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:24:56,316 - INFO - 
Testing Period:
2025-04-17 22:24:56,320 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:24:56,328 - INFO - Loading macro and market data...
2025-04-17 22:24:56,329 - INFO - Loading existing macro data...
2025-04-17 22:24:56,339 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:56,340 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:56,342 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:56,343 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:56,343 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:56,344 - INFO - Loading existing macro data...
2025-04-17 22:24:56,353 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:56,353 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:56,356 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:56,356 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:56,356 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:56,357 - INFO - Loading existing market data...
2025-04-17 22:24:56,360 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:56,361 - INFO - Loading existing market data...
2025-04-17 22:24:56,364 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:56,364 - INFO - Macro and market data loaded
2025-04-17 22:24:56,364 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:56,364 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:56,365 - INFO - Loading existing macro data...
2025-04-17 22:24:56,375 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:56,375 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:56,378 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:56,378 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:56,378 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:56,379 - INFO - Loading existing market data...
2025-04-17 22:24:56,382 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:56,396 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:24:56,396 - INFO - Prepared training data with 1536 samples
2025-04-17 22:24:56,397 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:56,397 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:56,398 - INFO - Loading existing macro data...
2025-04-17 22:24:56,408 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:56,409 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:56,412 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:56,413 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:56,413 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:56,414 - INFO - Loading existing market data...
2025-04-17 22:24:56,417 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:56,426 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:24:56,426 - INFO - Prepared test data with 1276 samples
2025-04-17 22:24:56,427 - INFO - Test data prepared
2025-04-17 22:24:56,427 - INFO - Storing data...
2025-04-17 22:24:56,427 - INFO - Aligning data indices...
2025-04-17 22:24:56,428 - INFO - Data indices aligned
2025-04-17 22:24:56,429 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:24:56,429 - INFO - Data preparation completed
2025-04-17 22:24:56,429 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:24:56,429 - INFO - Training models...
2025-04-17 22:24:56,429 - INFO - Starting model training...
2025-04-17 22:24:56,430 - INFO - Training regime classifier...
2025-04-17 22:24:56,430 - INFO - Training XGBoost model...
2025-04-17 22:24:56,430 - INFO - Preparing features...
2025-04-17 22:24:56,430 - INFO - Input shape: (1536, 8)
2025-04-17 22:24:56,430 - INFO - Handling missing values...
2025-04-17 22:24:56,431 - INFO - Missing values: 0 -> 0
2025-04-17 22:24:56,432 - INFO - Scaling features...
2025-04-17 22:24:56,433 - INFO - Fitted new scaler
2025-04-17 22:24:56,434 - INFO - Output shape: (1536, 8)
2025-04-17 22:24:56,541 - INFO - XGBoost model training completed
2025-04-17 22:24:56,753 - INFO - Training neural portfolio optimizer...
2025-04-17 22:24:56,754 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:24:56,754 - INFO - Model training completed
2025-04-17 22:24:56,756 - INFO - Model training completed
2025-04-17 22:24:56,756 - INFO - Initializing portfolio weights...
2025-04-17 22:24:56,757 - INFO - Portfolio weights initialized
2025-04-17 22:24:56,757 - INFO - Generating regime predictions for test period...
2025-04-17 22:24:56,758 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:24:56,758 - ERROR - Error running xgboost with neural and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:24:56,760 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 3 regimes
2025-04-17 22:24:56,760 - INFO - Initializing strategy...
2025-04-17 22:24:56,760 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 22:24:56,760 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:24:56,760 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:24:56,761 - INFO - Running strategy...
2025-04-17 22:24:56,761 - INFO - Starting strategy execution...
2025-04-17 22:24:56,761 - INFO - Preparing training and testing data...
2025-04-17 22:24:56,761 - INFO - Starting data preparation...
2025-04-17 22:24:56,761 - INFO - Loading Fama-French factors...
2025-04-17 22:24:56,771 - INFO - Fama-French factors loaded
2025-04-17 22:24:56,771 - INFO - Processing factor data...
2025-04-17 22:24:56,773 - INFO - Factor data processed
2025-04-17 22:24:56,773 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:24:56,773 - INFO - 
Training Period:
2025-04-17 22:24:56,777 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:24:56,785 - INFO - 
Testing Period:
2025-04-17 22:24:56,789 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:24:56,797 - INFO - Loading macro and market data...
2025-04-17 22:24:56,798 - INFO - Loading existing macro data...
2025-04-17 22:24:56,808 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:56,808 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:56,812 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:56,813 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:56,813 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:56,814 - INFO - Loading existing macro data...
2025-04-17 22:24:56,823 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:56,824 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:56,826 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:56,826 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:56,827 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:56,827 - INFO - Loading existing market data...
2025-04-17 22:24:56,831 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:56,832 - INFO - Loading existing market data...
2025-04-17 22:24:56,835 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:56,835 - INFO - Macro and market data loaded
2025-04-17 22:24:56,836 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:56,836 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:56,836 - INFO - Loading existing macro data...
2025-04-17 22:24:56,846 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:56,846 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:56,849 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:56,849 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:56,849 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:56,850 - INFO - Loading existing market data...
2025-04-17 22:24:56,853 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:56,867 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:24:56,867 - INFO - Prepared training data with 1536 samples
2025-04-17 22:24:56,868 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:56,868 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:56,869 - INFO - Loading existing macro data...
2025-04-17 22:24:56,881 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:56,882 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:56,885 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:56,885 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:56,885 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:56,886 - INFO - Loading existing market data...
2025-04-17 22:24:56,890 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:56,900 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:24:56,900 - INFO - Prepared test data with 1276 samples
2025-04-17 22:24:56,900 - INFO - Test data prepared
2025-04-17 22:24:56,901 - INFO - Storing data...
2025-04-17 22:24:56,901 - INFO - Aligning data indices...
2025-04-17 22:24:56,902 - INFO - Data indices aligned
2025-04-17 22:24:56,902 - INFO - Data preparation completed
2025-04-17 22:24:56,903 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:24:56,903 - INFO - Training models...
2025-04-17 22:24:56,903 - INFO - Starting model training...
2025-04-17 22:24:56,903 - INFO - Training regime classifier...
2025-04-17 22:24:56,904 - INFO - Training HMM model...
2025-04-17 22:24:57,121 - INFO - HMM model training completed
2025-04-17 22:24:57,451 - INFO - Model training completed
2025-04-17 22:24:57,453 - INFO - Model training completed
2025-04-17 22:24:57,453 - INFO - Initializing portfolio weights...
2025-04-17 22:24:57,453 - INFO - Portfolio weights initialized
2025-04-17 22:24:57,454 - INFO - Generating regime predictions for test period...
2025-04-17 22:24:57,455 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:24:57,456 - ERROR - Error running hmm with mean_variance and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:24:57,457 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 5 regimes
2025-04-17 22:24:57,458 - INFO - Initializing strategy...
2025-04-17 22:24:57,458 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 22:24:57,458 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:24:57,458 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:24:57,458 - INFO - Running strategy...
2025-04-17 22:24:57,458 - INFO - Starting strategy execution...
2025-04-17 22:24:57,458 - INFO - Preparing training and testing data...
2025-04-17 22:24:57,459 - INFO - Starting data preparation...
2025-04-17 22:24:57,459 - INFO - Loading Fama-French factors...
2025-04-17 22:24:57,468 - INFO - Fama-French factors loaded
2025-04-17 22:24:57,468 - INFO - Processing factor data...
2025-04-17 22:24:57,470 - INFO - Factor data processed
2025-04-17 22:24:57,470 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:24:57,470 - INFO - 
Training Period:
2025-04-17 22:24:57,474 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:24:57,481 - INFO - 
Testing Period:
2025-04-17 22:24:57,485 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:24:57,492 - INFO - Loading macro and market data...
2025-04-17 22:24:57,493 - INFO - Loading existing macro data...
2025-04-17 22:24:57,502 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:57,503 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:57,506 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:57,506 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:57,506 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:57,507 - INFO - Loading existing macro data...
2025-04-17 22:24:57,516 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:57,517 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:57,520 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:57,520 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:57,520 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:57,521 - INFO - Loading existing market data...
2025-04-17 22:24:57,525 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:57,526 - INFO - Loading existing market data...
2025-04-17 22:24:57,528 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:57,529 - INFO - Macro and market data loaded
2025-04-17 22:24:57,529 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:57,529 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:57,530 - INFO - Loading existing macro data...
2025-04-17 22:24:57,538 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:57,539 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:57,542 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:57,542 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:57,543 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:57,543 - INFO - Loading existing market data...
2025-04-17 22:24:57,547 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:57,560 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:24:57,560 - INFO - Prepared training data with 1536 samples
2025-04-17 22:24:57,560 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:57,561 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:57,562 - INFO - Loading existing macro data...
2025-04-17 22:24:57,572 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:57,572 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:57,575 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:57,576 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:57,576 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:57,577 - INFO - Loading existing market data...
2025-04-17 22:24:57,580 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:57,590 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:24:57,591 - INFO - Prepared test data with 1276 samples
2025-04-17 22:24:57,591 - INFO - Test data prepared
2025-04-17 22:24:57,591 - INFO - Storing data...
2025-04-17 22:24:57,591 - INFO - Aligning data indices...
2025-04-17 22:24:57,593 - INFO - Data indices aligned
2025-04-17 22:24:57,593 - INFO - Data preparation completed
2025-04-17 22:24:57,593 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:24:57,593 - INFO - Training models...
2025-04-17 22:24:57,594 - INFO - Starting model training...
2025-04-17 22:24:57,594 - INFO - Training regime classifier...
2025-04-17 22:24:57,594 - INFO - Training HMM model...
2025-04-17 22:24:57,817 - INFO - HMM model training completed
2025-04-17 22:24:57,999 - INFO - Model training completed
2025-04-17 22:24:58,001 - INFO - Model training completed
2025-04-17 22:24:58,001 - INFO - Initializing portfolio weights...
2025-04-17 22:24:58,002 - INFO - Portfolio weights initialized
2025-04-17 22:24:58,002 - INFO - Generating regime predictions for test period...
2025-04-17 22:24:58,003 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:24:58,004 - ERROR - Error running hmm with mean_variance and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:24:58,006 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 7 regimes
2025-04-17 22:24:58,006 - INFO - Initializing strategy...
2025-04-17 22:24:58,006 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 22:24:58,006 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:24:58,006 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:24:58,006 - INFO - Running strategy...
2025-04-17 22:24:58,006 - INFO - Starting strategy execution...
2025-04-17 22:24:58,007 - INFO - Preparing training and testing data...
2025-04-17 22:24:58,007 - INFO - Starting data preparation...
2025-04-17 22:24:58,007 - INFO - Loading Fama-French factors...
2025-04-17 22:24:58,015 - INFO - Fama-French factors loaded
2025-04-17 22:24:58,016 - INFO - Processing factor data...
2025-04-17 22:24:58,018 - INFO - Factor data processed
2025-04-17 22:24:58,018 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:24:58,018 - INFO - 
Training Period:
2025-04-17 22:24:58,022 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:24:58,029 - INFO - 
Testing Period:
2025-04-17 22:24:58,034 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:24:58,041 - INFO - Loading macro and market data...
2025-04-17 22:24:58,042 - INFO - Loading existing macro data...
2025-04-17 22:24:58,052 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:58,052 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:58,055 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:58,055 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:58,056 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:58,057 - INFO - Loading existing macro data...
2025-04-17 22:24:58,066 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:58,066 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:58,069 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:58,069 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:58,069 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:58,070 - INFO - Loading existing market data...
2025-04-17 22:24:58,074 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:58,075 - INFO - Loading existing market data...
2025-04-17 22:24:58,077 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:58,077 - INFO - Macro and market data loaded
2025-04-17 22:24:58,077 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:58,078 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:58,078 - INFO - Loading existing macro data...
2025-04-17 22:24:58,087 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:58,087 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:58,090 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:58,090 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:58,091 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:58,091 - INFO - Loading existing market data...
2025-04-17 22:24:58,095 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:58,107 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:24:58,107 - INFO - Prepared training data with 1536 samples
2025-04-17 22:24:58,108 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:58,108 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:58,109 - INFO - Loading existing macro data...
2025-04-17 22:24:58,119 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:58,119 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:58,122 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:58,122 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:58,122 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:58,123 - INFO - Loading existing market data...
2025-04-17 22:24:58,127 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:58,136 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:24:58,136 - INFO - Prepared test data with 1276 samples
2025-04-17 22:24:58,136 - INFO - Test data prepared
2025-04-17 22:24:58,137 - INFO - Storing data...
2025-04-17 22:24:58,137 - INFO - Aligning data indices...
2025-04-17 22:24:58,138 - INFO - Data indices aligned
2025-04-17 22:24:58,139 - INFO - Data preparation completed
2025-04-17 22:24:58,139 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:24:58,139 - INFO - Training models...
2025-04-17 22:24:58,139 - INFO - Starting model training...
2025-04-17 22:24:58,139 - INFO - Training regime classifier...
2025-04-17 22:24:58,140 - INFO - Training HMM model...
2025-04-17 22:24:58,352 - INFO - HMM model training completed
2025-04-17 22:24:58,537 - INFO - Model training completed
2025-04-17 22:24:58,539 - INFO - Model training completed
2025-04-17 22:24:58,539 - INFO - Initializing portfolio weights...
2025-04-17 22:24:58,539 - INFO - Portfolio weights initialized
2025-04-17 22:24:58,539 - INFO - Generating regime predictions for test period...
2025-04-17 22:24:58,541 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:24:58,541 - ERROR - Error running hmm with mean_variance and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:24:58,543 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 3 regimes
2025-04-17 22:24:58,543 - INFO - Initializing strategy...
2025-04-17 22:24:58,543 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 22:24:58,543 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:24:58,544 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:24:58,544 - INFO - Running strategy...
2025-04-17 22:24:58,544 - INFO - Starting strategy execution...
2025-04-17 22:24:58,544 - INFO - Preparing training and testing data...
2025-04-17 22:24:58,544 - INFO - Starting data preparation...
2025-04-17 22:24:58,544 - INFO - Loading Fama-French factors...
2025-04-17 22:24:58,553 - INFO - Fama-French factors loaded
2025-04-17 22:24:58,554 - INFO - Processing factor data...
2025-04-17 22:24:58,556 - INFO - Factor data processed
2025-04-17 22:24:58,556 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:24:58,556 - INFO - 
Training Period:
2025-04-17 22:24:58,560 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:24:58,567 - INFO - 
Testing Period:
2025-04-17 22:24:58,571 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:24:58,578 - INFO - Loading macro and market data...
2025-04-17 22:24:58,579 - INFO - Loading existing macro data...
2025-04-17 22:24:58,589 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:58,589 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:58,592 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:58,592 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:58,592 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:58,593 - INFO - Loading existing macro data...
2025-04-17 22:24:58,602 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:58,603 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:58,605 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:58,606 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:58,606 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:58,607 - INFO - Loading existing market data...
2025-04-17 22:24:58,611 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:58,612 - INFO - Loading existing market data...
2025-04-17 22:24:58,614 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:58,614 - INFO - Macro and market data loaded
2025-04-17 22:24:58,614 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:58,615 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:58,615 - INFO - Loading existing macro data...
2025-04-17 22:24:58,624 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:58,624 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:58,627 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:58,627 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:58,627 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:58,628 - INFO - Loading existing market data...
2025-04-17 22:24:58,632 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:58,644 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:24:58,644 - INFO - Prepared training data with 1536 samples
2025-04-17 22:24:58,644 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:58,644 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:58,645 - INFO - Loading existing macro data...
2025-04-17 22:24:58,656 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:58,656 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:58,659 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:58,659 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:58,659 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:58,660 - INFO - Loading existing market data...
2025-04-17 22:24:58,663 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:58,672 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:24:58,673 - INFO - Prepared test data with 1276 samples
2025-04-17 22:24:58,673 - INFO - Test data prepared
2025-04-17 22:24:58,673 - INFO - Storing data...
2025-04-17 22:24:58,674 - INFO - Aligning data indices...
2025-04-17 22:24:58,675 - INFO - Data indices aligned
2025-04-17 22:24:58,675 - INFO - Data preparation completed
2025-04-17 22:24:58,675 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:24:58,676 - INFO - Training models...
2025-04-17 22:24:58,676 - INFO - Starting model training...
2025-04-17 22:24:58,676 - INFO - Training regime classifier...
2025-04-17 22:24:58,676 - INFO - Training HMM model...
2025-04-17 22:24:58,893 - INFO - HMM model training completed
2025-04-17 22:24:59,078 - INFO - Model training completed
2025-04-17 22:24:59,080 - INFO - Model training completed
2025-04-17 22:24:59,080 - INFO - Initializing portfolio weights...
2025-04-17 22:24:59,081 - INFO - Portfolio weights initialized
2025-04-17 22:24:59,081 - INFO - Generating regime predictions for test period...
2025-04-17 22:24:59,082 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:24:59,083 - ERROR - Error running hmm with regime_aware and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:24:59,084 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 5 regimes
2025-04-17 22:24:59,085 - INFO - Initializing strategy...
2025-04-17 22:24:59,085 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 22:24:59,085 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:24:59,085 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:24:59,085 - INFO - Running strategy...
2025-04-17 22:24:59,085 - INFO - Starting strategy execution...
2025-04-17 22:24:59,085 - INFO - Preparing training and testing data...
2025-04-17 22:24:59,085 - INFO - Starting data preparation...
2025-04-17 22:24:59,085 - INFO - Loading Fama-French factors...
2025-04-17 22:24:59,095 - INFO - Fama-French factors loaded
2025-04-17 22:24:59,095 - INFO - Processing factor data...
2025-04-17 22:24:59,097 - INFO - Factor data processed
2025-04-17 22:24:59,097 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:24:59,097 - INFO - 
Training Period:
2025-04-17 22:24:59,101 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:24:59,108 - INFO - 
Testing Period:
2025-04-17 22:24:59,113 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:24:59,119 - INFO - Loading macro and market data...
2025-04-17 22:24:59,120 - INFO - Loading existing macro data...
2025-04-17 22:24:59,130 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:59,131 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:59,134 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:59,134 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:59,134 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:59,135 - INFO - Loading existing macro data...
2025-04-17 22:24:59,144 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:59,144 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:59,147 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:59,147 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:59,147 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:59,148 - INFO - Loading existing market data...
2025-04-17 22:24:59,152 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:59,153 - INFO - Loading existing market data...
2025-04-17 22:24:59,155 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:59,156 - INFO - Macro and market data loaded
2025-04-17 22:24:59,156 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:59,156 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:59,157 - INFO - Loading existing macro data...
2025-04-17 22:24:59,165 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:59,166 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:59,168 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:59,169 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:59,169 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:59,170 - INFO - Loading existing market data...
2025-04-17 22:24:59,173 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:59,186 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:24:59,186 - INFO - Prepared training data with 1536 samples
2025-04-17 22:24:59,186 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:59,186 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:59,187 - INFO - Loading existing macro data...
2025-04-17 22:24:59,197 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:59,198 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:59,200 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:59,201 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:59,201 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:59,202 - INFO - Loading existing market data...
2025-04-17 22:24:59,205 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:59,215 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:24:59,215 - INFO - Prepared test data with 1276 samples
2025-04-17 22:24:59,216 - INFO - Test data prepared
2025-04-17 22:24:59,216 - INFO - Storing data...
2025-04-17 22:24:59,216 - INFO - Aligning data indices...
2025-04-17 22:24:59,217 - INFO - Data indices aligned
2025-04-17 22:24:59,217 - INFO - Data preparation completed
2025-04-17 22:24:59,217 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:24:59,218 - INFO - Training models...
2025-04-17 22:24:59,218 - INFO - Starting model training...
2025-04-17 22:24:59,218 - INFO - Training regime classifier...
2025-04-17 22:24:59,218 - INFO - Training HMM model...
2025-04-17 22:24:59,439 - INFO - HMM model training completed
2025-04-17 22:24:59,619 - INFO - Model training completed
2025-04-17 22:24:59,621 - INFO - Model training completed
2025-04-17 22:24:59,621 - INFO - Initializing portfolio weights...
2025-04-17 22:24:59,622 - INFO - Portfolio weights initialized
2025-04-17 22:24:59,622 - INFO - Generating regime predictions for test period...
2025-04-17 22:24:59,624 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:24:59,624 - ERROR - Error running hmm with regime_aware and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:24:59,626 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 7 regimes
2025-04-17 22:24:59,626 - INFO - Initializing strategy...
2025-04-17 22:24:59,626 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 22:24:59,626 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:24:59,626 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:24:59,626 - INFO - Running strategy...
2025-04-17 22:24:59,626 - INFO - Starting strategy execution...
2025-04-17 22:24:59,627 - INFO - Preparing training and testing data...
2025-04-17 22:24:59,627 - INFO - Starting data preparation...
2025-04-17 22:24:59,627 - INFO - Loading Fama-French factors...
2025-04-17 22:24:59,636 - INFO - Fama-French factors loaded
2025-04-17 22:24:59,636 - INFO - Processing factor data...
2025-04-17 22:24:59,638 - INFO - Factor data processed
2025-04-17 22:24:59,639 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:24:59,639 - INFO - 
Training Period:
2025-04-17 22:24:59,643 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:24:59,651 - INFO - 
Testing Period:
2025-04-17 22:24:59,655 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:24:59,662 - INFO - Loading macro and market data...
2025-04-17 22:24:59,663 - INFO - Loading existing macro data...
2025-04-17 22:24:59,674 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:59,674 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:59,677 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:59,677 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:59,677 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:59,678 - INFO - Loading existing macro data...
2025-04-17 22:24:59,688 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:59,689 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:59,691 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:59,691 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:59,692 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:59,693 - INFO - Loading existing market data...
2025-04-17 22:24:59,696 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:59,697 - INFO - Loading existing market data...
2025-04-17 22:24:59,700 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:59,701 - INFO - Macro and market data loaded
2025-04-17 22:24:59,701 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:59,701 - INFO - Preparing training data for regime classification...
2025-04-17 22:24:59,702 - INFO - Loading existing macro data...
2025-04-17 22:24:59,711 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:59,712 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:59,714 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:59,714 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:24:59,715 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:24:59,715 - INFO - Loading existing market data...
2025-04-17 22:24:59,719 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:24:59,732 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:24:59,732 - INFO - Prepared training data with 1536 samples
2025-04-17 22:24:59,732 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:59,732 - INFO - Preparing test data for regime classification...
2025-04-17 22:24:59,733 - INFO - Loading existing macro data...
2025-04-17 22:24:59,743 - WARNING - US corporate credit spread file not found
2025-04-17 22:24:59,744 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:24:59,747 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:24:59,747 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:24:59,748 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:24:59,749 - INFO - Loading existing market data...
2025-04-17 22:24:59,752 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:24:59,763 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:24:59,763 - INFO - Prepared test data with 1276 samples
2025-04-17 22:24:59,764 - INFO - Test data prepared
2025-04-17 22:24:59,764 - INFO - Storing data...
2025-04-17 22:24:59,764 - INFO - Aligning data indices...
2025-04-17 22:24:59,765 - INFO - Data indices aligned
2025-04-17 22:24:59,766 - INFO - Data preparation completed
2025-04-17 22:24:59,766 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:24:59,766 - INFO - Training models...
2025-04-17 22:24:59,766 - INFO - Starting model training...
2025-04-17 22:24:59,766 - INFO - Training regime classifier...
2025-04-17 22:24:59,767 - INFO - Training HMM model...
2025-04-17 22:24:59,985 - INFO - HMM model training completed
2025-04-17 22:25:00,172 - INFO - Model training completed
2025-04-17 22:25:00,174 - INFO - Model training completed
2025-04-17 22:25:00,174 - INFO - Initializing portfolio weights...
2025-04-17 22:25:00,175 - INFO - Portfolio weights initialized
2025-04-17 22:25:00,175 - INFO - Generating regime predictions for test period...
2025-04-17 22:25:00,176 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:25:00,177 - ERROR - Error running hmm with regime_aware and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:25:00,178 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 3 regimes
2025-04-17 22:25:00,178 - INFO - Initializing strategy...
2025-04-17 22:25:00,179 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 22:25:00,179 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:25:00,179 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:25:00,179 - INFO - Running strategy...
2025-04-17 22:25:00,179 - INFO - Starting strategy execution...
2025-04-17 22:25:00,180 - INFO - Preparing training and testing data...
2025-04-17 22:25:00,180 - INFO - Starting data preparation...
2025-04-17 22:25:00,180 - INFO - Loading Fama-French factors...
2025-04-17 22:25:00,189 - INFO - Fama-French factors loaded
2025-04-17 22:25:00,189 - INFO - Processing factor data...
2025-04-17 22:25:00,191 - INFO - Factor data processed
2025-04-17 22:25:00,191 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:25:00,191 - INFO - 
Training Period:
2025-04-17 22:25:00,195 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:25:00,202 - INFO - 
Testing Period:
2025-04-17 22:25:00,207 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:25:00,215 - INFO - Loading macro and market data...
2025-04-17 22:25:00,216 - INFO - Loading existing macro data...
2025-04-17 22:25:00,226 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:00,226 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:00,229 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:00,229 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:00,229 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:00,230 - INFO - Loading existing macro data...
2025-04-17 22:25:00,239 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:00,240 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:00,243 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:00,243 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:00,243 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:00,244 - INFO - Loading existing market data...
2025-04-17 22:25:00,248 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:00,248 - INFO - Loading existing market data...
2025-04-17 22:25:00,251 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:00,251 - INFO - Macro and market data loaded
2025-04-17 22:25:00,251 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:00,252 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:00,252 - INFO - Loading existing macro data...
2025-04-17 22:25:00,261 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:00,261 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:00,264 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:00,264 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:00,265 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:00,265 - INFO - Loading existing market data...
2025-04-17 22:25:00,268 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:00,281 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:25:00,282 - INFO - Prepared training data with 1536 samples
2025-04-17 22:25:00,282 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:00,282 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:00,283 - INFO - Loading existing macro data...
2025-04-17 22:25:00,295 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:00,295 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:00,299 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:00,299 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:00,299 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:00,301 - INFO - Loading existing market data...
2025-04-17 22:25:00,305 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:00,315 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:25:00,316 - INFO - Prepared test data with 1276 samples
2025-04-17 22:25:00,316 - INFO - Test data prepared
2025-04-17 22:25:00,316 - INFO - Storing data...
2025-04-17 22:25:00,316 - INFO - Aligning data indices...
2025-04-17 22:25:00,318 - INFO - Data indices aligned
2025-04-17 22:25:00,318 - INFO - Data preparation completed
2025-04-17 22:25:00,318 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:25:00,318 - INFO - Training models...
2025-04-17 22:25:00,318 - INFO - Starting model training...
2025-04-17 22:25:00,319 - INFO - Training regime classifier...
2025-04-17 22:25:00,319 - INFO - Training HMM model...
2025-04-17 22:25:00,534 - INFO - HMM model training completed
2025-04-17 22:25:00,717 - INFO - Model training completed
2025-04-17 22:25:00,718 - INFO - Model training completed
2025-04-17 22:25:00,718 - INFO - Initializing portfolio weights...
2025-04-17 22:25:00,719 - INFO - Portfolio weights initialized
2025-04-17 22:25:00,719 - INFO - Generating regime predictions for test period...
2025-04-17 22:25:00,721 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:25:00,721 - ERROR - Error running hmm with neural_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:25:00,723 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 5 regimes
2025-04-17 22:25:00,723 - INFO - Initializing strategy...
2025-04-17 22:25:00,723 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 22:25:00,723 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:25:00,723 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:25:00,723 - INFO - Running strategy...
2025-04-17 22:25:00,723 - INFO - Starting strategy execution...
2025-04-17 22:25:00,724 - INFO - Preparing training and testing data...
2025-04-17 22:25:00,724 - INFO - Starting data preparation...
2025-04-17 22:25:00,724 - INFO - Loading Fama-French factors...
2025-04-17 22:25:00,733 - INFO - Fama-French factors loaded
2025-04-17 22:25:00,733 - INFO - Processing factor data...
2025-04-17 22:25:00,735 - INFO - Factor data processed
2025-04-17 22:25:00,735 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:25:00,736 - INFO - 
Training Period:
2025-04-17 22:25:00,740 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:25:00,747 - INFO - 
Testing Period:
2025-04-17 22:25:00,751 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:25:00,758 - INFO - Loading macro and market data...
2025-04-17 22:25:00,759 - INFO - Loading existing macro data...
2025-04-17 22:25:00,770 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:00,770 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:00,773 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:00,773 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:00,773 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:00,774 - INFO - Loading existing macro data...
2025-04-17 22:25:00,784 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:00,784 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:00,787 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:00,787 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:00,788 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:00,789 - INFO - Loading existing market data...
2025-04-17 22:25:00,792 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:00,793 - INFO - Loading existing market data...
2025-04-17 22:25:00,796 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:00,796 - INFO - Macro and market data loaded
2025-04-17 22:25:00,797 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:00,797 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:00,798 - INFO - Loading existing macro data...
2025-04-17 22:25:00,808 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:00,808 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:00,811 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:00,811 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:00,811 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:00,812 - INFO - Loading existing market data...
2025-04-17 22:25:00,815 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:00,828 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:25:00,828 - INFO - Prepared training data with 1536 samples
2025-04-17 22:25:00,829 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:00,829 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:00,830 - INFO - Loading existing macro data...
2025-04-17 22:25:00,840 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:00,841 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:00,844 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:00,844 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:00,845 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:00,846 - INFO - Loading existing market data...
2025-04-17 22:25:00,850 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:00,860 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:25:00,861 - INFO - Prepared test data with 1276 samples
2025-04-17 22:25:00,861 - INFO - Test data prepared
2025-04-17 22:25:00,861 - INFO - Storing data...
2025-04-17 22:25:00,861 - INFO - Aligning data indices...
2025-04-17 22:25:00,862 - INFO - Data indices aligned
2025-04-17 22:25:00,862 - INFO - Data preparation completed
2025-04-17 22:25:00,863 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:25:00,863 - INFO - Training models...
2025-04-17 22:25:00,863 - INFO - Starting model training...
2025-04-17 22:25:00,863 - INFO - Training regime classifier...
2025-04-17 22:25:00,863 - INFO - Training HMM model...
2025-04-17 22:25:01,081 - INFO - HMM model training completed
2025-04-17 22:25:01,264 - INFO - Model training completed
2025-04-17 22:25:01,266 - INFO - Model training completed
2025-04-17 22:25:01,266 - INFO - Initializing portfolio weights...
2025-04-17 22:25:01,266 - INFO - Portfolio weights initialized
2025-04-17 22:25:01,266 - INFO - Generating regime predictions for test period...
2025-04-17 22:25:01,268 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:25:01,268 - ERROR - Error running hmm with neural_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:25:01,270 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 7 regimes
2025-04-17 22:25:01,270 - INFO - Initializing strategy...
2025-04-17 22:25:01,270 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 22:25:01,270 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:25:01,270 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:25:01,270 - INFO - Running strategy...
2025-04-17 22:25:01,271 - INFO - Starting strategy execution...
2025-04-17 22:25:01,271 - INFO - Preparing training and testing data...
2025-04-17 22:25:01,271 - INFO - Starting data preparation...
2025-04-17 22:25:01,271 - INFO - Loading Fama-French factors...
2025-04-17 22:25:01,279 - INFO - Fama-French factors loaded
2025-04-17 22:25:01,280 - INFO - Processing factor data...
2025-04-17 22:25:01,282 - INFO - Factor data processed
2025-04-17 22:25:01,282 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:25:01,282 - INFO - 
Training Period:
2025-04-17 22:25:01,286 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:25:01,293 - INFO - 
Testing Period:
2025-04-17 22:25:01,297 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:25:01,304 - INFO - Loading macro and market data...
2025-04-17 22:25:01,305 - INFO - Loading existing macro data...
2025-04-17 22:25:01,314 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:01,314 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:01,317 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:01,318 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:01,318 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:01,319 - INFO - Loading existing macro data...
2025-04-17 22:25:01,328 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:01,329 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:01,331 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:01,332 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:01,332 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:01,333 - INFO - Loading existing market data...
2025-04-17 22:25:01,336 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:01,337 - INFO - Loading existing market data...
2025-04-17 22:25:01,339 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:01,339 - INFO - Macro and market data loaded
2025-04-17 22:25:01,340 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:01,340 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:01,340 - INFO - Loading existing macro data...
2025-04-17 22:25:01,350 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:01,350 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:01,353 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:01,353 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:01,353 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:01,354 - INFO - Loading existing market data...
2025-04-17 22:25:01,357 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:01,370 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:25:01,371 - INFO - Prepared training data with 1536 samples
2025-04-17 22:25:01,371 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:01,371 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:01,372 - INFO - Loading existing macro data...
2025-04-17 22:25:01,383 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:01,384 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:01,387 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:01,388 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:01,388 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:01,389 - INFO - Loading existing market data...
2025-04-17 22:25:01,393 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:01,403 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:25:01,403 - INFO - Prepared test data with 1276 samples
2025-04-17 22:25:01,404 - INFO - Test data prepared
2025-04-17 22:25:01,404 - INFO - Storing data...
2025-04-17 22:25:01,404 - INFO - Aligning data indices...
2025-04-17 22:25:01,405 - INFO - Data indices aligned
2025-04-17 22:25:01,405 - INFO - Data preparation completed
2025-04-17 22:25:01,405 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:25:01,405 - INFO - Training models...
2025-04-17 22:25:01,405 - INFO - Starting model training...
2025-04-17 22:25:01,405 - INFO - Training regime classifier...
2025-04-17 22:25:01,406 - INFO - Training HMM model...
2025-04-17 22:25:01,621 - INFO - HMM model training completed
2025-04-17 22:25:01,807 - INFO - Model training completed
2025-04-17 22:25:01,809 - INFO - Model training completed
2025-04-17 22:25:01,809 - INFO - Initializing portfolio weights...
2025-04-17 22:25:01,810 - INFO - Portfolio weights initialized
2025-04-17 22:25:01,810 - INFO - Generating regime predictions for test period...
2025-04-17 22:25:01,812 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:25:01,812 - ERROR - Error running hmm with neural_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:25:01,813 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 22:25:01,814 - INFO - Initializing strategy...
2025-04-17 22:25:01,814 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 22:25:01,814 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:25:01,814 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:25:01,814 - INFO - Running strategy...
2025-04-17 22:25:01,814 - INFO - Starting strategy execution...
2025-04-17 22:25:01,814 - INFO - Preparing training and testing data...
2025-04-17 22:25:01,814 - INFO - Starting data preparation...
2025-04-17 22:25:01,815 - INFO - Loading Fama-French factors...
2025-04-17 22:25:01,823 - INFO - Fama-French factors loaded
2025-04-17 22:25:01,824 - INFO - Processing factor data...
2025-04-17 22:25:01,826 - INFO - Factor data processed
2025-04-17 22:25:01,826 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:25:01,826 - INFO - 
Training Period:
2025-04-17 22:25:01,830 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:25:01,837 - INFO - 
Testing Period:
2025-04-17 22:25:01,841 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:25:01,848 - INFO - Loading macro and market data...
2025-04-17 22:25:01,849 - INFO - Loading existing macro data...
2025-04-17 22:25:01,858 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:01,859 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:01,861 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:01,861 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:01,862 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:01,862 - INFO - Loading existing macro data...
2025-04-17 22:25:01,872 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:01,872 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:01,875 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:01,875 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:01,876 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:01,876 - INFO - Loading existing market data...
2025-04-17 22:25:01,880 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:01,881 - INFO - Loading existing market data...
2025-04-17 22:25:01,884 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:01,884 - INFO - Macro and market data loaded
2025-04-17 22:25:01,884 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:01,884 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:01,885 - INFO - Loading existing macro data...
2025-04-17 22:25:01,894 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:01,895 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:01,897 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:01,898 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:01,898 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:01,899 - INFO - Loading existing market data...
2025-04-17 22:25:01,902 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:01,916 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:25:01,916 - INFO - Prepared training data with 1536 samples
2025-04-17 22:25:01,916 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:01,916 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:01,917 - INFO - Loading existing macro data...
2025-04-17 22:25:01,927 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:01,927 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:01,931 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:01,931 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:01,932 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:01,933 - INFO - Loading existing market data...
2025-04-17 22:25:01,937 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:01,948 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:25:01,948 - INFO - Prepared test data with 1276 samples
2025-04-17 22:25:01,948 - INFO - Test data prepared
2025-04-17 22:25:01,949 - INFO - Storing data...
2025-04-17 22:25:01,949 - INFO - Aligning data indices...
2025-04-17 22:25:01,950 - INFO - Data indices aligned
2025-04-17 22:25:01,950 - INFO - Data preparation completed
2025-04-17 22:25:01,951 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:25:01,951 - INFO - Training models...
2025-04-17 22:25:01,951 - INFO - Starting model training...
2025-04-17 22:25:01,951 - INFO - Training regime classifier...
2025-04-17 22:25:01,951 - INFO - Training HMM model...
2025-04-17 22:25:02,137 - WARNING - Model is not converging.  Current: 6604.332742761141 is not greater than 21103.699436208757. Delta is -14499.366693447617
2025-04-17 22:25:02,137 - INFO - HMM model training completed
2025-04-17 22:25:02,319 - INFO - Model training completed
2025-04-17 22:25:02,321 - INFO - Model training completed
2025-04-17 22:25:02,321 - INFO - Initializing portfolio weights...
2025-04-17 22:25:02,321 - INFO - Portfolio weights initialized
2025-04-17 22:25:02,321 - INFO - Generating regime predictions for test period...
2025-04-17 22:25:02,323 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:25:02,323 - ERROR - Error running hmm with autoencoder_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:25:02,325 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 22:25:02,325 - INFO - Initializing strategy...
2025-04-17 22:25:02,325 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 22:25:02,325 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:25:02,325 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:25:02,326 - INFO - Running strategy...
2025-04-17 22:25:02,326 - INFO - Starting strategy execution...
2025-04-17 22:25:02,326 - INFO - Preparing training and testing data...
2025-04-17 22:25:02,326 - INFO - Starting data preparation...
2025-04-17 22:25:02,326 - INFO - Loading Fama-French factors...
2025-04-17 22:25:02,335 - INFO - Fama-French factors loaded
2025-04-17 22:25:02,335 - INFO - Processing factor data...
2025-04-17 22:25:02,337 - INFO - Factor data processed
2025-04-17 22:25:02,337 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:25:02,338 - INFO - 
Training Period:
2025-04-17 22:25:02,342 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:25:02,349 - INFO - 
Testing Period:
2025-04-17 22:25:02,353 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:25:02,359 - INFO - Loading macro and market data...
2025-04-17 22:25:02,360 - INFO - Loading existing macro data...
2025-04-17 22:25:02,370 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:02,370 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:02,373 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:02,373 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:02,374 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:02,374 - INFO - Loading existing macro data...
2025-04-17 22:25:02,383 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:02,383 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:02,386 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:02,386 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:02,386 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:02,388 - INFO - Loading existing market data...
2025-04-17 22:25:02,391 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:02,392 - INFO - Loading existing market data...
2025-04-17 22:25:02,395 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:02,395 - INFO - Macro and market data loaded
2025-04-17 22:25:02,395 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:02,395 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:02,396 - INFO - Loading existing macro data...
2025-04-17 22:25:02,405 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:02,405 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:02,408 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:02,408 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:02,408 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:02,409 - INFO - Loading existing market data...
2025-04-17 22:25:02,413 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:02,426 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:25:02,426 - INFO - Prepared training data with 1536 samples
2025-04-17 22:25:02,426 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:02,426 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:02,428 - INFO - Loading existing macro data...
2025-04-17 22:25:02,438 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:02,438 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:02,441 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:02,441 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:02,442 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:02,443 - INFO - Loading existing market data...
2025-04-17 22:25:02,447 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:02,457 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:25:02,457 - INFO - Prepared test data with 1276 samples
2025-04-17 22:25:02,457 - INFO - Test data prepared
2025-04-17 22:25:02,457 - INFO - Storing data...
2025-04-17 22:25:02,457 - INFO - Aligning data indices...
2025-04-17 22:25:02,458 - INFO - Data indices aligned
2025-04-17 22:25:02,459 - INFO - Data preparation completed
2025-04-17 22:25:02,459 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:25:02,459 - INFO - Training models...
2025-04-17 22:25:02,459 - INFO - Starting model training...
2025-04-17 22:25:02,459 - INFO - Training regime classifier...
2025-04-17 22:25:02,459 - INFO - Training HMM model...
2025-04-17 22:25:02,670 - INFO - HMM model training completed
2025-04-17 22:25:02,853 - INFO - Model training completed
2025-04-17 22:25:02,855 - INFO - Model training completed
2025-04-17 22:25:02,855 - INFO - Initializing portfolio weights...
2025-04-17 22:25:02,856 - INFO - Portfolio weights initialized
2025-04-17 22:25:02,856 - INFO - Generating regime predictions for test period...
2025-04-17 22:25:02,857 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:25:02,858 - ERROR - Error running hmm with autoencoder_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:25:02,860 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 22:25:02,860 - INFO - Initializing strategy...
2025-04-17 22:25:02,860 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 22:25:02,860 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:25:02,861 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:25:02,861 - INFO - Running strategy...
2025-04-17 22:25:02,861 - INFO - Starting strategy execution...
2025-04-17 22:25:02,861 - INFO - Preparing training and testing data...
2025-04-17 22:25:02,861 - INFO - Starting data preparation...
2025-04-17 22:25:02,861 - INFO - Loading Fama-French factors...
2025-04-17 22:25:02,870 - INFO - Fama-French factors loaded
2025-04-17 22:25:02,870 - INFO - Processing factor data...
2025-04-17 22:25:02,872 - INFO - Factor data processed
2025-04-17 22:25:02,873 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:25:02,873 - INFO - 
Training Period:
2025-04-17 22:25:02,877 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:25:02,885 - INFO - 
Testing Period:
2025-04-17 22:25:02,889 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:25:02,896 - INFO - Loading macro and market data...
2025-04-17 22:25:02,897 - INFO - Loading existing macro data...
2025-04-17 22:25:02,907 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:02,907 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:02,910 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:02,910 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:02,910 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:02,911 - INFO - Loading existing macro data...
2025-04-17 22:25:02,921 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:02,921 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:02,924 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:02,924 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:02,924 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:02,926 - INFO - Loading existing market data...
2025-04-17 22:25:02,929 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:02,930 - INFO - Loading existing market data...
2025-04-17 22:25:02,933 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:02,933 - INFO - Macro and market data loaded
2025-04-17 22:25:02,933 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:02,933 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:02,934 - INFO - Loading existing macro data...
2025-04-17 22:25:02,944 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:02,945 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:02,947 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:02,948 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:02,948 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:02,949 - INFO - Loading existing market data...
2025-04-17 22:25:02,953 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:02,966 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:25:02,966 - INFO - Prepared training data with 1536 samples
2025-04-17 22:25:02,966 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:02,966 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:02,967 - INFO - Loading existing macro data...
2025-04-17 22:25:02,977 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:02,978 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:02,981 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:02,981 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:02,981 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:02,982 - INFO - Loading existing market data...
2025-04-17 22:25:02,985 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:02,995 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:25:02,995 - INFO - Prepared test data with 1276 samples
2025-04-17 22:25:02,995 - INFO - Test data prepared
2025-04-17 22:25:02,996 - INFO - Storing data...
2025-04-17 22:25:02,996 - INFO - Aligning data indices...
2025-04-17 22:25:02,998 - INFO - Data indices aligned
2025-04-17 22:25:02,998 - INFO - Data preparation completed
2025-04-17 22:25:02,998 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:25:02,998 - INFO - Training models...
2025-04-17 22:25:02,998 - INFO - Starting model training...
2025-04-17 22:25:02,998 - INFO - Training regime classifier...
2025-04-17 22:25:02,998 - INFO - Training HMM model...
2025-04-17 22:25:03,215 - INFO - HMM model training completed
2025-04-17 22:25:03,403 - INFO - Model training completed
2025-04-17 22:25:03,405 - INFO - Model training completed
2025-04-17 22:25:03,405 - INFO - Initializing portfolio weights...
2025-04-17 22:25:03,405 - INFO - Portfolio weights initialized
2025-04-17 22:25:03,406 - INFO - Generating regime predictions for test period...
2025-04-17 22:25:03,407 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:25:03,408 - ERROR - Error running hmm with autoencoder_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:25:03,409 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 3 regimes
2025-04-17 22:25:03,409 - INFO - Initializing strategy...
2025-04-17 22:25:03,409 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 22:25:03,410 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:25:03,410 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:25:03,410 - INFO - Running strategy...
2025-04-17 22:25:03,410 - INFO - Starting strategy execution...
2025-04-17 22:25:03,411 - INFO - Preparing training and testing data...
2025-04-17 22:25:03,411 - INFO - Starting data preparation...
2025-04-17 22:25:03,411 - INFO - Loading Fama-French factors...
2025-04-17 22:25:03,421 - INFO - Fama-French factors loaded
2025-04-17 22:25:03,421 - INFO - Processing factor data...
2025-04-17 22:25:03,423 - INFO - Factor data processed
2025-04-17 22:25:03,424 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:25:03,424 - INFO - 
Training Period:
2025-04-17 22:25:03,428 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:25:03,435 - INFO - 
Testing Period:
2025-04-17 22:25:03,439 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:25:03,446 - INFO - Loading macro and market data...
2025-04-17 22:25:03,447 - INFO - Loading existing macro data...
2025-04-17 22:25:03,458 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:03,458 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:03,462 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:03,462 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:03,462 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:03,463 - INFO - Loading existing macro data...
2025-04-17 22:25:03,473 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:03,473 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:03,476 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:03,477 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:03,477 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:03,478 - INFO - Loading existing market data...
2025-04-17 22:25:03,482 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:03,483 - INFO - Loading existing market data...
2025-04-17 22:25:03,486 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:03,486 - INFO - Macro and market data loaded
2025-04-17 22:25:03,487 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:03,487 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:03,487 - INFO - Loading existing macro data...
2025-04-17 22:25:03,497 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:03,497 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:03,500 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:03,500 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:03,500 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:03,501 - INFO - Loading existing market data...
2025-04-17 22:25:03,505 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:03,518 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:25:03,519 - INFO - Prepared training data with 1536 samples
2025-04-17 22:25:03,519 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:03,519 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:03,520 - INFO - Loading existing macro data...
2025-04-17 22:25:03,532 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:03,533 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:03,536 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:03,536 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:03,536 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:03,537 - INFO - Loading existing market data...
2025-04-17 22:25:03,542 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:03,552 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:25:03,553 - INFO - Prepared test data with 1276 samples
2025-04-17 22:25:03,553 - INFO - Test data prepared
2025-04-17 22:25:03,553 - INFO - Storing data...
2025-04-17 22:25:03,553 - INFO - Aligning data indices...
2025-04-17 22:25:03,555 - INFO - Data indices aligned
2025-04-17 22:25:03,555 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:25:03,555 - INFO - Data preparation completed
2025-04-17 22:25:03,555 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:25:03,556 - INFO - Training models...
2025-04-17 22:25:03,556 - INFO - Starting model training...
2025-04-17 22:25:03,556 - INFO - Training regime classifier...
2025-04-17 22:25:03,556 - INFO - Training HMM model...
2025-04-17 22:25:03,748 - WARNING - Model is not converging.  Current: 6604.335530223643 is not greater than 21252.70127342751. Delta is -14648.365743203865
2025-04-17 22:25:03,748 - INFO - HMM model training completed
2025-04-17 22:25:03,936 - INFO - Training neural portfolio optimizer...
2025-04-17 22:25:03,936 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:25:03,936 - INFO - Model training completed
2025-04-17 22:25:03,938 - INFO - Model training completed
2025-04-17 22:25:03,938 - INFO - Initializing portfolio weights...
2025-04-17 22:25:03,939 - INFO - Portfolio weights initialized
2025-04-17 22:25:03,939 - INFO - Generating regime predictions for test period...
2025-04-17 22:25:03,941 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:25:03,942 - ERROR - Error running hmm with neural and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:25:03,943 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 5 regimes
2025-04-17 22:25:03,944 - INFO - Initializing strategy...
2025-04-17 22:25:03,944 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 22:25:03,944 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:25:03,944 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:25:03,945 - INFO - Running strategy...
2025-04-17 22:25:03,945 - INFO - Starting strategy execution...
2025-04-17 22:25:03,945 - INFO - Preparing training and testing data...
2025-04-17 22:25:03,945 - INFO - Starting data preparation...
2025-04-17 22:25:03,945 - INFO - Loading Fama-French factors...
2025-04-17 22:25:03,955 - INFO - Fama-French factors loaded
2025-04-17 22:25:03,955 - INFO - Processing factor data...
2025-04-17 22:25:03,959 - INFO - Factor data processed
2025-04-17 22:25:03,959 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:25:03,959 - INFO - 
Training Period:
2025-04-17 22:25:03,963 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:25:03,970 - INFO - 
Testing Period:
2025-04-17 22:25:03,974 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:25:03,981 - INFO - Loading macro and market data...
2025-04-17 22:25:03,982 - INFO - Loading existing macro data...
2025-04-17 22:25:03,992 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:03,993 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:03,995 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:03,995 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:03,996 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:03,996 - INFO - Loading existing macro data...
2025-04-17 22:25:04,006 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:04,007 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:04,009 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:04,009 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:04,010 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:04,010 - INFO - Loading existing market data...
2025-04-17 22:25:04,014 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:04,015 - INFO - Loading existing market data...
2025-04-17 22:25:04,018 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:04,018 - INFO - Macro and market data loaded
2025-04-17 22:25:04,018 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:04,019 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:04,020 - INFO - Loading existing macro data...
2025-04-17 22:25:04,029 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:04,029 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:04,032 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:04,032 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:04,032 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:04,033 - INFO - Loading existing market data...
2025-04-17 22:25:04,037 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:04,051 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:25:04,051 - INFO - Prepared training data with 1536 samples
2025-04-17 22:25:04,052 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:04,052 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:04,053 - INFO - Loading existing macro data...
2025-04-17 22:25:04,064 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:04,064 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:04,067 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:04,068 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:04,068 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:04,069 - INFO - Loading existing market data...
2025-04-17 22:25:04,072 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:04,083 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:25:04,084 - INFO - Prepared test data with 1276 samples
2025-04-17 22:25:04,084 - INFO - Test data prepared
2025-04-17 22:25:04,084 - INFO - Storing data...
2025-04-17 22:25:04,084 - INFO - Aligning data indices...
2025-04-17 22:25:04,085 - INFO - Data indices aligned
2025-04-17 22:25:04,086 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:25:04,086 - INFO - Data preparation completed
2025-04-17 22:25:04,086 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:25:04,086 - INFO - Training models...
2025-04-17 22:25:04,087 - INFO - Starting model training...
2025-04-17 22:25:04,087 - INFO - Training regime classifier...
2025-04-17 22:25:04,087 - INFO - Training HMM model...
2025-04-17 22:25:04,309 - INFO - HMM model training completed
2025-04-17 22:25:04,491 - INFO - Training neural portfolio optimizer...
2025-04-17 22:25:04,491 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:25:04,491 - INFO - Model training completed
2025-04-17 22:25:04,493 - INFO - Model training completed
2025-04-17 22:25:04,493 - INFO - Initializing portfolio weights...
2025-04-17 22:25:04,494 - INFO - Portfolio weights initialized
2025-04-17 22:25:04,494 - INFO - Generating regime predictions for test period...
2025-04-17 22:25:04,495 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:25:04,496 - ERROR - Error running hmm with neural and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:25:04,497 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 7 regimes
2025-04-17 22:25:04,497 - INFO - Initializing strategy...
2025-04-17 22:25:04,498 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 22:25:04,498 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:25:04,498 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:25:04,499 - INFO - Running strategy...
2025-04-17 22:25:04,499 - INFO - Starting strategy execution...
2025-04-17 22:25:04,499 - INFO - Preparing training and testing data...
2025-04-17 22:25:04,499 - INFO - Starting data preparation...
2025-04-17 22:25:04,499 - INFO - Loading Fama-French factors...
2025-04-17 22:25:04,508 - INFO - Fama-French factors loaded
2025-04-17 22:25:04,509 - INFO - Processing factor data...
2025-04-17 22:25:04,511 - INFO - Factor data processed
2025-04-17 22:25:04,511 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:25:04,511 - INFO - 
Training Period:
2025-04-17 22:25:04,515 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:25:04,523 - INFO - 
Testing Period:
2025-04-17 22:25:04,527 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:25:04,534 - INFO - Loading macro and market data...
2025-04-17 22:25:04,535 - INFO - Loading existing macro data...
2025-04-17 22:25:04,545 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:04,546 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:04,548 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:04,549 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:04,549 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:04,550 - INFO - Loading existing macro data...
2025-04-17 22:25:04,559 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:04,559 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:04,562 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:04,562 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:04,563 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:04,564 - INFO - Loading existing market data...
2025-04-17 22:25:04,567 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:04,568 - INFO - Loading existing market data...
2025-04-17 22:25:04,571 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:04,571 - INFO - Macro and market data loaded
2025-04-17 22:25:04,571 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:04,571 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:04,572 - INFO - Loading existing macro data...
2025-04-17 22:25:04,581 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:04,581 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:04,584 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:04,584 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:04,584 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:04,585 - INFO - Loading existing market data...
2025-04-17 22:25:04,588 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:04,600 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:25:04,601 - INFO - Prepared training data with 1536 samples
2025-04-17 22:25:04,601 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:04,601 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:04,603 - INFO - Loading existing macro data...
2025-04-17 22:25:04,613 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:04,613 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:04,616 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:04,616 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:04,617 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:04,618 - INFO - Loading existing market data...
2025-04-17 22:25:04,621 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:04,630 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:25:04,630 - INFO - Prepared test data with 1276 samples
2025-04-17 22:25:04,631 - INFO - Test data prepared
2025-04-17 22:25:04,631 - INFO - Storing data...
2025-04-17 22:25:04,631 - INFO - Aligning data indices...
2025-04-17 22:25:04,632 - INFO - Data indices aligned
2025-04-17 22:25:04,633 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:25:04,633 - INFO - Data preparation completed
2025-04-17 22:25:04,633 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:25:04,633 - INFO - Training models...
2025-04-17 22:25:04,633 - INFO - Starting model training...
2025-04-17 22:25:04,634 - INFO - Training regime classifier...
2025-04-17 22:25:04,634 - INFO - Training HMM model...
2025-04-17 22:25:04,860 - INFO - HMM model training completed
2025-04-17 22:25:05,048 - INFO - Training neural portfolio optimizer...
2025-04-17 22:25:05,049 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:25:05,049 - INFO - Model training completed
2025-04-17 22:25:05,050 - INFO - Model training completed
2025-04-17 22:25:05,050 - INFO - Initializing portfolio weights...
2025-04-17 22:25:05,051 - INFO - Portfolio weights initialized
2025-04-17 22:25:05,051 - INFO - Generating regime predictions for test period...
2025-04-17 22:25:05,052 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:25:05,053 - ERROR - Error running hmm with neural and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:25:05,054 - ERROR - No valid results obtained from parameter grid search
2025-04-17 22:25:05,055 - ERROR - No valid results obtained from parameter grid search
2025-04-17 22:25:05,055 - INFO - Factor timing strategy optimization completed
2025-04-17 22:25:51,940 - INFO - Starting factor timing strategy optimization...
2025-04-17 22:25:51,941 - INFO - Running parameter grid search...
2025-04-17 22:25:51,941 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 3 regimes
2025-04-17 22:25:51,941 - INFO - Initializing strategy...
2025-04-17 22:25:51,941 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 22:25:51,941 - ERROR - Error running lstm with mean_variance and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:25:51,943 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 5 regimes
2025-04-17 22:25:51,943 - INFO - Initializing strategy...
2025-04-17 22:25:51,943 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 22:25:51,943 - ERROR - Error running lstm with mean_variance and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:25:51,944 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 7 regimes
2025-04-17 22:25:51,944 - INFO - Initializing strategy...
2025-04-17 22:25:51,945 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 22:25:51,945 - ERROR - Error running lstm with mean_variance and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:25:51,946 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 3 regimes
2025-04-17 22:25:51,946 - INFO - Initializing strategy...
2025-04-17 22:25:51,946 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 22:25:51,946 - ERROR - Error running lstm with regime_aware and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:25:51,947 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 5 regimes
2025-04-17 22:25:51,947 - INFO - Initializing strategy...
2025-04-17 22:25:51,947 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 22:25:51,947 - ERROR - Error running lstm with regime_aware and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:25:51,948 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 7 regimes
2025-04-17 22:25:51,948 - INFO - Initializing strategy...
2025-04-17 22:25:51,948 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 22:25:51,949 - ERROR - Error running lstm with regime_aware and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:25:51,949 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 3 regimes
2025-04-17 22:25:51,950 - INFO - Initializing strategy...
2025-04-17 22:25:51,950 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 22:25:51,950 - ERROR - Error running lstm with neural_regime and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:25:51,950 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 5 regimes
2025-04-17 22:25:51,951 - INFO - Initializing strategy...
2025-04-17 22:25:51,951 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 22:25:51,951 - ERROR - Error running lstm with neural_regime and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:25:51,952 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 7 regimes
2025-04-17 22:25:51,952 - INFO - Initializing strategy...
2025-04-17 22:25:51,952 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 22:25:51,952 - ERROR - Error running lstm with neural_regime and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:25:51,953 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 22:25:51,953 - INFO - Initializing strategy...
2025-04-17 22:25:51,953 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 22:25:51,953 - ERROR - Error running lstm with autoencoder_regime and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:25:51,954 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 22:25:51,954 - INFO - Initializing strategy...
2025-04-17 22:25:51,954 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 22:25:51,954 - ERROR - Error running lstm with autoencoder_regime and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:25:51,955 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 22:25:51,955 - INFO - Initializing strategy...
2025-04-17 22:25:51,955 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 22:25:51,955 - ERROR - Error running lstm with autoencoder_regime and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:25:51,956 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 3 regimes
2025-04-17 22:25:51,956 - INFO - Initializing strategy...
2025-04-17 22:25:51,956 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 22:25:51,956 - ERROR - Error running lstm with neural and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:25:51,957 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 5 regimes
2025-04-17 22:25:51,957 - INFO - Initializing strategy...
2025-04-17 22:25:51,957 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 22:25:51,957 - ERROR - Error running lstm with neural and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:25:51,958 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 7 regimes
2025-04-17 22:25:51,958 - INFO - Initializing strategy...
2025-04-17 22:25:51,958 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 22:25:51,958 - ERROR - Error running lstm with neural and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:25:51,959 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 3 regimes
2025-04-17 22:25:51,959 - INFO - Initializing strategy...
2025-04-17 22:25:51,960 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 22:25:51,960 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:25:51,982 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:25:51,982 - INFO - Running strategy...
2025-04-17 22:25:51,982 - INFO - Starting strategy execution...
2025-04-17 22:25:51,983 - INFO - Preparing training and testing data...
2025-04-17 22:25:51,983 - INFO - Starting data preparation...
2025-04-17 22:25:51,983 - INFO - Loading Fama-French factors...
2025-04-17 22:25:51,998 - INFO - Fama-French factors loaded
2025-04-17 22:25:51,998 - INFO - Processing factor data...
2025-04-17 22:25:52,001 - INFO - Factor data processed
2025-04-17 22:25:52,001 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:25:52,001 - INFO - 
Training Period:
2025-04-17 22:25:52,006 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:25:52,015 - INFO - 
Testing Period:
2025-04-17 22:25:52,020 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:25:52,027 - INFO - Loading macro and market data...
2025-04-17 22:25:52,028 - INFO - Loading existing macro data...
2025-04-17 22:25:52,039 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:52,039 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:52,043 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:52,043 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:52,043 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:52,044 - INFO - Loading existing macro data...
2025-04-17 22:25:52,054 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:52,054 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:52,057 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:52,057 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:52,058 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:52,059 - INFO - Loading existing market data...
2025-04-17 22:25:52,062 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:52,063 - INFO - Loading existing market data...
2025-04-17 22:25:52,066 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:52,066 - INFO - Macro and market data loaded
2025-04-17 22:25:52,066 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:52,066 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:52,067 - INFO - Loading existing macro data...
2025-04-17 22:25:52,076 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:52,076 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:52,079 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:52,079 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:52,079 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:52,080 - INFO - Loading existing market data...
2025-04-17 22:25:52,083 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:52,221 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:25:52,222 - INFO - Prepared training data with 1536 samples
2025-04-17 22:25:52,222 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:52,222 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:52,223 - INFO - Loading existing macro data...
2025-04-17 22:25:52,234 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:52,234 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:52,237 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:52,238 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:52,238 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:52,239 - INFO - Loading existing market data...
2025-04-17 22:25:52,242 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:52,250 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:25:52,251 - INFO - Prepared test data with 1276 samples
2025-04-17 22:25:52,251 - INFO - Test data prepared
2025-04-17 22:25:52,251 - INFO - Storing data...
2025-04-17 22:25:52,251 - INFO - Aligning data indices...
2025-04-17 22:25:52,252 - INFO - Data indices aligned
2025-04-17 22:25:52,252 - INFO - Data preparation completed
2025-04-17 22:25:52,253 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:25:52,253 - INFO - Training models...
2025-04-17 22:25:52,253 - INFO - Starting model training...
2025-04-17 22:25:52,253 - INFO - Training regime classifier...
2025-04-17 22:25:52,253 - INFO - Training XGBoost model...
2025-04-17 22:25:52,253 - INFO - Preparing features...
2025-04-17 22:25:52,253 - INFO - Input shape: (1536, 8)
2025-04-17 22:25:52,253 - INFO - Handling missing values...
2025-04-17 22:25:52,255 - INFO - Missing values: 0 -> 0
2025-04-17 22:25:52,255 - INFO - Scaling features...
2025-04-17 22:25:52,256 - INFO - Fitted new scaler
2025-04-17 22:25:52,257 - INFO - Output shape: (1536, 8)
2025-04-17 22:25:53,561 - INFO - XGBoost model training completed
2025-04-17 22:25:53,841 - INFO - Model training completed
2025-04-17 22:25:53,843 - INFO - Model training completed
2025-04-17 22:25:53,843 - INFO - Initializing portfolio weights...
2025-04-17 22:25:53,843 - INFO - Portfolio weights initialized
2025-04-17 22:25:53,844 - INFO - Generating regime predictions for test period...
2025-04-17 22:25:53,845 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:25:53,846 - ERROR - Error running xgboost with mean_variance and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:25:53,849 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 5 regimes
2025-04-17 22:25:53,849 - INFO - Initializing strategy...
2025-04-17 22:25:53,849 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 22:25:53,849 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:25:53,849 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:25:53,850 - INFO - Running strategy...
2025-04-17 22:25:53,850 - INFO - Starting strategy execution...
2025-04-17 22:25:53,850 - INFO - Preparing training and testing data...
2025-04-17 22:25:53,850 - INFO - Starting data preparation...
2025-04-17 22:25:53,850 - INFO - Loading Fama-French factors...
2025-04-17 22:25:53,860 - INFO - Fama-French factors loaded
2025-04-17 22:25:53,861 - INFO - Processing factor data...
2025-04-17 22:25:53,863 - INFO - Factor data processed
2025-04-17 22:25:53,863 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:25:53,863 - INFO - 
Training Period:
2025-04-17 22:25:53,867 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:25:53,874 - INFO - 
Testing Period:
2025-04-17 22:25:53,878 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:25:53,884 - INFO - Loading macro and market data...
2025-04-17 22:25:53,885 - INFO - Loading existing macro data...
2025-04-17 22:25:53,895 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:53,896 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:53,898 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:53,898 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:53,899 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:53,899 - INFO - Loading existing macro data...
2025-04-17 22:25:53,908 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:53,909 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:53,911 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:53,911 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:53,911 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:53,912 - INFO - Loading existing market data...
2025-04-17 22:25:53,915 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:53,916 - INFO - Loading existing market data...
2025-04-17 22:25:53,919 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:53,919 - INFO - Macro and market data loaded
2025-04-17 22:25:53,919 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:53,919 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:53,920 - INFO - Loading existing macro data...
2025-04-17 22:25:53,929 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:53,929 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:53,931 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:53,932 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:53,932 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:53,933 - INFO - Loading existing market data...
2025-04-17 22:25:53,936 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:53,948 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:25:53,949 - INFO - Prepared training data with 1536 samples
2025-04-17 22:25:53,949 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:53,949 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:53,950 - INFO - Loading existing macro data...
2025-04-17 22:25:53,960 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:53,960 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:53,964 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:53,964 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:53,964 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:53,965 - INFO - Loading existing market data...
2025-04-17 22:25:53,969 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:53,978 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:25:53,979 - INFO - Prepared test data with 1276 samples
2025-04-17 22:25:53,979 - INFO - Test data prepared
2025-04-17 22:25:53,979 - INFO - Storing data...
2025-04-17 22:25:53,979 - INFO - Aligning data indices...
2025-04-17 22:25:53,980 - INFO - Data indices aligned
2025-04-17 22:25:53,980 - INFO - Data preparation completed
2025-04-17 22:25:53,980 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:25:53,980 - INFO - Training models...
2025-04-17 22:25:53,981 - INFO - Starting model training...
2025-04-17 22:25:53,981 - INFO - Training regime classifier...
2025-04-17 22:25:53,981 - INFO - Training XGBoost model...
2025-04-17 22:25:53,981 - INFO - Preparing features...
2025-04-17 22:25:53,981 - INFO - Input shape: (1536, 8)
2025-04-17 22:25:53,981 - INFO - Handling missing values...
2025-04-17 22:25:53,982 - INFO - Missing values: 0 -> 0
2025-04-17 22:25:53,982 - INFO - Scaling features...
2025-04-17 22:25:53,984 - INFO - Fitted new scaler
2025-04-17 22:25:53,985 - INFO - Output shape: (1536, 8)
2025-04-17 22:25:54,213 - INFO - XGBoost model training completed
2025-04-17 22:25:54,560 - INFO - Model training completed
2025-04-17 22:25:54,561 - INFO - Model training completed
2025-04-17 22:25:54,562 - INFO - Initializing portfolio weights...
2025-04-17 22:25:54,562 - INFO - Portfolio weights initialized
2025-04-17 22:25:54,562 - INFO - Generating regime predictions for test period...
2025-04-17 22:25:54,564 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:25:54,564 - ERROR - Error running xgboost with mean_variance and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:25:54,565 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 7 regimes
2025-04-17 22:25:54,565 - INFO - Initializing strategy...
2025-04-17 22:25:54,566 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 22:25:54,566 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:25:54,566 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:25:54,566 - INFO - Running strategy...
2025-04-17 22:25:54,566 - INFO - Starting strategy execution...
2025-04-17 22:25:54,567 - INFO - Preparing training and testing data...
2025-04-17 22:25:54,567 - INFO - Starting data preparation...
2025-04-17 22:25:54,567 - INFO - Loading Fama-French factors...
2025-04-17 22:25:54,576 - INFO - Fama-French factors loaded
2025-04-17 22:25:54,576 - INFO - Processing factor data...
2025-04-17 22:25:54,578 - INFO - Factor data processed
2025-04-17 22:25:54,578 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:25:54,579 - INFO - 
Training Period:
2025-04-17 22:25:54,583 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:25:54,589 - INFO - 
Testing Period:
2025-04-17 22:25:54,593 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:25:54,600 - INFO - Loading macro and market data...
2025-04-17 22:25:54,601 - INFO - Loading existing macro data...
2025-04-17 22:25:54,610 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:54,611 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:54,613 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:54,614 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:54,614 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:54,615 - INFO - Loading existing macro data...
2025-04-17 22:25:54,624 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:54,625 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:54,627 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:54,628 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:54,628 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:54,629 - INFO - Loading existing market data...
2025-04-17 22:25:54,632 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:54,633 - INFO - Loading existing market data...
2025-04-17 22:25:54,636 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:54,636 - INFO - Macro and market data loaded
2025-04-17 22:25:54,636 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:54,636 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:54,637 - INFO - Loading existing macro data...
2025-04-17 22:25:54,647 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:54,647 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:54,649 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:54,650 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:54,650 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:54,651 - INFO - Loading existing market data...
2025-04-17 22:25:54,654 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:54,668 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:25:54,668 - INFO - Prepared training data with 1536 samples
2025-04-17 22:25:54,669 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:54,669 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:54,670 - INFO - Loading existing macro data...
2025-04-17 22:25:54,680 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:54,680 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:54,683 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:54,684 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:54,684 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:54,685 - INFO - Loading existing market data...
2025-04-17 22:25:54,688 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:54,697 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:25:54,697 - INFO - Prepared test data with 1276 samples
2025-04-17 22:25:54,697 - INFO - Test data prepared
2025-04-17 22:25:54,698 - INFO - Storing data...
2025-04-17 22:25:54,698 - INFO - Aligning data indices...
2025-04-17 22:25:54,699 - INFO - Data indices aligned
2025-04-17 22:25:54,700 - INFO - Data preparation completed
2025-04-17 22:25:54,700 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:25:54,700 - INFO - Training models...
2025-04-17 22:25:54,700 - INFO - Starting model training...
2025-04-17 22:25:54,700 - INFO - Training regime classifier...
2025-04-17 22:25:54,700 - INFO - Training XGBoost model...
2025-04-17 22:25:54,700 - INFO - Preparing features...
2025-04-17 22:25:54,701 - INFO - Input shape: (1536, 8)
2025-04-17 22:25:54,701 - INFO - Handling missing values...
2025-04-17 22:25:54,702 - INFO - Missing values: 0 -> 0
2025-04-17 22:25:54,702 - INFO - Scaling features...
2025-04-17 22:25:54,703 - INFO - Fitted new scaler
2025-04-17 22:25:54,704 - INFO - Output shape: (1536, 8)
2025-04-17 22:25:54,811 - INFO - XGBoost model training completed
2025-04-17 22:25:55,021 - INFO - Model training completed
2025-04-17 22:25:55,022 - INFO - Model training completed
2025-04-17 22:25:55,022 - INFO - Initializing portfolio weights...
2025-04-17 22:25:55,023 - INFO - Portfolio weights initialized
2025-04-17 22:25:55,023 - INFO - Generating regime predictions for test period...
2025-04-17 22:25:55,024 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:25:55,025 - ERROR - Error running xgboost with mean_variance and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:25:55,026 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 3 regimes
2025-04-17 22:25:55,026 - INFO - Initializing strategy...
2025-04-17 22:25:55,026 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 22:25:55,027 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:25:55,027 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:25:55,027 - INFO - Running strategy...
2025-04-17 22:25:55,027 - INFO - Starting strategy execution...
2025-04-17 22:25:55,028 - INFO - Preparing training and testing data...
2025-04-17 22:25:55,028 - INFO - Starting data preparation...
2025-04-17 22:25:55,028 - INFO - Loading Fama-French factors...
2025-04-17 22:25:55,037 - INFO - Fama-French factors loaded
2025-04-17 22:25:55,037 - INFO - Processing factor data...
2025-04-17 22:25:55,040 - INFO - Factor data processed
2025-04-17 22:25:55,040 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:25:55,040 - INFO - 
Training Period:
2025-04-17 22:25:55,044 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:25:55,051 - INFO - 
Testing Period:
2025-04-17 22:25:55,054 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:25:55,061 - INFO - Loading macro and market data...
2025-04-17 22:25:55,062 - INFO - Loading existing macro data...
2025-04-17 22:25:55,071 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:55,072 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:55,074 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:55,075 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:55,075 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:55,076 - INFO - Loading existing macro data...
2025-04-17 22:25:55,085 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:55,085 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:55,087 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:55,087 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:55,088 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:55,088 - INFO - Loading existing market data...
2025-04-17 22:25:55,092 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:55,093 - INFO - Loading existing market data...
2025-04-17 22:25:55,095 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:55,096 - INFO - Macro and market data loaded
2025-04-17 22:25:55,096 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:55,096 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:55,097 - INFO - Loading existing macro data...
2025-04-17 22:25:55,105 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:55,106 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:55,108 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:55,108 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:55,109 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:55,110 - INFO - Loading existing market data...
2025-04-17 22:25:55,113 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:55,127 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:25:55,127 - INFO - Prepared training data with 1536 samples
2025-04-17 22:25:55,128 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:55,128 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:55,129 - INFO - Loading existing macro data...
2025-04-17 22:25:55,141 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:55,142 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:55,146 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:55,146 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:55,146 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:55,147 - INFO - Loading existing market data...
2025-04-17 22:25:55,150 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:55,159 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:25:55,159 - INFO - Prepared test data with 1276 samples
2025-04-17 22:25:55,159 - INFO - Test data prepared
2025-04-17 22:25:55,160 - INFO - Storing data...
2025-04-17 22:25:55,160 - INFO - Aligning data indices...
2025-04-17 22:25:55,161 - INFO - Data indices aligned
2025-04-17 22:25:55,161 - INFO - Data preparation completed
2025-04-17 22:25:55,161 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:25:55,161 - INFO - Training models...
2025-04-17 22:25:55,161 - INFO - Starting model training...
2025-04-17 22:25:55,162 - INFO - Training regime classifier...
2025-04-17 22:25:55,162 - INFO - Training XGBoost model...
2025-04-17 22:25:55,162 - INFO - Preparing features...
2025-04-17 22:25:55,162 - INFO - Input shape: (1536, 8)
2025-04-17 22:25:55,162 - INFO - Handling missing values...
2025-04-17 22:25:55,163 - INFO - Missing values: 0 -> 0
2025-04-17 22:25:55,163 - INFO - Scaling features...
2025-04-17 22:25:55,164 - INFO - Fitted new scaler
2025-04-17 22:25:55,165 - INFO - Output shape: (1536, 8)
2025-04-17 22:25:55,271 - INFO - XGBoost model training completed
2025-04-17 22:25:55,482 - INFO - Model training completed
2025-04-17 22:25:55,484 - INFO - Model training completed
2025-04-17 22:25:55,484 - INFO - Initializing portfolio weights...
2025-04-17 22:25:55,485 - INFO - Portfolio weights initialized
2025-04-17 22:25:55,485 - INFO - Generating regime predictions for test period...
2025-04-17 22:25:55,486 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:25:55,487 - ERROR - Error running xgboost with regime_aware and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:25:55,488 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 5 regimes
2025-04-17 22:25:55,488 - INFO - Initializing strategy...
2025-04-17 22:25:55,488 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 22:25:55,488 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:25:55,488 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:25:55,489 - INFO - Running strategy...
2025-04-17 22:25:55,489 - INFO - Starting strategy execution...
2025-04-17 22:25:55,489 - INFO - Preparing training and testing data...
2025-04-17 22:25:55,489 - INFO - Starting data preparation...
2025-04-17 22:25:55,489 - INFO - Loading Fama-French factors...
2025-04-17 22:25:55,498 - INFO - Fama-French factors loaded
2025-04-17 22:25:55,499 - INFO - Processing factor data...
2025-04-17 22:25:55,501 - INFO - Factor data processed
2025-04-17 22:25:55,501 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:25:55,501 - INFO - 
Training Period:
2025-04-17 22:25:55,505 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:25:55,512 - INFO - 
Testing Period:
2025-04-17 22:25:55,516 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:25:55,523 - INFO - Loading macro and market data...
2025-04-17 22:25:55,524 - INFO - Loading existing macro data...
2025-04-17 22:25:55,534 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:55,534 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:55,537 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:55,537 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:55,537 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:55,538 - INFO - Loading existing macro data...
2025-04-17 22:25:55,548 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:55,548 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:55,550 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:55,551 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:55,551 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:55,551 - INFO - Loading existing market data...
2025-04-17 22:25:55,555 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:55,556 - INFO - Loading existing market data...
2025-04-17 22:25:55,558 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:55,558 - INFO - Macro and market data loaded
2025-04-17 22:25:55,558 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:55,559 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:55,559 - INFO - Loading existing macro data...
2025-04-17 22:25:55,568 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:55,569 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:55,571 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:55,571 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:55,571 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:55,572 - INFO - Loading existing market data...
2025-04-17 22:25:55,575 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:55,588 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:25:55,589 - INFO - Prepared training data with 1536 samples
2025-04-17 22:25:55,589 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:55,589 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:55,590 - INFO - Loading existing macro data...
2025-04-17 22:25:55,599 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:55,600 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:55,603 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:55,603 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:55,603 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:55,604 - INFO - Loading existing market data...
2025-04-17 22:25:55,608 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:55,617 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:25:55,617 - INFO - Prepared test data with 1276 samples
2025-04-17 22:25:55,618 - INFO - Test data prepared
2025-04-17 22:25:55,618 - INFO - Storing data...
2025-04-17 22:25:55,618 - INFO - Aligning data indices...
2025-04-17 22:25:55,619 - INFO - Data indices aligned
2025-04-17 22:25:55,619 - INFO - Data preparation completed
2025-04-17 22:25:55,619 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:25:55,619 - INFO - Training models...
2025-04-17 22:25:55,619 - INFO - Starting model training...
2025-04-17 22:25:55,619 - INFO - Training regime classifier...
2025-04-17 22:25:55,620 - INFO - Training XGBoost model...
2025-04-17 22:25:55,620 - INFO - Preparing features...
2025-04-17 22:25:55,620 - INFO - Input shape: (1536, 8)
2025-04-17 22:25:55,620 - INFO - Handling missing values...
2025-04-17 22:25:55,621 - INFO - Missing values: 0 -> 0
2025-04-17 22:25:55,621 - INFO - Scaling features...
2025-04-17 22:25:55,622 - INFO - Fitted new scaler
2025-04-17 22:25:55,623 - INFO - Output shape: (1536, 8)
2025-04-17 22:25:55,728 - INFO - XGBoost model training completed
2025-04-17 22:25:55,944 - INFO - Model training completed
2025-04-17 22:25:55,946 - INFO - Model training completed
2025-04-17 22:25:55,946 - INFO - Initializing portfolio weights...
2025-04-17 22:25:55,947 - INFO - Portfolio weights initialized
2025-04-17 22:25:55,947 - INFO - Generating regime predictions for test period...
2025-04-17 22:25:55,948 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:25:55,948 - ERROR - Error running xgboost with regime_aware and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:25:55,950 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 7 regimes
2025-04-17 22:25:55,950 - INFO - Initializing strategy...
2025-04-17 22:25:55,951 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 22:25:55,951 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:25:55,951 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:25:55,951 - INFO - Running strategy...
2025-04-17 22:25:55,952 - INFO - Starting strategy execution...
2025-04-17 22:25:55,952 - INFO - Preparing training and testing data...
2025-04-17 22:25:55,952 - INFO - Starting data preparation...
2025-04-17 22:25:55,952 - INFO - Loading Fama-French factors...
2025-04-17 22:25:55,962 - INFO - Fama-French factors loaded
2025-04-17 22:25:55,962 - INFO - Processing factor data...
2025-04-17 22:25:55,965 - INFO - Factor data processed
2025-04-17 22:25:55,965 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:25:55,966 - INFO - 
Training Period:
2025-04-17 22:25:55,970 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:25:55,977 - INFO - 
Testing Period:
2025-04-17 22:25:55,982 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:25:55,990 - INFO - Loading macro and market data...
2025-04-17 22:25:55,992 - INFO - Loading existing macro data...
2025-04-17 22:25:56,004 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:56,005 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:56,008 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:56,008 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:56,008 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:56,009 - INFO - Loading existing macro data...
2025-04-17 22:25:56,019 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:56,019 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:56,022 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:56,022 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:56,022 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:56,023 - INFO - Loading existing market data...
2025-04-17 22:25:56,027 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:56,028 - INFO - Loading existing market data...
2025-04-17 22:25:56,031 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:56,031 - INFO - Macro and market data loaded
2025-04-17 22:25:56,031 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:56,031 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:56,032 - INFO - Loading existing macro data...
2025-04-17 22:25:56,041 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:56,041 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:56,044 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:56,044 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:56,045 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:56,046 - INFO - Loading existing market data...
2025-04-17 22:25:56,049 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:56,063 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:25:56,063 - INFO - Prepared training data with 1536 samples
2025-04-17 22:25:56,064 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:56,064 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:56,065 - INFO - Loading existing macro data...
2025-04-17 22:25:56,075 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:56,075 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:56,079 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:56,079 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:56,079 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:56,080 - INFO - Loading existing market data...
2025-04-17 22:25:56,084 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:56,093 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:25:56,093 - INFO - Prepared test data with 1276 samples
2025-04-17 22:25:56,094 - INFO - Test data prepared
2025-04-17 22:25:56,094 - INFO - Storing data...
2025-04-17 22:25:56,094 - INFO - Aligning data indices...
2025-04-17 22:25:56,096 - INFO - Data indices aligned
2025-04-17 22:25:56,096 - INFO - Data preparation completed
2025-04-17 22:25:56,096 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:25:56,097 - INFO - Training models...
2025-04-17 22:25:56,097 - INFO - Starting model training...
2025-04-17 22:25:56,097 - INFO - Training regime classifier...
2025-04-17 22:25:56,097 - INFO - Training XGBoost model...
2025-04-17 22:25:56,097 - INFO - Preparing features...
2025-04-17 22:25:56,097 - INFO - Input shape: (1536, 8)
2025-04-17 22:25:56,097 - INFO - Handling missing values...
2025-04-17 22:25:56,098 - INFO - Missing values: 0 -> 0
2025-04-17 22:25:56,098 - INFO - Scaling features...
2025-04-17 22:25:56,099 - INFO - Fitted new scaler
2025-04-17 22:25:56,100 - INFO - Output shape: (1536, 8)
2025-04-17 22:25:56,214 - INFO - XGBoost model training completed
2025-04-17 22:25:56,425 - INFO - Model training completed
2025-04-17 22:25:56,427 - INFO - Model training completed
2025-04-17 22:25:56,427 - INFO - Initializing portfolio weights...
2025-04-17 22:25:56,427 - INFO - Portfolio weights initialized
2025-04-17 22:25:56,427 - INFO - Generating regime predictions for test period...
2025-04-17 22:25:56,429 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:25:56,429 - ERROR - Error running xgboost with regime_aware and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:25:56,431 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 3 regimes
2025-04-17 22:25:56,431 - INFO - Initializing strategy...
2025-04-17 22:25:56,431 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 22:25:56,431 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:25:56,431 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:25:56,432 - INFO - Running strategy...
2025-04-17 22:25:56,432 - INFO - Starting strategy execution...
2025-04-17 22:25:56,432 - INFO - Preparing training and testing data...
2025-04-17 22:25:56,432 - INFO - Starting data preparation...
2025-04-17 22:25:56,432 - INFO - Loading Fama-French factors...
2025-04-17 22:25:56,441 - INFO - Fama-French factors loaded
2025-04-17 22:25:56,442 - INFO - Processing factor data...
2025-04-17 22:25:56,444 - INFO - Factor data processed
2025-04-17 22:25:56,444 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:25:56,444 - INFO - 
Training Period:
2025-04-17 22:25:56,448 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:25:56,456 - INFO - 
Testing Period:
2025-04-17 22:25:56,460 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:25:56,467 - INFO - Loading macro and market data...
2025-04-17 22:25:56,468 - INFO - Loading existing macro data...
2025-04-17 22:25:56,477 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:56,478 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:56,481 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:56,481 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:56,481 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:56,482 - INFO - Loading existing macro data...
2025-04-17 22:25:56,491 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:56,491 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:56,493 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:56,494 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:56,494 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:56,495 - INFO - Loading existing market data...
2025-04-17 22:25:56,498 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:56,499 - INFO - Loading existing market data...
2025-04-17 22:25:56,502 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:56,502 - INFO - Macro and market data loaded
2025-04-17 22:25:56,502 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:56,502 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:56,503 - INFO - Loading existing macro data...
2025-04-17 22:25:56,512 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:56,512 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:56,515 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:56,515 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:56,516 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:56,517 - INFO - Loading existing market data...
2025-04-17 22:25:56,520 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:56,534 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:25:56,534 - INFO - Prepared training data with 1536 samples
2025-04-17 22:25:56,534 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:56,534 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:56,535 - INFO - Loading existing macro data...
2025-04-17 22:25:56,547 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:56,548 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:56,551 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:56,551 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:56,552 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:56,553 - INFO - Loading existing market data...
2025-04-17 22:25:56,556 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:56,567 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:25:56,567 - INFO - Prepared test data with 1276 samples
2025-04-17 22:25:56,568 - INFO - Test data prepared
2025-04-17 22:25:56,568 - INFO - Storing data...
2025-04-17 22:25:56,568 - INFO - Aligning data indices...
2025-04-17 22:25:56,569 - INFO - Data indices aligned
2025-04-17 22:25:56,569 - INFO - Data preparation completed
2025-04-17 22:25:56,570 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:25:56,570 - INFO - Training models...
2025-04-17 22:25:56,570 - INFO - Starting model training...
2025-04-17 22:25:56,570 - INFO - Training regime classifier...
2025-04-17 22:25:56,570 - INFO - Training XGBoost model...
2025-04-17 22:25:56,570 - INFO - Preparing features...
2025-04-17 22:25:56,570 - INFO - Input shape: (1536, 8)
2025-04-17 22:25:56,570 - INFO - Handling missing values...
2025-04-17 22:25:56,571 - INFO - Missing values: 0 -> 0
2025-04-17 22:25:56,571 - INFO - Scaling features...
2025-04-17 22:25:56,572 - INFO - Fitted new scaler
2025-04-17 22:25:56,573 - INFO - Output shape: (1536, 8)
2025-04-17 22:25:56,681 - INFO - XGBoost model training completed
2025-04-17 22:25:56,890 - INFO - Model training completed
2025-04-17 22:25:56,891 - INFO - Model training completed
2025-04-17 22:25:56,891 - INFO - Initializing portfolio weights...
2025-04-17 22:25:56,892 - INFO - Portfolio weights initialized
2025-04-17 22:25:56,892 - INFO - Generating regime predictions for test period...
2025-04-17 22:25:56,894 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:25:56,894 - ERROR - Error running xgboost with neural_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:25:56,896 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 5 regimes
2025-04-17 22:25:56,896 - INFO - Initializing strategy...
2025-04-17 22:25:56,896 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 22:25:56,896 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:25:56,896 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:25:56,897 - INFO - Running strategy...
2025-04-17 22:25:56,897 - INFO - Starting strategy execution...
2025-04-17 22:25:56,897 - INFO - Preparing training and testing data...
2025-04-17 22:25:56,897 - INFO - Starting data preparation...
2025-04-17 22:25:56,897 - INFO - Loading Fama-French factors...
2025-04-17 22:25:56,907 - INFO - Fama-French factors loaded
2025-04-17 22:25:56,908 - INFO - Processing factor data...
2025-04-17 22:25:56,910 - INFO - Factor data processed
2025-04-17 22:25:56,910 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:25:56,910 - INFO - 
Training Period:
2025-04-17 22:25:56,914 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:25:56,921 - INFO - 
Testing Period:
2025-04-17 22:25:56,925 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:25:56,932 - INFO - Loading macro and market data...
2025-04-17 22:25:56,933 - INFO - Loading existing macro data...
2025-04-17 22:25:56,943 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:56,943 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:56,946 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:56,946 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:56,946 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:56,947 - INFO - Loading existing macro data...
2025-04-17 22:25:56,956 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:56,957 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:56,959 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:56,959 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:56,960 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:56,960 - INFO - Loading existing market data...
2025-04-17 22:25:56,964 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:56,965 - INFO - Loading existing market data...
2025-04-17 22:25:56,968 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:56,969 - INFO - Macro and market data loaded
2025-04-17 22:25:56,969 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:56,969 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:56,970 - INFO - Loading existing macro data...
2025-04-17 22:25:56,979 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:56,979 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:56,982 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:56,982 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:56,983 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:56,983 - INFO - Loading existing market data...
2025-04-17 22:25:56,987 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:57,000 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:25:57,001 - INFO - Prepared training data with 1536 samples
2025-04-17 22:25:57,001 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:57,001 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:57,002 - INFO - Loading existing macro data...
2025-04-17 22:25:57,012 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:57,012 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:57,016 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:57,016 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:57,016 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:57,017 - INFO - Loading existing market data...
2025-04-17 22:25:57,021 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:57,030 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:25:57,030 - INFO - Prepared test data with 1276 samples
2025-04-17 22:25:57,031 - INFO - Test data prepared
2025-04-17 22:25:57,031 - INFO - Storing data...
2025-04-17 22:25:57,031 - INFO - Aligning data indices...
2025-04-17 22:25:57,032 - INFO - Data indices aligned
2025-04-17 22:25:57,032 - INFO - Data preparation completed
2025-04-17 22:25:57,033 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:25:57,033 - INFO - Training models...
2025-04-17 22:25:57,033 - INFO - Starting model training...
2025-04-17 22:25:57,033 - INFO - Training regime classifier...
2025-04-17 22:25:57,033 - INFO - Training XGBoost model...
2025-04-17 22:25:57,034 - INFO - Preparing features...
2025-04-17 22:25:57,034 - INFO - Input shape: (1536, 8)
2025-04-17 22:25:57,034 - INFO - Handling missing values...
2025-04-17 22:25:57,035 - INFO - Missing values: 0 -> 0
2025-04-17 22:25:57,035 - INFO - Scaling features...
2025-04-17 22:25:57,037 - INFO - Fitted new scaler
2025-04-17 22:25:57,037 - INFO - Output shape: (1536, 8)
2025-04-17 22:25:57,147 - INFO - XGBoost model training completed
2025-04-17 22:25:57,367 - INFO - Model training completed
2025-04-17 22:25:57,369 - INFO - Model training completed
2025-04-17 22:25:57,369 - INFO - Initializing portfolio weights...
2025-04-17 22:25:57,369 - INFO - Portfolio weights initialized
2025-04-17 22:25:57,370 - INFO - Generating regime predictions for test period...
2025-04-17 22:25:57,371 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:25:57,372 - ERROR - Error running xgboost with neural_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:25:57,373 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 7 regimes
2025-04-17 22:25:57,373 - INFO - Initializing strategy...
2025-04-17 22:25:57,374 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 22:25:57,374 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:25:57,374 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:25:57,374 - INFO - Running strategy...
2025-04-17 22:25:57,375 - INFO - Starting strategy execution...
2025-04-17 22:25:57,375 - INFO - Preparing training and testing data...
2025-04-17 22:25:57,375 - INFO - Starting data preparation...
2025-04-17 22:25:57,375 - INFO - Loading Fama-French factors...
2025-04-17 22:25:57,384 - INFO - Fama-French factors loaded
2025-04-17 22:25:57,385 - INFO - Processing factor data...
2025-04-17 22:25:57,387 - INFO - Factor data processed
2025-04-17 22:25:57,387 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:25:57,387 - INFO - 
Training Period:
2025-04-17 22:25:57,391 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:25:57,398 - INFO - 
Testing Period:
2025-04-17 22:25:57,402 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:25:57,408 - INFO - Loading macro and market data...
2025-04-17 22:25:57,409 - INFO - Loading existing macro data...
2025-04-17 22:25:57,419 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:57,419 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:57,422 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:57,422 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:57,423 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:57,423 - INFO - Loading existing macro data...
2025-04-17 22:25:57,433 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:57,433 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:57,436 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:57,436 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:57,436 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:57,437 - INFO - Loading existing market data...
2025-04-17 22:25:57,441 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:57,442 - INFO - Loading existing market data...
2025-04-17 22:25:57,445 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:57,445 - INFO - Macro and market data loaded
2025-04-17 22:25:57,445 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:57,446 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:57,446 - INFO - Loading existing macro data...
2025-04-17 22:25:57,456 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:57,456 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:57,459 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:57,459 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:57,459 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:57,461 - INFO - Loading existing market data...
2025-04-17 22:25:57,465 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:57,479 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:25:57,479 - INFO - Prepared training data with 1536 samples
2025-04-17 22:25:57,480 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:57,480 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:57,481 - INFO - Loading existing macro data...
2025-04-17 22:25:57,493 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:57,493 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:57,496 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:57,497 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:57,497 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:57,498 - INFO - Loading existing market data...
2025-04-17 22:25:57,502 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:57,512 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:25:57,512 - INFO - Prepared test data with 1276 samples
2025-04-17 22:25:57,512 - INFO - Test data prepared
2025-04-17 22:25:57,512 - INFO - Storing data...
2025-04-17 22:25:57,513 - INFO - Aligning data indices...
2025-04-17 22:25:57,514 - INFO - Data indices aligned
2025-04-17 22:25:57,514 - INFO - Data preparation completed
2025-04-17 22:25:57,514 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:25:57,514 - INFO - Training models...
2025-04-17 22:25:57,514 - INFO - Starting model training...
2025-04-17 22:25:57,515 - INFO - Training regime classifier...
2025-04-17 22:25:57,515 - INFO - Training XGBoost model...
2025-04-17 22:25:57,515 - INFO - Preparing features...
2025-04-17 22:25:57,515 - INFO - Input shape: (1536, 8)
2025-04-17 22:25:57,516 - INFO - Handling missing values...
2025-04-17 22:25:57,516 - INFO - Missing values: 0 -> 0
2025-04-17 22:25:57,517 - INFO - Scaling features...
2025-04-17 22:25:57,518 - INFO - Fitted new scaler
2025-04-17 22:25:57,518 - INFO - Output shape: (1536, 8)
2025-04-17 22:25:57,623 - INFO - XGBoost model training completed
2025-04-17 22:25:57,833 - INFO - Model training completed
2025-04-17 22:25:57,835 - INFO - Model training completed
2025-04-17 22:25:57,835 - INFO - Initializing portfolio weights...
2025-04-17 22:25:57,836 - INFO - Portfolio weights initialized
2025-04-17 22:25:57,836 - INFO - Generating regime predictions for test period...
2025-04-17 22:25:57,837 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:25:57,837 - ERROR - Error running xgboost with neural_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:25:57,839 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 22:25:57,839 - INFO - Initializing strategy...
2025-04-17 22:25:57,839 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 22:25:57,840 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:25:57,840 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:25:57,840 - INFO - Running strategy...
2025-04-17 22:25:57,840 - INFO - Starting strategy execution...
2025-04-17 22:25:57,841 - INFO - Preparing training and testing data...
2025-04-17 22:25:57,841 - INFO - Starting data preparation...
2025-04-17 22:25:57,841 - INFO - Loading Fama-French factors...
2025-04-17 22:25:57,850 - INFO - Fama-French factors loaded
2025-04-17 22:25:57,850 - INFO - Processing factor data...
2025-04-17 22:25:57,852 - INFO - Factor data processed
2025-04-17 22:25:57,852 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:25:57,852 - INFO - 
Training Period:
2025-04-17 22:25:57,856 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:25:57,864 - INFO - 
Testing Period:
2025-04-17 22:25:57,868 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:25:57,875 - INFO - Loading macro and market data...
2025-04-17 22:25:57,876 - INFO - Loading existing macro data...
2025-04-17 22:25:57,887 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:57,887 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:57,890 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:57,890 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:57,891 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:57,892 - INFO - Loading existing macro data...
2025-04-17 22:25:57,902 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:57,902 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:57,905 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:57,905 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:57,906 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:57,907 - INFO - Loading existing market data...
2025-04-17 22:25:57,911 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:57,911 - INFO - Loading existing market data...
2025-04-17 22:25:57,914 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:57,914 - INFO - Macro and market data loaded
2025-04-17 22:25:57,914 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:57,914 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:57,915 - INFO - Loading existing macro data...
2025-04-17 22:25:57,924 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:57,924 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:57,928 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:57,928 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:57,928 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:57,929 - INFO - Loading existing market data...
2025-04-17 22:25:57,932 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:57,946 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:25:57,946 - INFO - Prepared training data with 1536 samples
2025-04-17 22:25:57,947 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:57,947 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:57,948 - INFO - Loading existing macro data...
2025-04-17 22:25:57,958 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:57,959 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:57,961 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:57,962 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:57,962 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:57,963 - INFO - Loading existing market data...
2025-04-17 22:25:57,967 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:57,978 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:25:57,978 - INFO - Prepared test data with 1276 samples
2025-04-17 22:25:57,979 - INFO - Test data prepared
2025-04-17 22:25:57,979 - INFO - Storing data...
2025-04-17 22:25:57,979 - INFO - Aligning data indices...
2025-04-17 22:25:57,980 - INFO - Data indices aligned
2025-04-17 22:25:57,981 - INFO - Data preparation completed
2025-04-17 22:25:57,981 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:25:57,981 - INFO - Training models...
2025-04-17 22:25:57,981 - INFO - Starting model training...
2025-04-17 22:25:57,981 - INFO - Training regime classifier...
2025-04-17 22:25:57,981 - INFO - Training XGBoost model...
2025-04-17 22:25:57,981 - INFO - Preparing features...
2025-04-17 22:25:57,982 - INFO - Input shape: (1536, 8)
2025-04-17 22:25:57,982 - INFO - Handling missing values...
2025-04-17 22:25:57,983 - INFO - Missing values: 0 -> 0
2025-04-17 22:25:57,983 - INFO - Scaling features...
2025-04-17 22:25:57,984 - INFO - Fitted new scaler
2025-04-17 22:25:57,985 - INFO - Output shape: (1536, 8)
2025-04-17 22:25:58,091 - INFO - XGBoost model training completed
2025-04-17 22:25:58,306 - INFO - Model training completed
2025-04-17 22:25:58,308 - INFO - Model training completed
2025-04-17 22:25:58,308 - INFO - Initializing portfolio weights...
2025-04-17 22:25:58,309 - INFO - Portfolio weights initialized
2025-04-17 22:25:58,309 - INFO - Generating regime predictions for test period...
2025-04-17 22:25:58,311 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:25:58,311 - ERROR - Error running xgboost with autoencoder_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:25:58,312 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 22:25:58,313 - INFO - Initializing strategy...
2025-04-17 22:25:58,313 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 22:25:58,313 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:25:58,313 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:25:58,314 - INFO - Running strategy...
2025-04-17 22:25:58,314 - INFO - Starting strategy execution...
2025-04-17 22:25:58,314 - INFO - Preparing training and testing data...
2025-04-17 22:25:58,314 - INFO - Starting data preparation...
2025-04-17 22:25:58,314 - INFO - Loading Fama-French factors...
2025-04-17 22:25:58,323 - INFO - Fama-French factors loaded
2025-04-17 22:25:58,324 - INFO - Processing factor data...
2025-04-17 22:25:58,326 - INFO - Factor data processed
2025-04-17 22:25:58,326 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:25:58,326 - INFO - 
Training Period:
2025-04-17 22:25:58,330 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:25:58,338 - INFO - 
Testing Period:
2025-04-17 22:25:58,342 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:25:58,349 - INFO - Loading macro and market data...
2025-04-17 22:25:58,350 - INFO - Loading existing macro data...
2025-04-17 22:25:58,360 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:58,360 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:58,363 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:58,363 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:58,363 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:58,364 - INFO - Loading existing macro data...
2025-04-17 22:25:58,373 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:58,374 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:58,376 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:58,376 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:58,377 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:58,378 - INFO - Loading existing market data...
2025-04-17 22:25:58,382 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:58,383 - INFO - Loading existing market data...
2025-04-17 22:25:58,386 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:58,386 - INFO - Macro and market data loaded
2025-04-17 22:25:58,386 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:58,386 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:58,387 - INFO - Loading existing macro data...
2025-04-17 22:25:58,397 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:58,397 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:58,401 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:58,401 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:58,401 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:58,402 - INFO - Loading existing market data...
2025-04-17 22:25:58,405 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:58,419 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:25:58,420 - INFO - Prepared training data with 1536 samples
2025-04-17 22:25:58,420 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:58,420 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:58,421 - INFO - Loading existing macro data...
2025-04-17 22:25:58,431 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:58,432 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:58,435 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:58,435 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:58,435 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:58,436 - INFO - Loading existing market data...
2025-04-17 22:25:58,439 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:58,448 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:25:58,448 - INFO - Prepared test data with 1276 samples
2025-04-17 22:25:58,448 - INFO - Test data prepared
2025-04-17 22:25:58,449 - INFO - Storing data...
2025-04-17 22:25:58,449 - INFO - Aligning data indices...
2025-04-17 22:25:58,451 - INFO - Data indices aligned
2025-04-17 22:25:58,451 - INFO - Data preparation completed
2025-04-17 22:25:58,451 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:25:58,451 - INFO - Training models...
2025-04-17 22:25:58,452 - INFO - Starting model training...
2025-04-17 22:25:58,452 - INFO - Training regime classifier...
2025-04-17 22:25:58,452 - INFO - Training XGBoost model...
2025-04-17 22:25:58,452 - INFO - Preparing features...
2025-04-17 22:25:58,452 - INFO - Input shape: (1536, 8)
2025-04-17 22:25:58,452 - INFO - Handling missing values...
2025-04-17 22:25:58,453 - INFO - Missing values: 0 -> 0
2025-04-17 22:25:58,454 - INFO - Scaling features...
2025-04-17 22:25:58,455 - INFO - Fitted new scaler
2025-04-17 22:25:58,455 - INFO - Output shape: (1536, 8)
2025-04-17 22:25:58,566 - INFO - XGBoost model training completed
2025-04-17 22:25:58,779 - INFO - Model training completed
2025-04-17 22:25:58,780 - INFO - Model training completed
2025-04-17 22:25:58,780 - INFO - Initializing portfolio weights...
2025-04-17 22:25:58,781 - INFO - Portfolio weights initialized
2025-04-17 22:25:58,781 - INFO - Generating regime predictions for test period...
2025-04-17 22:25:58,783 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:25:58,783 - ERROR - Error running xgboost with autoencoder_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:25:58,785 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 22:25:58,785 - INFO - Initializing strategy...
2025-04-17 22:25:58,785 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 22:25:58,785 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:25:58,785 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:25:58,786 - INFO - Running strategy...
2025-04-17 22:25:58,786 - INFO - Starting strategy execution...
2025-04-17 22:25:58,786 - INFO - Preparing training and testing data...
2025-04-17 22:25:58,786 - INFO - Starting data preparation...
2025-04-17 22:25:58,786 - INFO - Loading Fama-French factors...
2025-04-17 22:25:58,795 - INFO - Fama-French factors loaded
2025-04-17 22:25:58,796 - INFO - Processing factor data...
2025-04-17 22:25:58,798 - INFO - Factor data processed
2025-04-17 22:25:58,798 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:25:58,798 - INFO - 
Training Period:
2025-04-17 22:25:58,802 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:25:58,810 - INFO - 
Testing Period:
2025-04-17 22:25:58,814 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:25:58,821 - INFO - Loading macro and market data...
2025-04-17 22:25:58,822 - INFO - Loading existing macro data...
2025-04-17 22:25:58,832 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:58,833 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:58,835 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:58,835 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:58,836 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:58,837 - INFO - Loading existing macro data...
2025-04-17 22:25:58,846 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:58,846 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:58,849 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:58,849 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:58,849 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:58,850 - INFO - Loading existing market data...
2025-04-17 22:25:58,854 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:58,855 - INFO - Loading existing market data...
2025-04-17 22:25:58,858 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:58,858 - INFO - Macro and market data loaded
2025-04-17 22:25:58,858 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:58,858 - INFO - Preparing training data for regime classification...
2025-04-17 22:25:58,859 - INFO - Loading existing macro data...
2025-04-17 22:25:58,869 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:58,869 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:58,872 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:58,872 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:25:58,872 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:25:58,873 - INFO - Loading existing market data...
2025-04-17 22:25:58,876 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:25:58,890 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:25:58,890 - INFO - Prepared training data with 1536 samples
2025-04-17 22:25:58,891 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:58,891 - INFO - Preparing test data for regime classification...
2025-04-17 22:25:58,892 - INFO - Loading existing macro data...
2025-04-17 22:25:58,902 - WARNING - US corporate credit spread file not found
2025-04-17 22:25:58,902 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:25:58,905 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:25:58,906 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:25:58,906 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:25:58,907 - INFO - Loading existing market data...
2025-04-17 22:25:58,911 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:25:58,922 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:25:58,922 - INFO - Prepared test data with 1276 samples
2025-04-17 22:25:58,922 - INFO - Test data prepared
2025-04-17 22:25:58,923 - INFO - Storing data...
2025-04-17 22:25:58,923 - INFO - Aligning data indices...
2025-04-17 22:25:58,924 - INFO - Data indices aligned
2025-04-17 22:25:58,924 - INFO - Data preparation completed
2025-04-17 22:25:58,924 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:25:58,924 - INFO - Training models...
2025-04-17 22:25:58,924 - INFO - Starting model training...
2025-04-17 22:25:58,924 - INFO - Training regime classifier...
2025-04-17 22:25:58,925 - INFO - Training XGBoost model...
2025-04-17 22:25:58,925 - INFO - Preparing features...
2025-04-17 22:25:58,925 - INFO - Input shape: (1536, 8)
2025-04-17 22:25:58,925 - INFO - Handling missing values...
2025-04-17 22:25:58,926 - INFO - Missing values: 0 -> 0
2025-04-17 22:25:58,926 - INFO - Scaling features...
2025-04-17 22:25:58,927 - INFO - Fitted new scaler
2025-04-17 22:25:58,928 - INFO - Output shape: (1536, 8)
2025-04-17 22:25:59,040 - INFO - XGBoost model training completed
2025-04-17 22:25:59,253 - INFO - Model training completed
2025-04-17 22:25:59,255 - INFO - Model training completed
2025-04-17 22:25:59,255 - INFO - Initializing portfolio weights...
2025-04-17 22:25:59,256 - INFO - Portfolio weights initialized
2025-04-17 22:25:59,256 - INFO - Generating regime predictions for test period...
2025-04-17 22:25:59,257 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:25:59,258 - ERROR - Error running xgboost with autoencoder_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:25:59,259 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 3 regimes
2025-04-17 22:25:59,259 - INFO - Initializing strategy...
2025-04-17 22:25:59,259 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 22:25:59,260 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:25:59,260 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:26:00,143 - INFO - Running strategy...
2025-04-17 22:26:00,144 - INFO - Starting strategy execution...
2025-04-17 22:26:00,144 - INFO - Preparing training and testing data...
2025-04-17 22:26:00,144 - INFO - Starting data preparation...
2025-04-17 22:26:00,144 - INFO - Loading Fama-French factors...
2025-04-17 22:26:00,154 - INFO - Fama-French factors loaded
2025-04-17 22:26:00,155 - INFO - Processing factor data...
2025-04-17 22:26:00,157 - INFO - Factor data processed
2025-04-17 22:26:00,157 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:26:00,157 - INFO - 
Training Period:
2025-04-17 22:26:00,161 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:26:00,169 - INFO - 
Testing Period:
2025-04-17 22:26:00,174 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:26:00,182 - INFO - Loading macro and market data...
2025-04-17 22:26:00,183 - INFO - Loading existing macro data...
2025-04-17 22:26:00,193 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:00,194 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:00,196 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:00,196 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:00,197 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:00,198 - INFO - Loading existing macro data...
2025-04-17 22:26:00,207 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:00,207 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:00,210 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:00,210 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:00,211 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:00,212 - INFO - Loading existing market data...
2025-04-17 22:26:00,215 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:00,216 - INFO - Loading existing market data...
2025-04-17 22:26:00,219 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:00,219 - INFO - Macro and market data loaded
2025-04-17 22:26:00,220 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:00,220 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:00,221 - INFO - Loading existing macro data...
2025-04-17 22:26:00,232 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:00,232 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:00,236 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:00,236 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:00,236 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:00,237 - INFO - Loading existing market data...
2025-04-17 22:26:00,241 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:00,255 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:26:00,256 - INFO - Prepared training data with 1536 samples
2025-04-17 22:26:00,256 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:00,257 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:00,258 - INFO - Loading existing macro data...
2025-04-17 22:26:00,267 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:00,268 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:00,271 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:00,271 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:00,272 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:00,273 - INFO - Loading existing market data...
2025-04-17 22:26:00,277 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:00,287 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:26:00,287 - INFO - Prepared test data with 1276 samples
2025-04-17 22:26:00,287 - INFO - Test data prepared
2025-04-17 22:26:00,288 - INFO - Storing data...
2025-04-17 22:26:00,288 - INFO - Aligning data indices...
2025-04-17 22:26:00,289 - INFO - Data indices aligned
2025-04-17 22:26:00,290 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:26:00,291 - INFO - Data preparation completed
2025-04-17 22:26:00,291 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:26:00,291 - INFO - Training models...
2025-04-17 22:26:00,291 - INFO - Starting model training...
2025-04-17 22:26:00,292 - INFO - Training regime classifier...
2025-04-17 22:26:00,292 - INFO - Training XGBoost model...
2025-04-17 22:26:00,292 - INFO - Preparing features...
2025-04-17 22:26:00,292 - INFO - Input shape: (1536, 8)
2025-04-17 22:26:00,292 - INFO - Handling missing values...
2025-04-17 22:26:00,293 - INFO - Missing values: 0 -> 0
2025-04-17 22:26:00,293 - INFO - Scaling features...
2025-04-17 22:26:00,294 - INFO - Fitted new scaler
2025-04-17 22:26:00,295 - INFO - Output shape: (1536, 8)
2025-04-17 22:26:00,401 - INFO - XGBoost model training completed
2025-04-17 22:26:00,615 - INFO - Training neural portfolio optimizer...
2025-04-17 22:26:00,615 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:26:00,615 - INFO - Model training completed
2025-04-17 22:26:00,617 - INFO - Model training completed
2025-04-17 22:26:00,617 - INFO - Initializing portfolio weights...
2025-04-17 22:26:00,618 - INFO - Portfolio weights initialized
2025-04-17 22:26:00,618 - INFO - Generating regime predictions for test period...
2025-04-17 22:26:00,619 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:26:00,620 - ERROR - Error running xgboost with neural and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:26:00,621 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 5 regimes
2025-04-17 22:26:00,621 - INFO - Initializing strategy...
2025-04-17 22:26:00,621 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 22:26:00,622 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:26:00,622 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:26:00,623 - INFO - Running strategy...
2025-04-17 22:26:00,623 - INFO - Starting strategy execution...
2025-04-17 22:26:00,623 - INFO - Preparing training and testing data...
2025-04-17 22:26:00,623 - INFO - Starting data preparation...
2025-04-17 22:26:00,623 - INFO - Loading Fama-French factors...
2025-04-17 22:26:00,632 - INFO - Fama-French factors loaded
2025-04-17 22:26:00,633 - INFO - Processing factor data...
2025-04-17 22:26:00,635 - INFO - Factor data processed
2025-04-17 22:26:00,635 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:26:00,635 - INFO - 
Training Period:
2025-04-17 22:26:00,639 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:26:00,646 - INFO - 
Testing Period:
2025-04-17 22:26:00,650 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:26:00,657 - INFO - Loading macro and market data...
2025-04-17 22:26:00,658 - INFO - Loading existing macro data...
2025-04-17 22:26:00,668 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:00,668 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:00,671 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:00,671 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:00,671 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:00,672 - INFO - Loading existing macro data...
2025-04-17 22:26:00,683 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:00,683 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:00,686 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:00,686 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:00,687 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:00,688 - INFO - Loading existing market data...
2025-04-17 22:26:00,693 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:00,694 - INFO - Loading existing market data...
2025-04-17 22:26:00,697 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:00,697 - INFO - Macro and market data loaded
2025-04-17 22:26:00,697 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:00,697 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:00,698 - INFO - Loading existing macro data...
2025-04-17 22:26:00,707 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:00,707 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:00,710 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:00,710 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:00,710 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:00,711 - INFO - Loading existing market data...
2025-04-17 22:26:00,714 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:00,728 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:26:00,728 - INFO - Prepared training data with 1536 samples
2025-04-17 22:26:00,728 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:00,728 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:00,729 - INFO - Loading existing macro data...
2025-04-17 22:26:00,739 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:00,739 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:00,742 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:00,742 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:00,743 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:00,744 - INFO - Loading existing market data...
2025-04-17 22:26:00,746 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:00,755 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:26:00,755 - INFO - Prepared test data with 1276 samples
2025-04-17 22:26:00,755 - INFO - Test data prepared
2025-04-17 22:26:00,756 - INFO - Storing data...
2025-04-17 22:26:00,756 - INFO - Aligning data indices...
2025-04-17 22:26:00,757 - INFO - Data indices aligned
2025-04-17 22:26:00,757 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:26:00,758 - INFO - Data preparation completed
2025-04-17 22:26:00,758 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:26:00,758 - INFO - Training models...
2025-04-17 22:26:00,758 - INFO - Starting model training...
2025-04-17 22:26:00,758 - INFO - Training regime classifier...
2025-04-17 22:26:00,758 - INFO - Training XGBoost model...
2025-04-17 22:26:00,758 - INFO - Preparing features...
2025-04-17 22:26:00,759 - INFO - Input shape: (1536, 8)
2025-04-17 22:26:00,759 - INFO - Handling missing values...
2025-04-17 22:26:00,760 - INFO - Missing values: 0 -> 0
2025-04-17 22:26:00,760 - INFO - Scaling features...
2025-04-17 22:26:00,761 - INFO - Fitted new scaler
2025-04-17 22:26:00,762 - INFO - Output shape: (1536, 8)
2025-04-17 22:26:00,871 - INFO - XGBoost model training completed
2025-04-17 22:26:01,085 - INFO - Training neural portfolio optimizer...
2025-04-17 22:26:01,085 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:26:01,086 - INFO - Model training completed
2025-04-17 22:26:01,087 - INFO - Model training completed
2025-04-17 22:26:01,087 - INFO - Initializing portfolio weights...
2025-04-17 22:26:01,088 - INFO - Portfolio weights initialized
2025-04-17 22:26:01,088 - INFO - Generating regime predictions for test period...
2025-04-17 22:26:01,089 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:26:01,089 - ERROR - Error running xgboost with neural and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:26:01,091 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 7 regimes
2025-04-17 22:26:01,091 - INFO - Initializing strategy...
2025-04-17 22:26:01,091 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 22:26:01,091 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:26:01,091 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:26:01,092 - INFO - Running strategy...
2025-04-17 22:26:01,092 - INFO - Starting strategy execution...
2025-04-17 22:26:01,093 - INFO - Preparing training and testing data...
2025-04-17 22:26:01,093 - INFO - Starting data preparation...
2025-04-17 22:26:01,093 - INFO - Loading Fama-French factors...
2025-04-17 22:26:01,102 - INFO - Fama-French factors loaded
2025-04-17 22:26:01,102 - INFO - Processing factor data...
2025-04-17 22:26:01,104 - INFO - Factor data processed
2025-04-17 22:26:01,105 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:26:01,105 - INFO - 
Training Period:
2025-04-17 22:26:01,109 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:26:01,117 - INFO - 
Testing Period:
2025-04-17 22:26:01,121 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:26:01,128 - INFO - Loading macro and market data...
2025-04-17 22:26:01,129 - INFO - Loading existing macro data...
2025-04-17 22:26:01,139 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:01,139 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:01,142 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:01,142 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:01,143 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:01,144 - INFO - Loading existing macro data...
2025-04-17 22:26:01,153 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:01,154 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:01,157 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:01,157 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:01,157 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:01,158 - INFO - Loading existing market data...
2025-04-17 22:26:01,162 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:01,162 - INFO - Loading existing market data...
2025-04-17 22:26:01,165 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:01,165 - INFO - Macro and market data loaded
2025-04-17 22:26:01,165 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:01,166 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:01,166 - INFO - Loading existing macro data...
2025-04-17 22:26:01,176 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:01,176 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:01,179 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:01,179 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:01,179 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:01,180 - INFO - Loading existing market data...
2025-04-17 22:26:01,184 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:01,200 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:26:01,200 - INFO - Prepared training data with 1536 samples
2025-04-17 22:26:01,200 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:01,200 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:01,201 - INFO - Loading existing macro data...
2025-04-17 22:26:01,212 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:01,212 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:01,215 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:01,216 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:01,216 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:01,217 - INFO - Loading existing market data...
2025-04-17 22:26:01,220 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:01,230 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:26:01,231 - INFO - Prepared test data with 1276 samples
2025-04-17 22:26:01,231 - INFO - Test data prepared
2025-04-17 22:26:01,232 - INFO - Storing data...
2025-04-17 22:26:01,232 - INFO - Aligning data indices...
2025-04-17 22:26:01,233 - INFO - Data indices aligned
2025-04-17 22:26:01,234 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:26:01,234 - INFO - Data preparation completed
2025-04-17 22:26:01,234 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:26:01,234 - INFO - Training models...
2025-04-17 22:26:01,234 - INFO - Starting model training...
2025-04-17 22:26:01,235 - INFO - Training regime classifier...
2025-04-17 22:26:01,235 - INFO - Training XGBoost model...
2025-04-17 22:26:01,235 - INFO - Preparing features...
2025-04-17 22:26:01,235 - INFO - Input shape: (1536, 8)
2025-04-17 22:26:01,235 - INFO - Handling missing values...
2025-04-17 22:26:01,236 - INFO - Missing values: 0 -> 0
2025-04-17 22:26:01,236 - INFO - Scaling features...
2025-04-17 22:26:01,237 - INFO - Fitted new scaler
2025-04-17 22:26:01,238 - INFO - Output shape: (1536, 8)
2025-04-17 22:26:01,345 - INFO - XGBoost model training completed
2025-04-17 22:26:01,564 - INFO - Training neural portfolio optimizer...
2025-04-17 22:26:01,565 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:26:01,565 - INFO - Model training completed
2025-04-17 22:26:01,566 - INFO - Model training completed
2025-04-17 22:26:01,566 - INFO - Initializing portfolio weights...
2025-04-17 22:26:01,567 - INFO - Portfolio weights initialized
2025-04-17 22:26:01,567 - INFO - Generating regime predictions for test period...
2025-04-17 22:26:01,569 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:26:01,569 - ERROR - Error running xgboost with neural and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:26:01,570 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 3 regimes
2025-04-17 22:26:01,570 - INFO - Initializing strategy...
2025-04-17 22:26:01,571 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 22:26:01,571 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:26:01,571 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:26:01,572 - INFO - Running strategy...
2025-04-17 22:26:01,572 - INFO - Starting strategy execution...
2025-04-17 22:26:01,572 - INFO - Preparing training and testing data...
2025-04-17 22:26:01,572 - INFO - Starting data preparation...
2025-04-17 22:26:01,572 - INFO - Loading Fama-French factors...
2025-04-17 22:26:01,582 - INFO - Fama-French factors loaded
2025-04-17 22:26:01,582 - INFO - Processing factor data...
2025-04-17 22:26:01,584 - INFO - Factor data processed
2025-04-17 22:26:01,585 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:26:01,585 - INFO - 
Training Period:
2025-04-17 22:26:01,589 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:26:01,596 - INFO - 
Testing Period:
2025-04-17 22:26:01,601 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:26:01,608 - INFO - Loading macro and market data...
2025-04-17 22:26:01,609 - INFO - Loading existing macro data...
2025-04-17 22:26:01,620 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:01,620 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:01,623 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:01,623 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:01,623 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:01,624 - INFO - Loading existing macro data...
2025-04-17 22:26:01,634 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:01,635 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:01,637 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:01,638 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:01,638 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:01,639 - INFO - Loading existing market data...
2025-04-17 22:26:01,642 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:01,643 - INFO - Loading existing market data...
2025-04-17 22:26:01,646 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:01,647 - INFO - Macro and market data loaded
2025-04-17 22:26:01,647 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:01,647 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:01,648 - INFO - Loading existing macro data...
2025-04-17 22:26:01,657 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:01,657 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:01,660 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:01,660 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:01,660 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:01,661 - INFO - Loading existing market data...
2025-04-17 22:26:01,664 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:01,678 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:26:01,678 - INFO - Prepared training data with 1536 samples
2025-04-17 22:26:01,678 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:01,678 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:01,680 - INFO - Loading existing macro data...
2025-04-17 22:26:01,691 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:01,691 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:01,695 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:01,695 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:01,695 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:01,696 - INFO - Loading existing market data...
2025-04-17 22:26:01,700 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:01,709 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:26:01,709 - INFO - Prepared test data with 1276 samples
2025-04-17 22:26:01,710 - INFO - Test data prepared
2025-04-17 22:26:01,710 - INFO - Storing data...
2025-04-17 22:26:01,710 - INFO - Aligning data indices...
2025-04-17 22:26:01,711 - INFO - Data indices aligned
2025-04-17 22:26:01,711 - INFO - Data preparation completed
2025-04-17 22:26:01,711 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:26:01,711 - INFO - Training models...
2025-04-17 22:26:01,711 - INFO - Starting model training...
2025-04-17 22:26:01,711 - INFO - Training regime classifier...
2025-04-17 22:26:01,711 - INFO - Training HMM model...
2025-04-17 22:26:01,928 - INFO - HMM model training completed
2025-04-17 22:26:02,271 - INFO - Model training completed
2025-04-17 22:26:02,273 - INFO - Model training completed
2025-04-17 22:26:02,273 - INFO - Initializing portfolio weights...
2025-04-17 22:26:02,273 - INFO - Portfolio weights initialized
2025-04-17 22:26:02,274 - INFO - Generating regime predictions for test period...
2025-04-17 22:26:02,275 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:26:02,275 - ERROR - Error running hmm with mean_variance and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:26:02,277 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 5 regimes
2025-04-17 22:26:02,277 - INFO - Initializing strategy...
2025-04-17 22:26:02,277 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 22:26:02,277 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:26:02,278 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:26:02,278 - INFO - Running strategy...
2025-04-17 22:26:02,278 - INFO - Starting strategy execution...
2025-04-17 22:26:02,278 - INFO - Preparing training and testing data...
2025-04-17 22:26:02,278 - INFO - Starting data preparation...
2025-04-17 22:26:02,278 - INFO - Loading Fama-French factors...
2025-04-17 22:26:02,287 - INFO - Fama-French factors loaded
2025-04-17 22:26:02,288 - INFO - Processing factor data...
2025-04-17 22:26:02,290 - INFO - Factor data processed
2025-04-17 22:26:02,290 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:26:02,290 - INFO - 
Training Period:
2025-04-17 22:26:02,294 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:26:02,301 - INFO - 
Testing Period:
2025-04-17 22:26:02,305 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:26:02,312 - INFO - Loading macro and market data...
2025-04-17 22:26:02,313 - INFO - Loading existing macro data...
2025-04-17 22:26:02,322 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:02,323 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:02,326 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:02,326 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:02,326 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:02,327 - INFO - Loading existing macro data...
2025-04-17 22:26:02,337 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:02,337 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:02,340 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:02,340 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:02,340 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:02,342 - INFO - Loading existing market data...
2025-04-17 22:26:02,345 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:02,346 - INFO - Loading existing market data...
2025-04-17 22:26:02,349 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:02,349 - INFO - Macro and market data loaded
2025-04-17 22:26:02,349 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:02,349 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:02,350 - INFO - Loading existing macro data...
2025-04-17 22:26:02,360 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:02,360 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:02,363 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:02,363 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:02,363 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:02,364 - INFO - Loading existing market data...
2025-04-17 22:26:02,368 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:02,381 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:26:02,381 - INFO - Prepared training data with 1536 samples
2025-04-17 22:26:02,381 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:02,381 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:02,382 - INFO - Loading existing macro data...
2025-04-17 22:26:02,393 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:02,393 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:02,396 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:02,397 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:02,397 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:02,398 - INFO - Loading existing market data...
2025-04-17 22:26:02,401 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:02,410 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:26:02,411 - INFO - Prepared test data with 1276 samples
2025-04-17 22:26:02,411 - INFO - Test data prepared
2025-04-17 22:26:02,411 - INFO - Storing data...
2025-04-17 22:26:02,411 - INFO - Aligning data indices...
2025-04-17 22:26:02,413 - INFO - Data indices aligned
2025-04-17 22:26:02,414 - INFO - Data preparation completed
2025-04-17 22:26:02,414 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:26:02,414 - INFO - Training models...
2025-04-17 22:26:02,414 - INFO - Starting model training...
2025-04-17 22:26:02,414 - INFO - Training regime classifier...
2025-04-17 22:26:02,415 - INFO - Training HMM model...
2025-04-17 22:26:02,629 - INFO - HMM model training completed
2025-04-17 22:26:02,813 - INFO - Model training completed
2025-04-17 22:26:02,814 - INFO - Model training completed
2025-04-17 22:26:02,814 - INFO - Initializing portfolio weights...
2025-04-17 22:26:02,815 - INFO - Portfolio weights initialized
2025-04-17 22:26:02,815 - INFO - Generating regime predictions for test period...
2025-04-17 22:26:02,816 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:26:02,817 - ERROR - Error running hmm with mean_variance and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:26:02,818 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 7 regimes
2025-04-17 22:26:02,819 - INFO - Initializing strategy...
2025-04-17 22:26:02,819 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 22:26:02,819 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:26:02,819 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:26:02,819 - INFO - Running strategy...
2025-04-17 22:26:02,819 - INFO - Starting strategy execution...
2025-04-17 22:26:02,819 - INFO - Preparing training and testing data...
2025-04-17 22:26:02,819 - INFO - Starting data preparation...
2025-04-17 22:26:02,820 - INFO - Loading Fama-French factors...
2025-04-17 22:26:02,829 - INFO - Fama-French factors loaded
2025-04-17 22:26:02,829 - INFO - Processing factor data...
2025-04-17 22:26:02,831 - INFO - Factor data processed
2025-04-17 22:26:02,831 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:26:02,832 - INFO - 
Training Period:
2025-04-17 22:26:02,836 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:26:02,842 - INFO - 
Testing Period:
2025-04-17 22:26:02,846 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:26:02,854 - INFO - Loading macro and market data...
2025-04-17 22:26:02,855 - INFO - Loading existing macro data...
2025-04-17 22:26:02,865 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:02,865 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:02,868 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:02,869 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:02,869 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:02,870 - INFO - Loading existing macro data...
2025-04-17 22:26:02,879 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:02,879 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:02,882 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:02,882 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:02,882 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:02,883 - INFO - Loading existing market data...
2025-04-17 22:26:02,887 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:02,888 - INFO - Loading existing market data...
2025-04-17 22:26:02,891 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:02,891 - INFO - Macro and market data loaded
2025-04-17 22:26:02,891 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:02,891 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:02,892 - INFO - Loading existing macro data...
2025-04-17 22:26:02,901 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:02,901 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:02,903 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:02,904 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:02,904 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:02,905 - INFO - Loading existing market data...
2025-04-17 22:26:02,908 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:02,922 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:26:02,922 - INFO - Prepared training data with 1536 samples
2025-04-17 22:26:02,922 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:02,923 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:02,924 - INFO - Loading existing macro data...
2025-04-17 22:26:02,935 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:02,935 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:02,938 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:02,938 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:02,938 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:02,939 - INFO - Loading existing market data...
2025-04-17 22:26:02,942 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:02,951 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:26:02,951 - INFO - Prepared test data with 1276 samples
2025-04-17 22:26:02,952 - INFO - Test data prepared
2025-04-17 22:26:02,952 - INFO - Storing data...
2025-04-17 22:26:02,952 - INFO - Aligning data indices...
2025-04-17 22:26:02,953 - INFO - Data indices aligned
2025-04-17 22:26:02,953 - INFO - Data preparation completed
2025-04-17 22:26:02,954 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:26:02,954 - INFO - Training models...
2025-04-17 22:26:02,954 - INFO - Starting model training...
2025-04-17 22:26:02,954 - INFO - Training regime classifier...
2025-04-17 22:26:02,954 - INFO - Training HMM model...
2025-04-17 22:26:03,169 - INFO - HMM model training completed
2025-04-17 22:26:03,354 - INFO - Model training completed
2025-04-17 22:26:03,356 - INFO - Model training completed
2025-04-17 22:26:03,356 - INFO - Initializing portfolio weights...
2025-04-17 22:26:03,357 - INFO - Portfolio weights initialized
2025-04-17 22:26:03,357 - INFO - Generating regime predictions for test period...
2025-04-17 22:26:03,358 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:26:03,359 - ERROR - Error running hmm with mean_variance and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:26:03,360 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 3 regimes
2025-04-17 22:26:03,361 - INFO - Initializing strategy...
2025-04-17 22:26:03,361 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 22:26:03,361 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:26:03,361 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:26:03,361 - INFO - Running strategy...
2025-04-17 22:26:03,361 - INFO - Starting strategy execution...
2025-04-17 22:26:03,361 - INFO - Preparing training and testing data...
2025-04-17 22:26:03,362 - INFO - Starting data preparation...
2025-04-17 22:26:03,362 - INFO - Loading Fama-French factors...
2025-04-17 22:26:03,371 - INFO - Fama-French factors loaded
2025-04-17 22:26:03,371 - INFO - Processing factor data...
2025-04-17 22:26:03,373 - INFO - Factor data processed
2025-04-17 22:26:03,374 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:26:03,374 - INFO - 
Training Period:
2025-04-17 22:26:03,378 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:26:03,385 - INFO - 
Testing Period:
2025-04-17 22:26:03,390 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:26:03,397 - INFO - Loading macro and market data...
2025-04-17 22:26:03,398 - INFO - Loading existing macro data...
2025-04-17 22:26:03,408 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:03,408 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:03,411 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:03,412 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:03,412 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:03,413 - INFO - Loading existing macro data...
2025-04-17 22:26:03,423 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:03,423 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:03,426 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:03,426 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:03,426 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:03,427 - INFO - Loading existing market data...
2025-04-17 22:26:03,431 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:03,432 - INFO - Loading existing market data...
2025-04-17 22:26:03,435 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:03,435 - INFO - Macro and market data loaded
2025-04-17 22:26:03,435 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:03,435 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:03,436 - INFO - Loading existing macro data...
2025-04-17 22:26:03,445 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:03,446 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:03,448 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:03,448 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:03,449 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:03,450 - INFO - Loading existing market data...
2025-04-17 22:26:03,453 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:03,466 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:26:03,466 - INFO - Prepared training data with 1536 samples
2025-04-17 22:26:03,467 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:03,467 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:03,468 - INFO - Loading existing macro data...
2025-04-17 22:26:03,480 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:03,480 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:03,483 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:03,483 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:03,483 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:03,484 - INFO - Loading existing market data...
2025-04-17 22:26:03,488 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:03,498 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:26:03,498 - INFO - Prepared test data with 1276 samples
2025-04-17 22:26:03,498 - INFO - Test data prepared
2025-04-17 22:26:03,498 - INFO - Storing data...
2025-04-17 22:26:03,499 - INFO - Aligning data indices...
2025-04-17 22:26:03,500 - INFO - Data indices aligned
2025-04-17 22:26:03,500 - INFO - Data preparation completed
2025-04-17 22:26:03,500 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:26:03,500 - INFO - Training models...
2025-04-17 22:26:03,500 - INFO - Starting model training...
2025-04-17 22:26:03,501 - INFO - Training regime classifier...
2025-04-17 22:26:03,501 - INFO - Training HMM model...
2025-04-17 22:26:03,727 - INFO - HMM model training completed
2025-04-17 22:26:03,911 - INFO - Model training completed
2025-04-17 22:26:03,913 - INFO - Model training completed
2025-04-17 22:26:03,913 - INFO - Initializing portfolio weights...
2025-04-17 22:26:03,914 - INFO - Portfolio weights initialized
2025-04-17 22:26:03,914 - INFO - Generating regime predictions for test period...
2025-04-17 22:26:03,915 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:26:03,916 - ERROR - Error running hmm with regime_aware and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:26:03,917 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 5 regimes
2025-04-17 22:26:03,918 - INFO - Initializing strategy...
2025-04-17 22:26:03,918 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 22:26:03,918 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:26:03,918 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:26:03,918 - INFO - Running strategy...
2025-04-17 22:26:03,918 - INFO - Starting strategy execution...
2025-04-17 22:26:03,918 - INFO - Preparing training and testing data...
2025-04-17 22:26:03,919 - INFO - Starting data preparation...
2025-04-17 22:26:03,919 - INFO - Loading Fama-French factors...
2025-04-17 22:26:03,928 - INFO - Fama-French factors loaded
2025-04-17 22:26:03,929 - INFO - Processing factor data...
2025-04-17 22:26:03,931 - INFO - Factor data processed
2025-04-17 22:26:03,932 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:26:03,932 - INFO - 
Training Period:
2025-04-17 22:26:03,936 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:26:03,944 - INFO - 
Testing Period:
2025-04-17 22:26:03,947 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:26:03,955 - INFO - Loading macro and market data...
2025-04-17 22:26:03,956 - INFO - Loading existing macro data...
2025-04-17 22:26:03,966 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:03,966 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:03,969 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:03,969 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:03,969 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:03,971 - INFO - Loading existing macro data...
2025-04-17 22:26:03,981 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:03,981 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:03,984 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:03,984 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:03,984 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:03,985 - INFO - Loading existing market data...
2025-04-17 22:26:03,989 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:03,989 - INFO - Loading existing market data...
2025-04-17 22:26:03,992 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:03,992 - INFO - Macro and market data loaded
2025-04-17 22:26:03,993 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:03,993 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:03,993 - INFO - Loading existing macro data...
2025-04-17 22:26:04,002 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:04,003 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:04,005 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:04,006 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:04,006 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:04,007 - INFO - Loading existing market data...
2025-04-17 22:26:04,010 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:04,022 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:26:04,022 - INFO - Prepared training data with 1536 samples
2025-04-17 22:26:04,022 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:04,022 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:04,023 - INFO - Loading existing macro data...
2025-04-17 22:26:04,035 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:04,036 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:04,039 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:04,039 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:04,039 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:04,040 - INFO - Loading existing market data...
2025-04-17 22:26:04,043 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:04,052 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:26:04,052 - INFO - Prepared test data with 1276 samples
2025-04-17 22:26:04,053 - INFO - Test data prepared
2025-04-17 22:26:04,053 - INFO - Storing data...
2025-04-17 22:26:04,053 - INFO - Aligning data indices...
2025-04-17 22:26:04,054 - INFO - Data indices aligned
2025-04-17 22:26:04,054 - INFO - Data preparation completed
2025-04-17 22:26:04,055 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:26:04,055 - INFO - Training models...
2025-04-17 22:26:04,055 - INFO - Starting model training...
2025-04-17 22:26:04,055 - INFO - Training regime classifier...
2025-04-17 22:26:04,055 - INFO - Training HMM model...
2025-04-17 22:26:04,238 - WARNING - Model is not converging.  Current: 6604.339029598852 is not greater than 21507.424263679746. Delta is -14903.085234080894
2025-04-17 22:26:04,239 - INFO - HMM model training completed
2025-04-17 22:26:04,420 - INFO - Model training completed
2025-04-17 22:26:04,422 - INFO - Model training completed
2025-04-17 22:26:04,422 - INFO - Initializing portfolio weights...
2025-04-17 22:26:04,422 - INFO - Portfolio weights initialized
2025-04-17 22:26:04,423 - INFO - Generating regime predictions for test period...
2025-04-17 22:26:04,424 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:26:04,425 - ERROR - Error running hmm with regime_aware and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:26:04,426 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 7 regimes
2025-04-17 22:26:04,426 - INFO - Initializing strategy...
2025-04-17 22:26:04,426 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 22:26:04,426 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:26:04,427 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:26:04,427 - INFO - Running strategy...
2025-04-17 22:26:04,427 - INFO - Starting strategy execution...
2025-04-17 22:26:04,427 - INFO - Preparing training and testing data...
2025-04-17 22:26:04,427 - INFO - Starting data preparation...
2025-04-17 22:26:04,427 - INFO - Loading Fama-French factors...
2025-04-17 22:26:04,437 - INFO - Fama-French factors loaded
2025-04-17 22:26:04,437 - INFO - Processing factor data...
2025-04-17 22:26:04,439 - INFO - Factor data processed
2025-04-17 22:26:04,439 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:26:04,439 - INFO - 
Training Period:
2025-04-17 22:26:04,444 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:26:04,451 - INFO - 
Testing Period:
2025-04-17 22:26:04,455 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:26:04,461 - INFO - Loading macro and market data...
2025-04-17 22:26:04,462 - INFO - Loading existing macro data...
2025-04-17 22:26:04,472 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:04,472 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:04,475 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:04,475 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:04,476 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:04,476 - INFO - Loading existing macro data...
2025-04-17 22:26:04,485 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:04,486 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:04,488 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:04,489 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:04,489 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:04,490 - INFO - Loading existing market data...
2025-04-17 22:26:04,494 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:04,495 - INFO - Loading existing market data...
2025-04-17 22:26:04,498 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:04,498 - INFO - Macro and market data loaded
2025-04-17 22:26:04,499 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:04,499 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:04,500 - INFO - Loading existing macro data...
2025-04-17 22:26:04,509 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:04,509 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:04,512 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:04,512 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:04,513 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:04,514 - INFO - Loading existing market data...
2025-04-17 22:26:04,517 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:04,529 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:26:04,530 - INFO - Prepared training data with 1536 samples
2025-04-17 22:26:04,530 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:04,530 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:04,531 - INFO - Loading existing macro data...
2025-04-17 22:26:04,543 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:04,543 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:04,547 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:04,547 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:04,547 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:04,548 - INFO - Loading existing market data...
2025-04-17 22:26:04,551 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:04,560 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:26:04,561 - INFO - Prepared test data with 1276 samples
2025-04-17 22:26:04,561 - INFO - Test data prepared
2025-04-17 22:26:04,562 - INFO - Storing data...
2025-04-17 22:26:04,562 - INFO - Aligning data indices...
2025-04-17 22:26:04,563 - INFO - Data indices aligned
2025-04-17 22:26:04,563 - INFO - Data preparation completed
2025-04-17 22:26:04,563 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:26:04,563 - INFO - Training models...
2025-04-17 22:26:04,564 - INFO - Starting model training...
2025-04-17 22:26:04,564 - INFO - Training regime classifier...
2025-04-17 22:26:04,564 - INFO - Training HMM model...
2025-04-17 22:26:04,779 - INFO - HMM model training completed
2025-04-17 22:26:04,964 - INFO - Model training completed
2025-04-17 22:26:04,966 - INFO - Model training completed
2025-04-17 22:26:04,967 - INFO - Initializing portfolio weights...
2025-04-17 22:26:04,967 - INFO - Portfolio weights initialized
2025-04-17 22:26:04,967 - INFO - Generating regime predictions for test period...
2025-04-17 22:26:04,969 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:26:04,969 - ERROR - Error running hmm with regime_aware and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:26:04,971 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 3 regimes
2025-04-17 22:26:04,971 - INFO - Initializing strategy...
2025-04-17 22:26:04,971 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 22:26:04,971 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:26:04,971 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:26:04,972 - INFO - Running strategy...
2025-04-17 22:26:04,972 - INFO - Starting strategy execution...
2025-04-17 22:26:04,972 - INFO - Preparing training and testing data...
2025-04-17 22:26:04,972 - INFO - Starting data preparation...
2025-04-17 22:26:04,972 - INFO - Loading Fama-French factors...
2025-04-17 22:26:04,981 - INFO - Fama-French factors loaded
2025-04-17 22:26:04,981 - INFO - Processing factor data...
2025-04-17 22:26:04,983 - INFO - Factor data processed
2025-04-17 22:26:04,984 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:26:04,984 - INFO - 
Training Period:
2025-04-17 22:26:04,988 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:26:04,995 - INFO - 
Testing Period:
2025-04-17 22:26:04,999 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:26:05,005 - INFO - Loading macro and market data...
2025-04-17 22:26:05,006 - INFO - Loading existing macro data...
2025-04-17 22:26:05,016 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:05,016 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:05,019 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:05,019 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:05,020 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:05,020 - INFO - Loading existing macro data...
2025-04-17 22:26:05,029 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:05,029 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:05,032 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:05,032 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:05,032 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:05,033 - INFO - Loading existing market data...
2025-04-17 22:26:05,037 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:05,038 - INFO - Loading existing market data...
2025-04-17 22:26:05,041 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:05,041 - INFO - Macro and market data loaded
2025-04-17 22:26:05,041 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:05,041 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:05,042 - INFO - Loading existing macro data...
2025-04-17 22:26:05,051 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:05,051 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:05,054 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:05,054 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:05,054 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:05,055 - INFO - Loading existing market data...
2025-04-17 22:26:05,059 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:05,071 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:26:05,071 - INFO - Prepared training data with 1536 samples
2025-04-17 22:26:05,071 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:05,072 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:05,073 - INFO - Loading existing macro data...
2025-04-17 22:26:05,083 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:05,083 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:05,086 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:05,086 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:05,087 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:05,088 - INFO - Loading existing market data...
2025-04-17 22:26:05,091 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:05,102 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:26:05,102 - INFO - Prepared test data with 1276 samples
2025-04-17 22:26:05,102 - INFO - Test data prepared
2025-04-17 22:26:05,103 - INFO - Storing data...
2025-04-17 22:26:05,103 - INFO - Aligning data indices...
2025-04-17 22:26:05,104 - INFO - Data indices aligned
2025-04-17 22:26:05,104 - INFO - Data preparation completed
2025-04-17 22:26:05,104 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:26:05,104 - INFO - Training models...
2025-04-17 22:26:05,105 - INFO - Starting model training...
2025-04-17 22:26:05,105 - INFO - Training regime classifier...
2025-04-17 22:26:05,105 - INFO - Training HMM model...
2025-04-17 22:26:05,320 - INFO - HMM model training completed
2025-04-17 22:26:05,503 - INFO - Model training completed
2025-04-17 22:26:05,505 - INFO - Model training completed
2025-04-17 22:26:05,505 - INFO - Initializing portfolio weights...
2025-04-17 22:26:05,506 - INFO - Portfolio weights initialized
2025-04-17 22:26:05,506 - INFO - Generating regime predictions for test period...
2025-04-17 22:26:05,507 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:26:05,508 - ERROR - Error running hmm with neural_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:26:05,509 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 5 regimes
2025-04-17 22:26:05,509 - INFO - Initializing strategy...
2025-04-17 22:26:05,510 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 22:26:05,510 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:26:05,510 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:26:05,510 - INFO - Running strategy...
2025-04-17 22:26:05,510 - INFO - Starting strategy execution...
2025-04-17 22:26:05,510 - INFO - Preparing training and testing data...
2025-04-17 22:26:05,510 - INFO - Starting data preparation...
2025-04-17 22:26:05,511 - INFO - Loading Fama-French factors...
2025-04-17 22:26:05,520 - INFO - Fama-French factors loaded
2025-04-17 22:26:05,520 - INFO - Processing factor data...
2025-04-17 22:26:05,522 - INFO - Factor data processed
2025-04-17 22:26:05,522 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:26:05,523 - INFO - 
Training Period:
2025-04-17 22:26:05,526 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:26:05,534 - INFO - 
Testing Period:
2025-04-17 22:26:05,537 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:26:05,544 - INFO - Loading macro and market data...
2025-04-17 22:26:05,545 - INFO - Loading existing macro data...
2025-04-17 22:26:05,555 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:05,555 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:05,558 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:05,558 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:05,559 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:05,560 - INFO - Loading existing macro data...
2025-04-17 22:26:05,569 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:05,569 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:05,572 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:05,572 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:05,572 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:05,573 - INFO - Loading existing market data...
2025-04-17 22:26:05,577 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:05,578 - INFO - Loading existing market data...
2025-04-17 22:26:05,581 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:05,581 - INFO - Macro and market data loaded
2025-04-17 22:26:05,581 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:05,581 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:05,582 - INFO - Loading existing macro data...
2025-04-17 22:26:05,591 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:05,591 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:05,594 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:05,594 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:05,595 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:05,596 - INFO - Loading existing market data...
2025-04-17 22:26:05,599 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:05,612 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:26:05,613 - INFO - Prepared training data with 1536 samples
2025-04-17 22:26:05,613 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:05,613 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:05,614 - INFO - Loading existing macro data...
2025-04-17 22:26:05,626 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:05,627 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:05,630 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:05,630 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:05,630 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:05,631 - INFO - Loading existing market data...
2025-04-17 22:26:05,635 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:05,645 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:26:05,645 - INFO - Prepared test data with 1276 samples
2025-04-17 22:26:05,645 - INFO - Test data prepared
2025-04-17 22:26:05,645 - INFO - Storing data...
2025-04-17 22:26:05,646 - INFO - Aligning data indices...
2025-04-17 22:26:05,647 - INFO - Data indices aligned
2025-04-17 22:26:05,647 - INFO - Data preparation completed
2025-04-17 22:26:05,647 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:26:05,647 - INFO - Training models...
2025-04-17 22:26:05,647 - INFO - Starting model training...
2025-04-17 22:26:05,647 - INFO - Training regime classifier...
2025-04-17 22:26:05,648 - INFO - Training HMM model...
2025-04-17 22:26:05,866 - INFO - HMM model training completed
2025-04-17 22:26:06,047 - INFO - Model training completed
2025-04-17 22:26:06,048 - INFO - Model training completed
2025-04-17 22:26:06,049 - INFO - Initializing portfolio weights...
2025-04-17 22:26:06,049 - INFO - Portfolio weights initialized
2025-04-17 22:26:06,049 - INFO - Generating regime predictions for test period...
2025-04-17 22:26:06,051 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:26:06,051 - ERROR - Error running hmm with neural_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:26:06,052 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 7 regimes
2025-04-17 22:26:06,053 - INFO - Initializing strategy...
2025-04-17 22:26:06,053 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 22:26:06,053 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:26:06,053 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:26:06,054 - INFO - Running strategy...
2025-04-17 22:26:06,054 - INFO - Starting strategy execution...
2025-04-17 22:26:06,054 - INFO - Preparing training and testing data...
2025-04-17 22:26:06,054 - INFO - Starting data preparation...
2025-04-17 22:26:06,054 - INFO - Loading Fama-French factors...
2025-04-17 22:26:06,063 - INFO - Fama-French factors loaded
2025-04-17 22:26:06,063 - INFO - Processing factor data...
2025-04-17 22:26:06,065 - INFO - Factor data processed
2025-04-17 22:26:06,066 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:26:06,066 - INFO - 
Training Period:
2025-04-17 22:26:06,070 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:26:06,077 - INFO - 
Testing Period:
2025-04-17 22:26:06,081 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:26:06,088 - INFO - Loading macro and market data...
2025-04-17 22:26:06,089 - INFO - Loading existing macro data...
2025-04-17 22:26:06,098 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:06,099 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:06,101 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:06,102 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:06,102 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:06,103 - INFO - Loading existing macro data...
2025-04-17 22:26:06,112 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:06,112 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:06,115 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:06,115 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:06,115 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:06,116 - INFO - Loading existing market data...
2025-04-17 22:26:06,120 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:06,121 - INFO - Loading existing market data...
2025-04-17 22:26:06,123 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:06,123 - INFO - Macro and market data loaded
2025-04-17 22:26:06,124 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:06,124 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:06,124 - INFO - Loading existing macro data...
2025-04-17 22:26:06,133 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:06,133 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:06,136 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:06,136 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:06,137 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:06,138 - INFO - Loading existing market data...
2025-04-17 22:26:06,141 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:06,153 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:26:06,153 - INFO - Prepared training data with 1536 samples
2025-04-17 22:26:06,154 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:06,154 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:06,155 - INFO - Loading existing macro data...
2025-04-17 22:26:06,167 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:06,167 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:06,170 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:06,170 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:06,170 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:06,171 - INFO - Loading existing market data...
2025-04-17 22:26:06,174 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:06,183 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:26:06,183 - INFO - Prepared test data with 1276 samples
2025-04-17 22:26:06,184 - INFO - Test data prepared
2025-04-17 22:26:06,184 - INFO - Storing data...
2025-04-17 22:26:06,184 - INFO - Aligning data indices...
2025-04-17 22:26:06,185 - INFO - Data indices aligned
2025-04-17 22:26:06,185 - INFO - Data preparation completed
2025-04-17 22:26:06,186 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:26:06,186 - INFO - Training models...
2025-04-17 22:26:06,186 - INFO - Starting model training...
2025-04-17 22:26:06,186 - INFO - Training regime classifier...
2025-04-17 22:26:06,186 - INFO - Training HMM model...
2025-04-17 22:26:06,404 - INFO - HMM model training completed
2025-04-17 22:26:06,590 - INFO - Model training completed
2025-04-17 22:26:06,592 - INFO - Model training completed
2025-04-17 22:26:06,592 - INFO - Initializing portfolio weights...
2025-04-17 22:26:06,593 - INFO - Portfolio weights initialized
2025-04-17 22:26:06,593 - INFO - Generating regime predictions for test period...
2025-04-17 22:26:06,594 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:26:06,595 - ERROR - Error running hmm with neural_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:26:06,596 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 22:26:06,596 - INFO - Initializing strategy...
2025-04-17 22:26:06,596 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 22:26:06,597 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:26:06,597 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:26:06,597 - INFO - Running strategy...
2025-04-17 22:26:06,597 - INFO - Starting strategy execution...
2025-04-17 22:26:06,597 - INFO - Preparing training and testing data...
2025-04-17 22:26:06,597 - INFO - Starting data preparation...
2025-04-17 22:26:06,597 - INFO - Loading Fama-French factors...
2025-04-17 22:26:06,607 - INFO - Fama-French factors loaded
2025-04-17 22:26:06,607 - INFO - Processing factor data...
2025-04-17 22:26:06,609 - INFO - Factor data processed
2025-04-17 22:26:06,609 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:26:06,609 - INFO - 
Training Period:
2025-04-17 22:26:06,613 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:26:06,620 - INFO - 
Testing Period:
2025-04-17 22:26:06,624 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:26:06,631 - INFO - Loading macro and market data...
2025-04-17 22:26:06,632 - INFO - Loading existing macro data...
2025-04-17 22:26:06,642 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:06,642 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:06,645 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:06,645 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:06,646 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:06,646 - INFO - Loading existing macro data...
2025-04-17 22:26:06,655 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:06,656 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:06,658 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:06,659 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:06,659 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:06,660 - INFO - Loading existing market data...
2025-04-17 22:26:06,663 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:06,664 - INFO - Loading existing market data...
2025-04-17 22:26:06,667 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:06,667 - INFO - Macro and market data loaded
2025-04-17 22:26:06,667 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:06,667 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:06,668 - INFO - Loading existing macro data...
2025-04-17 22:26:06,677 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:06,679 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:06,682 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:06,682 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:06,682 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:06,683 - INFO - Loading existing market data...
2025-04-17 22:26:06,686 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:06,699 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:26:06,699 - INFO - Prepared training data with 1536 samples
2025-04-17 22:26:06,699 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:06,700 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:06,701 - INFO - Loading existing macro data...
2025-04-17 22:26:06,714 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:06,714 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:06,717 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:06,718 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:06,718 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:06,719 - INFO - Loading existing market data...
2025-04-17 22:26:06,723 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:06,733 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:26:06,733 - INFO - Prepared test data with 1276 samples
2025-04-17 22:26:06,734 - INFO - Test data prepared
2025-04-17 22:26:06,734 - INFO - Storing data...
2025-04-17 22:26:06,734 - INFO - Aligning data indices...
2025-04-17 22:26:06,735 - INFO - Data indices aligned
2025-04-17 22:26:06,736 - INFO - Data preparation completed
2025-04-17 22:26:06,736 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:26:06,736 - INFO - Training models...
2025-04-17 22:26:06,736 - INFO - Starting model training...
2025-04-17 22:26:06,737 - INFO - Training regime classifier...
2025-04-17 22:26:06,737 - INFO - Training HMM model...
2025-04-17 22:26:06,957 - INFO - HMM model training completed
2025-04-17 22:26:07,134 - INFO - Model training completed
2025-04-17 22:26:07,135 - INFO - Model training completed
2025-04-17 22:26:07,135 - INFO - Initializing portfolio weights...
2025-04-17 22:26:07,136 - INFO - Portfolio weights initialized
2025-04-17 22:26:07,136 - INFO - Generating regime predictions for test period...
2025-04-17 22:26:07,137 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:26:07,138 - ERROR - Error running hmm with autoencoder_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:26:07,139 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 22:26:07,139 - INFO - Initializing strategy...
2025-04-17 22:26:07,140 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 22:26:07,140 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:26:07,140 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:26:07,140 - INFO - Running strategy...
2025-04-17 22:26:07,140 - INFO - Starting strategy execution...
2025-04-17 22:26:07,140 - INFO - Preparing training and testing data...
2025-04-17 22:26:07,141 - INFO - Starting data preparation...
2025-04-17 22:26:07,141 - INFO - Loading Fama-French factors...
2025-04-17 22:26:07,150 - INFO - Fama-French factors loaded
2025-04-17 22:26:07,150 - INFO - Processing factor data...
2025-04-17 22:26:07,153 - INFO - Factor data processed
2025-04-17 22:26:07,153 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:26:07,153 - INFO - 
Training Period:
2025-04-17 22:26:07,157 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:26:07,165 - INFO - 
Testing Period:
2025-04-17 22:26:07,169 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:26:07,177 - INFO - Loading macro and market data...
2025-04-17 22:26:07,178 - INFO - Loading existing macro data...
2025-04-17 22:26:07,189 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:07,189 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:07,192 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:07,192 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:07,193 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:07,194 - INFO - Loading existing macro data...
2025-04-17 22:26:07,203 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:07,203 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:07,206 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:07,207 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:07,207 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:07,208 - INFO - Loading existing market data...
2025-04-17 22:26:07,212 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:07,213 - INFO - Loading existing market data...
2025-04-17 22:26:07,216 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:07,216 - INFO - Macro and market data loaded
2025-04-17 22:26:07,217 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:07,217 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:07,218 - INFO - Loading existing macro data...
2025-04-17 22:26:07,228 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:07,228 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:07,231 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:07,231 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:07,231 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:07,233 - INFO - Loading existing market data...
2025-04-17 22:26:07,236 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:07,250 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:26:07,250 - INFO - Prepared training data with 1536 samples
2025-04-17 22:26:07,250 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:07,251 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:07,252 - INFO - Loading existing macro data...
2025-04-17 22:26:07,264 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:07,264 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:07,267 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:07,267 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:07,267 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:07,269 - INFO - Loading existing market data...
2025-04-17 22:26:07,272 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:07,281 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:26:07,281 - INFO - Prepared test data with 1276 samples
2025-04-17 22:26:07,282 - INFO - Test data prepared
2025-04-17 22:26:07,282 - INFO - Storing data...
2025-04-17 22:26:07,282 - INFO - Aligning data indices...
2025-04-17 22:26:07,283 - INFO - Data indices aligned
2025-04-17 22:26:07,284 - INFO - Data preparation completed
2025-04-17 22:26:07,284 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:26:07,284 - INFO - Training models...
2025-04-17 22:26:07,284 - INFO - Starting model training...
2025-04-17 22:26:07,284 - INFO - Training regime classifier...
2025-04-17 22:26:07,284 - INFO - Training HMM model...
2025-04-17 22:26:07,502 - INFO - HMM model training completed
2025-04-17 22:26:07,685 - INFO - Model training completed
2025-04-17 22:26:07,687 - INFO - Model training completed
2025-04-17 22:26:07,687 - INFO - Initializing portfolio weights...
2025-04-17 22:26:07,688 - INFO - Portfolio weights initialized
2025-04-17 22:26:07,688 - INFO - Generating regime predictions for test period...
2025-04-17 22:26:07,689 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:26:07,690 - ERROR - Error running hmm with autoencoder_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:26:07,691 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 22:26:07,691 - INFO - Initializing strategy...
2025-04-17 22:26:07,692 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 22:26:07,692 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:26:07,692 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:26:07,692 - INFO - Running strategy...
2025-04-17 22:26:07,692 - INFO - Starting strategy execution...
2025-04-17 22:26:07,692 - INFO - Preparing training and testing data...
2025-04-17 22:26:07,692 - INFO - Starting data preparation...
2025-04-17 22:26:07,693 - INFO - Loading Fama-French factors...
2025-04-17 22:26:07,702 - INFO - Fama-French factors loaded
2025-04-17 22:26:07,702 - INFO - Processing factor data...
2025-04-17 22:26:07,704 - INFO - Factor data processed
2025-04-17 22:26:07,704 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:26:07,704 - INFO - 
Training Period:
2025-04-17 22:26:07,708 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:26:07,715 - INFO - 
Testing Period:
2025-04-17 22:26:07,720 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:26:07,726 - INFO - Loading macro and market data...
2025-04-17 22:26:07,727 - INFO - Loading existing macro data...
2025-04-17 22:26:07,737 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:07,738 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:07,740 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:07,741 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:07,741 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:07,742 - INFO - Loading existing macro data...
2025-04-17 22:26:07,751 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:07,751 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:07,754 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:07,754 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:07,754 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:07,755 - INFO - Loading existing market data...
2025-04-17 22:26:07,759 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:07,760 - INFO - Loading existing market data...
2025-04-17 22:26:07,762 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:07,763 - INFO - Macro and market data loaded
2025-04-17 22:26:07,763 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:07,763 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:07,764 - INFO - Loading existing macro data...
2025-04-17 22:26:07,772 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:07,773 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:07,776 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:07,776 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:07,776 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:07,777 - INFO - Loading existing market data...
2025-04-17 22:26:07,781 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:07,793 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:26:07,793 - INFO - Prepared training data with 1536 samples
2025-04-17 22:26:07,794 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:07,794 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:07,795 - INFO - Loading existing macro data...
2025-04-17 22:26:07,805 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:07,805 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:07,808 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:07,808 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:07,808 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:07,809 - INFO - Loading existing market data...
2025-04-17 22:26:07,813 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:07,824 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:26:07,824 - INFO - Prepared test data with 1276 samples
2025-04-17 22:26:07,824 - INFO - Test data prepared
2025-04-17 22:26:07,825 - INFO - Storing data...
2025-04-17 22:26:07,825 - INFO - Aligning data indices...
2025-04-17 22:26:07,826 - INFO - Data indices aligned
2025-04-17 22:26:07,827 - INFO - Data preparation completed
2025-04-17 22:26:07,827 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:26:07,827 - INFO - Training models...
2025-04-17 22:26:07,827 - INFO - Starting model training...
2025-04-17 22:26:07,827 - INFO - Training regime classifier...
2025-04-17 22:26:07,828 - INFO - Training HMM model...
2025-04-17 22:26:08,045 - INFO - HMM model training completed
2025-04-17 22:26:08,229 - INFO - Model training completed
2025-04-17 22:26:08,231 - INFO - Model training completed
2025-04-17 22:26:08,231 - INFO - Initializing portfolio weights...
2025-04-17 22:26:08,232 - INFO - Portfolio weights initialized
2025-04-17 22:26:08,232 - INFO - Generating regime predictions for test period...
2025-04-17 22:26:08,233 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:26:08,234 - ERROR - Error running hmm with autoencoder_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:26:08,236 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 3 regimes
2025-04-17 22:26:08,236 - INFO - Initializing strategy...
2025-04-17 22:26:08,236 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 22:26:08,236 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:26:08,236 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:26:08,237 - INFO - Running strategy...
2025-04-17 22:26:08,237 - INFO - Starting strategy execution...
2025-04-17 22:26:08,237 - INFO - Preparing training and testing data...
2025-04-17 22:26:08,237 - INFO - Starting data preparation...
2025-04-17 22:26:08,237 - INFO - Loading Fama-French factors...
2025-04-17 22:26:08,246 - INFO - Fama-French factors loaded
2025-04-17 22:26:08,247 - INFO - Processing factor data...
2025-04-17 22:26:08,249 - INFO - Factor data processed
2025-04-17 22:26:08,249 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:26:08,249 - INFO - 
Training Period:
2025-04-17 22:26:08,253 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:26:08,260 - INFO - 
Testing Period:
2025-04-17 22:26:08,265 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:26:08,272 - INFO - Loading macro and market data...
2025-04-17 22:26:08,273 - INFO - Loading existing macro data...
2025-04-17 22:26:08,283 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:08,283 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:08,286 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:08,286 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:08,287 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:08,288 - INFO - Loading existing macro data...
2025-04-17 22:26:08,298 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:08,298 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:08,301 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:08,301 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:08,301 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:08,302 - INFO - Loading existing market data...
2025-04-17 22:26:08,306 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:08,307 - INFO - Loading existing market data...
2025-04-17 22:26:08,310 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:08,310 - INFO - Macro and market data loaded
2025-04-17 22:26:08,310 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:08,310 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:08,311 - INFO - Loading existing macro data...
2025-04-17 22:26:08,321 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:08,321 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:08,324 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:08,324 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:08,324 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:08,325 - INFO - Loading existing market data...
2025-04-17 22:26:08,328 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:08,341 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:26:08,341 - INFO - Prepared training data with 1536 samples
2025-04-17 22:26:08,342 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:08,342 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:08,343 - INFO - Loading existing macro data...
2025-04-17 22:26:08,354 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:08,354 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:08,357 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:08,357 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:08,357 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:08,358 - INFO - Loading existing market data...
2025-04-17 22:26:08,361 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:08,369 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:26:08,370 - INFO - Prepared test data with 1276 samples
2025-04-17 22:26:08,370 - INFO - Test data prepared
2025-04-17 22:26:08,370 - INFO - Storing data...
2025-04-17 22:26:08,370 - INFO - Aligning data indices...
2025-04-17 22:26:08,371 - INFO - Data indices aligned
2025-04-17 22:26:08,372 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:26:08,372 - INFO - Data preparation completed
2025-04-17 22:26:08,373 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:26:08,373 - INFO - Training models...
2025-04-17 22:26:08,373 - INFO - Starting model training...
2025-04-17 22:26:08,373 - INFO - Training regime classifier...
2025-04-17 22:26:08,373 - INFO - Training HMM model...
2025-04-17 22:26:08,586 - INFO - HMM model training completed
2025-04-17 22:26:08,768 - INFO - Training neural portfolio optimizer...
2025-04-17 22:26:08,768 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:26:08,768 - INFO - Model training completed
2025-04-17 22:26:08,770 - INFO - Model training completed
2025-04-17 22:26:08,770 - INFO - Initializing portfolio weights...
2025-04-17 22:26:08,770 - INFO - Portfolio weights initialized
2025-04-17 22:26:08,771 - INFO - Generating regime predictions for test period...
2025-04-17 22:26:08,772 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:26:08,773 - ERROR - Error running hmm with neural and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:26:08,774 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 5 regimes
2025-04-17 22:26:08,774 - INFO - Initializing strategy...
2025-04-17 22:26:08,774 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 22:26:08,775 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:26:08,775 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:26:08,775 - INFO - Running strategy...
2025-04-17 22:26:08,776 - INFO - Starting strategy execution...
2025-04-17 22:26:08,776 - INFO - Preparing training and testing data...
2025-04-17 22:26:08,776 - INFO - Starting data preparation...
2025-04-17 22:26:08,776 - INFO - Loading Fama-French factors...
2025-04-17 22:26:08,785 - INFO - Fama-French factors loaded
2025-04-17 22:26:08,786 - INFO - Processing factor data...
2025-04-17 22:26:08,788 - INFO - Factor data processed
2025-04-17 22:26:08,788 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:26:08,788 - INFO - 
Training Period:
2025-04-17 22:26:08,792 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:26:08,799 - INFO - 
Testing Period:
2025-04-17 22:26:08,803 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:26:08,810 - INFO - Loading macro and market data...
2025-04-17 22:26:08,812 - INFO - Loading existing macro data...
2025-04-17 22:26:08,822 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:08,823 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:08,826 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:08,826 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:08,827 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:08,828 - INFO - Loading existing macro data...
2025-04-17 22:26:08,837 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:08,837 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:08,840 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:08,840 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:08,840 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:08,841 - INFO - Loading existing market data...
2025-04-17 22:26:08,845 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:08,846 - INFO - Loading existing market data...
2025-04-17 22:26:08,849 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:08,849 - INFO - Macro and market data loaded
2025-04-17 22:26:08,849 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:08,849 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:08,850 - INFO - Loading existing macro data...
2025-04-17 22:26:08,859 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:08,859 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:08,862 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:08,862 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:08,862 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:08,863 - INFO - Loading existing market data...
2025-04-17 22:26:08,866 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:08,878 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:26:08,878 - INFO - Prepared training data with 1536 samples
2025-04-17 22:26:08,879 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:08,879 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:08,880 - INFO - Loading existing macro data...
2025-04-17 22:26:08,891 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:08,892 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:08,895 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:08,895 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:08,895 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:08,896 - INFO - Loading existing market data...
2025-04-17 22:26:08,899 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:08,908 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:26:08,908 - INFO - Prepared test data with 1276 samples
2025-04-17 22:26:08,909 - INFO - Test data prepared
2025-04-17 22:26:08,909 - INFO - Storing data...
2025-04-17 22:26:08,909 - INFO - Aligning data indices...
2025-04-17 22:26:08,910 - INFO - Data indices aligned
2025-04-17 22:26:08,911 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:26:08,911 - INFO - Data preparation completed
2025-04-17 22:26:08,911 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:26:08,911 - INFO - Training models...
2025-04-17 22:26:08,911 - INFO - Starting model training...
2025-04-17 22:26:08,911 - INFO - Training regime classifier...
2025-04-17 22:26:08,911 - INFO - Training HMM model...
2025-04-17 22:26:09,131 - INFO - HMM model training completed
2025-04-17 22:26:09,314 - INFO - Training neural portfolio optimizer...
2025-04-17 22:26:09,314 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:26:09,315 - INFO - Model training completed
2025-04-17 22:26:09,316 - INFO - Model training completed
2025-04-17 22:26:09,316 - INFO - Initializing portfolio weights...
2025-04-17 22:26:09,317 - INFO - Portfolio weights initialized
2025-04-17 22:26:09,317 - INFO - Generating regime predictions for test period...
2025-04-17 22:26:09,318 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:26:09,319 - ERROR - Error running hmm with neural and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:26:09,320 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 7 regimes
2025-04-17 22:26:09,321 - INFO - Initializing strategy...
2025-04-17 22:26:09,321 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 22:26:09,321 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:26:09,321 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:26:09,322 - INFO - Running strategy...
2025-04-17 22:26:09,322 - INFO - Starting strategy execution...
2025-04-17 22:26:09,322 - INFO - Preparing training and testing data...
2025-04-17 22:26:09,322 - INFO - Starting data preparation...
2025-04-17 22:26:09,322 - INFO - Loading Fama-French factors...
2025-04-17 22:26:09,331 - INFO - Fama-French factors loaded
2025-04-17 22:26:09,332 - INFO - Processing factor data...
2025-04-17 22:26:09,334 - INFO - Factor data processed
2025-04-17 22:26:09,334 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:26:09,334 - INFO - 
Training Period:
2025-04-17 22:26:09,338 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:26:09,345 - INFO - 
Testing Period:
2025-04-17 22:26:09,350 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:26:09,357 - INFO - Loading macro and market data...
2025-04-17 22:26:09,358 - INFO - Loading existing macro data...
2025-04-17 22:26:09,368 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:09,368 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:09,371 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:09,371 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:09,371 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:09,372 - INFO - Loading existing macro data...
2025-04-17 22:26:09,381 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:09,381 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:09,384 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:09,384 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:09,384 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:09,385 - INFO - Loading existing market data...
2025-04-17 22:26:09,389 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:09,390 - INFO - Loading existing market data...
2025-04-17 22:26:09,392 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:09,393 - INFO - Macro and market data loaded
2025-04-17 22:26:09,393 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:09,393 - INFO - Preparing training data for regime classification...
2025-04-17 22:26:09,394 - INFO - Loading existing macro data...
2025-04-17 22:26:09,403 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:09,403 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:09,406 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:09,406 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:26:09,406 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:26:09,407 - INFO - Loading existing market data...
2025-04-17 22:26:09,411 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:26:09,423 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:26:09,423 - INFO - Prepared training data with 1536 samples
2025-04-17 22:26:09,423 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:09,424 - INFO - Preparing test data for regime classification...
2025-04-17 22:26:09,425 - INFO - Loading existing macro data...
2025-04-17 22:26:09,435 - WARNING - US corporate credit spread file not found
2025-04-17 22:26:09,435 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:26:09,438 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:26:09,438 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:26:09,439 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:26:09,439 - INFO - Loading existing market data...
2025-04-17 22:26:09,443 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:26:09,452 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:26:09,453 - INFO - Prepared test data with 1276 samples
2025-04-17 22:26:09,453 - INFO - Test data prepared
2025-04-17 22:26:09,453 - INFO - Storing data...
2025-04-17 22:26:09,454 - INFO - Aligning data indices...
2025-04-17 22:26:09,455 - INFO - Data indices aligned
2025-04-17 22:26:09,456 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:26:09,456 - INFO - Data preparation completed
2025-04-17 22:26:09,456 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:26:09,456 - INFO - Training models...
2025-04-17 22:26:09,456 - INFO - Starting model training...
2025-04-17 22:26:09,456 - INFO - Training regime classifier...
2025-04-17 22:26:09,457 - INFO - Training HMM model...
2025-04-17 22:26:09,647 - WARNING - Model is not converging.  Current: 6604.339029579349 is not greater than 21507.42426463861. Delta is -14903.08523505926
2025-04-17 22:26:09,647 - INFO - HMM model training completed
2025-04-17 22:26:09,834 - INFO - Training neural portfolio optimizer...
2025-04-17 22:26:09,835 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:26:09,835 - INFO - Model training completed
2025-04-17 22:26:09,836 - INFO - Model training completed
2025-04-17 22:26:09,836 - INFO - Initializing portfolio weights...
2025-04-17 22:26:09,837 - INFO - Portfolio weights initialized
2025-04-17 22:26:09,837 - INFO - Generating regime predictions for test period...
2025-04-17 22:26:09,839 - INFO - Test features shape after alignment: (41, 6)
2025-04-17 22:26:09,839 - ERROR - Error running hmm with neural and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 283, in run_strategy
    regime_predictions = self.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:26:09,841 - ERROR - No valid results obtained from parameter grid search
2025-04-17 22:26:09,841 - ERROR - No valid results obtained from parameter grid search
2025-04-17 22:26:09,841 - INFO - Factor timing strategy optimization completed
2025-04-17 22:28:20,581 - INFO - Starting factor timing strategy optimization...
2025-04-17 22:28:20,582 - INFO - Running parameter grid search...
2025-04-17 22:28:20,582 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 3 regimes
2025-04-17 22:28:20,583 - INFO - Initializing strategy...
2025-04-17 22:28:20,583 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 22:28:20,583 - ERROR - Error running lstm with mean_variance and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:28:20,585 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 5 regimes
2025-04-17 22:28:20,585 - INFO - Initializing strategy...
2025-04-17 22:28:20,585 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 22:28:20,585 - ERROR - Error running lstm with mean_variance and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:28:20,586 - INFO - 
Running strategy with lstm classifier, mean_variance optimizer, and 7 regimes
2025-04-17 22:28:20,586 - INFO - Initializing strategy...
2025-04-17 22:28:20,587 - INFO - Initializing FactorTimingStrategy with lstm model and mean_variance optimizer
2025-04-17 22:28:20,587 - ERROR - Error running lstm with mean_variance and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:28:20,588 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 3 regimes
2025-04-17 22:28:20,588 - INFO - Initializing strategy...
2025-04-17 22:28:20,588 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 22:28:20,588 - ERROR - Error running lstm with regime_aware and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:28:20,589 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 5 regimes
2025-04-17 22:28:20,589 - INFO - Initializing strategy...
2025-04-17 22:28:20,589 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 22:28:20,589 - ERROR - Error running lstm with regime_aware and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:28:20,590 - INFO - 
Running strategy with lstm classifier, regime_aware optimizer, and 7 regimes
2025-04-17 22:28:20,590 - INFO - Initializing strategy...
2025-04-17 22:28:20,590 - INFO - Initializing FactorTimingStrategy with lstm model and regime_aware optimizer
2025-04-17 22:28:20,590 - ERROR - Error running lstm with regime_aware and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:28:20,591 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 3 regimes
2025-04-17 22:28:20,591 - INFO - Initializing strategy...
2025-04-17 22:28:20,591 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 22:28:20,591 - ERROR - Error running lstm with neural_regime and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:28:20,592 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 5 regimes
2025-04-17 22:28:20,592 - INFO - Initializing strategy...
2025-04-17 22:28:20,592 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 22:28:20,592 - ERROR - Error running lstm with neural_regime and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:28:20,593 - INFO - 
Running strategy with lstm classifier, neural_regime optimizer, and 7 regimes
2025-04-17 22:28:20,593 - INFO - Initializing strategy...
2025-04-17 22:28:20,593 - INFO - Initializing FactorTimingStrategy with lstm model and neural_regime optimizer
2025-04-17 22:28:20,593 - ERROR - Error running lstm with neural_regime and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:28:20,594 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 22:28:20,594 - INFO - Initializing strategy...
2025-04-17 22:28:20,594 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 22:28:20,594 - ERROR - Error running lstm with autoencoder_regime and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:28:20,595 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 22:28:20,595 - INFO - Initializing strategy...
2025-04-17 22:28:20,595 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 22:28:20,595 - ERROR - Error running lstm with autoencoder_regime and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:28:20,596 - INFO - 
Running strategy with lstm classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 22:28:20,596 - INFO - Initializing strategy...
2025-04-17 22:28:20,596 - INFO - Initializing FactorTimingStrategy with lstm model and autoencoder_regime optimizer
2025-04-17 22:28:20,596 - ERROR - Error running lstm with autoencoder_regime and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:28:20,597 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 3 regimes
2025-04-17 22:28:20,597 - INFO - Initializing strategy...
2025-04-17 22:28:20,597 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 22:28:20,597 - ERROR - Error running lstm with neural and 3 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:28:20,598 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 5 regimes
2025-04-17 22:28:20,598 - INFO - Initializing strategy...
2025-04-17 22:28:20,598 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 22:28:20,598 - ERROR - Error running lstm with neural and 5 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:28:20,599 - INFO - 
Running strategy with lstm classifier, neural optimizer, and 7 regimes
2025-04-17 22:28:20,599 - INFO - Initializing strategy...
2025-04-17 22:28:20,599 - INFO - Initializing FactorTimingStrategy with lstm model and neural optimizer
2025-04-17 22:28:20,599 - ERROR - Error running lstm with neural and 7 regimes: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 43, in run_parameter_grid
    strategy = FactorTimingStrategy(
        train_start_date='2014-01-01',
    ...<5 lines>...
        data_dir=data_dir
    )
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 41, in __init__
    self.regime_classifier = self._init_regime_classifier(model_type)
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 48, in _init_regime_classifier
    return LSTMRegimeClassifier(
        input_size=6,  # Match actual number of features
    ...<2 lines>...
        num_regimes=5  # Number of regimes to classify
    )
TypeError: LSTMRegimeClassifier.__init__() got an unexpected keyword argument 'input_size'
2025-04-17 22:28:20,600 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 3 regimes
2025-04-17 22:28:20,600 - INFO - Initializing strategy...
2025-04-17 22:28:20,600 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 22:28:20,600 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:20,619 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:28:20,620 - INFO - Running strategy...
2025-04-17 22:28:20,620 - INFO - Starting strategy execution...
2025-04-17 22:28:20,620 - INFO - Preparing training and testing data...
2025-04-17 22:28:20,620 - INFO - Starting data preparation...
2025-04-17 22:28:20,621 - INFO - Loading Fama-French factors...
2025-04-17 22:28:20,635 - INFO - Fama-French factors loaded
2025-04-17 22:28:20,635 - INFO - Processing factor data...
2025-04-17 22:28:20,637 - INFO - Factor data processed
2025-04-17 22:28:20,638 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:20,638 - INFO - 
Training Period:
2025-04-17 22:28:20,642 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:20,651 - INFO - 
Testing Period:
2025-04-17 22:28:20,655 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:20,661 - INFO - Loading macro and market data...
2025-04-17 22:28:20,662 - INFO - Loading existing macro data...
2025-04-17 22:28:20,673 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:20,674 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:20,679 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:20,679 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:20,680 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:20,681 - INFO - Loading existing macro data...
2025-04-17 22:28:20,690 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:20,690 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:20,693 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:20,693 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:20,693 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:20,694 - INFO - Loading existing market data...
2025-04-17 22:28:20,698 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:20,699 - INFO - Loading existing market data...
2025-04-17 22:28:20,702 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:20,702 - INFO - Macro and market data loaded
2025-04-17 22:28:20,702 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:20,702 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:20,703 - INFO - Loading existing macro data...
2025-04-17 22:28:20,712 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:20,712 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:20,715 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:20,715 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:20,715 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:20,716 - INFO - Loading existing market data...
2025-04-17 22:28:20,719 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:20,852 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:20,853 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:20,853 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:20,853 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:20,854 - INFO - Loading existing macro data...
2025-04-17 22:28:20,864 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:20,864 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:20,868 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:20,868 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:20,868 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:20,869 - INFO - Loading existing market data...
2025-04-17 22:28:20,873 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:20,883 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:20,883 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:20,884 - INFO - Test data prepared
2025-04-17 22:28:20,884 - INFO - Storing data...
2025-04-17 22:28:20,884 - INFO - Aligning data indices...
2025-04-17 22:28:20,885 - INFO - Data indices aligned
2025-04-17 22:28:20,886 - INFO - Data preparation completed
2025-04-17 22:28:20,886 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:20,886 - INFO - Training models...
2025-04-17 22:28:20,886 - INFO - Starting model training...
2025-04-17 22:28:20,886 - INFO - Training regime classifier...
2025-04-17 22:28:20,886 - INFO - Training XGBoost model...
2025-04-17 22:28:20,887 - INFO - Preparing features...
2025-04-17 22:28:20,887 - INFO - Input shape: (1536, 8)
2025-04-17 22:28:20,887 - INFO - Handling missing values...
2025-04-17 22:28:20,888 - INFO - Missing values: 0 -> 0
2025-04-17 22:28:20,889 - INFO - Scaling features...
2025-04-17 22:28:20,890 - INFO - Fitted new scaler
2025-04-17 22:28:20,890 - INFO - Output shape: (1536, 8)
2025-04-17 22:28:22,206 - INFO - XGBoost model training completed
2025-04-17 22:28:22,486 - INFO - Model training completed
2025-04-17 22:28:22,488 - INFO - Model training completed
2025-04-17 22:28:22,488 - INFO - Initializing portfolio weights...
2025-04-17 22:28:22,489 - INFO - Portfolio weights initialized
2025-04-17 22:28:22,489 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:22,491 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:22,493 - INFO - Generated 41 regime predictions
2025-04-17 22:28:22,493 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:22,497 - INFO - Found 5 unique regimes
2025-04-17 22:28:22,498 - INFO - Processing regime 0...
2025-04-17 22:28:22,499 - INFO - Regime 0: 16 samples
2025-04-17 22:28:22,499 - INFO - Processing regime 1...
2025-04-17 22:28:22,500 - INFO - Regime 1: 4 samples
2025-04-17 22:28:22,500 - INFO - Processing regime 2...
2025-04-17 22:28:22,501 - INFO - Regime 2: 10 samples
2025-04-17 22:28:22,501 - INFO - Processing regime 3...
2025-04-17 22:28:22,502 - INFO - Regime 3: 3 samples
2025-04-17 22:28:22,502 - INFO - Processing regime 4...
2025-04-17 22:28:22,503 - INFO - Regime 4: 12 samples
2025-04-17 22:28:22,503 - INFO - Training portfolio optimizer...
2025-04-17 22:28:22,503 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:22,504 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:22,505 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:22,505 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:22,509 - WARNING - All weights are zero, using equal weights
2025-04-17 22:28:22,535 - INFO - Portfolio optimization completed
2025-04-17 22:28:22,535 - INFO - Initializing backtester...
2025-04-17 22:28:22,542 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:22,542 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:22,542 - INFO - Running backtest...
2025-04-17 22:28:22,543 - INFO - Starting backtest...
2025-04-17 22:28:22,543 - INFO - Calculating portfolio returns...
2025-04-17 22:28:22,543 - INFO - Calculating portfolio returns...
2025-04-17 22:28:22,544 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:22,544 - INFO - Calculating performance metrics...
2025-04-17 22:28:22,544 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:22,544 - INFO - Calculating metrics...
2025-04-17 22:28:22,547 - INFO - Performance metrics calculation completed
2025-04-17 22:28:22,547 - INFO - Backtest completed
2025-04-17 22:28:22,548 - INFO - Backtest completed
2025-04-17 22:28:22,548 - INFO - Strategy execution completed
2025-04-17 22:28:22,549 - ERROR - Error running xgboost with mean_variance and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:22,553 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 5 regimes
2025-04-17 22:28:22,553 - INFO - Initializing strategy...
2025-04-17 22:28:22,553 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 22:28:22,553 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:22,553 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:28:22,554 - INFO - Running strategy...
2025-04-17 22:28:22,554 - INFO - Starting strategy execution...
2025-04-17 22:28:22,554 - INFO - Preparing training and testing data...
2025-04-17 22:28:22,554 - INFO - Starting data preparation...
2025-04-17 22:28:22,554 - INFO - Loading Fama-French factors...
2025-04-17 22:28:22,566 - INFO - Fama-French factors loaded
2025-04-17 22:28:22,566 - INFO - Processing factor data...
2025-04-17 22:28:22,569 - INFO - Factor data processed
2025-04-17 22:28:22,569 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:22,569 - INFO - 
Training Period:
2025-04-17 22:28:22,574 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:22,583 - INFO - 
Testing Period:
2025-04-17 22:28:22,588 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:22,597 - INFO - Loading macro and market data...
2025-04-17 22:28:22,598 - INFO - Loading existing macro data...
2025-04-17 22:28:22,608 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:22,608 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:22,611 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:22,611 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:22,611 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:22,612 - INFO - Loading existing macro data...
2025-04-17 22:28:22,621 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:22,621 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:22,624 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:22,624 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:22,624 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:22,625 - INFO - Loading existing market data...
2025-04-17 22:28:22,628 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:22,629 - INFO - Loading existing market data...
2025-04-17 22:28:22,632 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:22,632 - INFO - Macro and market data loaded
2025-04-17 22:28:22,632 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:22,632 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:22,633 - INFO - Loading existing macro data...
2025-04-17 22:28:22,642 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:22,642 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:22,645 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:22,645 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:22,645 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:22,646 - INFO - Loading existing market data...
2025-04-17 22:28:22,650 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:22,663 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:22,663 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:22,663 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:22,664 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:22,665 - INFO - Loading existing macro data...
2025-04-17 22:28:22,675 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:22,675 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:22,678 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:22,679 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:22,679 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:22,680 - INFO - Loading existing market data...
2025-04-17 22:28:22,684 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:22,695 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:22,696 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:22,696 - INFO - Test data prepared
2025-04-17 22:28:22,696 - INFO - Storing data...
2025-04-17 22:28:22,696 - INFO - Aligning data indices...
2025-04-17 22:28:22,698 - INFO - Data indices aligned
2025-04-17 22:28:22,698 - INFO - Data preparation completed
2025-04-17 22:28:22,698 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:22,699 - INFO - Training models...
2025-04-17 22:28:22,699 - INFO - Starting model training...
2025-04-17 22:28:22,699 - INFO - Training regime classifier...
2025-04-17 22:28:22,699 - INFO - Training XGBoost model...
2025-04-17 22:28:22,699 - INFO - Preparing features...
2025-04-17 22:28:22,699 - INFO - Input shape: (1536, 8)
2025-04-17 22:28:22,700 - INFO - Handling missing values...
2025-04-17 22:28:22,701 - INFO - Missing values: 0 -> 0
2025-04-17 22:28:22,701 - INFO - Scaling features...
2025-04-17 22:28:22,703 - INFO - Fitted new scaler
2025-04-17 22:28:22,704 - INFO - Output shape: (1536, 8)
2025-04-17 22:28:22,949 - INFO - XGBoost model training completed
2025-04-17 22:28:23,313 - INFO - Model training completed
2025-04-17 22:28:23,315 - INFO - Model training completed
2025-04-17 22:28:23,315 - INFO - Initializing portfolio weights...
2025-04-17 22:28:23,316 - INFO - Portfolio weights initialized
2025-04-17 22:28:23,316 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:23,318 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:23,320 - INFO - Generated 41 regime predictions
2025-04-17 22:28:23,320 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:23,325 - INFO - Found 5 unique regimes
2025-04-17 22:28:23,325 - INFO - Processing regime 0...
2025-04-17 22:28:23,326 - INFO - Regime 0: 16 samples
2025-04-17 22:28:23,326 - INFO - Processing regime 1...
2025-04-17 22:28:23,327 - INFO - Regime 1: 4 samples
2025-04-17 22:28:23,327 - INFO - Processing regime 2...
2025-04-17 22:28:23,328 - INFO - Regime 2: 10 samples
2025-04-17 22:28:23,329 - INFO - Processing regime 3...
2025-04-17 22:28:23,329 - INFO - Regime 3: 3 samples
2025-04-17 22:28:23,330 - INFO - Processing regime 4...
2025-04-17 22:28:23,330 - INFO - Regime 4: 12 samples
2025-04-17 22:28:23,331 - INFO - Training portfolio optimizer...
2025-04-17 22:28:23,331 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:23,331 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:23,331 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:23,331 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:23,333 - WARNING - All weights are zero, using equal weights
2025-04-17 22:28:23,359 - INFO - Portfolio optimization completed
2025-04-17 22:28:23,360 - INFO - Initializing backtester...
2025-04-17 22:28:23,367 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:23,367 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:23,368 - INFO - Running backtest...
2025-04-17 22:28:23,368 - INFO - Starting backtest...
2025-04-17 22:28:23,368 - INFO - Calculating portfolio returns...
2025-04-17 22:28:23,368 - INFO - Calculating portfolio returns...
2025-04-17 22:28:23,369 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:23,370 - INFO - Calculating performance metrics...
2025-04-17 22:28:23,370 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:23,370 - INFO - Calculating metrics...
2025-04-17 22:28:23,373 - INFO - Performance metrics calculation completed
2025-04-17 22:28:23,373 - INFO - Backtest completed
2025-04-17 22:28:23,373 - INFO - Backtest completed
2025-04-17 22:28:23,374 - INFO - Strategy execution completed
2025-04-17 22:28:23,375 - ERROR - Error running xgboost with mean_variance and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:23,377 - INFO - 
Running strategy with xgboost classifier, mean_variance optimizer, and 7 regimes
2025-04-17 22:28:23,377 - INFO - Initializing strategy...
2025-04-17 22:28:23,377 - INFO - Initializing FactorTimingStrategy with xgboost model and mean_variance optimizer
2025-04-17 22:28:23,377 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:23,377 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:28:23,378 - INFO - Running strategy...
2025-04-17 22:28:23,378 - INFO - Starting strategy execution...
2025-04-17 22:28:23,379 - INFO - Preparing training and testing data...
2025-04-17 22:28:23,379 - INFO - Starting data preparation...
2025-04-17 22:28:23,379 - INFO - Loading Fama-French factors...
2025-04-17 22:28:23,392 - INFO - Fama-French factors loaded
2025-04-17 22:28:23,392 - INFO - Processing factor data...
2025-04-17 22:28:23,395 - INFO - Factor data processed
2025-04-17 22:28:23,395 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:23,395 - INFO - 
Training Period:
2025-04-17 22:28:23,400 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:23,410 - INFO - 
Testing Period:
2025-04-17 22:28:23,415 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:23,425 - INFO - Loading macro and market data...
2025-04-17 22:28:23,426 - INFO - Loading existing macro data...
2025-04-17 22:28:23,437 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:23,437 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:23,440 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:23,440 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:23,441 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:23,441 - INFO - Loading existing macro data...
2025-04-17 22:28:23,452 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:23,452 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:23,455 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:23,456 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:23,456 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:23,457 - INFO - Loading existing market data...
2025-04-17 22:28:23,461 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:23,462 - INFO - Loading existing market data...
2025-04-17 22:28:23,465 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:23,465 - INFO - Macro and market data loaded
2025-04-17 22:28:23,465 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:23,465 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:23,466 - INFO - Loading existing macro data...
2025-04-17 22:28:23,476 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:23,476 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:23,480 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:23,480 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:23,481 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:23,482 - INFO - Loading existing market data...
2025-04-17 22:28:23,485 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:23,501 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:23,501 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:23,502 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:23,502 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:23,503 - INFO - Loading existing macro data...
2025-04-17 22:28:23,516 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:23,516 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:23,520 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:23,520 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:23,520 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:23,521 - INFO - Loading existing market data...
2025-04-17 22:28:23,525 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:23,536 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:23,536 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:23,537 - INFO - Test data prepared
2025-04-17 22:28:23,537 - INFO - Storing data...
2025-04-17 22:28:23,537 - INFO - Aligning data indices...
2025-04-17 22:28:23,539 - INFO - Data indices aligned
2025-04-17 22:28:23,539 - INFO - Data preparation completed
2025-04-17 22:28:23,539 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:23,539 - INFO - Training models...
2025-04-17 22:28:23,539 - INFO - Starting model training...
2025-04-17 22:28:23,539 - INFO - Training regime classifier...
2025-04-17 22:28:23,539 - INFO - Training XGBoost model...
2025-04-17 22:28:23,540 - INFO - Preparing features...
2025-04-17 22:28:23,540 - INFO - Input shape: (1536, 8)
2025-04-17 22:28:23,540 - INFO - Handling missing values...
2025-04-17 22:28:23,541 - INFO - Missing values: 0 -> 0
2025-04-17 22:28:23,541 - INFO - Scaling features...
2025-04-17 22:28:23,543 - INFO - Fitted new scaler
2025-04-17 22:28:23,544 - INFO - Output shape: (1536, 8)
2025-04-17 22:28:23,677 - INFO - XGBoost model training completed
2025-04-17 22:28:23,899 - INFO - Model training completed
2025-04-17 22:28:23,901 - INFO - Model training completed
2025-04-17 22:28:23,901 - INFO - Initializing portfolio weights...
2025-04-17 22:28:23,901 - INFO - Portfolio weights initialized
2025-04-17 22:28:23,901 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:23,904 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:23,906 - INFO - Generated 41 regime predictions
2025-04-17 22:28:23,906 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:23,910 - INFO - Found 5 unique regimes
2025-04-17 22:28:23,910 - INFO - Processing regime 0...
2025-04-17 22:28:23,911 - INFO - Regime 0: 16 samples
2025-04-17 22:28:23,912 - INFO - Processing regime 1...
2025-04-17 22:28:23,912 - INFO - Regime 1: 4 samples
2025-04-17 22:28:23,913 - INFO - Processing regime 2...
2025-04-17 22:28:23,913 - INFO - Regime 2: 10 samples
2025-04-17 22:28:23,914 - INFO - Processing regime 3...
2025-04-17 22:28:23,914 - INFO - Regime 3: 3 samples
2025-04-17 22:28:23,915 - INFO - Processing regime 4...
2025-04-17 22:28:23,915 - INFO - Regime 4: 12 samples
2025-04-17 22:28:23,916 - INFO - Training portfolio optimizer...
2025-04-17 22:28:23,916 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:23,916 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:23,916 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:23,916 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:23,918 - WARNING - All weights are zero, using equal weights
2025-04-17 22:28:23,944 - INFO - Portfolio optimization completed
2025-04-17 22:28:23,945 - INFO - Initializing backtester...
2025-04-17 22:28:23,952 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:23,952 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:23,953 - INFO - Running backtest...
2025-04-17 22:28:23,953 - INFO - Starting backtest...
2025-04-17 22:28:23,953 - INFO - Calculating portfolio returns...
2025-04-17 22:28:23,953 - INFO - Calculating portfolio returns...
2025-04-17 22:28:23,954 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:23,955 - INFO - Calculating performance metrics...
2025-04-17 22:28:23,955 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:23,955 - INFO - Calculating metrics...
2025-04-17 22:28:23,957 - INFO - Performance metrics calculation completed
2025-04-17 22:28:23,958 - INFO - Backtest completed
2025-04-17 22:28:23,958 - INFO - Backtest completed
2025-04-17 22:28:23,958 - INFO - Strategy execution completed
2025-04-17 22:28:23,960 - ERROR - Error running xgboost with mean_variance and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:23,961 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 3 regimes
2025-04-17 22:28:23,962 - INFO - Initializing strategy...
2025-04-17 22:28:23,962 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 22:28:23,962 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:23,962 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:28:23,963 - INFO - Running strategy...
2025-04-17 22:28:23,963 - INFO - Starting strategy execution...
2025-04-17 22:28:23,963 - INFO - Preparing training and testing data...
2025-04-17 22:28:23,963 - INFO - Starting data preparation...
2025-04-17 22:28:23,963 - INFO - Loading Fama-French factors...
2025-04-17 22:28:23,976 - INFO - Fama-French factors loaded
2025-04-17 22:28:23,976 - INFO - Processing factor data...
2025-04-17 22:28:23,979 - INFO - Factor data processed
2025-04-17 22:28:23,979 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:23,980 - INFO - 
Training Period:
2025-04-17 22:28:23,985 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:23,995 - INFO - 
Testing Period:
2025-04-17 22:28:24,001 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:24,010 - INFO - Loading macro and market data...
2025-04-17 22:28:24,012 - INFO - Loading existing macro data...
2025-04-17 22:28:24,024 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:24,025 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:24,028 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:24,028 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:24,028 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:24,029 - INFO - Loading existing macro data...
2025-04-17 22:28:24,039 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:24,039 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:24,042 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:24,042 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:24,043 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:24,044 - INFO - Loading existing market data...
2025-04-17 22:28:24,048 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:24,049 - INFO - Loading existing market data...
2025-04-17 22:28:24,052 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:24,052 - INFO - Macro and market data loaded
2025-04-17 22:28:24,052 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:24,052 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:24,053 - INFO - Loading existing macro data...
2025-04-17 22:28:24,062 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:24,063 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:24,066 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:24,066 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:24,066 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:24,067 - INFO - Loading existing market data...
2025-04-17 22:28:24,071 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:24,086 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:24,086 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:24,086 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:24,087 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:24,088 - INFO - Loading existing macro data...
2025-04-17 22:28:24,100 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:24,101 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:24,105 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:24,105 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:24,106 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:24,107 - INFO - Loading existing market data...
2025-04-17 22:28:24,111 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:24,121 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:24,122 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:24,122 - INFO - Test data prepared
2025-04-17 22:28:24,122 - INFO - Storing data...
2025-04-17 22:28:24,122 - INFO - Aligning data indices...
2025-04-17 22:28:24,124 - INFO - Data indices aligned
2025-04-17 22:28:24,124 - INFO - Data preparation completed
2025-04-17 22:28:24,124 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:24,124 - INFO - Training models...
2025-04-17 22:28:24,125 - INFO - Starting model training...
2025-04-17 22:28:24,125 - INFO - Training regime classifier...
2025-04-17 22:28:24,125 - INFO - Training XGBoost model...
2025-04-17 22:28:24,125 - INFO - Preparing features...
2025-04-17 22:28:24,125 - INFO - Input shape: (1536, 8)
2025-04-17 22:28:24,125 - INFO - Handling missing values...
2025-04-17 22:28:24,126 - INFO - Missing values: 0 -> 0
2025-04-17 22:28:24,126 - INFO - Scaling features...
2025-04-17 22:28:24,127 - INFO - Fitted new scaler
2025-04-17 22:28:24,128 - INFO - Output shape: (1536, 8)
2025-04-17 22:28:24,257 - INFO - XGBoost model training completed
2025-04-17 22:28:24,480 - INFO - Model training completed
2025-04-17 22:28:24,482 - INFO - Model training completed
2025-04-17 22:28:24,482 - INFO - Initializing portfolio weights...
2025-04-17 22:28:24,482 - INFO - Portfolio weights initialized
2025-04-17 22:28:24,483 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:24,485 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:24,487 - INFO - Generated 41 regime predictions
2025-04-17 22:28:24,487 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:24,492 - INFO - Found 5 unique regimes
2025-04-17 22:28:24,492 - INFO - Processing regime 0...
2025-04-17 22:28:24,493 - INFO - Regime 0: 16 samples
2025-04-17 22:28:24,493 - INFO - Processing regime 1...
2025-04-17 22:28:24,494 - INFO - Regime 1: 4 samples
2025-04-17 22:28:24,494 - INFO - Processing regime 2...
2025-04-17 22:28:24,495 - INFO - Regime 2: 10 samples
2025-04-17 22:28:24,495 - INFO - Processing regime 3...
2025-04-17 22:28:24,496 - INFO - Regime 3: 3 samples
2025-04-17 22:28:24,496 - INFO - Processing regime 4...
2025-04-17 22:28:24,497 - INFO - Regime 4: 12 samples
2025-04-17 22:28:24,497 - INFO - Training portfolio optimizer...
2025-04-17 22:28:24,497 - INFO - Training regime-aware optimizer...
2025-04-17 22:28:24,498 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:24,498 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:24,498 - INFO - Trained optimizer for regime 0 with 16 samples
2025-04-17 22:28:24,498 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:24,499 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:24,499 - INFO - Trained optimizer for regime 1 with 4 samples
2025-04-17 22:28:24,499 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:24,499 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:24,500 - INFO - Trained optimizer for regime 2 with 10 samples
2025-04-17 22:28:24,500 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:24,500 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:24,500 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:24,501 - WARNING - All weights are zero, using equal weights
2025-04-17 22:28:24,502 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:24,503 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:24,503 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 22:28:24,504 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:24,504 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 22:28:24,505 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,505 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,506 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:24,506 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 22:28:24,507 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,507 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,508 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:24,508 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 22:28:24,509 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:24,509 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 22:28:24,510 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,510 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,511 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,511 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,512 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,512 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,513 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,513 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,514 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,514 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,515 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,515 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,516 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,516 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,517 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:24,517 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 22:28:24,518 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:24,519 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:24,519 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 22:28:24,520 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:24,520 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:24,521 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 22:28:24,521 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:24,522 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:24,523 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:24,524 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:24,524 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 22:28:24,525 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,525 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,526 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,526 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,527 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,527 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,528 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,528 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,529 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,529 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,530 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,530 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,531 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,531 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,532 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,532 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,533 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,533 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,534 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,534 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,535 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,535 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,536 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,536 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,537 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,537 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,538 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,538 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,539 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,539 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,540 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:24,540 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:24,541 - INFO - Portfolio optimization completed
2025-04-17 22:28:24,541 - INFO - Initializing backtester...
2025-04-17 22:28:24,549 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:24,549 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:24,549 - INFO - Running backtest...
2025-04-17 22:28:24,549 - INFO - Starting backtest...
2025-04-17 22:28:24,549 - INFO - Calculating portfolio returns...
2025-04-17 22:28:24,550 - INFO - Calculating portfolio returns...
2025-04-17 22:28:24,551 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:24,551 - INFO - Calculating performance metrics...
2025-04-17 22:28:24,551 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:24,551 - INFO - Calculating metrics...
2025-04-17 22:28:24,554 - INFO - Performance metrics calculation completed
2025-04-17 22:28:24,554 - INFO - Backtest completed
2025-04-17 22:28:24,554 - INFO - Backtest completed
2025-04-17 22:28:24,555 - INFO - Strategy execution completed
2025-04-17 22:28:24,556 - ERROR - Error running xgboost with regime_aware and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:24,558 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 5 regimes
2025-04-17 22:28:24,558 - INFO - Initializing strategy...
2025-04-17 22:28:24,558 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 22:28:24,558 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:24,558 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:28:24,559 - INFO - Running strategy...
2025-04-17 22:28:24,559 - INFO - Starting strategy execution...
2025-04-17 22:28:24,559 - INFO - Preparing training and testing data...
2025-04-17 22:28:24,560 - INFO - Starting data preparation...
2025-04-17 22:28:24,560 - INFO - Loading Fama-French factors...
2025-04-17 22:28:24,572 - INFO - Fama-French factors loaded
2025-04-17 22:28:24,573 - INFO - Processing factor data...
2025-04-17 22:28:24,575 - INFO - Factor data processed
2025-04-17 22:28:24,575 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:24,576 - INFO - 
Training Period:
2025-04-17 22:28:24,581 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:24,591 - INFO - 
Testing Period:
2025-04-17 22:28:24,597 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:24,605 - INFO - Loading macro and market data...
2025-04-17 22:28:24,607 - INFO - Loading existing macro data...
2025-04-17 22:28:24,618 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:24,618 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:24,622 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:24,622 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:24,622 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:24,624 - INFO - Loading existing macro data...
2025-04-17 22:28:24,634 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:24,634 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:24,637 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:24,638 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:24,638 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:24,639 - INFO - Loading existing market data...
2025-04-17 22:28:24,643 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:24,644 - INFO - Loading existing market data...
2025-04-17 22:28:24,647 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:24,647 - INFO - Macro and market data loaded
2025-04-17 22:28:24,647 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:24,647 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:24,648 - INFO - Loading existing macro data...
2025-04-17 22:28:24,658 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:24,658 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:24,661 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:24,661 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:24,661 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:24,662 - INFO - Loading existing market data...
2025-04-17 22:28:24,665 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:24,679 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:24,679 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:24,679 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:24,680 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:24,681 - INFO - Loading existing macro data...
2025-04-17 22:28:24,693 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:24,694 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:24,698 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:24,698 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:24,699 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:24,700 - INFO - Loading existing market data...
2025-04-17 22:28:24,705 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:24,714 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:24,715 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:24,715 - INFO - Test data prepared
2025-04-17 22:28:24,715 - INFO - Storing data...
2025-04-17 22:28:24,715 - INFO - Aligning data indices...
2025-04-17 22:28:24,717 - INFO - Data indices aligned
2025-04-17 22:28:24,717 - INFO - Data preparation completed
2025-04-17 22:28:24,717 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:24,717 - INFO - Training models...
2025-04-17 22:28:24,718 - INFO - Starting model training...
2025-04-17 22:28:24,718 - INFO - Training regime classifier...
2025-04-17 22:28:24,718 - INFO - Training XGBoost model...
2025-04-17 22:28:24,718 - INFO - Preparing features...
2025-04-17 22:28:24,719 - INFO - Input shape: (1536, 8)
2025-04-17 22:28:24,719 - INFO - Handling missing values...
2025-04-17 22:28:24,721 - INFO - Missing values: 0 -> 0
2025-04-17 22:28:24,721 - INFO - Scaling features...
2025-04-17 22:28:24,723 - INFO - Fitted new scaler
2025-04-17 22:28:24,724 - INFO - Output shape: (1536, 8)
2025-04-17 22:28:24,856 - INFO - XGBoost model training completed
2025-04-17 22:28:25,080 - INFO - Model training completed
2025-04-17 22:28:25,082 - INFO - Model training completed
2025-04-17 22:28:25,082 - INFO - Initializing portfolio weights...
2025-04-17 22:28:25,083 - INFO - Portfolio weights initialized
2025-04-17 22:28:25,083 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:25,085 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:25,087 - INFO - Generated 41 regime predictions
2025-04-17 22:28:25,087 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:25,091 - INFO - Found 5 unique regimes
2025-04-17 22:28:25,091 - INFO - Processing regime 0...
2025-04-17 22:28:25,092 - INFO - Regime 0: 16 samples
2025-04-17 22:28:25,093 - INFO - Processing regime 1...
2025-04-17 22:28:25,094 - INFO - Regime 1: 4 samples
2025-04-17 22:28:25,094 - INFO - Processing regime 2...
2025-04-17 22:28:25,095 - INFO - Regime 2: 10 samples
2025-04-17 22:28:25,095 - INFO - Processing regime 3...
2025-04-17 22:28:25,096 - INFO - Regime 3: 3 samples
2025-04-17 22:28:25,096 - INFO - Processing regime 4...
2025-04-17 22:28:25,097 - INFO - Regime 4: 12 samples
2025-04-17 22:28:25,097 - INFO - Training portfolio optimizer...
2025-04-17 22:28:25,097 - INFO - Training regime-aware optimizer...
2025-04-17 22:28:25,098 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:25,098 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:25,098 - INFO - Trained optimizer for regime 0 with 16 samples
2025-04-17 22:28:25,098 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:25,099 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:25,099 - INFO - Trained optimizer for regime 1 with 4 samples
2025-04-17 22:28:25,099 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:25,099 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:25,100 - INFO - Trained optimizer for regime 2 with 10 samples
2025-04-17 22:28:25,100 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:25,100 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:25,100 - INFO - Trained optimizer for regime 3 with 3 samples
2025-04-17 22:28:25,100 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:25,101 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:25,101 - INFO - Trained optimizer for regime 4 with 12 samples
2025-04-17 22:28:25,101 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:25,101 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:25,102 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:25,103 - WARNING - All weights are zero, using equal weights
2025-04-17 22:28:25,103 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:25,104 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:25,105 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:25,106 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,107 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:25,108 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,109 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:25,110 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:25,110 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,111 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,112 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,113 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,114 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,115 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,115 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,116 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:25,117 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:25,118 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:25,119 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:25,120 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:25,121 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:25,121 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:25,122 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:25,123 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:25,124 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,125 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,126 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,126 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,127 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,128 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,129 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,130 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,131 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,131 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,132 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,133 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,134 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,135 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,136 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,136 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,137 - INFO - Portfolio optimization completed
2025-04-17 22:28:25,137 - INFO - Initializing backtester...
2025-04-17 22:28:25,145 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:25,145 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:25,145 - INFO - Running backtest...
2025-04-17 22:28:25,146 - INFO - Starting backtest...
2025-04-17 22:28:25,146 - INFO - Calculating portfolio returns...
2025-04-17 22:28:25,146 - INFO - Calculating portfolio returns...
2025-04-17 22:28:25,147 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:25,148 - INFO - Calculating performance metrics...
2025-04-17 22:28:25,148 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:25,148 - INFO - Calculating metrics...
2025-04-17 22:28:25,151 - INFO - Performance metrics calculation completed
2025-04-17 22:28:25,151 - INFO - Backtest completed
2025-04-17 22:28:25,151 - INFO - Backtest completed
2025-04-17 22:28:25,152 - INFO - Strategy execution completed
2025-04-17 22:28:25,153 - ERROR - Error running xgboost with regime_aware and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:25,155 - INFO - 
Running strategy with xgboost classifier, regime_aware optimizer, and 7 regimes
2025-04-17 22:28:25,155 - INFO - Initializing strategy...
2025-04-17 22:28:25,155 - INFO - Initializing FactorTimingStrategy with xgboost model and regime_aware optimizer
2025-04-17 22:28:25,155 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:25,155 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:28:25,156 - INFO - Running strategy...
2025-04-17 22:28:25,156 - INFO - Starting strategy execution...
2025-04-17 22:28:25,156 - INFO - Preparing training and testing data...
2025-04-17 22:28:25,156 - INFO - Starting data preparation...
2025-04-17 22:28:25,156 - INFO - Loading Fama-French factors...
2025-04-17 22:28:25,169 - INFO - Fama-French factors loaded
2025-04-17 22:28:25,169 - INFO - Processing factor data...
2025-04-17 22:28:25,172 - INFO - Factor data processed
2025-04-17 22:28:25,172 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:25,172 - INFO - 
Training Period:
2025-04-17 22:28:25,177 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:25,187 - INFO - 
Testing Period:
2025-04-17 22:28:25,192 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:25,199 - INFO - Loading macro and market data...
2025-04-17 22:28:25,200 - INFO - Loading existing macro data...
2025-04-17 22:28:25,211 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:25,211 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:25,214 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:25,214 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:25,214 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:25,215 - INFO - Loading existing macro data...
2025-04-17 22:28:25,226 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:25,226 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:25,229 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:25,229 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:25,229 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:25,230 - INFO - Loading existing market data...
2025-04-17 22:28:25,234 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:25,235 - INFO - Loading existing market data...
2025-04-17 22:28:25,238 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:25,238 - INFO - Macro and market data loaded
2025-04-17 22:28:25,238 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:25,238 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:25,239 - INFO - Loading existing macro data...
2025-04-17 22:28:25,249 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:25,250 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:25,253 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:25,253 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:25,254 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:25,255 - INFO - Loading existing market data...
2025-04-17 22:28:25,259 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:25,274 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:25,274 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:25,274 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:25,274 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:25,275 - INFO - Loading existing macro data...
2025-04-17 22:28:25,286 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:25,287 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:25,290 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:25,291 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:25,291 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:25,292 - INFO - Loading existing market data...
2025-04-17 22:28:25,295 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:25,305 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:25,305 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:25,306 - INFO - Test data prepared
2025-04-17 22:28:25,306 - INFO - Storing data...
2025-04-17 22:28:25,306 - INFO - Aligning data indices...
2025-04-17 22:28:25,307 - INFO - Data indices aligned
2025-04-17 22:28:25,307 - INFO - Data preparation completed
2025-04-17 22:28:25,308 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:25,308 - INFO - Training models...
2025-04-17 22:28:25,308 - INFO - Starting model training...
2025-04-17 22:28:25,308 - INFO - Training regime classifier...
2025-04-17 22:28:25,308 - INFO - Training XGBoost model...
2025-04-17 22:28:25,308 - INFO - Preparing features...
2025-04-17 22:28:25,308 - INFO - Input shape: (1536, 8)
2025-04-17 22:28:25,308 - INFO - Handling missing values...
2025-04-17 22:28:25,310 - INFO - Missing values: 0 -> 0
2025-04-17 22:28:25,310 - INFO - Scaling features...
2025-04-17 22:28:25,311 - INFO - Fitted new scaler
2025-04-17 22:28:25,312 - INFO - Output shape: (1536, 8)
2025-04-17 22:28:25,440 - INFO - XGBoost model training completed
2025-04-17 22:28:25,667 - INFO - Model training completed
2025-04-17 22:28:25,668 - INFO - Model training completed
2025-04-17 22:28:25,668 - INFO - Initializing portfolio weights...
2025-04-17 22:28:25,669 - INFO - Portfolio weights initialized
2025-04-17 22:28:25,669 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:25,671 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:25,673 - INFO - Generated 41 regime predictions
2025-04-17 22:28:25,674 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:25,678 - INFO - Found 5 unique regimes
2025-04-17 22:28:25,678 - INFO - Processing regime 0...
2025-04-17 22:28:25,679 - INFO - Regime 0: 16 samples
2025-04-17 22:28:25,679 - INFO - Processing regime 1...
2025-04-17 22:28:25,680 - INFO - Regime 1: 4 samples
2025-04-17 22:28:25,681 - INFO - Processing regime 2...
2025-04-17 22:28:25,682 - INFO - Regime 2: 10 samples
2025-04-17 22:28:25,682 - INFO - Processing regime 3...
2025-04-17 22:28:25,683 - INFO - Regime 3: 3 samples
2025-04-17 22:28:25,683 - INFO - Processing regime 4...
2025-04-17 22:28:25,684 - INFO - Regime 4: 12 samples
2025-04-17 22:28:25,684 - INFO - Training portfolio optimizer...
2025-04-17 22:28:25,684 - INFO - Training regime-aware optimizer...
2025-04-17 22:28:25,684 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:25,685 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:25,685 - INFO - Trained optimizer for regime 0 with 16 samples
2025-04-17 22:28:25,685 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:25,685 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:25,685 - INFO - Trained optimizer for regime 1 with 4 samples
2025-04-17 22:28:25,686 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:25,686 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:25,686 - INFO - Trained optimizer for regime 2 with 10 samples
2025-04-17 22:28:25,686 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:25,687 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:25,687 - INFO - Trained optimizer for regime 3 with 3 samples
2025-04-17 22:28:25,687 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:25,687 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:25,688 - INFO - Trained optimizer for regime 4 with 12 samples
2025-04-17 22:28:25,688 - WARNING - No samples found for regime 5
2025-04-17 22:28:25,688 - WARNING - No samples found for regime 6
2025-04-17 22:28:25,688 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:25,688 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:25,689 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:25,690 - WARNING - All weights are zero, using equal weights
2025-04-17 22:28:25,690 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:25,691 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:25,692 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:25,693 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,694 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:25,695 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,696 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:25,697 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:25,697 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,698 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,699 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,700 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,701 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,702 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,702 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,703 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:25,704 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:25,705 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:25,706 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:25,707 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:25,708 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:25,708 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:25,709 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:25,710 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:25,711 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,712 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,713 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,714 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,714 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,715 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,716 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,717 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,718 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,719 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,719 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,720 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,721 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,722 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,723 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,724 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:25,725 - INFO - Portfolio optimization completed
2025-04-17 22:28:25,725 - INFO - Initializing backtester...
2025-04-17 22:28:25,732 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:25,733 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:25,733 - INFO - Running backtest...
2025-04-17 22:28:25,733 - INFO - Starting backtest...
2025-04-17 22:28:25,733 - INFO - Calculating portfolio returns...
2025-04-17 22:28:25,733 - INFO - Calculating portfolio returns...
2025-04-17 22:28:25,735 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:25,735 - INFO - Calculating performance metrics...
2025-04-17 22:28:25,735 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:25,735 - INFO - Calculating metrics...
2025-04-17 22:28:25,738 - INFO - Performance metrics calculation completed
2025-04-17 22:28:25,738 - INFO - Backtest completed
2025-04-17 22:28:25,738 - INFO - Backtest completed
2025-04-17 22:28:25,739 - INFO - Strategy execution completed
2025-04-17 22:28:25,741 - ERROR - Error running xgboost with regime_aware and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:25,742 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 3 regimes
2025-04-17 22:28:25,742 - INFO - Initializing strategy...
2025-04-17 22:28:25,743 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 22:28:25,743 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:25,743 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:28:25,744 - INFO - Running strategy...
2025-04-17 22:28:25,744 - INFO - Starting strategy execution...
2025-04-17 22:28:25,744 - INFO - Preparing training and testing data...
2025-04-17 22:28:25,744 - INFO - Starting data preparation...
2025-04-17 22:28:25,744 - INFO - Loading Fama-French factors...
2025-04-17 22:28:25,757 - INFO - Fama-French factors loaded
2025-04-17 22:28:25,758 - INFO - Processing factor data...
2025-04-17 22:28:25,761 - INFO - Factor data processed
2025-04-17 22:28:25,761 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:25,761 - INFO - 
Training Period:
2025-04-17 22:28:25,767 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:25,776 - INFO - 
Testing Period:
2025-04-17 22:28:25,782 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:25,790 - INFO - Loading macro and market data...
2025-04-17 22:28:25,792 - INFO - Loading existing macro data...
2025-04-17 22:28:25,803 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:25,803 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:25,806 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:25,806 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:25,806 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:25,807 - INFO - Loading existing macro data...
2025-04-17 22:28:25,817 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:25,817 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:25,820 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:25,820 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:25,820 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:25,821 - INFO - Loading existing market data...
2025-04-17 22:28:25,825 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:25,826 - INFO - Loading existing market data...
2025-04-17 22:28:25,829 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:25,829 - INFO - Macro and market data loaded
2025-04-17 22:28:25,829 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:25,829 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:25,830 - INFO - Loading existing macro data...
2025-04-17 22:28:25,840 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:25,840 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:25,843 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:25,843 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:25,843 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:25,844 - INFO - Loading existing market data...
2025-04-17 22:28:25,848 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:25,863 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:25,863 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:25,863 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:25,863 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:25,865 - INFO - Loading existing macro data...
2025-04-17 22:28:25,875 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:25,875 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:25,879 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:25,879 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:25,879 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:25,880 - INFO - Loading existing market data...
2025-04-17 22:28:25,884 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:25,894 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:25,894 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:25,894 - INFO - Test data prepared
2025-04-17 22:28:25,895 - INFO - Storing data...
2025-04-17 22:28:25,895 - INFO - Aligning data indices...
2025-04-17 22:28:25,896 - INFO - Data indices aligned
2025-04-17 22:28:25,896 - INFO - Data preparation completed
2025-04-17 22:28:25,896 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:25,896 - INFO - Training models...
2025-04-17 22:28:25,896 - INFO - Starting model training...
2025-04-17 22:28:25,897 - INFO - Training regime classifier...
2025-04-17 22:28:25,897 - INFO - Training XGBoost model...
2025-04-17 22:28:25,897 - INFO - Preparing features...
2025-04-17 22:28:25,897 - INFO - Input shape: (1536, 8)
2025-04-17 22:28:25,897 - INFO - Handling missing values...
2025-04-17 22:28:25,898 - INFO - Missing values: 0 -> 0
2025-04-17 22:28:25,899 - INFO - Scaling features...
2025-04-17 22:28:25,900 - INFO - Fitted new scaler
2025-04-17 22:28:25,901 - INFO - Output shape: (1536, 8)
2025-04-17 22:28:26,031 - INFO - XGBoost model training completed
2025-04-17 22:28:26,263 - INFO - Model training completed
2025-04-17 22:28:26,265 - INFO - Model training completed
2025-04-17 22:28:26,265 - INFO - Initializing portfolio weights...
2025-04-17 22:28:26,265 - INFO - Portfolio weights initialized
2025-04-17 22:28:26,266 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:26,268 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:26,270 - INFO - Generated 41 regime predictions
2025-04-17 22:28:26,270 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:26,274 - INFO - Found 5 unique regimes
2025-04-17 22:28:26,275 - INFO - Processing regime 0...
2025-04-17 22:28:26,276 - INFO - Regime 0: 16 samples
2025-04-17 22:28:26,276 - INFO - Processing regime 1...
2025-04-17 22:28:26,277 - INFO - Regime 1: 4 samples
2025-04-17 22:28:26,277 - INFO - Processing regime 2...
2025-04-17 22:28:26,278 - INFO - Regime 2: 10 samples
2025-04-17 22:28:26,278 - INFO - Processing regime 3...
2025-04-17 22:28:26,279 - INFO - Regime 3: 3 samples
2025-04-17 22:28:26,279 - INFO - Processing regime 4...
2025-04-17 22:28:26,280 - INFO - Regime 4: 12 samples
2025-04-17 22:28:26,280 - INFO - Training portfolio optimizer...
2025-04-17 22:28:26,280 - INFO - Training neural regime optimizer...
2025-04-17 22:28:26,281 - INFO - Training model for regime 0 with 16 samples
2025-04-17 22:28:27,334 - INFO - Training model for regime 1 with 4 samples
2025-04-17 22:28:27,433 - INFO - Training model for regime 2 with 10 samples
2025-04-17 22:28:27,540 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:27,541 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:27,544 - WARNING - No model found for regime 3, using equal weights
2025-04-17 22:28:27,544 - WARNING - No model found for regime 3, using equal weights
2025-04-17 22:28:27,544 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,545 - WARNING - No model found for regime 3, using equal weights
2025-04-17 22:28:27,545 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,545 - WARNING - No model found for regime 3, using equal weights
2025-04-17 22:28:27,546 - WARNING - No model found for regime 3, using equal weights
2025-04-17 22:28:27,546 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,546 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,547 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,547 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,547 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,548 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,548 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,548 - WARNING - No model found for regime 3, using equal weights
2025-04-17 22:28:27,549 - WARNING - No model found for regime 3, using equal weights
2025-04-17 22:28:27,550 - WARNING - No model found for regime 3, using equal weights
2025-04-17 22:28:27,551 - WARNING - No model found for regime 3, using equal weights
2025-04-17 22:28:27,551 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,552 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,552 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,552 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,553 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,553 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,553 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,554 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,554 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,554 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,554 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,555 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,555 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,555 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,556 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,556 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:27,556 - INFO - Portfolio optimization completed
2025-04-17 22:28:27,556 - INFO - Initializing backtester...
2025-04-17 22:28:27,562 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:27,563 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:27,563 - INFO - Running backtest...
2025-04-17 22:28:27,563 - INFO - Starting backtest...
2025-04-17 22:28:27,563 - INFO - Calculating portfolio returns...
2025-04-17 22:28:27,563 - INFO - Calculating portfolio returns...
2025-04-17 22:28:27,565 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:27,565 - INFO - Calculating performance metrics...
2025-04-17 22:28:27,565 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:27,565 - INFO - Calculating metrics...
2025-04-17 22:28:27,567 - INFO - Performance metrics calculation completed
2025-04-17 22:28:27,567 - INFO - Backtest completed
2025-04-17 22:28:27,567 - INFO - Backtest completed
2025-04-17 22:28:27,568 - INFO - Strategy execution completed
2025-04-17 22:28:27,569 - ERROR - Error running xgboost with neural_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:27,571 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 5 regimes
2025-04-17 22:28:27,571 - INFO - Initializing strategy...
2025-04-17 22:28:27,571 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 22:28:27,571 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:27,571 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:28:27,572 - INFO - Running strategy...
2025-04-17 22:28:27,572 - INFO - Starting strategy execution...
2025-04-17 22:28:27,572 - INFO - Preparing training and testing data...
2025-04-17 22:28:27,572 - INFO - Starting data preparation...
2025-04-17 22:28:27,572 - INFO - Loading Fama-French factors...
2025-04-17 22:28:27,581 - INFO - Fama-French factors loaded
2025-04-17 22:28:27,582 - INFO - Processing factor data...
2025-04-17 22:28:27,584 - INFO - Factor data processed
2025-04-17 22:28:27,584 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:27,585 - INFO - 
Training Period:
2025-04-17 22:28:27,589 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:27,596 - INFO - 
Testing Period:
2025-04-17 22:28:27,600 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:27,607 - INFO - Loading macro and market data...
2025-04-17 22:28:27,608 - INFO - Loading existing macro data...
2025-04-17 22:28:27,619 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:27,619 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:27,622 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:27,623 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:27,623 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:27,624 - INFO - Loading existing macro data...
2025-04-17 22:28:27,633 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:27,633 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:27,636 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:27,636 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:27,636 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:27,637 - INFO - Loading existing market data...
2025-04-17 22:28:27,642 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:27,643 - INFO - Loading existing market data...
2025-04-17 22:28:27,647 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:27,647 - INFO - Macro and market data loaded
2025-04-17 22:28:27,647 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:27,648 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:27,649 - INFO - Loading existing macro data...
2025-04-17 22:28:27,658 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:27,658 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:27,661 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:27,661 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:27,661 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:27,662 - INFO - Loading existing market data...
2025-04-17 22:28:27,666 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:27,681 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:27,682 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:27,682 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:27,682 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:27,683 - INFO - Loading existing macro data...
2025-04-17 22:28:27,695 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:27,695 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:27,698 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:27,698 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:27,698 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:27,700 - INFO - Loading existing market data...
2025-04-17 22:28:27,703 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:27,711 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:27,712 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:27,712 - INFO - Test data prepared
2025-04-17 22:28:27,712 - INFO - Storing data...
2025-04-17 22:28:27,712 - INFO - Aligning data indices...
2025-04-17 22:28:27,713 - INFO - Data indices aligned
2025-04-17 22:28:27,714 - INFO - Data preparation completed
2025-04-17 22:28:27,714 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:27,714 - INFO - Training models...
2025-04-17 22:28:27,714 - INFO - Starting model training...
2025-04-17 22:28:27,714 - INFO - Training regime classifier...
2025-04-17 22:28:27,714 - INFO - Training XGBoost model...
2025-04-17 22:28:27,714 - INFO - Preparing features...
2025-04-17 22:28:27,715 - INFO - Input shape: (1536, 8)
2025-04-17 22:28:27,715 - INFO - Handling missing values...
2025-04-17 22:28:27,716 - INFO - Missing values: 0 -> 0
2025-04-17 22:28:27,716 - INFO - Scaling features...
2025-04-17 22:28:27,717 - INFO - Fitted new scaler
2025-04-17 22:28:27,718 - INFO - Output shape: (1536, 8)
2025-04-17 22:28:27,835 - INFO - XGBoost model training completed
2025-04-17 22:28:28,048 - INFO - Model training completed
2025-04-17 22:28:28,050 - INFO - Model training completed
2025-04-17 22:28:28,050 - INFO - Initializing portfolio weights...
2025-04-17 22:28:28,051 - INFO - Portfolio weights initialized
2025-04-17 22:28:28,051 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:28,053 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:28,055 - INFO - Generated 41 regime predictions
2025-04-17 22:28:28,055 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:28,059 - INFO - Found 5 unique regimes
2025-04-17 22:28:28,059 - INFO - Processing regime 0...
2025-04-17 22:28:28,061 - INFO - Regime 0: 16 samples
2025-04-17 22:28:28,061 - INFO - Processing regime 1...
2025-04-17 22:28:28,061 - INFO - Regime 1: 4 samples
2025-04-17 22:28:28,062 - INFO - Processing regime 2...
2025-04-17 22:28:28,062 - INFO - Regime 2: 10 samples
2025-04-17 22:28:28,063 - INFO - Processing regime 3...
2025-04-17 22:28:28,063 - INFO - Regime 3: 3 samples
2025-04-17 22:28:28,063 - INFO - Processing regime 4...
2025-04-17 22:28:28,064 - INFO - Regime 4: 12 samples
2025-04-17 22:28:28,064 - INFO - Training portfolio optimizer...
2025-04-17 22:28:28,064 - INFO - Training neural regime optimizer...
2025-04-17 22:28:28,065 - INFO - Training model for regime 0 with 16 samples
2025-04-17 22:28:28,186 - INFO - Training model for regime 1 with 4 samples
2025-04-17 22:28:28,276 - INFO - Training model for regime 2 with 10 samples
2025-04-17 22:28:28,368 - INFO - Training model for regime 3 with 3 samples
2025-04-17 22:28:28,456 - INFO - Training model for regime 4 with 12 samples
2025-04-17 22:28:28,552 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:28,552 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:28,566 - INFO - Portfolio optimization completed
2025-04-17 22:28:28,567 - INFO - Initializing backtester...
2025-04-17 22:28:28,574 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:28,575 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:28,575 - INFO - Running backtest...
2025-04-17 22:28:28,575 - INFO - Starting backtest...
2025-04-17 22:28:28,575 - INFO - Calculating portfolio returns...
2025-04-17 22:28:28,575 - INFO - Calculating portfolio returns...
2025-04-17 22:28:28,576 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:28,577 - INFO - Calculating performance metrics...
2025-04-17 22:28:28,577 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:28,577 - INFO - Calculating metrics...
2025-04-17 22:28:28,579 - INFO - Performance metrics calculation completed
2025-04-17 22:28:28,579 - INFO - Backtest completed
2025-04-17 22:28:28,579 - INFO - Backtest completed
2025-04-17 22:28:28,580 - INFO - Strategy execution completed
2025-04-17 22:28:28,581 - ERROR - Error running xgboost with neural_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:28,583 - INFO - 
Running strategy with xgboost classifier, neural_regime optimizer, and 7 regimes
2025-04-17 22:28:28,583 - INFO - Initializing strategy...
2025-04-17 22:28:28,583 - INFO - Initializing FactorTimingStrategy with xgboost model and neural_regime optimizer
2025-04-17 22:28:28,583 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:28,583 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:28:28,584 - INFO - Running strategy...
2025-04-17 22:28:28,584 - INFO - Starting strategy execution...
2025-04-17 22:28:28,585 - INFO - Preparing training and testing data...
2025-04-17 22:28:28,585 - INFO - Starting data preparation...
2025-04-17 22:28:28,585 - INFO - Loading Fama-French factors...
2025-04-17 22:28:28,595 - INFO - Fama-French factors loaded
2025-04-17 22:28:28,595 - INFO - Processing factor data...
2025-04-17 22:28:28,598 - INFO - Factor data processed
2025-04-17 22:28:28,598 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:28,598 - INFO - 
Training Period:
2025-04-17 22:28:28,603 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:28,611 - INFO - 
Testing Period:
2025-04-17 22:28:28,616 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:28,623 - INFO - Loading macro and market data...
2025-04-17 22:28:28,624 - INFO - Loading existing macro data...
2025-04-17 22:28:28,636 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:28,637 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:28,640 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:28,640 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:28,640 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:28,641 - INFO - Loading existing macro data...
2025-04-17 22:28:28,651 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:28,651 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:28,654 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:28,654 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:28,654 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:28,655 - INFO - Loading existing market data...
2025-04-17 22:28:28,659 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:28,660 - INFO - Loading existing market data...
2025-04-17 22:28:28,663 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:28,663 - INFO - Macro and market data loaded
2025-04-17 22:28:28,663 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:28,664 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:28,664 - INFO - Loading existing macro data...
2025-04-17 22:28:28,675 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:28,675 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:28,678 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:28,679 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:28,679 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:28,680 - INFO - Loading existing market data...
2025-04-17 22:28:28,683 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:28,699 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:28,699 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:28,699 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:28,700 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:28,701 - INFO - Loading existing macro data...
2025-04-17 22:28:28,712 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:28,713 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:28,716 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:28,716 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:28,716 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:28,717 - INFO - Loading existing market data...
2025-04-17 22:28:28,721 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:28,729 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:28,730 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:28,730 - INFO - Test data prepared
2025-04-17 22:28:28,730 - INFO - Storing data...
2025-04-17 22:28:28,730 - INFO - Aligning data indices...
2025-04-17 22:28:28,731 - INFO - Data indices aligned
2025-04-17 22:28:28,732 - INFO - Data preparation completed
2025-04-17 22:28:28,732 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:28,732 - INFO - Training models...
2025-04-17 22:28:28,732 - INFO - Starting model training...
2025-04-17 22:28:28,732 - INFO - Training regime classifier...
2025-04-17 22:28:28,732 - INFO - Training XGBoost model...
2025-04-17 22:28:28,733 - INFO - Preparing features...
2025-04-17 22:28:28,733 - INFO - Input shape: (1536, 8)
2025-04-17 22:28:28,733 - INFO - Handling missing values...
2025-04-17 22:28:28,734 - INFO - Missing values: 0 -> 0
2025-04-17 22:28:28,734 - INFO - Scaling features...
2025-04-17 22:28:28,736 - INFO - Fitted new scaler
2025-04-17 22:28:28,737 - INFO - Output shape: (1536, 8)
2025-04-17 22:28:28,851 - INFO - XGBoost model training completed
2025-04-17 22:28:29,067 - INFO - Model training completed
2025-04-17 22:28:29,069 - INFO - Model training completed
2025-04-17 22:28:29,069 - INFO - Initializing portfolio weights...
2025-04-17 22:28:29,070 - INFO - Portfolio weights initialized
2025-04-17 22:28:29,070 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:29,072 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:29,074 - INFO - Generated 41 regime predictions
2025-04-17 22:28:29,074 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:29,078 - INFO - Found 5 unique regimes
2025-04-17 22:28:29,078 - INFO - Processing regime 0...
2025-04-17 22:28:29,079 - INFO - Regime 0: 16 samples
2025-04-17 22:28:29,080 - INFO - Processing regime 1...
2025-04-17 22:28:29,080 - INFO - Regime 1: 4 samples
2025-04-17 22:28:29,081 - INFO - Processing regime 2...
2025-04-17 22:28:29,081 - INFO - Regime 2: 10 samples
2025-04-17 22:28:29,081 - INFO - Processing regime 3...
2025-04-17 22:28:29,082 - INFO - Regime 3: 3 samples
2025-04-17 22:28:29,082 - INFO - Processing regime 4...
2025-04-17 22:28:29,083 - INFO - Regime 4: 12 samples
2025-04-17 22:28:29,083 - INFO - Training portfolio optimizer...
2025-04-17 22:28:29,083 - INFO - Training neural regime optimizer...
2025-04-17 22:28:29,084 - INFO - Training model for regime 0 with 16 samples
2025-04-17 22:28:29,205 - INFO - Training model for regime 1 with 4 samples
2025-04-17 22:28:29,296 - INFO - Training model for regime 2 with 10 samples
2025-04-17 22:28:29,384 - INFO - Training model for regime 3 with 3 samples
2025-04-17 22:28:29,471 - INFO - Training model for regime 4 with 12 samples
2025-04-17 22:28:29,557 - WARNING - No samples found for regime 5
2025-04-17 22:28:29,558 - WARNING - No samples found for regime 6
2025-04-17 22:28:29,558 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:29,558 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:29,572 - INFO - Portfolio optimization completed
2025-04-17 22:28:29,573 - INFO - Initializing backtester...
2025-04-17 22:28:29,580 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:29,580 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:29,580 - INFO - Running backtest...
2025-04-17 22:28:29,581 - INFO - Starting backtest...
2025-04-17 22:28:29,581 - INFO - Calculating portfolio returns...
2025-04-17 22:28:29,581 - INFO - Calculating portfolio returns...
2025-04-17 22:28:29,582 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:29,582 - INFO - Calculating performance metrics...
2025-04-17 22:28:29,582 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:29,583 - INFO - Calculating metrics...
2025-04-17 22:28:29,585 - INFO - Performance metrics calculation completed
2025-04-17 22:28:29,585 - INFO - Backtest completed
2025-04-17 22:28:29,585 - INFO - Backtest completed
2025-04-17 22:28:29,586 - INFO - Strategy execution completed
2025-04-17 22:28:29,587 - ERROR - Error running xgboost with neural_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:29,589 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 22:28:29,589 - INFO - Initializing strategy...
2025-04-17 22:28:29,589 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 22:28:29,589 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:29,589 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:28:29,590 - INFO - Running strategy...
2025-04-17 22:28:29,590 - INFO - Starting strategy execution...
2025-04-17 22:28:29,590 - INFO - Preparing training and testing data...
2025-04-17 22:28:29,591 - INFO - Starting data preparation...
2025-04-17 22:28:29,591 - INFO - Loading Fama-French factors...
2025-04-17 22:28:29,599 - INFO - Fama-French factors loaded
2025-04-17 22:28:29,600 - INFO - Processing factor data...
2025-04-17 22:28:29,602 - INFO - Factor data processed
2025-04-17 22:28:29,602 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:29,602 - INFO - 
Training Period:
2025-04-17 22:28:29,606 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:29,613 - INFO - 
Testing Period:
2025-04-17 22:28:29,617 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:29,623 - INFO - Loading macro and market data...
2025-04-17 22:28:29,624 - INFO - Loading existing macro data...
2025-04-17 22:28:29,634 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:29,634 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:29,638 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:29,638 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:29,638 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:29,639 - INFO - Loading existing macro data...
2025-04-17 22:28:29,648 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:29,648 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:29,651 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:29,651 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:29,651 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:29,652 - INFO - Loading existing market data...
2025-04-17 22:28:29,656 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:29,657 - INFO - Loading existing market data...
2025-04-17 22:28:29,661 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:29,661 - INFO - Macro and market data loaded
2025-04-17 22:28:29,662 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:29,662 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:29,663 - INFO - Loading existing macro data...
2025-04-17 22:28:29,673 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:29,674 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:29,677 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:29,677 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:29,677 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:29,678 - INFO - Loading existing market data...
2025-04-17 22:28:29,682 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:29,697 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:29,698 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:29,698 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:29,698 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:29,699 - INFO - Loading existing macro data...
2025-04-17 22:28:29,710 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:29,711 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:29,714 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:29,714 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:29,715 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:29,716 - INFO - Loading existing market data...
2025-04-17 22:28:29,719 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:29,728 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:29,728 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:29,728 - INFO - Test data prepared
2025-04-17 22:28:29,728 - INFO - Storing data...
2025-04-17 22:28:29,728 - INFO - Aligning data indices...
2025-04-17 22:28:29,729 - INFO - Data indices aligned
2025-04-17 22:28:29,730 - INFO - Data preparation completed
2025-04-17 22:28:29,730 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:29,730 - INFO - Training models...
2025-04-17 22:28:29,730 - INFO - Starting model training...
2025-04-17 22:28:29,730 - INFO - Training regime classifier...
2025-04-17 22:28:29,730 - INFO - Training XGBoost model...
2025-04-17 22:28:29,731 - INFO - Preparing features...
2025-04-17 22:28:29,731 - INFO - Input shape: (1536, 8)
2025-04-17 22:28:29,731 - INFO - Handling missing values...
2025-04-17 22:28:29,732 - INFO - Missing values: 0 -> 0
2025-04-17 22:28:29,732 - INFO - Scaling features...
2025-04-17 22:28:29,733 - INFO - Fitted new scaler
2025-04-17 22:28:29,734 - INFO - Output shape: (1536, 8)
2025-04-17 22:28:29,873 - INFO - XGBoost model training completed
2025-04-17 22:28:30,085 - INFO - Model training completed
2025-04-17 22:28:30,086 - INFO - Model training completed
2025-04-17 22:28:30,086 - INFO - Initializing portfolio weights...
2025-04-17 22:28:30,087 - INFO - Portfolio weights initialized
2025-04-17 22:28:30,087 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:30,089 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:30,091 - INFO - Generated 41 regime predictions
2025-04-17 22:28:30,091 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:30,095 - INFO - Found 5 unique regimes
2025-04-17 22:28:30,095 - INFO - Processing regime 0...
2025-04-17 22:28:30,096 - INFO - Regime 0: 16 samples
2025-04-17 22:28:30,096 - INFO - Processing regime 1...
2025-04-17 22:28:30,097 - INFO - Regime 1: 4 samples
2025-04-17 22:28:30,097 - INFO - Processing regime 2...
2025-04-17 22:28:30,098 - INFO - Regime 2: 10 samples
2025-04-17 22:28:30,098 - INFO - Processing regime 3...
2025-04-17 22:28:30,099 - INFO - Regime 3: 3 samples
2025-04-17 22:28:30,099 - INFO - Processing regime 4...
2025-04-17 22:28:30,100 - INFO - Regime 4: 12 samples
2025-04-17 22:28:30,100 - INFO - Training portfolio optimizer...
2025-04-17 22:28:30,100 - INFO - Training autoencoder regime optimizer...
2025-04-17 22:28:30,100 - INFO - Training autoencoder for regime 0 with 16 samples
2025-04-17 22:28:30,254 - INFO - Training autoencoder for regime 1 with 4 samples
2025-04-17 22:28:30,378 - INFO - Training autoencoder for regime 2 with 10 samples
2025-04-17 22:28:30,505 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:30,505 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:30,506 - WARNING - No autoencoder found for regime 3, using equal weights
2025-04-17 22:28:30,507 - WARNING - No autoencoder found for regime 3, using equal weights
2025-04-17 22:28:30,507 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,507 - WARNING - No autoencoder found for regime 3, using equal weights
2025-04-17 22:28:30,508 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,508 - WARNING - No autoencoder found for regime 3, using equal weights
2025-04-17 22:28:30,508 - WARNING - No autoencoder found for regime 3, using equal weights
2025-04-17 22:28:30,508 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,509 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,509 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,509 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,509 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,509 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,510 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,510 - WARNING - No autoencoder found for regime 3, using equal weights
2025-04-17 22:28:30,511 - WARNING - No autoencoder found for regime 3, using equal weights
2025-04-17 22:28:30,511 - WARNING - No autoencoder found for regime 3, using equal weights
2025-04-17 22:28:30,513 - WARNING - No autoencoder found for regime 3, using equal weights
2025-04-17 22:28:30,513 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,513 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,513 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,514 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,514 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,514 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,514 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,514 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,515 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,515 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,515 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,515 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,516 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,516 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,516 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,517 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:30,517 - INFO - Portfolio optimization completed
2025-04-17 22:28:30,517 - INFO - Initializing backtester...
2025-04-17 22:28:30,522 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:30,523 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:30,523 - INFO - Running backtest...
2025-04-17 22:28:30,523 - INFO - Starting backtest...
2025-04-17 22:28:30,524 - INFO - Calculating portfolio returns...
2025-04-17 22:28:30,524 - INFO - Calculating portfolio returns...
2025-04-17 22:28:30,525 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:30,525 - INFO - Calculating performance metrics...
2025-04-17 22:28:30,525 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:30,525 - INFO - Calculating metrics...
2025-04-17 22:28:30,527 - INFO - Performance metrics calculation completed
2025-04-17 22:28:30,528 - INFO - Backtest completed
2025-04-17 22:28:30,528 - INFO - Backtest completed
2025-04-17 22:28:30,529 - INFO - Strategy execution completed
2025-04-17 22:28:30,530 - ERROR - Error running xgboost with autoencoder_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:30,531 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 22:28:30,531 - INFO - Initializing strategy...
2025-04-17 22:28:30,531 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 22:28:30,531 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:30,531 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:28:30,532 - INFO - Running strategy...
2025-04-17 22:28:30,532 - INFO - Starting strategy execution...
2025-04-17 22:28:30,532 - INFO - Preparing training and testing data...
2025-04-17 22:28:30,532 - INFO - Starting data preparation...
2025-04-17 22:28:30,533 - INFO - Loading Fama-French factors...
2025-04-17 22:28:30,541 - INFO - Fama-French factors loaded
2025-04-17 22:28:30,541 - INFO - Processing factor data...
2025-04-17 22:28:30,543 - INFO - Factor data processed
2025-04-17 22:28:30,543 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:30,543 - INFO - 
Training Period:
2025-04-17 22:28:30,547 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:30,554 - INFO - 
Testing Period:
2025-04-17 22:28:30,558 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:30,567 - INFO - Loading macro and market data...
2025-04-17 22:28:30,568 - INFO - Loading existing macro data...
2025-04-17 22:28:30,577 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:30,577 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:30,580 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:30,580 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:30,581 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:30,581 - INFO - Loading existing macro data...
2025-04-17 22:28:30,590 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:30,591 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:30,593 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:30,593 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:30,594 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:30,594 - INFO - Loading existing market data...
2025-04-17 22:28:30,598 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:30,598 - INFO - Loading existing market data...
2025-04-17 22:28:30,601 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:30,602 - INFO - Macro and market data loaded
2025-04-17 22:28:30,602 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:30,602 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:30,603 - INFO - Loading existing macro data...
2025-04-17 22:28:30,611 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:30,612 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:30,615 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:30,615 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:30,615 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:30,616 - INFO - Loading existing market data...
2025-04-17 22:28:30,619 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:30,633 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:30,633 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:30,634 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:30,634 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:30,635 - INFO - Loading existing macro data...
2025-04-17 22:28:30,645 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:30,646 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:30,649 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:30,649 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:30,650 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:30,651 - INFO - Loading existing market data...
2025-04-17 22:28:30,654 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:30,662 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:30,663 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:30,663 - INFO - Test data prepared
2025-04-17 22:28:30,663 - INFO - Storing data...
2025-04-17 22:28:30,663 - INFO - Aligning data indices...
2025-04-17 22:28:30,665 - INFO - Data indices aligned
2025-04-17 22:28:30,665 - INFO - Data preparation completed
2025-04-17 22:28:30,665 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:30,665 - INFO - Training models...
2025-04-17 22:28:30,666 - INFO - Starting model training...
2025-04-17 22:28:30,666 - INFO - Training regime classifier...
2025-04-17 22:28:30,666 - INFO - Training XGBoost model...
2025-04-17 22:28:30,666 - INFO - Preparing features...
2025-04-17 22:28:30,666 - INFO - Input shape: (1536, 8)
2025-04-17 22:28:30,666 - INFO - Handling missing values...
2025-04-17 22:28:30,667 - INFO - Missing values: 0 -> 0
2025-04-17 22:28:30,667 - INFO - Scaling features...
2025-04-17 22:28:30,668 - INFO - Fitted new scaler
2025-04-17 22:28:30,669 - INFO - Output shape: (1536, 8)
2025-04-17 22:28:30,778 - INFO - XGBoost model training completed
2025-04-17 22:28:30,982 - INFO - Model training completed
2025-04-17 22:28:30,984 - INFO - Model training completed
2025-04-17 22:28:30,984 - INFO - Initializing portfolio weights...
2025-04-17 22:28:30,984 - INFO - Portfolio weights initialized
2025-04-17 22:28:30,985 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:30,987 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:30,988 - INFO - Generated 41 regime predictions
2025-04-17 22:28:30,989 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:30,992 - INFO - Found 5 unique regimes
2025-04-17 22:28:30,993 - INFO - Processing regime 0...
2025-04-17 22:28:30,993 - INFO - Regime 0: 16 samples
2025-04-17 22:28:30,994 - INFO - Processing regime 1...
2025-04-17 22:28:30,994 - INFO - Regime 1: 4 samples
2025-04-17 22:28:30,994 - INFO - Processing regime 2...
2025-04-17 22:28:30,995 - INFO - Regime 2: 10 samples
2025-04-17 22:28:30,995 - INFO - Processing regime 3...
2025-04-17 22:28:30,996 - INFO - Regime 3: 3 samples
2025-04-17 22:28:30,996 - INFO - Processing regime 4...
2025-04-17 22:28:30,997 - INFO - Regime 4: 12 samples
2025-04-17 22:28:30,997 - INFO - Training portfolio optimizer...
2025-04-17 22:28:30,997 - INFO - Training autoencoder regime optimizer...
2025-04-17 22:28:30,997 - INFO - Training autoencoder for regime 0 with 16 samples
2025-04-17 22:28:31,152 - INFO - Training autoencoder for regime 1 with 4 samples
2025-04-17 22:28:31,272 - INFO - Training autoencoder for regime 2 with 10 samples
2025-04-17 22:28:31,391 - INFO - Training autoencoder for regime 3 with 3 samples
2025-04-17 22:28:31,509 - INFO - Training autoencoder for regime 4 with 12 samples
2025-04-17 22:28:31,631 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:31,632 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:31,646 - INFO - Portfolio optimization completed
2025-04-17 22:28:31,646 - INFO - Initializing backtester...
2025-04-17 22:28:31,651 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:31,652 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:31,652 - INFO - Running backtest...
2025-04-17 22:28:31,652 - INFO - Starting backtest...
2025-04-17 22:28:31,652 - INFO - Calculating portfolio returns...
2025-04-17 22:28:31,652 - INFO - Calculating portfolio returns...
2025-04-17 22:28:31,653 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:31,653 - INFO - Calculating performance metrics...
2025-04-17 22:28:31,653 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:31,654 - INFO - Calculating metrics...
2025-04-17 22:28:31,656 - INFO - Performance metrics calculation completed
2025-04-17 22:28:31,656 - INFO - Backtest completed
2025-04-17 22:28:31,656 - INFO - Backtest completed
2025-04-17 22:28:31,657 - INFO - Strategy execution completed
2025-04-17 22:28:31,658 - ERROR - Error running xgboost with autoencoder_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:31,659 - INFO - 
Running strategy with xgboost classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 22:28:31,659 - INFO - Initializing strategy...
2025-04-17 22:28:31,659 - INFO - Initializing FactorTimingStrategy with xgboost model and autoencoder_regime optimizer
2025-04-17 22:28:31,659 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:31,659 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:28:31,660 - INFO - Running strategy...
2025-04-17 22:28:31,660 - INFO - Starting strategy execution...
2025-04-17 22:28:31,660 - INFO - Preparing training and testing data...
2025-04-17 22:28:31,660 - INFO - Starting data preparation...
2025-04-17 22:28:31,661 - INFO - Loading Fama-French factors...
2025-04-17 22:28:31,669 - INFO - Fama-French factors loaded
2025-04-17 22:28:31,669 - INFO - Processing factor data...
2025-04-17 22:28:31,671 - INFO - Factor data processed
2025-04-17 22:28:31,671 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:31,672 - INFO - 
Training Period:
2025-04-17 22:28:31,675 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:31,682 - INFO - 
Testing Period:
2025-04-17 22:28:31,687 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:31,693 - INFO - Loading macro and market data...
2025-04-17 22:28:31,694 - INFO - Loading existing macro data...
2025-04-17 22:28:31,705 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:31,706 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:31,709 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:31,709 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:31,709 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:31,710 - INFO - Loading existing macro data...
2025-04-17 22:28:31,719 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:31,719 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:31,721 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:31,722 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:31,722 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:31,723 - INFO - Loading existing market data...
2025-04-17 22:28:31,726 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:31,727 - INFO - Loading existing market data...
2025-04-17 22:28:31,730 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:31,730 - INFO - Macro and market data loaded
2025-04-17 22:28:31,730 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:31,731 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:31,731 - INFO - Loading existing macro data...
2025-04-17 22:28:31,740 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:31,741 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:31,743 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:31,744 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:31,744 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:31,745 - INFO - Loading existing market data...
2025-04-17 22:28:31,748 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:31,761 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:31,761 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:31,762 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:31,762 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:31,763 - INFO - Loading existing macro data...
2025-04-17 22:28:31,773 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:31,773 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:31,776 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:31,776 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:31,776 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:31,777 - INFO - Loading existing market data...
2025-04-17 22:28:31,781 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:31,789 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:31,790 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:31,790 - INFO - Test data prepared
2025-04-17 22:28:31,790 - INFO - Storing data...
2025-04-17 22:28:31,791 - INFO - Aligning data indices...
2025-04-17 22:28:31,792 - INFO - Data indices aligned
2025-04-17 22:28:31,792 - INFO - Data preparation completed
2025-04-17 22:28:31,792 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:31,792 - INFO - Training models...
2025-04-17 22:28:31,793 - INFO - Starting model training...
2025-04-17 22:28:31,793 - INFO - Training regime classifier...
2025-04-17 22:28:31,793 - INFO - Training XGBoost model...
2025-04-17 22:28:31,793 - INFO - Preparing features...
2025-04-17 22:28:31,793 - INFO - Input shape: (1536, 8)
2025-04-17 22:28:31,793 - INFO - Handling missing values...
2025-04-17 22:28:31,794 - INFO - Missing values: 0 -> 0
2025-04-17 22:28:31,794 - INFO - Scaling features...
2025-04-17 22:28:31,795 - INFO - Fitted new scaler
2025-04-17 22:28:31,796 - INFO - Output shape: (1536, 8)
2025-04-17 22:28:31,906 - INFO - XGBoost model training completed
2025-04-17 22:28:32,112 - INFO - Model training completed
2025-04-17 22:28:32,114 - INFO - Model training completed
2025-04-17 22:28:32,114 - INFO - Initializing portfolio weights...
2025-04-17 22:28:32,115 - INFO - Portfolio weights initialized
2025-04-17 22:28:32,115 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:32,117 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:32,119 - INFO - Generated 41 regime predictions
2025-04-17 22:28:32,119 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:32,123 - INFO - Found 5 unique regimes
2025-04-17 22:28:32,123 - INFO - Processing regime 0...
2025-04-17 22:28:32,124 - INFO - Regime 0: 16 samples
2025-04-17 22:28:32,124 - INFO - Processing regime 1...
2025-04-17 22:28:32,125 - INFO - Regime 1: 4 samples
2025-04-17 22:28:32,125 - INFO - Processing regime 2...
2025-04-17 22:28:32,126 - INFO - Regime 2: 10 samples
2025-04-17 22:28:32,126 - INFO - Processing regime 3...
2025-04-17 22:28:32,127 - INFO - Regime 3: 3 samples
2025-04-17 22:28:32,127 - INFO - Processing regime 4...
2025-04-17 22:28:32,128 - INFO - Regime 4: 12 samples
2025-04-17 22:28:32,128 - INFO - Training portfolio optimizer...
2025-04-17 22:28:32,128 - INFO - Training autoencoder regime optimizer...
2025-04-17 22:28:32,128 - INFO - Training autoencoder for regime 0 with 16 samples
2025-04-17 22:28:32,280 - INFO - Training autoencoder for regime 1 with 4 samples
2025-04-17 22:28:32,405 - INFO - Training autoencoder for regime 2 with 10 samples
2025-04-17 22:28:32,527 - INFO - Training autoencoder for regime 3 with 3 samples
2025-04-17 22:28:32,654 - INFO - Training autoencoder for regime 4 with 12 samples
2025-04-17 22:28:32,774 - WARNING - No samples found for regime 5
2025-04-17 22:28:32,774 - WARNING - No samples found for regime 6
2025-04-17 22:28:32,774 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:32,775 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:32,788 - INFO - Portfolio optimization completed
2025-04-17 22:28:32,789 - INFO - Initializing backtester...
2025-04-17 22:28:32,794 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:32,795 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:32,795 - INFO - Running backtest...
2025-04-17 22:28:32,795 - INFO - Starting backtest...
2025-04-17 22:28:32,795 - INFO - Calculating portfolio returns...
2025-04-17 22:28:32,796 - INFO - Calculating portfolio returns...
2025-04-17 22:28:32,797 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:32,797 - INFO - Calculating performance metrics...
2025-04-17 22:28:32,797 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:32,797 - INFO - Calculating metrics...
2025-04-17 22:28:32,799 - INFO - Performance metrics calculation completed
2025-04-17 22:28:32,799 - INFO - Backtest completed
2025-04-17 22:28:32,800 - INFO - Backtest completed
2025-04-17 22:28:32,800 - INFO - Strategy execution completed
2025-04-17 22:28:32,801 - ERROR - Error running xgboost with autoencoder_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 224, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:32,803 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 3 regimes
2025-04-17 22:28:32,803 - INFO - Initializing strategy...
2025-04-17 22:28:32,803 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 22:28:32,803 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:32,803 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:28:32,804 - INFO - Running strategy...
2025-04-17 22:28:32,805 - INFO - Starting strategy execution...
2025-04-17 22:28:32,805 - INFO - Preparing training and testing data...
2025-04-17 22:28:32,805 - INFO - Starting data preparation...
2025-04-17 22:28:32,805 - INFO - Loading Fama-French factors...
2025-04-17 22:28:32,813 - INFO - Fama-French factors loaded
2025-04-17 22:28:32,813 - INFO - Processing factor data...
2025-04-17 22:28:32,815 - INFO - Factor data processed
2025-04-17 22:28:32,815 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:32,816 - INFO - 
Training Period:
2025-04-17 22:28:32,819 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:32,826 - INFO - 
Testing Period:
2025-04-17 22:28:32,830 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:32,837 - INFO - Loading macro and market data...
2025-04-17 22:28:32,838 - INFO - Loading existing macro data...
2025-04-17 22:28:32,847 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:32,847 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:32,850 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:32,850 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:32,850 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:32,851 - INFO - Loading existing macro data...
2025-04-17 22:28:32,860 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:32,860 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:32,862 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:32,863 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:32,863 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:32,864 - INFO - Loading existing market data...
2025-04-17 22:28:32,868 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:32,868 - INFO - Loading existing market data...
2025-04-17 22:28:32,871 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:32,871 - INFO - Macro and market data loaded
2025-04-17 22:28:32,871 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:32,871 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:32,872 - INFO - Loading existing macro data...
2025-04-17 22:28:32,881 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:32,881 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:32,884 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:32,884 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:32,884 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:32,885 - INFO - Loading existing market data...
2025-04-17 22:28:32,888 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:32,901 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:32,902 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:32,902 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:32,902 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:32,903 - INFO - Loading existing macro data...
2025-04-17 22:28:32,913 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:32,913 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:32,917 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:32,917 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:32,917 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:32,918 - INFO - Loading existing market data...
2025-04-17 22:28:32,922 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:32,931 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:32,931 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:32,931 - INFO - Test data prepared
2025-04-17 22:28:32,931 - INFO - Storing data...
2025-04-17 22:28:32,932 - INFO - Aligning data indices...
2025-04-17 22:28:32,933 - INFO - Data indices aligned
2025-04-17 22:28:32,933 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:28:32,934 - INFO - Data preparation completed
2025-04-17 22:28:32,934 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:32,934 - INFO - Training models...
2025-04-17 22:28:32,934 - INFO - Starting model training...
2025-04-17 22:28:32,934 - INFO - Training regime classifier...
2025-04-17 22:28:32,934 - INFO - Training XGBoost model...
2025-04-17 22:28:32,934 - INFO - Preparing features...
2025-04-17 22:28:32,934 - INFO - Input shape: (1536, 8)
2025-04-17 22:28:32,935 - INFO - Handling missing values...
2025-04-17 22:28:32,936 - INFO - Missing values: 0 -> 0
2025-04-17 22:28:32,936 - INFO - Scaling features...
2025-04-17 22:28:32,938 - INFO - Fitted new scaler
2025-04-17 22:28:32,939 - INFO - Output shape: (1536, 8)
2025-04-17 22:28:33,046 - INFO - XGBoost model training completed
2025-04-17 22:28:33,253 - INFO - Training neural portfolio optimizer...
2025-04-17 22:28:33,254 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:28:33,254 - INFO - Model training completed
2025-04-17 22:28:33,255 - INFO - Model training completed
2025-04-17 22:28:33,255 - INFO - Initializing portfolio weights...
2025-04-17 22:28:33,256 - INFO - Portfolio weights initialized
2025-04-17 22:28:33,256 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:33,258 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:33,260 - INFO - Generated 41 regime predictions
2025-04-17 22:28:33,260 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:33,264 - INFO - Found 5 unique regimes
2025-04-17 22:28:33,264 - INFO - Processing regime 0...
2025-04-17 22:28:33,265 - INFO - Regime 0: 16 samples
2025-04-17 22:28:33,265 - INFO - Processing regime 1...
2025-04-17 22:28:33,266 - INFO - Regime 1: 4 samples
2025-04-17 22:28:33,266 - INFO - Processing regime 2...
2025-04-17 22:28:33,267 - INFO - Regime 2: 10 samples
2025-04-17 22:28:33,267 - INFO - Processing regime 3...
2025-04-17 22:28:33,268 - INFO - Regime 3: 3 samples
2025-04-17 22:28:33,268 - INFO - Processing regime 4...
2025-04-17 22:28:33,269 - INFO - Regime 4: 12 samples
2025-04-17 22:28:33,270 - INFO - Training portfolio optimizer...
2025-04-17 22:28:33,270 - ERROR - Error running xgboost with neural and 3 regimes: mat1 and mat2 shapes cannot be multiplied (45x5 and 8x64)
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 361, in run_strategy
    self.portfolio_optimizer.train(train_factors, target_weights)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\optimizer\portfolio_optimizer.py", line 128, in train
    predictions = self.model(features_tensor)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\Desktop\factor_timing\optimizer\portfolio_optimizer.py", line 141, in forward
    x = torch.relu(self.fc1(x))
                   ~~~~~~~~^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\linear.py", line 125, in forward
    return F.linear(input, self.weight, self.bias)
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: mat1 and mat2 shapes cannot be multiplied (45x5 and 8x64)
2025-04-17 22:28:33,274 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 5 regimes
2025-04-17 22:28:33,274 - INFO - Initializing strategy...
2025-04-17 22:28:33,274 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 22:28:33,275 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:33,275 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:28:33,276 - INFO - Running strategy...
2025-04-17 22:28:33,276 - INFO - Starting strategy execution...
2025-04-17 22:28:33,276 - INFO - Preparing training and testing data...
2025-04-17 22:28:33,276 - INFO - Starting data preparation...
2025-04-17 22:28:33,276 - INFO - Loading Fama-French factors...
2025-04-17 22:28:33,289 - INFO - Fama-French factors loaded
2025-04-17 22:28:33,289 - INFO - Processing factor data...
2025-04-17 22:28:33,292 - INFO - Factor data processed
2025-04-17 22:28:33,292 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:33,292 - INFO - 
Training Period:
2025-04-17 22:28:33,297 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:33,305 - INFO - 
Testing Period:
2025-04-17 22:28:33,310 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:33,319 - INFO - Loading macro and market data...
2025-04-17 22:28:33,320 - INFO - Loading existing macro data...
2025-04-17 22:28:33,332 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:33,332 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:33,335 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:33,336 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:33,336 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:33,337 - INFO - Loading existing macro data...
2025-04-17 22:28:33,348 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:33,348 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:33,351 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:33,351 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:33,352 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:33,353 - INFO - Loading existing market data...
2025-04-17 22:28:33,357 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:33,357 - INFO - Loading existing market data...
2025-04-17 22:28:33,361 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:33,361 - INFO - Macro and market data loaded
2025-04-17 22:28:33,361 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:33,361 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:33,362 - INFO - Loading existing macro data...
2025-04-17 22:28:33,371 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:33,372 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:33,374 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:33,375 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:33,375 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:33,376 - INFO - Loading existing market data...
2025-04-17 22:28:33,379 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:33,392 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:33,393 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:33,393 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:33,393 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:33,394 - INFO - Loading existing macro data...
2025-04-17 22:28:33,404 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:33,404 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:33,407 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:33,407 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:33,407 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:33,408 - INFO - Loading existing market data...
2025-04-17 22:28:33,411 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:33,419 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:33,419 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:33,419 - INFO - Test data prepared
2025-04-17 22:28:33,419 - INFO - Storing data...
2025-04-17 22:28:33,420 - INFO - Aligning data indices...
2025-04-17 22:28:33,421 - INFO - Data indices aligned
2025-04-17 22:28:33,422 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:28:33,422 - INFO - Data preparation completed
2025-04-17 22:28:33,422 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:33,422 - INFO - Training models...
2025-04-17 22:28:33,422 - INFO - Starting model training...
2025-04-17 22:28:33,422 - INFO - Training regime classifier...
2025-04-17 22:28:33,423 - INFO - Training XGBoost model...
2025-04-17 22:28:33,423 - INFO - Preparing features...
2025-04-17 22:28:33,423 - INFO - Input shape: (1536, 8)
2025-04-17 22:28:33,423 - INFO - Handling missing values...
2025-04-17 22:28:33,424 - INFO - Missing values: 0 -> 0
2025-04-17 22:28:33,424 - INFO - Scaling features...
2025-04-17 22:28:33,425 - INFO - Fitted new scaler
2025-04-17 22:28:33,426 - INFO - Output shape: (1536, 8)
2025-04-17 22:28:33,538 - INFO - XGBoost model training completed
2025-04-17 22:28:33,748 - INFO - Training neural portfolio optimizer...
2025-04-17 22:28:33,749 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:28:33,749 - INFO - Model training completed
2025-04-17 22:28:33,751 - INFO - Model training completed
2025-04-17 22:28:33,751 - INFO - Initializing portfolio weights...
2025-04-17 22:28:33,751 - INFO - Portfolio weights initialized
2025-04-17 22:28:33,751 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:33,753 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:33,755 - INFO - Generated 41 regime predictions
2025-04-17 22:28:33,755 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:33,759 - INFO - Found 5 unique regimes
2025-04-17 22:28:33,759 - INFO - Processing regime 0...
2025-04-17 22:28:33,760 - INFO - Regime 0: 16 samples
2025-04-17 22:28:33,760 - INFO - Processing regime 1...
2025-04-17 22:28:33,761 - INFO - Regime 1: 4 samples
2025-04-17 22:28:33,761 - INFO - Processing regime 2...
2025-04-17 22:28:33,762 - INFO - Regime 2: 10 samples
2025-04-17 22:28:33,762 - INFO - Processing regime 3...
2025-04-17 22:28:33,763 - INFO - Regime 3: 3 samples
2025-04-17 22:28:33,763 - INFO - Processing regime 4...
2025-04-17 22:28:33,764 - INFO - Regime 4: 12 samples
2025-04-17 22:28:33,764 - INFO - Training portfolio optimizer...
2025-04-17 22:28:33,765 - ERROR - Error running xgboost with neural and 5 regimes: mat1 and mat2 shapes cannot be multiplied (45x5 and 8x64)
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 361, in run_strategy
    self.portfolio_optimizer.train(train_factors, target_weights)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\optimizer\portfolio_optimizer.py", line 128, in train
    predictions = self.model(features_tensor)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\Desktop\factor_timing\optimizer\portfolio_optimizer.py", line 141, in forward
    x = torch.relu(self.fc1(x))
                   ~~~~~~~~^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\linear.py", line 125, in forward
    return F.linear(input, self.weight, self.bias)
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: mat1 and mat2 shapes cannot be multiplied (45x5 and 8x64)
2025-04-17 22:28:33,767 - INFO - 
Running strategy with xgboost classifier, neural optimizer, and 7 regimes
2025-04-17 22:28:33,767 - INFO - Initializing strategy...
2025-04-17 22:28:33,767 - INFO - Initializing FactorTimingStrategy with xgboost model and neural optimizer
2025-04-17 22:28:33,768 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:33,768 - INFO - Initialized XGBoostRegimeClassifier with 5 regimes
2025-04-17 22:28:33,769 - INFO - Running strategy...
2025-04-17 22:28:33,769 - INFO - Starting strategy execution...
2025-04-17 22:28:33,769 - INFO - Preparing training and testing data...
2025-04-17 22:28:33,769 - INFO - Starting data preparation...
2025-04-17 22:28:33,769 - INFO - Loading Fama-French factors...
2025-04-17 22:28:33,781 - INFO - Fama-French factors loaded
2025-04-17 22:28:33,781 - INFO - Processing factor data...
2025-04-17 22:28:33,784 - INFO - Factor data processed
2025-04-17 22:28:33,785 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:33,785 - INFO - 
Training Period:
2025-04-17 22:28:33,790 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:33,798 - INFO - 
Testing Period:
2025-04-17 22:28:33,803 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:33,811 - INFO - Loading macro and market data...
2025-04-17 22:28:33,812 - INFO - Loading existing macro data...
2025-04-17 22:28:33,824 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:33,824 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:33,828 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:33,828 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:33,828 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:33,829 - INFO - Loading existing macro data...
2025-04-17 22:28:33,840 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:33,840 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:33,991 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:33,991 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:33,992 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:33,993 - INFO - Loading existing market data...
2025-04-17 22:28:33,996 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:33,997 - INFO - Loading existing market data...
2025-04-17 22:28:34,000 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:34,000 - INFO - Macro and market data loaded
2025-04-17 22:28:34,000 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:34,000 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:34,001 - INFO - Loading existing macro data...
2025-04-17 22:28:34,009 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:34,010 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:34,012 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:34,013 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:34,013 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:34,014 - INFO - Loading existing market data...
2025-04-17 22:28:34,017 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:34,030 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:34,031 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:34,031 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:34,031 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:34,032 - INFO - Loading existing macro data...
2025-04-17 22:28:34,041 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:34,042 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:34,044 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:34,044 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:34,044 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:34,045 - INFO - Loading existing market data...
2025-04-17 22:28:34,048 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:34,056 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:34,057 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:34,057 - INFO - Test data prepared
2025-04-17 22:28:34,057 - INFO - Storing data...
2025-04-17 22:28:34,057 - INFO - Aligning data indices...
2025-04-17 22:28:34,059 - INFO - Data indices aligned
2025-04-17 22:28:34,059 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:28:34,059 - INFO - Data preparation completed
2025-04-17 22:28:34,060 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:34,060 - INFO - Training models...
2025-04-17 22:28:34,060 - INFO - Starting model training...
2025-04-17 22:28:34,060 - INFO - Training regime classifier...
2025-04-17 22:28:34,060 - INFO - Training XGBoost model...
2025-04-17 22:28:34,061 - INFO - Preparing features...
2025-04-17 22:28:34,061 - INFO - Input shape: (1536, 8)
2025-04-17 22:28:34,061 - INFO - Handling missing values...
2025-04-17 22:28:34,062 - INFO - Missing values: 0 -> 0
2025-04-17 22:28:34,062 - INFO - Scaling features...
2025-04-17 22:28:34,063 - INFO - Fitted new scaler
2025-04-17 22:28:34,064 - INFO - Output shape: (1536, 8)
2025-04-17 22:28:34,172 - INFO - XGBoost model training completed
2025-04-17 22:28:34,378 - INFO - Training neural portfolio optimizer...
2025-04-17 22:28:34,378 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:28:34,378 - INFO - Model training completed
2025-04-17 22:28:34,380 - INFO - Model training completed
2025-04-17 22:28:34,380 - INFO - Initializing portfolio weights...
2025-04-17 22:28:34,380 - INFO - Portfolio weights initialized
2025-04-17 22:28:34,381 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:34,382 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:34,384 - INFO - Generated 41 regime predictions
2025-04-17 22:28:34,384 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:34,388 - INFO - Found 5 unique regimes
2025-04-17 22:28:34,388 - INFO - Processing regime 0...
2025-04-17 22:28:34,389 - INFO - Regime 0: 16 samples
2025-04-17 22:28:34,389 - INFO - Processing regime 1...
2025-04-17 22:28:34,390 - INFO - Regime 1: 4 samples
2025-04-17 22:28:34,390 - INFO - Processing regime 2...
2025-04-17 22:28:34,391 - INFO - Regime 2: 10 samples
2025-04-17 22:28:34,391 - INFO - Processing regime 3...
2025-04-17 22:28:34,392 - INFO - Regime 3: 3 samples
2025-04-17 22:28:34,392 - INFO - Processing regime 4...
2025-04-17 22:28:34,393 - INFO - Regime 4: 12 samples
2025-04-17 22:28:34,393 - INFO - Training portfolio optimizer...
2025-04-17 22:28:34,394 - ERROR - Error running xgboost with neural and 7 regimes: mat1 and mat2 shapes cannot be multiplied (45x5 and 8x64)
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 361, in run_strategy
    self.portfolio_optimizer.train(train_factors, target_weights)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\optimizer\portfolio_optimizer.py", line 128, in train
    predictions = self.model(features_tensor)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\Desktop\factor_timing\optimizer\portfolio_optimizer.py", line 141, in forward
    x = torch.relu(self.fc1(x))
                   ~~~~~~~~^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\linear.py", line 125, in forward
    return F.linear(input, self.weight, self.bias)
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: mat1 and mat2 shapes cannot be multiplied (45x5 and 8x64)
2025-04-17 22:28:34,396 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 3 regimes
2025-04-17 22:28:34,396 - INFO - Initializing strategy...
2025-04-17 22:28:34,396 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 22:28:34,396 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:34,396 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:28:34,397 - INFO - Running strategy...
2025-04-17 22:28:34,397 - INFO - Starting strategy execution...
2025-04-17 22:28:34,397 - INFO - Preparing training and testing data...
2025-04-17 22:28:34,397 - INFO - Starting data preparation...
2025-04-17 22:28:34,397 - INFO - Loading Fama-French factors...
2025-04-17 22:28:34,409 - INFO - Fama-French factors loaded
2025-04-17 22:28:34,409 - INFO - Processing factor data...
2025-04-17 22:28:34,412 - INFO - Factor data processed
2025-04-17 22:28:34,412 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:34,412 - INFO - 
Training Period:
2025-04-17 22:28:34,417 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:34,426 - INFO - 
Testing Period:
2025-04-17 22:28:34,431 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:34,439 - INFO - Loading macro and market data...
2025-04-17 22:28:34,440 - INFO - Loading existing macro data...
2025-04-17 22:28:34,452 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:34,452 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:34,456 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:34,456 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:34,456 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:34,457 - INFO - Loading existing macro data...
2025-04-17 22:28:34,468 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:34,468 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:34,471 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:34,472 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:34,472 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:34,473 - INFO - Loading existing market data...
2025-04-17 22:28:34,477 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:34,478 - INFO - Loading existing market data...
2025-04-17 22:28:34,481 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:34,481 - INFO - Macro and market data loaded
2025-04-17 22:28:34,481 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:34,482 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:34,483 - INFO - Loading existing macro data...
2025-04-17 22:28:34,492 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:34,493 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:34,495 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:34,496 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:34,496 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:34,497 - INFO - Loading existing market data...
2025-04-17 22:28:34,500 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:34,514 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:34,514 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:34,515 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:34,515 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:34,516 - INFO - Loading existing macro data...
2025-04-17 22:28:34,525 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:34,525 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:34,528 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:34,529 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:34,529 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:34,530 - INFO - Loading existing market data...
2025-04-17 22:28:34,533 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:34,541 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:34,541 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:34,541 - INFO - Test data prepared
2025-04-17 22:28:34,542 - INFO - Storing data...
2025-04-17 22:28:34,542 - INFO - Aligning data indices...
2025-04-17 22:28:34,543 - INFO - Data indices aligned
2025-04-17 22:28:34,543 - INFO - Data preparation completed
2025-04-17 22:28:34,543 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:34,544 - INFO - Training models...
2025-04-17 22:28:34,544 - INFO - Starting model training...
2025-04-17 22:28:34,544 - INFO - Training regime classifier...
2025-04-17 22:28:34,544 - INFO - Training HMM model...
2025-04-17 22:28:34,744 - INFO - HMM model training completed
2025-04-17 22:28:34,922 - INFO - Model training completed
2025-04-17 22:28:34,924 - INFO - Model training completed
2025-04-17 22:28:34,924 - INFO - Initializing portfolio weights...
2025-04-17 22:28:34,924 - INFO - Portfolio weights initialized
2025-04-17 22:28:34,924 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:34,926 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:34,929 - INFO - Generated 41 regime predictions
2025-04-17 22:28:34,930 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:34,933 - INFO - Found 4 unique regimes
2025-04-17 22:28:34,934 - INFO - Processing regime 0...
2025-04-17 22:28:34,934 - INFO - Regime 0: 4 samples
2025-04-17 22:28:34,934 - INFO - Processing regime 1...
2025-04-17 22:28:34,935 - INFO - Regime 1: 16 samples
2025-04-17 22:28:34,935 - INFO - Processing regime 3...
2025-04-17 22:28:34,936 - INFO - Regime 3: 9 samples
2025-04-17 22:28:34,936 - INFO - Processing regime 4...
2025-04-17 22:28:34,937 - INFO - Regime 4: 16 samples
2025-04-17 22:28:34,937 - INFO - Training portfolio optimizer...
2025-04-17 22:28:34,937 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:34,937 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:34,937 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:34,937 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:34,938 - WARNING - All weights are zero, using equal weights
2025-04-17 22:28:34,957 - INFO - Portfolio optimization completed
2025-04-17 22:28:34,957 - INFO - Initializing backtester...
2025-04-17 22:28:34,962 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:34,963 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:34,963 - INFO - Running backtest...
2025-04-17 22:28:34,964 - INFO - Starting backtest...
2025-04-17 22:28:34,964 - INFO - Calculating portfolio returns...
2025-04-17 22:28:34,964 - INFO - Calculating portfolio returns...
2025-04-17 22:28:34,965 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:34,965 - INFO - Calculating performance metrics...
2025-04-17 22:28:34,965 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:34,965 - INFO - Calculating metrics...
2025-04-17 22:28:34,967 - INFO - Performance metrics calculation completed
2025-04-17 22:28:34,968 - INFO - Backtest completed
2025-04-17 22:28:34,968 - INFO - Backtest completed
2025-04-17 22:28:34,968 - INFO - Strategy execution completed
2025-04-17 22:28:34,970 - ERROR - Error running hmm with mean_variance and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:34,971 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 5 regimes
2025-04-17 22:28:34,971 - INFO - Initializing strategy...
2025-04-17 22:28:34,971 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 22:28:34,972 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:34,972 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:28:34,972 - INFO - Running strategy...
2025-04-17 22:28:34,972 - INFO - Starting strategy execution...
2025-04-17 22:28:34,972 - INFO - Preparing training and testing data...
2025-04-17 22:28:34,972 - INFO - Starting data preparation...
2025-04-17 22:28:34,972 - INFO - Loading Fama-French factors...
2025-04-17 22:28:34,981 - INFO - Fama-French factors loaded
2025-04-17 22:28:34,981 - INFO - Processing factor data...
2025-04-17 22:28:34,983 - INFO - Factor data processed
2025-04-17 22:28:34,983 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:34,983 - INFO - 
Training Period:
2025-04-17 22:28:34,987 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:34,994 - INFO - 
Testing Period:
2025-04-17 22:28:34,998 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:35,004 - INFO - Loading macro and market data...
2025-04-17 22:28:35,005 - INFO - Loading existing macro data...
2025-04-17 22:28:35,014 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:35,014 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:35,018 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:35,018 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:35,018 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:35,019 - INFO - Loading existing macro data...
2025-04-17 22:28:35,028 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:35,028 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:35,031 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:35,031 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:35,031 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:35,032 - INFO - Loading existing market data...
2025-04-17 22:28:35,035 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:35,036 - INFO - Loading existing market data...
2025-04-17 22:28:35,039 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:35,039 - INFO - Macro and market data loaded
2025-04-17 22:28:35,039 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:35,040 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:35,040 - INFO - Loading existing macro data...
2025-04-17 22:28:35,049 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:35,050 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:35,052 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:35,052 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:35,053 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:35,054 - INFO - Loading existing market data...
2025-04-17 22:28:35,057 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:35,069 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:35,070 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:35,070 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:35,070 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:35,071 - INFO - Loading existing macro data...
2025-04-17 22:28:35,080 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:35,081 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:35,084 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:35,084 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:35,084 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:35,085 - INFO - Loading existing market data...
2025-04-17 22:28:35,089 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:35,100 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:35,100 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:35,100 - INFO - Test data prepared
2025-04-17 22:28:35,100 - INFO - Storing data...
2025-04-17 22:28:35,101 - INFO - Aligning data indices...
2025-04-17 22:28:35,102 - INFO - Data indices aligned
2025-04-17 22:28:35,102 - INFO - Data preparation completed
2025-04-17 22:28:35,102 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:35,102 - INFO - Training models...
2025-04-17 22:28:35,103 - INFO - Starting model training...
2025-04-17 22:28:35,103 - INFO - Training regime classifier...
2025-04-17 22:28:35,103 - INFO - Training HMM model...
2025-04-17 22:28:35,312 - INFO - HMM model training completed
2025-04-17 22:28:35,493 - INFO - Model training completed
2025-04-17 22:28:35,494 - INFO - Model training completed
2025-04-17 22:28:35,495 - INFO - Initializing portfolio weights...
2025-04-17 22:28:35,495 - INFO - Portfolio weights initialized
2025-04-17 22:28:35,495 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:35,497 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:35,501 - INFO - Generated 41 regime predictions
2025-04-17 22:28:35,501 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:35,505 - INFO - Found 4 unique regimes
2025-04-17 22:28:35,505 - INFO - Processing regime 0...
2025-04-17 22:28:35,506 - INFO - Regime 0: 4 samples
2025-04-17 22:28:35,506 - INFO - Processing regime 1...
2025-04-17 22:28:35,507 - INFO - Regime 1: 16 samples
2025-04-17 22:28:35,507 - INFO - Processing regime 3...
2025-04-17 22:28:35,508 - INFO - Regime 3: 9 samples
2025-04-17 22:28:35,508 - INFO - Processing regime 4...
2025-04-17 22:28:35,509 - INFO - Regime 4: 16 samples
2025-04-17 22:28:35,509 - INFO - Training portfolio optimizer...
2025-04-17 22:28:35,509 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:35,509 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:35,509 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:35,509 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:35,510 - WARNING - All weights are zero, using equal weights
2025-04-17 22:28:35,529 - INFO - Portfolio optimization completed
2025-04-17 22:28:35,529 - INFO - Initializing backtester...
2025-04-17 22:28:35,534 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:35,535 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:35,535 - INFO - Running backtest...
2025-04-17 22:28:35,536 - INFO - Starting backtest...
2025-04-17 22:28:35,536 - INFO - Calculating portfolio returns...
2025-04-17 22:28:35,536 - INFO - Calculating portfolio returns...
2025-04-17 22:28:35,537 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:35,538 - INFO - Calculating performance metrics...
2025-04-17 22:28:35,538 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:35,538 - INFO - Calculating metrics...
2025-04-17 22:28:35,541 - INFO - Performance metrics calculation completed
2025-04-17 22:28:35,541 - INFO - Backtest completed
2025-04-17 22:28:35,541 - INFO - Backtest completed
2025-04-17 22:28:35,542 - INFO - Strategy execution completed
2025-04-17 22:28:35,543 - ERROR - Error running hmm with mean_variance and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:35,544 - INFO - 
Running strategy with hmm classifier, mean_variance optimizer, and 7 regimes
2025-04-17 22:28:35,544 - INFO - Initializing strategy...
2025-04-17 22:28:35,544 - INFO - Initializing FactorTimingStrategy with hmm model and mean_variance optimizer
2025-04-17 22:28:35,545 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:35,545 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:28:35,545 - INFO - Running strategy...
2025-04-17 22:28:35,545 - INFO - Starting strategy execution...
2025-04-17 22:28:35,545 - INFO - Preparing training and testing data...
2025-04-17 22:28:35,545 - INFO - Starting data preparation...
2025-04-17 22:28:35,545 - INFO - Loading Fama-French factors...
2025-04-17 22:28:35,556 - INFO - Fama-French factors loaded
2025-04-17 22:28:35,556 - INFO - Processing factor data...
2025-04-17 22:28:35,559 - INFO - Factor data processed
2025-04-17 22:28:35,559 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:35,559 - INFO - 
Training Period:
2025-04-17 22:28:35,563 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:35,572 - INFO - 
Testing Period:
2025-04-17 22:28:35,576 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:35,583 - INFO - Loading macro and market data...
2025-04-17 22:28:35,584 - INFO - Loading existing macro data...
2025-04-17 22:28:35,594 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:35,594 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:35,597 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:35,597 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:35,598 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:35,599 - INFO - Loading existing macro data...
2025-04-17 22:28:35,608 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:35,608 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:35,611 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:35,611 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:35,612 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:35,613 - INFO - Loading existing market data...
2025-04-17 22:28:35,617 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:35,618 - INFO - Loading existing market data...
2025-04-17 22:28:35,621 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:35,621 - INFO - Macro and market data loaded
2025-04-17 22:28:35,621 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:35,621 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:35,622 - INFO - Loading existing macro data...
2025-04-17 22:28:35,632 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:35,632 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:35,634 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:35,635 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:35,635 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:35,636 - INFO - Loading existing market data...
2025-04-17 22:28:35,639 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:35,652 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:35,652 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:35,652 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:35,652 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:35,653 - INFO - Loading existing macro data...
2025-04-17 22:28:35,664 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:35,665 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:35,667 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:35,668 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:35,668 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:35,669 - INFO - Loading existing market data...
2025-04-17 22:28:35,672 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:35,681 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:35,681 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:35,681 - INFO - Test data prepared
2025-04-17 22:28:35,682 - INFO - Storing data...
2025-04-17 22:28:35,682 - INFO - Aligning data indices...
2025-04-17 22:28:35,683 - INFO - Data indices aligned
2025-04-17 22:28:35,683 - INFO - Data preparation completed
2025-04-17 22:28:35,683 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:35,684 - INFO - Training models...
2025-04-17 22:28:35,684 - INFO - Starting model training...
2025-04-17 22:28:35,684 - INFO - Training regime classifier...
2025-04-17 22:28:35,684 - INFO - Training HMM model...
2025-04-17 22:28:35,892 - INFO - HMM model training completed
2025-04-17 22:28:36,071 - INFO - Model training completed
2025-04-17 22:28:36,073 - INFO - Model training completed
2025-04-17 22:28:36,073 - INFO - Initializing portfolio weights...
2025-04-17 22:28:36,073 - INFO - Portfolio weights initialized
2025-04-17 22:28:36,074 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:36,076 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:36,080 - INFO - Generated 41 regime predictions
2025-04-17 22:28:36,080 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:36,084 - INFO - Found 4 unique regimes
2025-04-17 22:28:36,085 - INFO - Processing regime 0...
2025-04-17 22:28:36,085 - INFO - Regime 0: 4 samples
2025-04-17 22:28:36,086 - INFO - Processing regime 1...
2025-04-17 22:28:36,086 - INFO - Regime 1: 16 samples
2025-04-17 22:28:36,086 - INFO - Processing regime 3...
2025-04-17 22:28:36,087 - INFO - Regime 3: 9 samples
2025-04-17 22:28:36,087 - INFO - Processing regime 4...
2025-04-17 22:28:36,088 - INFO - Regime 4: 16 samples
2025-04-17 22:28:36,088 - INFO - Training portfolio optimizer...
2025-04-17 22:28:36,088 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:36,088 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:36,088 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:36,088 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:36,089 - WARNING - All weights are zero, using equal weights
2025-04-17 22:28:36,109 - INFO - Portfolio optimization completed
2025-04-17 22:28:36,109 - INFO - Initializing backtester...
2025-04-17 22:28:36,114 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:36,115 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:36,115 - INFO - Running backtest...
2025-04-17 22:28:36,115 - INFO - Starting backtest...
2025-04-17 22:28:36,116 - INFO - Calculating portfolio returns...
2025-04-17 22:28:36,116 - INFO - Calculating portfolio returns...
2025-04-17 22:28:36,117 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:36,117 - INFO - Calculating performance metrics...
2025-04-17 22:28:36,117 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:36,117 - INFO - Calculating metrics...
2025-04-17 22:28:36,119 - INFO - Performance metrics calculation completed
2025-04-17 22:28:36,119 - INFO - Backtest completed
2025-04-17 22:28:36,119 - INFO - Backtest completed
2025-04-17 22:28:36,120 - INFO - Strategy execution completed
2025-04-17 22:28:36,121 - ERROR - Error running hmm with mean_variance and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:36,123 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 3 regimes
2025-04-17 22:28:36,123 - INFO - Initializing strategy...
2025-04-17 22:28:36,123 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 22:28:36,123 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:36,123 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:28:36,123 - INFO - Running strategy...
2025-04-17 22:28:36,123 - INFO - Starting strategy execution...
2025-04-17 22:28:36,124 - INFO - Preparing training and testing data...
2025-04-17 22:28:36,124 - INFO - Starting data preparation...
2025-04-17 22:28:36,124 - INFO - Loading Fama-French factors...
2025-04-17 22:28:36,132 - INFO - Fama-French factors loaded
2025-04-17 22:28:36,133 - INFO - Processing factor data...
2025-04-17 22:28:36,135 - INFO - Factor data processed
2025-04-17 22:28:36,135 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:36,135 - INFO - 
Training Period:
2025-04-17 22:28:36,139 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:36,147 - INFO - 
Testing Period:
2025-04-17 22:28:36,151 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:36,158 - INFO - Loading macro and market data...
2025-04-17 22:28:36,159 - INFO - Loading existing macro data...
2025-04-17 22:28:36,169 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:36,169 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:36,172 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:36,172 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:36,172 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:36,173 - INFO - Loading existing macro data...
2025-04-17 22:28:36,182 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:36,182 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:36,185 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:36,185 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:36,185 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:36,187 - INFO - Loading existing market data...
2025-04-17 22:28:36,190 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:36,191 - INFO - Loading existing market data...
2025-04-17 22:28:36,194 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:36,194 - INFO - Macro and market data loaded
2025-04-17 22:28:36,194 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:36,194 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:36,195 - INFO - Loading existing macro data...
2025-04-17 22:28:36,204 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:36,205 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:36,207 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:36,207 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:36,208 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:36,209 - INFO - Loading existing market data...
2025-04-17 22:28:36,212 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:36,225 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:36,225 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:36,225 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:36,225 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:36,227 - INFO - Loading existing macro data...
2025-04-17 22:28:36,238 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:36,238 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:36,242 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:36,242 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:36,242 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:36,243 - INFO - Loading existing market data...
2025-04-17 22:28:36,246 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:36,255 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:36,255 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:36,256 - INFO - Test data prepared
2025-04-17 22:28:36,256 - INFO - Storing data...
2025-04-17 22:28:36,256 - INFO - Aligning data indices...
2025-04-17 22:28:36,257 - INFO - Data indices aligned
2025-04-17 22:28:36,257 - INFO - Data preparation completed
2025-04-17 22:28:36,257 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:36,258 - INFO - Training models...
2025-04-17 22:28:36,258 - INFO - Starting model training...
2025-04-17 22:28:36,258 - INFO - Training regime classifier...
2025-04-17 22:28:36,258 - INFO - Training HMM model...
2025-04-17 22:28:36,464 - INFO - HMM model training completed
2025-04-17 22:28:36,640 - INFO - Model training completed
2025-04-17 22:28:36,642 - INFO - Model training completed
2025-04-17 22:28:36,642 - INFO - Initializing portfolio weights...
2025-04-17 22:28:36,642 - INFO - Portfolio weights initialized
2025-04-17 22:28:36,643 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:36,645 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:36,649 - INFO - Generated 41 regime predictions
2025-04-17 22:28:36,649 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:36,653 - INFO - Found 4 unique regimes
2025-04-17 22:28:36,654 - INFO - Processing regime 0...
2025-04-17 22:28:36,654 - INFO - Regime 0: 4 samples
2025-04-17 22:28:36,654 - INFO - Processing regime 1...
2025-04-17 22:28:36,655 - INFO - Regime 1: 16 samples
2025-04-17 22:28:36,655 - INFO - Processing regime 3...
2025-04-17 22:28:36,656 - INFO - Regime 3: 9 samples
2025-04-17 22:28:36,656 - INFO - Processing regime 4...
2025-04-17 22:28:36,657 - INFO - Regime 4: 16 samples
2025-04-17 22:28:36,657 - INFO - Training portfolio optimizer...
2025-04-17 22:28:36,657 - INFO - Training regime-aware optimizer...
2025-04-17 22:28:36,657 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:36,657 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:36,658 - INFO - Trained optimizer for regime 0 with 4 samples
2025-04-17 22:28:36,658 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:36,658 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:36,658 - INFO - Trained optimizer for regime 1 with 16 samples
2025-04-17 22:28:36,658 - WARNING - No samples found for regime 2
2025-04-17 22:28:36,658 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:36,659 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:36,659 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:36,659 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 22:28:36,660 - WARNING - All weights are zero, using equal weights
2025-04-17 22:28:36,660 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:36,661 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 22:28:36,661 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:36,661 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 22:28:36,662 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:36,662 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 22:28:36,663 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:36,663 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 22:28:36,664 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:36,664 - WARNING - No optimizer found for regime 3, using base optimizer
2025-04-17 22:28:36,664 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:36,665 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:36,666 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:36,666 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:36,667 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:36,668 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:36,668 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,669 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,669 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,669 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,670 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,670 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,671 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,671 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,672 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,672 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,673 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,673 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,673 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,674 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,674 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,675 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,676 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,676 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,677 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,677 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,677 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,678 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,678 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,678 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,679 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,679 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,680 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,680 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,680 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,681 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,681 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,681 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,682 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,682 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,683 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,683 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,683 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,683 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,684 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,684 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,685 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,685 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,686 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,686 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,686 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,686 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,687 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,687 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,688 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,688 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,689 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,689 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,689 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,689 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,690 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,690 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,691 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:36,691 - WARNING - No optimizer found for regime 4, using base optimizer
2025-04-17 22:28:36,692 - INFO - Portfolio optimization completed
2025-04-17 22:28:36,692 - INFO - Initializing backtester...
2025-04-17 22:28:36,698 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:36,698 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:36,698 - INFO - Running backtest...
2025-04-17 22:28:36,699 - INFO - Starting backtest...
2025-04-17 22:28:36,699 - INFO - Calculating portfolio returns...
2025-04-17 22:28:36,699 - INFO - Calculating portfolio returns...
2025-04-17 22:28:36,700 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:36,700 - INFO - Calculating performance metrics...
2025-04-17 22:28:36,700 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:36,700 - INFO - Calculating metrics...
2025-04-17 22:28:36,702 - INFO - Performance metrics calculation completed
2025-04-17 22:28:36,702 - INFO - Backtest completed
2025-04-17 22:28:36,702 - INFO - Backtest completed
2025-04-17 22:28:36,703 - INFO - Strategy execution completed
2025-04-17 22:28:36,705 - ERROR - Error running hmm with regime_aware and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:36,706 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 5 regimes
2025-04-17 22:28:36,706 - INFO - Initializing strategy...
2025-04-17 22:28:36,706 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 22:28:36,707 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:36,707 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:28:36,707 - INFO - Running strategy...
2025-04-17 22:28:36,707 - INFO - Starting strategy execution...
2025-04-17 22:28:36,707 - INFO - Preparing training and testing data...
2025-04-17 22:28:36,707 - INFO - Starting data preparation...
2025-04-17 22:28:36,707 - INFO - Loading Fama-French factors...
2025-04-17 22:28:36,717 - INFO - Fama-French factors loaded
2025-04-17 22:28:36,717 - INFO - Processing factor data...
2025-04-17 22:28:36,719 - INFO - Factor data processed
2025-04-17 22:28:36,719 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:36,719 - INFO - 
Training Period:
2025-04-17 22:28:36,723 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:36,730 - INFO - 
Testing Period:
2025-04-17 22:28:36,734 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:36,741 - INFO - Loading macro and market data...
2025-04-17 22:28:36,742 - INFO - Loading existing macro data...
2025-04-17 22:28:36,751 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:36,752 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:36,755 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:36,755 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:36,755 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:36,756 - INFO - Loading existing macro data...
2025-04-17 22:28:36,765 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:36,765 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:36,768 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:36,768 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:36,768 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:36,769 - INFO - Loading existing market data...
2025-04-17 22:28:36,772 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:36,773 - INFO - Loading existing market data...
2025-04-17 22:28:36,776 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:36,776 - INFO - Macro and market data loaded
2025-04-17 22:28:36,776 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:36,776 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:36,777 - INFO - Loading existing macro data...
2025-04-17 22:28:36,786 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:36,786 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:36,788 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:36,789 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:36,789 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:36,790 - INFO - Loading existing market data...
2025-04-17 22:28:36,793 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:36,805 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:36,805 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:36,805 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:36,806 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:36,807 - INFO - Loading existing macro data...
2025-04-17 22:28:36,816 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:36,816 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:36,820 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:36,820 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:36,820 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:36,821 - INFO - Loading existing market data...
2025-04-17 22:28:36,824 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:36,833 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:36,833 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:36,833 - INFO - Test data prepared
2025-04-17 22:28:36,834 - INFO - Storing data...
2025-04-17 22:28:36,834 - INFO - Aligning data indices...
2025-04-17 22:28:36,835 - INFO - Data indices aligned
2025-04-17 22:28:36,835 - INFO - Data preparation completed
2025-04-17 22:28:36,835 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:36,836 - INFO - Training models...
2025-04-17 22:28:36,836 - INFO - Starting model training...
2025-04-17 22:28:36,836 - INFO - Training regime classifier...
2025-04-17 22:28:36,836 - INFO - Training HMM model...
2025-04-17 22:28:37,042 - INFO - HMM model training completed
2025-04-17 22:28:37,224 - INFO - Model training completed
2025-04-17 22:28:37,225 - INFO - Model training completed
2025-04-17 22:28:37,226 - INFO - Initializing portfolio weights...
2025-04-17 22:28:37,226 - INFO - Portfolio weights initialized
2025-04-17 22:28:37,226 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:37,228 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:37,231 - INFO - Generated 41 regime predictions
2025-04-17 22:28:37,232 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:37,235 - INFO - Found 4 unique regimes
2025-04-17 22:28:37,235 - INFO - Processing regime 0...
2025-04-17 22:28:37,236 - INFO - Regime 0: 4 samples
2025-04-17 22:28:37,236 - INFO - Processing regime 1...
2025-04-17 22:28:37,237 - INFO - Regime 1: 16 samples
2025-04-17 22:28:37,237 - INFO - Processing regime 3...
2025-04-17 22:28:37,238 - INFO - Regime 3: 9 samples
2025-04-17 22:28:37,238 - INFO - Processing regime 4...
2025-04-17 22:28:37,239 - INFO - Regime 4: 16 samples
2025-04-17 22:28:37,239 - INFO - Training portfolio optimizer...
2025-04-17 22:28:37,239 - INFO - Training regime-aware optimizer...
2025-04-17 22:28:37,239 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:37,239 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:37,240 - INFO - Trained optimizer for regime 0 with 4 samples
2025-04-17 22:28:37,240 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:37,240 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:37,240 - INFO - Trained optimizer for regime 1 with 16 samples
2025-04-17 22:28:37,241 - WARNING - No samples found for regime 2
2025-04-17 22:28:37,241 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:37,241 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:37,241 - INFO - Trained optimizer for regime 3 with 9 samples
2025-04-17 22:28:37,241 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:37,241 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:37,242 - INFO - Trained optimizer for regime 4 with 16 samples
2025-04-17 22:28:37,242 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:37,242 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:37,242 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:37,243 - WARNING - All weights are zero, using equal weights
2025-04-17 22:28:37,243 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:37,244 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:37,245 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:37,245 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:37,246 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:37,247 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:37,247 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:37,248 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:37,249 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:37,249 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:37,250 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:37,251 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,251 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,252 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,253 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,253 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,254 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,255 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,255 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,256 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,257 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,257 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,258 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,259 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,259 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,260 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,261 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,261 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,262 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,263 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,263 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,264 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,265 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,265 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,266 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,267 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,267 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,268 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,269 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,269 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,270 - INFO - Portfolio optimization completed
2025-04-17 22:28:37,270 - INFO - Initializing backtester...
2025-04-17 22:28:37,276 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:37,276 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:37,276 - INFO - Running backtest...
2025-04-17 22:28:37,276 - INFO - Starting backtest...
2025-04-17 22:28:37,276 - INFO - Calculating portfolio returns...
2025-04-17 22:28:37,276 - INFO - Calculating portfolio returns...
2025-04-17 22:28:37,277 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:37,278 - INFO - Calculating performance metrics...
2025-04-17 22:28:37,278 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:37,278 - INFO - Calculating metrics...
2025-04-17 22:28:37,280 - INFO - Performance metrics calculation completed
2025-04-17 22:28:37,280 - INFO - Backtest completed
2025-04-17 22:28:37,280 - INFO - Backtest completed
2025-04-17 22:28:37,280 - INFO - Strategy execution completed
2025-04-17 22:28:37,281 - ERROR - Error running hmm with regime_aware and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:37,283 - INFO - 
Running strategy with hmm classifier, regime_aware optimizer, and 7 regimes
2025-04-17 22:28:37,283 - INFO - Initializing strategy...
2025-04-17 22:28:37,283 - INFO - Initializing FactorTimingStrategy with hmm model and regime_aware optimizer
2025-04-17 22:28:37,283 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:37,283 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:28:37,284 - INFO - Running strategy...
2025-04-17 22:28:37,284 - INFO - Starting strategy execution...
2025-04-17 22:28:37,284 - INFO - Preparing training and testing data...
2025-04-17 22:28:37,284 - INFO - Starting data preparation...
2025-04-17 22:28:37,284 - INFO - Loading Fama-French factors...
2025-04-17 22:28:37,293 - INFO - Fama-French factors loaded
2025-04-17 22:28:37,293 - INFO - Processing factor data...
2025-04-17 22:28:37,295 - INFO - Factor data processed
2025-04-17 22:28:37,295 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:37,295 - INFO - 
Training Period:
2025-04-17 22:28:37,299 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:37,306 - INFO - 
Testing Period:
2025-04-17 22:28:37,310 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:37,316 - INFO - Loading macro and market data...
2025-04-17 22:28:37,317 - INFO - Loading existing macro data...
2025-04-17 22:28:37,328 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:37,328 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:37,331 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:37,331 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:37,331 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:37,332 - INFO - Loading existing macro data...
2025-04-17 22:28:37,341 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:37,341 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:37,344 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:37,344 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:37,344 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:37,345 - INFO - Loading existing market data...
2025-04-17 22:28:37,348 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:37,349 - INFO - Loading existing market data...
2025-04-17 22:28:37,352 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:37,352 - INFO - Macro and market data loaded
2025-04-17 22:28:37,353 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:37,353 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:37,353 - INFO - Loading existing macro data...
2025-04-17 22:28:37,362 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:37,362 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:37,365 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:37,365 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:37,365 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:37,366 - INFO - Loading existing market data...
2025-04-17 22:28:37,369 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:37,382 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:37,382 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:37,382 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:37,382 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:37,384 - INFO - Loading existing macro data...
2025-04-17 22:28:37,395 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:37,395 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:37,399 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:37,399 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:37,399 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:37,401 - INFO - Loading existing market data...
2025-04-17 22:28:37,404 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:37,412 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:37,412 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:37,413 - INFO - Test data prepared
2025-04-17 22:28:37,413 - INFO - Storing data...
2025-04-17 22:28:37,413 - INFO - Aligning data indices...
2025-04-17 22:28:37,414 - INFO - Data indices aligned
2025-04-17 22:28:37,414 - INFO - Data preparation completed
2025-04-17 22:28:37,414 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:37,414 - INFO - Training models...
2025-04-17 22:28:37,414 - INFO - Starting model training...
2025-04-17 22:28:37,414 - INFO - Training regime classifier...
2025-04-17 22:28:37,415 - INFO - Training HMM model...
2025-04-17 22:28:37,627 - INFO - HMM model training completed
2025-04-17 22:28:37,802 - INFO - Model training completed
2025-04-17 22:28:37,804 - INFO - Model training completed
2025-04-17 22:28:37,805 - INFO - Initializing portfolio weights...
2025-04-17 22:28:37,805 - INFO - Portfolio weights initialized
2025-04-17 22:28:37,805 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:37,807 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:37,810 - INFO - Generated 41 regime predictions
2025-04-17 22:28:37,810 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:37,814 - INFO - Found 4 unique regimes
2025-04-17 22:28:37,814 - INFO - Processing regime 0...
2025-04-17 22:28:37,815 - INFO - Regime 0: 4 samples
2025-04-17 22:28:37,815 - INFO - Processing regime 1...
2025-04-17 22:28:37,816 - INFO - Regime 1: 16 samples
2025-04-17 22:28:37,816 - INFO - Processing regime 3...
2025-04-17 22:28:37,817 - INFO - Regime 3: 9 samples
2025-04-17 22:28:37,817 - INFO - Processing regime 4...
2025-04-17 22:28:37,817 - INFO - Regime 4: 16 samples
2025-04-17 22:28:37,818 - INFO - Training portfolio optimizer...
2025-04-17 22:28:37,818 - INFO - Training regime-aware optimizer...
2025-04-17 22:28:37,818 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:37,818 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:37,818 - INFO - Trained optimizer for regime 0 with 4 samples
2025-04-17 22:28:37,818 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:37,819 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:37,819 - INFO - Trained optimizer for regime 1 with 16 samples
2025-04-17 22:28:37,819 - WARNING - No samples found for regime 2
2025-04-17 22:28:37,819 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:37,819 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:37,820 - INFO - Trained optimizer for regime 3 with 9 samples
2025-04-17 22:28:37,820 - INFO - Training mean-variance optimizer...
2025-04-17 22:28:37,820 - INFO - Mean-variance optimizer training completed
2025-04-17 22:28:37,820 - INFO - Trained optimizer for regime 4 with 16 samples
2025-04-17 22:28:37,820 - WARNING - No samples found for regime 5
2025-04-17 22:28:37,820 - WARNING - No samples found for regime 6
2025-04-17 22:28:37,821 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:37,821 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:37,821 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:37,822 - WARNING - All weights are zero, using equal weights
2025-04-17 22:28:37,822 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:37,823 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:37,824 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:37,824 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:37,825 - INFO - Optimizing weights for regime 3
2025-04-17 22:28:37,826 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:37,826 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:37,827 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:37,828 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:37,828 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:37,829 - INFO - Optimizing weights for regime 1
2025-04-17 22:28:37,830 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,830 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,831 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,832 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,832 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,833 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,834 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,834 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,835 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,836 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,837 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,837 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,838 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,839 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,839 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,840 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,841 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,841 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,842 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,843 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,844 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,845 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,845 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,846 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,847 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,847 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,848 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,849 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,849 - INFO - Optimizing weights for regime 4
2025-04-17 22:28:37,850 - INFO - Portfolio optimization completed
2025-04-17 22:28:37,850 - INFO - Initializing backtester...
2025-04-17 22:28:37,855 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:37,856 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:37,856 - INFO - Running backtest...
2025-04-17 22:28:37,856 - INFO - Starting backtest...
2025-04-17 22:28:37,856 - INFO - Calculating portfolio returns...
2025-04-17 22:28:37,857 - INFO - Calculating portfolio returns...
2025-04-17 22:28:37,858 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:37,858 - INFO - Calculating performance metrics...
2025-04-17 22:28:37,858 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:37,858 - INFO - Calculating metrics...
2025-04-17 22:28:37,860 - INFO - Performance metrics calculation completed
2025-04-17 22:28:37,860 - INFO - Backtest completed
2025-04-17 22:28:37,860 - INFO - Backtest completed
2025-04-17 22:28:37,861 - INFO - Strategy execution completed
2025-04-17 22:28:37,862 - ERROR - Error running hmm with regime_aware and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:37,864 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 3 regimes
2025-04-17 22:28:37,864 - INFO - Initializing strategy...
2025-04-17 22:28:37,864 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 22:28:37,864 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:37,864 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:28:37,864 - INFO - Running strategy...
2025-04-17 22:28:37,864 - INFO - Starting strategy execution...
2025-04-17 22:28:37,865 - INFO - Preparing training and testing data...
2025-04-17 22:28:37,865 - INFO - Starting data preparation...
2025-04-17 22:28:37,865 - INFO - Loading Fama-French factors...
2025-04-17 22:28:37,874 - INFO - Fama-French factors loaded
2025-04-17 22:28:37,874 - INFO - Processing factor data...
2025-04-17 22:28:37,876 - INFO - Factor data processed
2025-04-17 22:28:37,876 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:37,876 - INFO - 
Training Period:
2025-04-17 22:28:37,880 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:37,887 - INFO - 
Testing Period:
2025-04-17 22:28:37,891 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:37,898 - INFO - Loading macro and market data...
2025-04-17 22:28:37,899 - INFO - Loading existing macro data...
2025-04-17 22:28:37,908 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:37,908 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:37,911 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:37,912 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:37,912 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:37,913 - INFO - Loading existing macro data...
2025-04-17 22:28:37,921 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:37,922 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:37,924 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:37,924 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:37,924 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:37,925 - INFO - Loading existing market data...
2025-04-17 22:28:37,929 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:37,930 - INFO - Loading existing market data...
2025-04-17 22:28:37,932 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:37,932 - INFO - Macro and market data loaded
2025-04-17 22:28:37,932 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:37,933 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:37,933 - INFO - Loading existing macro data...
2025-04-17 22:28:37,943 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:37,943 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:37,946 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:37,946 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:37,947 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:37,947 - INFO - Loading existing market data...
2025-04-17 22:28:37,951 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:37,963 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:37,963 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:37,964 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:37,964 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:37,965 - INFO - Loading existing macro data...
2025-04-17 22:28:37,974 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:37,974 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:37,977 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:37,978 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:37,978 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:37,979 - INFO - Loading existing market data...
2025-04-17 22:28:37,982 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:37,990 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:37,991 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:37,993 - INFO - Test data prepared
2025-04-17 22:28:37,993 - INFO - Storing data...
2025-04-17 22:28:37,993 - INFO - Aligning data indices...
2025-04-17 22:28:37,995 - INFO - Data indices aligned
2025-04-17 22:28:37,995 - INFO - Data preparation completed
2025-04-17 22:28:37,995 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:37,995 - INFO - Training models...
2025-04-17 22:28:37,995 - INFO - Starting model training...
2025-04-17 22:28:37,995 - INFO - Training regime classifier...
2025-04-17 22:28:37,995 - INFO - Training HMM model...
2025-04-17 22:28:38,200 - INFO - HMM model training completed
2025-04-17 22:28:38,375 - INFO - Model training completed
2025-04-17 22:28:38,377 - INFO - Model training completed
2025-04-17 22:28:38,377 - INFO - Initializing portfolio weights...
2025-04-17 22:28:38,378 - INFO - Portfolio weights initialized
2025-04-17 22:28:38,378 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:38,380 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:38,384 - INFO - Generated 41 regime predictions
2025-04-17 22:28:38,384 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:38,388 - INFO - Found 4 unique regimes
2025-04-17 22:28:38,388 - INFO - Processing regime 0...
2025-04-17 22:28:38,389 - INFO - Regime 0: 4 samples
2025-04-17 22:28:38,389 - INFO - Processing regime 1...
2025-04-17 22:28:38,390 - INFO - Regime 1: 16 samples
2025-04-17 22:28:38,390 - INFO - Processing regime 3...
2025-04-17 22:28:38,391 - INFO - Regime 3: 9 samples
2025-04-17 22:28:38,391 - INFO - Processing regime 4...
2025-04-17 22:28:38,391 - INFO - Regime 4: 16 samples
2025-04-17 22:28:38,392 - INFO - Training portfolio optimizer...
2025-04-17 22:28:38,392 - INFO - Training neural regime optimizer...
2025-04-17 22:28:38,392 - INFO - Training model for regime 0 with 4 samples
2025-04-17 22:28:38,482 - INFO - Training model for regime 1 with 16 samples
2025-04-17 22:28:38,575 - WARNING - No samples found for regime 2
2025-04-17 22:28:38,576 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:38,576 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:38,577 - WARNING - No model found for regime 3, using equal weights
2025-04-17 22:28:38,577 - WARNING - No model found for regime 3, using equal weights
2025-04-17 22:28:38,578 - WARNING - No model found for regime 3, using equal weights
2025-04-17 22:28:38,578 - WARNING - No model found for regime 3, using equal weights
2025-04-17 22:28:38,579 - WARNING - No model found for regime 3, using equal weights
2025-04-17 22:28:38,579 - WARNING - No model found for regime 3, using equal weights
2025-04-17 22:28:38,582 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,582 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,582 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,583 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,583 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,583 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,583 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,584 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,584 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,584 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,584 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,585 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,585 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,585 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,585 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,586 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,586 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,586 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,586 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,587 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,587 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,587 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,588 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,588 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,588 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,589 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,589 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,589 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,589 - WARNING - No model found for regime 4, using equal weights
2025-04-17 22:28:38,590 - INFO - Portfolio optimization completed
2025-04-17 22:28:38,590 - INFO - Initializing backtester...
2025-04-17 22:28:38,597 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:38,597 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:38,597 - INFO - Running backtest...
2025-04-17 22:28:38,597 - INFO - Starting backtest...
2025-04-17 22:28:38,597 - INFO - Calculating portfolio returns...
2025-04-17 22:28:38,598 - INFO - Calculating portfolio returns...
2025-04-17 22:28:38,599 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:38,599 - INFO - Calculating performance metrics...
2025-04-17 22:28:38,599 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:38,599 - INFO - Calculating metrics...
2025-04-17 22:28:38,601 - INFO - Performance metrics calculation completed
2025-04-17 22:28:38,601 - INFO - Backtest completed
2025-04-17 22:28:38,602 - INFO - Backtest completed
2025-04-17 22:28:38,602 - INFO - Strategy execution completed
2025-04-17 22:28:38,604 - ERROR - Error running hmm with neural_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:38,605 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 5 regimes
2025-04-17 22:28:38,605 - INFO - Initializing strategy...
2025-04-17 22:28:38,606 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 22:28:38,606 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:38,606 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:28:38,606 - INFO - Running strategy...
2025-04-17 22:28:38,606 - INFO - Starting strategy execution...
2025-04-17 22:28:38,606 - INFO - Preparing training and testing data...
2025-04-17 22:28:38,607 - INFO - Starting data preparation...
2025-04-17 22:28:38,607 - INFO - Loading Fama-French factors...
2025-04-17 22:28:38,616 - INFO - Fama-French factors loaded
2025-04-17 22:28:38,616 - INFO - Processing factor data...
2025-04-17 22:28:38,618 - INFO - Factor data processed
2025-04-17 22:28:38,619 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:38,619 - INFO - 
Training Period:
2025-04-17 22:28:38,623 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:38,630 - INFO - 
Testing Period:
2025-04-17 22:28:38,634 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:38,640 - INFO - Loading macro and market data...
2025-04-17 22:28:38,641 - INFO - Loading existing macro data...
2025-04-17 22:28:38,652 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:38,652 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:38,655 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:38,655 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:38,656 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:38,657 - INFO - Loading existing macro data...
2025-04-17 22:28:38,667 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:38,668 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:38,670 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:38,671 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:38,671 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:38,672 - INFO - Loading existing market data...
2025-04-17 22:28:38,675 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:38,676 - INFO - Loading existing market data...
2025-04-17 22:28:38,679 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:38,679 - INFO - Macro and market data loaded
2025-04-17 22:28:38,679 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:38,679 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:38,680 - INFO - Loading existing macro data...
2025-04-17 22:28:38,689 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:38,690 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:38,692 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:38,692 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:38,693 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:38,694 - INFO - Loading existing market data...
2025-04-17 22:28:38,697 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:38,711 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:38,711 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:38,712 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:38,712 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:38,713 - INFO - Loading existing macro data...
2025-04-17 22:28:38,724 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:38,724 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:38,727 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:38,728 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:38,728 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:38,729 - INFO - Loading existing market data...
2025-04-17 22:28:38,732 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:38,741 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:38,741 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:38,742 - INFO - Test data prepared
2025-04-17 22:28:38,742 - INFO - Storing data...
2025-04-17 22:28:38,742 - INFO - Aligning data indices...
2025-04-17 22:28:38,743 - INFO - Data indices aligned
2025-04-17 22:28:38,743 - INFO - Data preparation completed
2025-04-17 22:28:38,744 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:38,744 - INFO - Training models...
2025-04-17 22:28:38,744 - INFO - Starting model training...
2025-04-17 22:28:38,744 - INFO - Training regime classifier...
2025-04-17 22:28:38,744 - INFO - Training HMM model...
2025-04-17 22:28:38,949 - INFO - HMM model training completed
2025-04-17 22:28:39,128 - INFO - Model training completed
2025-04-17 22:28:39,130 - INFO - Model training completed
2025-04-17 22:28:39,130 - INFO - Initializing portfolio weights...
2025-04-17 22:28:39,131 - INFO - Portfolio weights initialized
2025-04-17 22:28:39,131 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:39,133 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:39,137 - INFO - Generated 41 regime predictions
2025-04-17 22:28:39,137 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:39,141 - INFO - Found 4 unique regimes
2025-04-17 22:28:39,141 - INFO - Processing regime 0...
2025-04-17 22:28:39,142 - INFO - Regime 0: 4 samples
2025-04-17 22:28:39,142 - INFO - Processing regime 1...
2025-04-17 22:28:39,143 - INFO - Regime 1: 16 samples
2025-04-17 22:28:39,143 - INFO - Processing regime 3...
2025-04-17 22:28:39,144 - INFO - Regime 3: 9 samples
2025-04-17 22:28:39,144 - INFO - Processing regime 4...
2025-04-17 22:28:39,144 - INFO - Regime 4: 16 samples
2025-04-17 22:28:39,145 - INFO - Training portfolio optimizer...
2025-04-17 22:28:39,145 - INFO - Training neural regime optimizer...
2025-04-17 22:28:39,145 - INFO - Training model for regime 0 with 4 samples
2025-04-17 22:28:39,241 - INFO - Training model for regime 1 with 16 samples
2025-04-17 22:28:39,334 - WARNING - No samples found for regime 2
2025-04-17 22:28:39,335 - INFO - Training model for regime 3 with 9 samples
2025-04-17 22:28:39,429 - INFO - Training model for regime 4 with 16 samples
2025-04-17 22:28:39,532 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:39,533 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:39,546 - INFO - Portfolio optimization completed
2025-04-17 22:28:39,547 - INFO - Initializing backtester...
2025-04-17 22:28:39,553 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:39,554 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:39,554 - INFO - Running backtest...
2025-04-17 22:28:39,554 - INFO - Starting backtest...
2025-04-17 22:28:39,554 - INFO - Calculating portfolio returns...
2025-04-17 22:28:39,554 - INFO - Calculating portfolio returns...
2025-04-17 22:28:39,556 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:39,556 - INFO - Calculating performance metrics...
2025-04-17 22:28:39,556 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:39,556 - INFO - Calculating metrics...
2025-04-17 22:28:39,558 - INFO - Performance metrics calculation completed
2025-04-17 22:28:39,558 - INFO - Backtest completed
2025-04-17 22:28:39,558 - INFO - Backtest completed
2025-04-17 22:28:39,559 - INFO - Strategy execution completed
2025-04-17 22:28:39,561 - ERROR - Error running hmm with neural_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:39,562 - INFO - 
Running strategy with hmm classifier, neural_regime optimizer, and 7 regimes
2025-04-17 22:28:39,563 - INFO - Initializing strategy...
2025-04-17 22:28:39,563 - INFO - Initializing FactorTimingStrategy with hmm model and neural_regime optimizer
2025-04-17 22:28:39,563 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:39,563 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:28:39,564 - INFO - Running strategy...
2025-04-17 22:28:39,564 - INFO - Starting strategy execution...
2025-04-17 22:28:39,564 - INFO - Preparing training and testing data...
2025-04-17 22:28:39,564 - INFO - Starting data preparation...
2025-04-17 22:28:39,564 - INFO - Loading Fama-French factors...
2025-04-17 22:28:39,573 - INFO - Fama-French factors loaded
2025-04-17 22:28:39,573 - INFO - Processing factor data...
2025-04-17 22:28:39,576 - INFO - Factor data processed
2025-04-17 22:28:39,576 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:39,576 - INFO - 
Training Period:
2025-04-17 22:28:39,580 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:39,587 - INFO - 
Testing Period:
2025-04-17 22:28:39,591 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:39,598 - INFO - Loading macro and market data...
2025-04-17 22:28:39,599 - INFO - Loading existing macro data...
2025-04-17 22:28:39,609 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:39,609 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:39,612 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:39,612 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:39,612 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:39,613 - INFO - Loading existing macro data...
2025-04-17 22:28:39,622 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:39,623 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:39,626 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:39,626 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:39,626 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:39,627 - INFO - Loading existing market data...
2025-04-17 22:28:39,631 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:39,632 - INFO - Loading existing market data...
2025-04-17 22:28:39,635 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:39,635 - INFO - Macro and market data loaded
2025-04-17 22:28:39,635 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:39,635 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:39,636 - INFO - Loading existing macro data...
2025-04-17 22:28:39,646 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:39,646 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:39,649 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:39,649 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:39,649 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:39,650 - INFO - Loading existing market data...
2025-04-17 22:28:39,654 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:39,667 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:39,667 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:39,667 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:39,668 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:39,669 - INFO - Loading existing macro data...
2025-04-17 22:28:39,680 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:39,680 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:39,683 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:39,684 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:39,684 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:39,685 - INFO - Loading existing market data...
2025-04-17 22:28:39,689 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:39,697 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:39,697 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:39,698 - INFO - Test data prepared
2025-04-17 22:28:39,698 - INFO - Storing data...
2025-04-17 22:28:39,698 - INFO - Aligning data indices...
2025-04-17 22:28:39,699 - INFO - Data indices aligned
2025-04-17 22:28:39,699 - INFO - Data preparation completed
2025-04-17 22:28:39,699 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:39,700 - INFO - Training models...
2025-04-17 22:28:39,700 - INFO - Starting model training...
2025-04-17 22:28:39,700 - INFO - Training regime classifier...
2025-04-17 22:28:39,700 - INFO - Training HMM model...
2025-04-17 22:28:39,901 - INFO - HMM model training completed
2025-04-17 22:28:40,080 - INFO - Model training completed
2025-04-17 22:28:40,082 - INFO - Model training completed
2025-04-17 22:28:40,082 - INFO - Initializing portfolio weights...
2025-04-17 22:28:40,083 - INFO - Portfolio weights initialized
2025-04-17 22:28:40,083 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:40,085 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:40,088 - INFO - Generated 41 regime predictions
2025-04-17 22:28:40,088 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:40,092 - INFO - Found 4 unique regimes
2025-04-17 22:28:40,092 - INFO - Processing regime 0...
2025-04-17 22:28:40,093 - INFO - Regime 0: 4 samples
2025-04-17 22:28:40,093 - INFO - Processing regime 1...
2025-04-17 22:28:40,094 - INFO - Regime 1: 16 samples
2025-04-17 22:28:40,094 - INFO - Processing regime 3...
2025-04-17 22:28:40,095 - INFO - Regime 3: 9 samples
2025-04-17 22:28:40,095 - INFO - Processing regime 4...
2025-04-17 22:28:40,096 - INFO - Regime 4: 16 samples
2025-04-17 22:28:40,096 - INFO - Training portfolio optimizer...
2025-04-17 22:28:40,096 - INFO - Training neural regime optimizer...
2025-04-17 22:28:40,096 - INFO - Training model for regime 0 with 4 samples
2025-04-17 22:28:40,193 - INFO - Training model for regime 1 with 16 samples
2025-04-17 22:28:40,281 - WARNING - No samples found for regime 2
2025-04-17 22:28:40,282 - INFO - Training model for regime 3 with 9 samples
2025-04-17 22:28:40,381 - INFO - Training model for regime 4 with 16 samples
2025-04-17 22:28:40,479 - WARNING - No samples found for regime 5
2025-04-17 22:28:40,480 - WARNING - No samples found for regime 6
2025-04-17 22:28:40,480 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:40,480 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:40,494 - INFO - Portfolio optimization completed
2025-04-17 22:28:40,494 - INFO - Initializing backtester...
2025-04-17 22:28:40,500 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:40,500 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:40,501 - INFO - Running backtest...
2025-04-17 22:28:40,501 - INFO - Starting backtest...
2025-04-17 22:28:40,501 - INFO - Calculating portfolio returns...
2025-04-17 22:28:40,501 - INFO - Calculating portfolio returns...
2025-04-17 22:28:40,502 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:40,502 - INFO - Calculating performance metrics...
2025-04-17 22:28:40,503 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:40,503 - INFO - Calculating metrics...
2025-04-17 22:28:40,505 - INFO - Performance metrics calculation completed
2025-04-17 22:28:40,505 - INFO - Backtest completed
2025-04-17 22:28:40,505 - INFO - Backtest completed
2025-04-17 22:28:40,506 - INFO - Strategy execution completed
2025-04-17 22:28:40,507 - ERROR - Error running hmm with neural_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:40,508 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 3 regimes
2025-04-17 22:28:40,509 - INFO - Initializing strategy...
2025-04-17 22:28:40,509 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 22:28:40,509 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:40,509 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:28:40,509 - INFO - Running strategy...
2025-04-17 22:28:40,510 - INFO - Starting strategy execution...
2025-04-17 22:28:40,510 - INFO - Preparing training and testing data...
2025-04-17 22:28:40,510 - INFO - Starting data preparation...
2025-04-17 22:28:40,510 - INFO - Loading Fama-French factors...
2025-04-17 22:28:40,520 - INFO - Fama-French factors loaded
2025-04-17 22:28:40,521 - INFO - Processing factor data...
2025-04-17 22:28:40,523 - INFO - Factor data processed
2025-04-17 22:28:40,523 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:40,523 - INFO - 
Training Period:
2025-04-17 22:28:40,528 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:40,535 - INFO - 
Testing Period:
2025-04-17 22:28:40,539 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:40,546 - INFO - Loading macro and market data...
2025-04-17 22:28:40,547 - INFO - Loading existing macro data...
2025-04-17 22:28:40,560 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:40,560 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:40,564 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:40,564 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:40,564 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:40,565 - INFO - Loading existing macro data...
2025-04-17 22:28:40,574 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:40,575 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:40,577 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:40,578 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:40,578 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:40,579 - INFO - Loading existing market data...
2025-04-17 22:28:40,583 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:40,584 - INFO - Loading existing market data...
2025-04-17 22:28:40,586 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:40,587 - INFO - Macro and market data loaded
2025-04-17 22:28:40,587 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:40,587 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:40,588 - INFO - Loading existing macro data...
2025-04-17 22:28:40,597 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:40,597 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:40,600 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:40,600 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:40,600 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:40,601 - INFO - Loading existing market data...
2025-04-17 22:28:40,605 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:40,617 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:40,618 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:40,618 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:40,618 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:40,619 - INFO - Loading existing macro data...
2025-04-17 22:28:40,631 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:40,631 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:40,634 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:40,634 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:40,635 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:40,636 - INFO - Loading existing market data...
2025-04-17 22:28:40,639 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:40,648 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:40,648 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:40,648 - INFO - Test data prepared
2025-04-17 22:28:40,649 - INFO - Storing data...
2025-04-17 22:28:40,649 - INFO - Aligning data indices...
2025-04-17 22:28:40,650 - INFO - Data indices aligned
2025-04-17 22:28:40,650 - INFO - Data preparation completed
2025-04-17 22:28:40,651 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:40,651 - INFO - Training models...
2025-04-17 22:28:40,651 - INFO - Starting model training...
2025-04-17 22:28:40,651 - INFO - Training regime classifier...
2025-04-17 22:28:40,651 - INFO - Training HMM model...
2025-04-17 22:28:40,856 - INFO - HMM model training completed
2025-04-17 22:28:41,032 - INFO - Model training completed
2025-04-17 22:28:41,035 - INFO - Model training completed
2025-04-17 22:28:41,035 - INFO - Initializing portfolio weights...
2025-04-17 22:28:41,036 - INFO - Portfolio weights initialized
2025-04-17 22:28:41,036 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:41,038 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:41,041 - INFO - Generated 41 regime predictions
2025-04-17 22:28:41,041 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:41,045 - INFO - Found 4 unique regimes
2025-04-17 22:28:41,046 - INFO - Processing regime 0...
2025-04-17 22:28:41,047 - INFO - Regime 0: 4 samples
2025-04-17 22:28:41,047 - INFO - Processing regime 1...
2025-04-17 22:28:41,047 - INFO - Regime 1: 16 samples
2025-04-17 22:28:41,048 - INFO - Processing regime 3...
2025-04-17 22:28:41,048 - INFO - Regime 3: 9 samples
2025-04-17 22:28:41,048 - INFO - Processing regime 4...
2025-04-17 22:28:41,049 - INFO - Regime 4: 16 samples
2025-04-17 22:28:41,049 - INFO - Training portfolio optimizer...
2025-04-17 22:28:41,049 - INFO - Training autoencoder regime optimizer...
2025-04-17 22:28:41,049 - INFO - Training autoencoder for regime 0 with 4 samples
2025-04-17 22:28:41,172 - INFO - Training autoencoder for regime 1 with 16 samples
2025-04-17 22:28:41,295 - WARNING - No samples found for regime 2
2025-04-17 22:28:41,295 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:41,296 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:41,297 - WARNING - No autoencoder found for regime 3, using equal weights
2025-04-17 22:28:41,297 - WARNING - No autoencoder found for regime 3, using equal weights
2025-04-17 22:28:41,297 - WARNING - No autoencoder found for regime 3, using equal weights
2025-04-17 22:28:41,298 - WARNING - No autoencoder found for regime 3, using equal weights
2025-04-17 22:28:41,298 - WARNING - No autoencoder found for regime 3, using equal weights
2025-04-17 22:28:41,298 - WARNING - No autoencoder found for regime 3, using equal weights
2025-04-17 22:28:41,301 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,301 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,301 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,302 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,302 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,303 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,303 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,303 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,304 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,304 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,304 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,304 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,304 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,305 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,305 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,305 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,305 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,306 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,306 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,306 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,306 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,307 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,307 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,307 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,307 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,308 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,308 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,308 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,308 - WARNING - No autoencoder found for regime 4, using equal weights
2025-04-17 22:28:41,309 - INFO - Portfolio optimization completed
2025-04-17 22:28:41,309 - INFO - Initializing backtester...
2025-04-17 22:28:41,314 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:41,314 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:41,315 - INFO - Running backtest...
2025-04-17 22:28:41,315 - INFO - Starting backtest...
2025-04-17 22:28:41,315 - INFO - Calculating portfolio returns...
2025-04-17 22:28:41,315 - INFO - Calculating portfolio returns...
2025-04-17 22:28:41,316 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:41,316 - INFO - Calculating performance metrics...
2025-04-17 22:28:41,316 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:41,316 - INFO - Calculating metrics...
2025-04-17 22:28:41,318 - INFO - Performance metrics calculation completed
2025-04-17 22:28:41,319 - INFO - Backtest completed
2025-04-17 22:28:41,319 - INFO - Backtest completed
2025-04-17 22:28:41,320 - INFO - Strategy execution completed
2025-04-17 22:28:41,321 - ERROR - Error running hmm with autoencoder_regime and 3 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:41,323 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 5 regimes
2025-04-17 22:28:41,323 - INFO - Initializing strategy...
2025-04-17 22:28:41,323 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 22:28:41,323 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:41,323 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:28:41,323 - INFO - Running strategy...
2025-04-17 22:28:41,324 - INFO - Starting strategy execution...
2025-04-17 22:28:41,324 - INFO - Preparing training and testing data...
2025-04-17 22:28:41,324 - INFO - Starting data preparation...
2025-04-17 22:28:41,324 - INFO - Loading Fama-French factors...
2025-04-17 22:28:41,332 - INFO - Fama-French factors loaded
2025-04-17 22:28:41,332 - INFO - Processing factor data...
2025-04-17 22:28:41,335 - INFO - Factor data processed
2025-04-17 22:28:41,335 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:41,335 - INFO - 
Training Period:
2025-04-17 22:28:41,339 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:41,346 - INFO - 
Testing Period:
2025-04-17 22:28:41,350 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:41,357 - INFO - Loading macro and market data...
2025-04-17 22:28:41,358 - INFO - Loading existing macro data...
2025-04-17 22:28:41,368 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:41,368 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:41,371 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:41,372 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:41,372 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:41,373 - INFO - Loading existing macro data...
2025-04-17 22:28:41,381 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:41,382 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:41,385 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:41,385 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:41,385 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:41,386 - INFO - Loading existing market data...
2025-04-17 22:28:41,390 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:41,391 - INFO - Loading existing market data...
2025-04-17 22:28:41,393 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:41,394 - INFO - Macro and market data loaded
2025-04-17 22:28:41,394 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:41,394 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:41,394 - INFO - Loading existing macro data...
2025-04-17 22:28:41,404 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:41,404 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:41,406 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:41,406 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:41,407 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:41,407 - INFO - Loading existing market data...
2025-04-17 22:28:41,410 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:41,423 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:41,423 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:41,424 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:41,424 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:41,425 - INFO - Loading existing macro data...
2025-04-17 22:28:41,435 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:41,435 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:41,439 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:41,439 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:41,439 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:41,440 - INFO - Loading existing market data...
2025-04-17 22:28:41,444 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:41,452 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:41,453 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:41,453 - INFO - Test data prepared
2025-04-17 22:28:41,453 - INFO - Storing data...
2025-04-17 22:28:41,454 - INFO - Aligning data indices...
2025-04-17 22:28:41,455 - INFO - Data indices aligned
2025-04-17 22:28:41,455 - INFO - Data preparation completed
2025-04-17 22:28:41,455 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:41,455 - INFO - Training models...
2025-04-17 22:28:41,455 - INFO - Starting model training...
2025-04-17 22:28:41,456 - INFO - Training regime classifier...
2025-04-17 22:28:41,456 - INFO - Training HMM model...
2025-04-17 22:28:41,627 - WARNING - Model is not converging.  Current: 6604.339029599374 is not greater than 21507.42426409928. Delta is -14903.085234499908
2025-04-17 22:28:41,627 - INFO - HMM model training completed
2025-04-17 22:28:41,811 - INFO - Model training completed
2025-04-17 22:28:41,813 - INFO - Model training completed
2025-04-17 22:28:41,813 - INFO - Initializing portfolio weights...
2025-04-17 22:28:41,814 - INFO - Portfolio weights initialized
2025-04-17 22:28:41,814 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:41,816 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:41,820 - INFO - Generated 41 regime predictions
2025-04-17 22:28:41,820 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:41,824 - INFO - Found 4 unique regimes
2025-04-17 22:28:41,824 - INFO - Processing regime 0...
2025-04-17 22:28:41,825 - INFO - Regime 0: 11 samples
2025-04-17 22:28:41,825 - INFO - Processing regime 1...
2025-04-17 22:28:41,826 - INFO - Regime 1: 14 samples
2025-04-17 22:28:41,826 - INFO - Processing regime 3...
2025-04-17 22:28:41,827 - INFO - Regime 3: 10 samples
2025-04-17 22:28:41,827 - INFO - Processing regime 4...
2025-04-17 22:28:41,827 - INFO - Regime 4: 10 samples
2025-04-17 22:28:41,827 - INFO - Training portfolio optimizer...
2025-04-17 22:28:41,828 - INFO - Training autoencoder regime optimizer...
2025-04-17 22:28:41,828 - INFO - Training autoencoder for regime 0 with 11 samples
2025-04-17 22:28:41,949 - INFO - Training autoencoder for regime 1 with 14 samples
2025-04-17 22:28:42,069 - WARNING - No samples found for regime 2
2025-04-17 22:28:42,070 - INFO - Training autoencoder for regime 3 with 10 samples
2025-04-17 22:28:42,189 - INFO - Training autoencoder for regime 4 with 10 samples
2025-04-17 22:28:42,309 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:42,309 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:42,323 - INFO - Portfolio optimization completed
2025-04-17 22:28:42,324 - INFO - Initializing backtester...
2025-04-17 22:28:42,329 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:42,330 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:42,330 - INFO - Running backtest...
2025-04-17 22:28:42,331 - INFO - Starting backtest...
2025-04-17 22:28:42,331 - INFO - Calculating portfolio returns...
2025-04-17 22:28:42,331 - INFO - Calculating portfolio returns...
2025-04-17 22:28:42,333 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:42,333 - INFO - Calculating performance metrics...
2025-04-17 22:28:42,333 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:42,333 - INFO - Calculating metrics...
2025-04-17 22:28:42,335 - INFO - Performance metrics calculation completed
2025-04-17 22:28:42,336 - INFO - Backtest completed
2025-04-17 22:28:42,336 - INFO - Backtest completed
2025-04-17 22:28:42,336 - INFO - Strategy execution completed
2025-04-17 22:28:42,338 - ERROR - Error running hmm with autoencoder_regime and 5 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:42,339 - INFO - 
Running strategy with hmm classifier, autoencoder_regime optimizer, and 7 regimes
2025-04-17 22:28:42,339 - INFO - Initializing strategy...
2025-04-17 22:28:42,339 - INFO - Initializing FactorTimingStrategy with hmm model and autoencoder_regime optimizer
2025-04-17 22:28:42,340 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:42,340 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:28:42,340 - INFO - Running strategy...
2025-04-17 22:28:42,340 - INFO - Starting strategy execution...
2025-04-17 22:28:42,340 - INFO - Preparing training and testing data...
2025-04-17 22:28:42,340 - INFO - Starting data preparation...
2025-04-17 22:28:42,340 - INFO - Loading Fama-French factors...
2025-04-17 22:28:42,349 - INFO - Fama-French factors loaded
2025-04-17 22:28:42,349 - INFO - Processing factor data...
2025-04-17 22:28:42,351 - INFO - Factor data processed
2025-04-17 22:28:42,351 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:42,352 - INFO - 
Training Period:
2025-04-17 22:28:42,355 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:42,362 - INFO - 
Testing Period:
2025-04-17 22:28:42,366 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:42,373 - INFO - Loading macro and market data...
2025-04-17 22:28:42,374 - INFO - Loading existing macro data...
2025-04-17 22:28:42,384 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:42,384 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:42,387 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:42,387 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:42,388 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:42,389 - INFO - Loading existing macro data...
2025-04-17 22:28:42,398 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:42,399 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:42,402 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:42,402 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:42,402 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:42,404 - INFO - Loading existing market data...
2025-04-17 22:28:42,407 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:42,408 - INFO - Loading existing market data...
2025-04-17 22:28:42,411 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:42,411 - INFO - Macro and market data loaded
2025-04-17 22:28:42,411 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:42,412 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:42,412 - INFO - Loading existing macro data...
2025-04-17 22:28:42,422 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:42,423 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:42,425 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:42,425 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:42,426 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:42,427 - INFO - Loading existing market data...
2025-04-17 22:28:42,430 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:42,444 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:42,444 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:42,444 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:42,444 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:42,446 - INFO - Loading existing macro data...
2025-04-17 22:28:42,457 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:42,457 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:42,460 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:42,461 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:42,461 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:42,462 - INFO - Loading existing market data...
2025-04-17 22:28:42,467 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:42,477 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:42,477 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:42,477 - INFO - Test data prepared
2025-04-17 22:28:42,478 - INFO - Storing data...
2025-04-17 22:28:42,478 - INFO - Aligning data indices...
2025-04-17 22:28:42,479 - INFO - Data indices aligned
2025-04-17 22:28:42,480 - INFO - Data preparation completed
2025-04-17 22:28:42,480 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:42,480 - INFO - Training models...
2025-04-17 22:28:42,480 - INFO - Starting model training...
2025-04-17 22:28:42,481 - INFO - Training regime classifier...
2025-04-17 22:28:42,481 - INFO - Training HMM model...
2025-04-17 22:28:42,658 - WARNING - Model is not converging.  Current: 6604.335530239133 is not greater than 21252.701274313542. Delta is -14648.36574407441
2025-04-17 22:28:42,658 - INFO - HMM model training completed
2025-04-17 22:28:42,834 - INFO - Model training completed
2025-04-17 22:28:42,836 - INFO - Model training completed
2025-04-17 22:28:42,836 - INFO - Initializing portfolio weights...
2025-04-17 22:28:42,836 - INFO - Portfolio weights initialized
2025-04-17 22:28:42,836 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:42,838 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:42,842 - INFO - Generated 41 regime predictions
2025-04-17 22:28:42,842 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:42,846 - INFO - Found 4 unique regimes
2025-04-17 22:28:42,846 - INFO - Processing regime 0...
2025-04-17 22:28:42,847 - INFO - Regime 0: 11 samples
2025-04-17 22:28:42,847 - INFO - Processing regime 1...
2025-04-17 22:28:42,847 - INFO - Regime 1: 14 samples
2025-04-17 22:28:42,848 - INFO - Processing regime 3...
2025-04-17 22:28:42,848 - INFO - Regime 3: 10 samples
2025-04-17 22:28:42,848 - INFO - Processing regime 4...
2025-04-17 22:28:42,849 - INFO - Regime 4: 10 samples
2025-04-17 22:28:42,849 - INFO - Training portfolio optimizer...
2025-04-17 22:28:42,849 - INFO - Training autoencoder regime optimizer...
2025-04-17 22:28:42,849 - INFO - Training autoencoder for regime 0 with 11 samples
2025-04-17 22:28:42,971 - INFO - Training autoencoder for regime 1 with 14 samples
2025-04-17 22:28:43,091 - WARNING - No samples found for regime 2
2025-04-17 22:28:43,091 - INFO - Training autoencoder for regime 3 with 10 samples
2025-04-17 22:28:43,210 - INFO - Training autoencoder for regime 4 with 10 samples
2025-04-17 22:28:43,335 - WARNING - No samples found for regime 5
2025-04-17 22:28:43,335 - WARNING - No samples found for regime 6
2025-04-17 22:28:43,336 - INFO - Portfolio optimizer training completed
2025-04-17 22:28:43,336 - INFO - Optimizing portfolio weights...
2025-04-17 22:28:43,351 - INFO - Portfolio optimization completed
2025-04-17 22:28:43,351 - INFO - Initializing backtester...
2025-04-17 22:28:43,357 - INFO - Loaded risk-free rate from FF5 data
2025-04-17 22:28:43,357 - INFO - RF rate range: 0.0000% to 0.4800%
2025-04-17 22:28:43,358 - INFO - Running backtest...
2025-04-17 22:28:43,358 - INFO - Starting backtest...
2025-04-17 22:28:43,358 - INFO - Calculating portfolio returns...
2025-04-17 22:28:43,359 - INFO - Calculating portfolio returns...
2025-04-17 22:28:43,360 - INFO - Calculated 41 portfolio returns
2025-04-17 22:28:43,360 - INFO - Calculating performance metrics...
2025-04-17 22:28:43,360 - INFO - Starting performance metrics calculation...
2025-04-17 22:28:43,361 - INFO - Calculating metrics...
2025-04-17 22:28:43,363 - INFO - Performance metrics calculation completed
2025-04-17 22:28:43,363 - INFO - Backtest completed
2025-04-17 22:28:43,363 - INFO - Backtest completed
2025-04-17 22:28:43,364 - INFO - Strategy execution completed
2025-04-17 22:28:43,366 - ERROR - Error running hmm with autoencoder_regime and 7 regimes: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 77, in run_parameter_grid
    test_predictions = strategy.regime_classifier.predict(test_X)
  File "C:\Users\ye\Desktop\factor_timing\classifier\regime_classifier.py", line 272, in predict
    X_scaled = self.scaler.transform(X)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\preprocessing\_data.py", line 1062, in transform
    X = validate_data(
        self,
    ...<6 lines>...
        ensure_all_finite="allow-nan",
    )
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2919, in validate_data
    _check_feature_names(_estimator, X, reset=reset)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\sklearn\utils\validation.py", line 2777, in _check_feature_names
    raise ValueError(message)
ValueError: The feature names should match those that were passed during fit.
Feature names seen at fit time, yet now missing:
- momentum
- volatility

2025-04-17 22:28:43,367 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 3 regimes
2025-04-17 22:28:43,367 - INFO - Initializing strategy...
2025-04-17 22:28:43,367 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 22:28:43,367 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:43,368 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:28:43,368 - INFO - Running strategy...
2025-04-17 22:28:43,368 - INFO - Starting strategy execution...
2025-04-17 22:28:43,368 - INFO - Preparing training and testing data...
2025-04-17 22:28:43,369 - INFO - Starting data preparation...
2025-04-17 22:28:43,369 - INFO - Loading Fama-French factors...
2025-04-17 22:28:43,377 - INFO - Fama-French factors loaded
2025-04-17 22:28:43,377 - INFO - Processing factor data...
2025-04-17 22:28:43,380 - INFO - Factor data processed
2025-04-17 22:28:43,380 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:43,380 - INFO - 
Training Period:
2025-04-17 22:28:43,384 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:43,391 - INFO - 
Testing Period:
2025-04-17 22:28:43,395 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:43,401 - INFO - Loading macro and market data...
2025-04-17 22:28:43,402 - INFO - Loading existing macro data...
2025-04-17 22:28:43,412 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:43,413 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:43,416 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:43,416 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:43,416 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:43,417 - INFO - Loading existing macro data...
2025-04-17 22:28:43,426 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:43,426 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:43,429 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:43,430 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:43,430 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:43,431 - INFO - Loading existing market data...
2025-04-17 22:28:43,434 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:43,435 - INFO - Loading existing market data...
2025-04-17 22:28:43,438 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:43,438 - INFO - Macro and market data loaded
2025-04-17 22:28:43,438 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:43,438 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:43,439 - INFO - Loading existing macro data...
2025-04-17 22:28:43,448 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:43,449 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:43,451 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:43,452 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:43,452 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:43,453 - INFO - Loading existing market data...
2025-04-17 22:28:43,456 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:43,470 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:43,470 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:43,470 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:43,470 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:43,471 - INFO - Loading existing macro data...
2025-04-17 22:28:43,482 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:43,482 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:43,485 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:43,485 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:43,485 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:43,486 - INFO - Loading existing market data...
2025-04-17 22:28:43,489 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:43,498 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:43,498 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:43,499 - INFO - Test data prepared
2025-04-17 22:28:43,499 - INFO - Storing data...
2025-04-17 22:28:43,499 - INFO - Aligning data indices...
2025-04-17 22:28:43,500 - INFO - Data indices aligned
2025-04-17 22:28:43,501 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:28:43,501 - INFO - Data preparation completed
2025-04-17 22:28:43,501 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:43,501 - INFO - Training models...
2025-04-17 22:28:43,502 - INFO - Starting model training...
2025-04-17 22:28:43,502 - INFO - Training regime classifier...
2025-04-17 22:28:43,502 - INFO - Training HMM model...
2025-04-17 22:28:43,704 - INFO - HMM model training completed
2025-04-17 22:28:43,883 - INFO - Training neural portfolio optimizer...
2025-04-17 22:28:43,884 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:28:43,884 - INFO - Model training completed
2025-04-17 22:28:43,885 - INFO - Model training completed
2025-04-17 22:28:43,885 - INFO - Initializing portfolio weights...
2025-04-17 22:28:43,886 - INFO - Portfolio weights initialized
2025-04-17 22:28:43,886 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:43,888 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:43,893 - INFO - Generated 41 regime predictions
2025-04-17 22:28:43,893 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:43,897 - INFO - Found 4 unique regimes
2025-04-17 22:28:43,898 - INFO - Processing regime 0...
2025-04-17 22:28:43,898 - INFO - Regime 0: 4 samples
2025-04-17 22:28:43,898 - INFO - Processing regime 1...
2025-04-17 22:28:43,899 - INFO - Regime 1: 16 samples
2025-04-17 22:28:43,899 - INFO - Processing regime 3...
2025-04-17 22:28:43,900 - INFO - Regime 3: 9 samples
2025-04-17 22:28:43,900 - INFO - Processing regime 4...
2025-04-17 22:28:43,901 - INFO - Regime 4: 16 samples
2025-04-17 22:28:43,901 - INFO - Training portfolio optimizer...
2025-04-17 22:28:43,901 - ERROR - Error running hmm with neural and 3 regimes: mat1 and mat2 shapes cannot be multiplied (45x5 and 8x64)
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 361, in run_strategy
    self.portfolio_optimizer.train(train_factors, target_weights)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\optimizer\portfolio_optimizer.py", line 128, in train
    predictions = self.model(features_tensor)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\Desktop\factor_timing\optimizer\portfolio_optimizer.py", line 141, in forward
    x = torch.relu(self.fc1(x))
                   ~~~~~~~~^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\linear.py", line 125, in forward
    return F.linear(input, self.weight, self.bias)
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: mat1 and mat2 shapes cannot be multiplied (45x5 and 8x64)
2025-04-17 22:28:43,903 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 5 regimes
2025-04-17 22:28:43,903 - INFO - Initializing strategy...
2025-04-17 22:28:43,903 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 22:28:43,903 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:43,903 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:28:43,904 - INFO - Running strategy...
2025-04-17 22:28:43,904 - INFO - Starting strategy execution...
2025-04-17 22:28:43,904 - INFO - Preparing training and testing data...
2025-04-17 22:28:43,904 - INFO - Starting data preparation...
2025-04-17 22:28:43,904 - INFO - Loading Fama-French factors...
2025-04-17 22:28:43,914 - INFO - Fama-French factors loaded
2025-04-17 22:28:43,914 - INFO - Processing factor data...
2025-04-17 22:28:43,916 - INFO - Factor data processed
2025-04-17 22:28:43,916 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:43,916 - INFO - 
Training Period:
2025-04-17 22:28:43,920 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:43,927 - INFO - 
Testing Period:
2025-04-17 22:28:43,931 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:43,940 - INFO - Loading macro and market data...
2025-04-17 22:28:43,941 - INFO - Loading existing macro data...
2025-04-17 22:28:43,951 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:43,951 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:43,954 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:43,954 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:43,954 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:43,955 - INFO - Loading existing macro data...
2025-04-17 22:28:43,965 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:43,965 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:43,968 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:43,968 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:43,969 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:43,970 - INFO - Loading existing market data...
2025-04-17 22:28:43,973 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:43,974 - INFO - Loading existing market data...
2025-04-17 22:28:43,977 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:43,977 - INFO - Macro and market data loaded
2025-04-17 22:28:43,977 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:43,977 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:43,978 - INFO - Loading existing macro data...
2025-04-17 22:28:43,987 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:43,987 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:43,989 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:43,990 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:43,990 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:43,991 - INFO - Loading existing market data...
2025-04-17 22:28:43,994 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:44,006 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:44,006 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:44,007 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:44,007 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:44,008 - INFO - Loading existing macro data...
2025-04-17 22:28:44,017 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:44,017 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:44,020 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:44,020 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:44,020 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:44,021 - INFO - Loading existing market data...
2025-04-17 22:28:44,024 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:44,033 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:44,034 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:44,034 - INFO - Test data prepared
2025-04-17 22:28:44,034 - INFO - Storing data...
2025-04-17 22:28:44,035 - INFO - Aligning data indices...
2025-04-17 22:28:44,036 - INFO - Data indices aligned
2025-04-17 22:28:44,036 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:28:44,037 - INFO - Data preparation completed
2025-04-17 22:28:44,037 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:44,037 - INFO - Training models...
2025-04-17 22:28:44,037 - INFO - Starting model training...
2025-04-17 22:28:44,037 - INFO - Training regime classifier...
2025-04-17 22:28:44,037 - INFO - Training HMM model...
2025-04-17 22:28:44,241 - INFO - HMM model training completed
2025-04-17 22:28:44,425 - INFO - Training neural portfolio optimizer...
2025-04-17 22:28:44,425 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:28:44,425 - INFO - Model training completed
2025-04-17 22:28:44,427 - INFO - Model training completed
2025-04-17 22:28:44,427 - INFO - Initializing portfolio weights...
2025-04-17 22:28:44,427 - INFO - Portfolio weights initialized
2025-04-17 22:28:44,428 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:44,430 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:44,434 - INFO - Generated 41 regime predictions
2025-04-17 22:28:44,434 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:44,438 - INFO - Found 4 unique regimes
2025-04-17 22:28:44,438 - INFO - Processing regime 0...
2025-04-17 22:28:44,439 - INFO - Regime 0: 4 samples
2025-04-17 22:28:44,439 - INFO - Processing regime 1...
2025-04-17 22:28:44,440 - INFO - Regime 1: 16 samples
2025-04-17 22:28:44,440 - INFO - Processing regime 3...
2025-04-17 22:28:44,440 - INFO - Regime 3: 9 samples
2025-04-17 22:28:44,441 - INFO - Processing regime 4...
2025-04-17 22:28:44,441 - INFO - Regime 4: 16 samples
2025-04-17 22:28:44,441 - INFO - Training portfolio optimizer...
2025-04-17 22:28:44,442 - ERROR - Error running hmm with neural and 5 regimes: mat1 and mat2 shapes cannot be multiplied (45x5 and 8x64)
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 361, in run_strategy
    self.portfolio_optimizer.train(train_factors, target_weights)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\optimizer\portfolio_optimizer.py", line 128, in train
    predictions = self.model(features_tensor)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\Desktop\factor_timing\optimizer\portfolio_optimizer.py", line 141, in forward
    x = torch.relu(self.fc1(x))
                   ~~~~~~~~^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\linear.py", line 125, in forward
    return F.linear(input, self.weight, self.bias)
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: mat1 and mat2 shapes cannot be multiplied (45x5 and 8x64)
2025-04-17 22:28:44,444 - INFO - 
Running strategy with hmm classifier, neural optimizer, and 7 regimes
2025-04-17 22:28:44,444 - INFO - Initializing strategy...
2025-04-17 22:28:44,444 - INFO - Initializing FactorTimingStrategy with hmm model and neural optimizer
2025-04-17 22:28:44,444 - INFO - Initialized BaseRegimeClassifier with 5 regimes
2025-04-17 22:28:44,444 - INFO - Initialized HMMRegimeClassifier with 5 regimes
2025-04-17 22:28:44,445 - INFO - Running strategy...
2025-04-17 22:28:44,445 - INFO - Starting strategy execution...
2025-04-17 22:28:44,445 - INFO - Preparing training and testing data...
2025-04-17 22:28:44,445 - INFO - Starting data preparation...
2025-04-17 22:28:44,445 - INFO - Loading Fama-French factors...
2025-04-17 22:28:44,454 - INFO - Fama-French factors loaded
2025-04-17 22:28:44,454 - INFO - Processing factor data...
2025-04-17 22:28:44,456 - INFO - Factor data processed
2025-04-17 22:28:44,456 - INFO - 
Factor Returns Summary (in decimal):
2025-04-17 22:28:44,456 - INFO - 
Training Period:
2025-04-17 22:28:44,460 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  72.000000  72.000000  72.000000  72.000000  72.000000
mean    0.009000  -0.002390  -0.003132   0.001429  -0.002057
std     0.034268   0.025209   0.025297   0.014796   0.015346
min    -0.095700  -0.045500  -0.047900  -0.038700  -0.032600
25%    -0.001000  -0.021150  -0.019225  -0.006475  -0.012950
50%     0.010950   0.002550  -0.005150   0.003650  -0.003900
75%     0.026800   0.009950   0.007125   0.009350   0.005300
max     0.084000   0.070700   0.082100   0.034700   0.036900
2025-04-17 22:28:44,466 - INFO - 
Testing Period:
2025-04-17 22:28:44,470 - INFO -           Mkt-RF        SMB        HML        RMW        CMA
count  60.000000  60.000000  60.000000  60.000000  60.000000
mean    0.010582  -0.001545  -0.000152   0.006287   0.000443
std     0.054485   0.035034   0.046867   0.026354   0.029893
min    -0.133900  -0.082400  -0.138800  -0.047900  -0.072000
25%    -0.024400  -0.026075  -0.026050  -0.014925  -0.018525
50%     0.016750  -0.004050  -0.004300   0.005850  -0.005950
75%     0.046900   0.018425   0.029125   0.023475   0.014325
max     0.136500   0.082800   0.128000   0.072700   0.077400
2025-04-17 22:28:44,477 - INFO - Loading macro and market data...
2025-04-17 22:28:44,478 - INFO - Loading existing macro data...
2025-04-17 22:28:44,487 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:44,488 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:44,490 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:44,491 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:44,491 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:44,492 - INFO - Loading existing macro data...
2025-04-17 22:28:44,501 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:44,501 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:44,504 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:44,504 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:44,504 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:44,505 - INFO - Loading existing market data...
2025-04-17 22:28:44,509 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:44,509 - INFO - Loading existing market data...
2025-04-17 22:28:44,512 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:44,513 - INFO - Macro and market data loaded
2025-04-17 22:28:44,513 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:44,513 - INFO - Preparing training data for regime classification...
2025-04-17 22:28:44,514 - INFO - Loading existing macro data...
2025-04-17 22:28:44,523 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:44,523 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:44,525 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:44,526 - INFO - Loaded macro data with 72 rows and 3 columns
2025-04-17 22:28:44,526 - INFO - Date range: 2014-01-01 00:00:00 to 2019-12-01 00:00:00
2025-04-17 22:28:44,527 - INFO - Loading existing market data...
2025-04-17 22:28:44,530 - INFO - Loaded existing market data with 1509 rows
2025-04-17 22:28:44,543 - INFO - Training class distribution: {0: np.int64(808), 2: np.int64(215), 3: np.int64(211), 4: np.int64(173), 1: np.int64(129)}
2025-04-17 22:28:44,543 - INFO - Prepared training data with 1536 samples
2025-04-17 22:28:44,544 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:44,544 - INFO - Preparing test data for regime classification...
2025-04-17 22:28:44,545 - INFO - Loading existing macro data...
2025-04-17 22:28:44,554 - WARNING - US corporate credit spread file not found
2025-04-17 22:28:44,554 - WARNING - 10-year Treasury rate file not found
2025-04-17 22:28:44,557 - INFO - Saved combined macro data to C:\Users\ye\Desktop\factor_timing\data\combined_macro_data.csv
2025-04-17 22:28:44,558 - INFO - Loaded macro data with 60 rows and 3 columns
2025-04-17 22:28:44,558 - INFO - Date range: 2020-01-01 00:00:00 to 2024-12-01 00:00:00
2025-04-17 22:28:44,559 - INFO - Loading existing market data...
2025-04-17 22:28:44,563 - INFO - Loaded existing market data with 1257 rows
2025-04-17 22:28:44,573 - INFO - Test class distribution: {4: np.int64(1061), 1: np.int64(102), 2: np.int64(86), 3: np.int64(27)}
2025-04-17 22:28:44,573 - INFO - Prepared test data with 1276 samples
2025-04-17 22:28:44,574 - INFO - Test data prepared
2025-04-17 22:28:44,574 - INFO - Storing data...
2025-04-17 22:28:44,574 - INFO - Aligning data indices...
2025-04-17 22:28:44,575 - INFO - Data indices aligned
2025-04-17 22:28:44,576 - INFO - Updated neural optimizer input size to 8
2025-04-17 22:28:44,576 - INFO - Data preparation completed
2025-04-17 22:28:44,576 - INFO - Prepared data - Train shape: (45, 5), Test shape: (41, 5)
2025-04-17 22:28:44,576 - INFO - Training models...
2025-04-17 22:28:44,576 - INFO - Starting model training...
2025-04-17 22:28:44,577 - INFO - Training regime classifier...
2025-04-17 22:28:44,577 - INFO - Training HMM model...
2025-04-17 22:28:44,752 - WARNING - Model is not converging.  Current: 6604.332742761141 is not greater than 21103.699436208757. Delta is -14499.366693447617
2025-04-17 22:28:44,753 - INFO - HMM model training completed
2025-04-17 22:28:44,932 - INFO - Training neural portfolio optimizer...
2025-04-17 22:28:44,932 - INFO - Neural portfolio optimizer training completed
2025-04-17 22:28:44,932 - INFO - Model training completed
2025-04-17 22:28:44,934 - INFO - Model training completed
2025-04-17 22:28:44,934 - INFO - Initializing portfolio weights...
2025-04-17 22:28:44,934 - INFO - Portfolio weights initialized
2025-04-17 22:28:44,934 - INFO - Generating regime predictions for test period...
2025-04-17 22:28:44,936 - INFO - Test features shape after alignment: (41, 8)
2025-04-17 22:28:44,939 - INFO - Generated 41 regime predictions
2025-04-17 22:28:44,939 - INFO - Calculating regime-specific returns...
2025-04-17 22:28:44,943 - INFO - Found 4 unique regimes
2025-04-17 22:28:44,943 - INFO - Processing regime 0...
2025-04-17 22:28:44,943 - INFO - Regime 0: 11 samples
2025-04-17 22:28:44,944 - INFO - Processing regime 1...
2025-04-17 22:28:44,944 - INFO - Regime 1: 14 samples
2025-04-17 22:28:44,944 - INFO - Processing regime 3...
2025-04-17 22:28:44,945 - INFO - Regime 3: 10 samples
2025-04-17 22:28:44,945 - INFO - Processing regime 4...
2025-04-17 22:28:44,946 - INFO - Regime 4: 10 samples
2025-04-17 22:28:44,946 - INFO - Training portfolio optimizer...
2025-04-17 22:28:44,947 - ERROR - Error running hmm with neural and 7 regimes: mat1 and mat2 shapes cannot be multiplied (45x5 and 8x64)
Traceback (most recent call last):
  File "C:\Users\ye\Desktop\factor_timing\select_strategy.py", line 63, in run_parameter_grid
    strategy_results = strategy.run_strategy()
  File "C:\Users\ye\Desktop\factor_timing\main.py", line 361, in run_strategy
    self.portfolio_optimizer.train(train_factors, target_weights)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\Desktop\factor_timing\optimizer\portfolio_optimizer.py", line 128, in train
    predictions = self.model(features_tensor)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\Desktop\factor_timing\optimizer\portfolio_optimizer.py", line 141, in forward
    x = torch.relu(self.fc1(x))
                   ~~~~~~~~^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\ye\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.13_qbz5n2kfra8p0\LocalCache\local-packages\Python313\site-packages\torch\nn\modules\linear.py", line 125, in forward
    return F.linear(input, self.weight, self.bias)
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: mat1 and mat2 shapes cannot be multiplied (45x5 and 8x64)
2025-04-17 22:28:44,948 - ERROR - No valid results obtained from parameter grid search
2025-04-17 22:28:44,948 - ERROR - No valid results obtained from parameter grid search
2025-04-17 22:28:44,949 - INFO - Factor timing strategy optimization completed
